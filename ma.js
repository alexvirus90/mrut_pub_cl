function RagChart(t,e,n,s){function o(t){var e=(""+t).replace(/[^0-9\.]/gi,""),i=parseFloat(e),n="number"==typeof i&&i!=+i;return n?0:i}var r=e,a=n,l=void 0==typeof s?{}:s,h=new Number,c=["green","yellow","red"],u="";this.init=function(){l&&l.rgaLength?(h=l.rgaLength,u=100/h,u=' style="height:'+u+'%;"'):h=3,l&&l.rga&&(c=l.rga),this.render()},this.render=function(){var e="";l&&"figsOnly"==l.type?(e+=this.renderFigs(),e+=this.renderLabels()):(e+=this.renderBars(),e+=this.renderFigs(),e+=this.renderLabels()),$(t).html(e)},this.renderBars=function(){for(var t='<div class="rag-bars"><ul>',e=0;h>e;e++)if(l&&l.customColor)t+='<li style="height: '+o(r[e])+'%"><div class="rag-bars-bar" style="background-color: '+l.customColor[e]+';"></div></li>';else{if(void 0==c[e])var i="mb-missing";else var i=c[e];t+='<li style="height: '+o(r[e])+'%"><div class="rag-bars-bar '+i+' mb"></div></li>'}return t+="</ul></div>"},this.renderFigs=function(){var t="";l&&l.postfix&&(t=l.postfix);var e="";l&&"figsOnly"==l.type&&(e="rag-figs-only");for(var i='<div class="rag-figs '+e+'"><ul>',n=0;h>n;n++)if(l&&l.customColor)i+="<li"+u+'><div class="rag-figs-fig"><p style="color: '+l.customColor[n]+';">'+r[n]+t+"</p></div></li>";else{if(void 0==c[n])var s="m-missing";else var s=c[n];i+="<li"+u+'><div class="rag-figs-fig '+s+'"><p>'+r[n]+t+"</p></div></li>"}return i+="</ul></div>"},this.renderLabels=function(){var t="";l&&"figsOnly"==l.type&&(t="rag-txts-only");var e='<div class="rag-txts '+t+'"><ul>';for(i=0;h>i;i++){if(void 0==c[i])var n="m-missing";else var n=c[i];e+="<li"+u+'><div class="rag-txts-txt '+n+'"><p>'+a[i]+"</p></div></li>"}return e+="</ul></div>"},this.init()}function FunnelChart(t,e,i,n){var s=e,o=i,r=void 0==typeof n?{}:n,a=s.length,l=s[0],h=[],c=.5/a,u="";this.init=function(){for(var t=0;a>t;t++)h[t]=100*(s[t]/l),h[t]=h[t]<1&&h[t]>0?1:Math.round(h[t]);if(r&&r.customColors)if(r.customColors.length!=a&&r.customColors.length>1)for(var t=0;a>t;t++)r.customColors[t]||(r.customColors[t]="#f6f6f6");else for(var t=0;a>t;t++)r.customColors[t]=r.customColors[0];for(var t=0;a>t;t++)void 0==o[t]&&(o[t]="-");u="height: "+100/a+"%;",this.render()},this.update=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=null==t[i]?s[i]:t[i];s=e,l=s[0],this.init()},this.render=function(){var e="";r&&"right"==r.layout?(e+=this.renderFigs(),e+=this.renderFunnel()):(e+=this.renderFunnel(),e+=this.renderFigs()),$(t).html(e)},this.renderFunnel=function(){if(r&&"right"==r.layout)var t="d-funnels-right";else var t="d-funnels-left";for(var e='<div class="d-funnels '+t+'"><ul>',i=0;a>i;i++)os=r&&r.barOpacity&&0!=r.barOpacity?.6+i*c:1,e+=r&&r.customColors?'<li style="'+u+" width:"+h[i]+"%; opacity:"+os+"; background-color: "+r.customColors[i]+'"></li>':'<li class="green mb" style="'+u+" width:"+h[i]+"%; opacity:"+os+'"></li>';return e+="</ul></div>"},this.renderFigs=function(){for(var t='<div class="d-figstxts"><ul>',e=0;a>e;e++)os=r&&r.metricOpacity&&0!=r.metricOpacity?.6+e*c:1,t+=r&&r.customColors?'<li style="'+u+'"><div><p class="metric" style="opacity:'+os+"; color:"+r.customColors[e]+'">'+s[e]+"</p></div><div><p>"+o[e]+"</p></div></li>":'<li style="'+u+'"><div><p class="metric green mc" style="opacity:'+os+'">'+s[e]+"</p><p>"+o[e]+"</p></div></li>";return t+="</ul></div>"},this.init()}var PRODUCTION=!0;require(["common"],function(){requirejs.config({paths:{jqueryui:LIBS_PATH+"jquery/jquery.ui",jcolorbox:LIBS_PATH+"colorbox/jquery.colorbox",opentip:LIBS_PATH+"jquery/opentip-jquery.min",bootstrap:LIBS_PATH+"bootstrap/bootstrap",timepicker:LIBS_PATH+"bootstrap/timepicker/bootstrap-timepicker",carousel:LIBS_PATH+"bootstrap/carousel/bootstrap-carousel",charts:LIBS_PATH+"charts",EasyPieChart:LIBS_PATH+"charts/easyPieChart/easypiechart",datatables:LIBS_PATH+"grids/DataTables/js/jquery.dataTables","datatables-scroller":LIBS_PATH+"grids/DataTables/extensions/Scroller/js/dataTables.scroller.min",moment:LIBS_PATH+"moment/moment-with-locales-cropped",fileDownload:LIBS_PATH+"jquery/fileDownload/jquery.fileDownload",validation:LIBS_PATH+"jquery/validation/jquery.validate",colresize:LIBS_PATH+"jquery/colresize/jquery.colresize",util:COMMON_PATH+"util/util",geo:COMMON_PATH+"geo/geo",maps:COMMON_PATH+"maps",geozones:COMMON_PATH+"geozones"},shim:{jqueryui:["jquery"],jcolorbox:["jquery"],bootstrap:["jquery"],timepicker:["jquery"],carousel:["jquery"],fileDownload:["jquery"]}}),requirejs(["_common/AppModule"],function(t){"undefined"==typeof UNSUPPORTED_BROWSER&&new t({id:"app"})})}),define("_common/main",function(){}),define("bootstrap",["jquery"],function(t){!function(t){t(function(){t.support.transition=function(){var t=function(){var t,e=document.createElement("bootstrap"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in i)if(void 0!==e.style[t])return i[t]}();return t&&{end:t}}()})}(window.jQuery),+function(t){function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}function i(i){i&&3===i.which||(t(s).remove(),t(o).each(function(){var n=t(this),s=e(n),o={relatedTarget:this};s.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(s[0],i.target)||(s.trigger(i=t.Event("hide.bs.dropdown",o)),i.isDefaultPrevented()||(n.attr("aria-expanded","false"),s.removeClass("open").trigger(t.Event("hidden.bs.dropdown",o)))))}))}function n(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new r(this)),"string"==typeof e&&n[e].call(i)})}var s=".dropdown-backdrop",o='[data-toggle="dropdown"]',r=function(e){t(e).on("click.bs.dropdown",this.toggle)};r.VERSION="3.3.7",r.prototype.toggle=function(n){var s=t(this);if(!s.is(".disabled, :disabled")){var o=e(s),r=o.hasClass("open");if(i(),!r){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",a)),n.isDefaultPrevented())return;s.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},r.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var s=e(n),r=s.hasClass("open");if(!r&&27!=i.which||r&&27==i.which)return 27==i.which&&s.find(o).trigger("focus"),n.trigger("click");var a=" li:not(.disabled):visible a",l=s.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=n,t.fn.dropdown.Constructor=r,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",o,r.prototype.toggle).on("keydown.bs.dropdown.data-api",o,r.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",r.prototype.keydown)}(t),+function(t){function e(e){return this.each(function(){var n=t(this),s=n.data("bs.tab");s||n.data("bs.tab",s=new i(this)),"string"==typeof e&&s[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var s=i.find(".active:last a"),o=t.Event("hide.bs.tab",{relatedTarget:e[0]}),r=t.Event("show.bs.tab",{relatedTarget:s[0]});if(s.trigger(o),e.trigger(r),!r.isDefaultPrevented()&&!o.isDefaultPrevented()){var a=t(n);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){s.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:s[0]})})}}},i.prototype.activate=function(e,n,s){function o(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),s&&s()}var r=n.find("> .active"),a=s&&t.support.transition&&(r.length&&r.hasClass("fade")||!!n.find("> .fade").length);r.length&&a?r.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),r.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var s=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',s).on("click.bs.tab.data-api",'[data-toggle="pill"]',s)}(t)}),define("_common/nls/common",{root:{save:"Save",apply:"Apply",saveAndClose:"Save and close","delete":"delete",edit:"edit",copy:"Copy",build:"generate",rebuild:"regenerate",params:"Options",hasBeenBuilt:"is generated",connection:"connection",coords:"coordinates",coordinatesTime:"Fixture time",place:"Location",lat:"Latitude",lon:"Longitude",address:"address",addresses:"addresses",addressNotFound:"The address is not found",canNotFindCoordsByAddress:"Failed to define coordinates by the address.",specifyAddress:"Enter an address",distanceToAddress:"Distance to an address",country:"Country",region:"Area",city:"Town",street:"Street",house:"House",building:"Building",phone:"phone",phones:"phones",comments:"comment",info:"information",service:"service",row:"row",or:"or",and:"and",add:"add",change:"change",choose:"Select","new":"new",next:"next",prev:"previous",current:"current",nextShort:"next",prevShort:"prev",another:"another",nearest:"nearest",all:"all",online:"Online",filteredOnly:"Filter",print:"Print",pleaseWait:"Please wait",fromDate:"from",from:"from",rangeFrom:"from",to:"to",upto:"to",till:"to",attention:"Warning",hide:"Hide",hideAll:"Hide all",show:"show",showAll:"Show all",switchState:"State",switchedOn:"Switched on",switchedOnShort:"On",switchedOff:"Switched off",switchedOffShort:"Off",switchOn:"Switch on",switchOff:"Switch off",notChoosed:"Is not selected",notEntered:"Is not specified",confirmation:"Confirmation",cancel:"Cancel",submit:"Submit","continue":"Continue",done:"Done",toDate:"to",dataForDate:"Data for",name:"name",type:"type",color:"color",power:"power",powerOn:"Main",powerOff:"Reserve",hardware:"Equipment",objImage:"Image",changeImage:"Change image",chooseImage:"Select image",chooseObjectImage:"Select an object image",objServing:"Maintenance",objServed:"Is maintained",objNotServed:"Is not maintained",user:"user",username:"username",login:"login",password:"password",demo:"Demo",accountRightsAreLimited:"The rights to your account are limited.",simCard:"SIM card",GSMConnection:"Connection",GlonassGPS:"GLONASS/GPS",settings:"settings",object:"object",objects:"objects",objectsLabels:["object","objects"],objectsLabels1:["object","objects"],byObject:"by object",bySelectedObjects:"by selected objects",byNSelectedObjects:"by #n# #type#",selectedObjects:"Objects selected",nObjectsSelected:["#n# object is selected","#n# objects selected"],allObjects:"All objects",noWatchedObjectsMsg:"There are no objects selected",noWatchedVehiclesMsg:"There are no vehicles selected.",noWatchedStationaryMsg:"There are no real estates selected.",openObjectCard:"Open an object card",objectCardLoadingFailed:"Failed to open an object card",showExtentedInfo:"Show extended information",showShortedInfo:"Show compact information",mapObjSearchMode:"Mode of search at the map",mapObjSearchMode1:"The found object becomes the only monitored object",mapObjSearchMode2:"The found object is added to monitored objects",objectsOnMap:"Objects at the map",objectsViewType:"Objects View",infoInBaloon:"Info in baloon",vehicles:"Vehicles",vehiclesLabels:["vehicle","vehicles"],byVehiclesLabels:["vehicle","vehicles"],stationary:"Real Estate",stationaryLabels:["real estate","real estates"],byStationaryLabels:["real estate","real estates"],objectTitleType:"Title",objProps:"Object properties",objState:"Object state",objStatus:"Status",objStatuses:{1:"Is maintained",0:"Is not maintained",2:"Service"},objName:"Object name",objTitle:"Object title",objIdNumber:"Object ID",objIdNumberShort:"ID",objModel:"Brand/model",licenseNumber:"Number plate",objYear:"YOM",objVin:"VIN",objGroup:"Object's group",objServerPassword:"Connection password",objOwner:"Owner",objOwnerPass:"Owners's password",objContract:"Contract number",objContractDate:"Date of contract",objHardwareType:"Device type",objHardwareUnknown:"Unknown",objExtraHardware:"Additional equipment",objPhoto:"Object photo",objTrackReading:"Track reading",noPictures:"There are no images yet",addPicture:"Add an image",deletePicture:"Delete an image",enterComment:"Enter a comment",upload:"Load",uploadFailed:"Failed to upload the file.",confirmDeletePicture:"Please confirm deletion of the image",pictureHadBeenDeleted:"The image was deleted",noCaption:"No title",addObject:"Add an object",addChildGroup:"Add a subgroup",errAddGroupBefore:"To add an object, create at &nbsp;least one&nbsp;group.",setupDevice:"Setup a device",errSetupLoad:"Unable to open setup window due to a server error.",find:"find",sortBy:"Sort by:",search:"Search",searchResultLable:"Found",searchNoResults:"No results",tableNoRecords:"There are no records",searchObjects:"Search for objects",searchZones:"Search for zones",nothingFoundByYourRequest:"Your search returned no results",findClosestObjects:"Search for the nearest objects",inRadius:"within a radius",anotherRadius:"Another radius",noObjectsFound:"There are no objects found",report:"report",reports:"reports",reportParams:"Report options",buildReport:"Generate a report",buildReportByGroup:"Generate a report by group",geozone:"geofence",geozones:"geofences",pois:"Points",traffic:"Traffic",error:"Error",commonSuccessHeader:"All right",group:"Group",groups:"Groups",addGroup:"Add group",renameGroup:"Rename group",enterGroupName:"Enter group name",distance:"Distance",maxDistance:"Maximum distance",runDistance:"Mileage",close:"close",clear:"clear",reload:"reload",clearMap:"Clear the map",printMap:"Print the map",autozoom:"Selfscaling",zoomIn:"Zoom in",zoomOut:"Zoom out",mapPanUp:"Up",mapPanDown:"Down",mapPanLeft:"Left",mapPanRight:"Right",mapRuler:"Ruler",mapName:"#name# map",map:"map",showOnMap:"Show on the map",showOnYandexMap:"Open on Yandex maps",showOnGoogleMap:"Open on Google maps",satMapName:"#name# satellite",hybridMapName:"#name# hybrid",landMapName:"#name# terrain",transMapName:"#name# vehicles",wikiMapName:"#name# wiki",specialMapName:"Additional map",removeFromMap:"Remove from the map",zoomToObject:"Zoom to the object",routeBuilding:"Route generating",routeHere:"Route to this point",buildRoute:"Generate the route",routeNoTrafficAlert:"Route is generated without traffic jams",errCanNotBuildRoute:"Unable to generate the route",errNoRoutingOnMap:"Unable to generate the route on the selected map.",andMore:"and more #q# #l#",logout:"logout",chart:"chart",showChart:"Show chart",hideChart:"Hide chart",deviceInput:"Input",deviceOut:"Output",setDefaults:"set defaults",switchOffAll:"disable all",notRecommended:"is not recommended",editHistory:"Changes history",settingsField:"Setting",settingOldValue:"Old value",settingNewValue:"New value",reportsNames:{run:"Mileage report",runShort:"Mileage report (short)",movepark:"Driving and parking report",speeding:"Speeding report",acceleration:"Aggressive driving report",flow:"Fuel consumption report",fuel:"Fuel level report",fuel2:"Fuel level report (form 2)",device:"Machine report",device2:"Object operation report",can:"Object operation report (CAN)",zoneviz:"Geofence visit report",zoneex:"Geofence leaving report",zonevizcount:"Geofence visit count report",pass:"Passenger traffic report",lostfix:"Fixture loss report",objst:"Object state report",alertssummary:"Events and alarms summary report",alerts:"Events and alarms per object",temperature:"Temperature abuse report",voltage:"Voltage report",engspeed:"Engine RPM report",discretes:"Discrete parameters report",distance:"Report on distance to objects",guardscallcount:"Quantitative report of RRT object visits"},track:"track",tracks:"tracks",clearTracksList:"Clear the list",showTrackPoints:"Show track points",colorTracks:"Color tracks based on speed",tracksCountText:"#n# generated",showTrack:"Show the track",hideTrack:"Hide the track",zoomToTrack:"Zoom to the track",removeTrack:"Remove the track",removeEmptyTracks:"Remove empty tracks",showHideTrack:"Show/Hide",buildTrack:"Generate the track",buildTrackByGroup:"Generate the track based on the group",pleaseBuildOneTrack:"Generate at least one track please",severalTracksShownLeaveOneForZone:"The map shows several tracks. Leave only one please to build the zone",tooManyObjectsForTracks:"Too many objects selected. It is possible to build tracks using no more than #max# objects",trackPlayer:"Track player",trackPlaySpeed:"Play speed",msgCanNotBuildTracks:"Track generating failed due to the server error. Please try again later.",speedLessThan:"The speed is less than",speedFrom:"The speed is from",speedGreaterThan:"The speed is more than",saveAsPlt:"Save to file (.plt)",parks:"Stops",parkBegin:"start",parkEnd:"end",parkTime:"stop time",discret:"discrete",discretSensor:"Sensor",discretSensors:"Discrete sensors",discretParam:"Parameter",analogue:"analog",analogueSensor:"Sensor",sensorValue:"Sensor readings",dataSource:"Data source",calculatedValue:"Expected value",noDataForDay:"There is no data for this day",noDataForPeriod:"There is no data for this period",noDataForObject:"There is no data for this object",dateInstall:"Installation date",placeInstall:"Installation location",installer:"Installer",imeiChangeConfirm:{msg:"Removing or changing the IMEI-code in object's properties will disconnect the device from the system.",hdr:"Change IMEI?"},additionalInfo:"Additional information",currentState:"State",turnOff:"Turn off",turnOn:"Turn on",auto:"auto",autoMode:'"Auto" mode',history:"Chronology",alarm:"alarm",withAlarm:"with alarm",alarms:"alarms",alarmsLabels:["alarm","alarms"],objWithAlarms:"with alarms",totalAlarms:"Total alarms",alarmsShort:"Alarms",commentAlarmResolved:"Alarm is resolved",commentAllAlarmsOnObjResolved:"All alarms at the object are resolved",commentAllAlarmsResolved:"All alarms are resolved",alert:"event",alerts:"events",alertEvent:"Event",objectAlertsAndLog:"Events and log",alertsLog:"Event list",turnOnAlertsLog:"Turn on the event list",alertsLogDepth:"Maximum number of entries",alertsLogFilters:"Filters",stopAlertsLog:"Stop",resumeAlertsLog:"Resume",objArea:"Area",objAreas:"Areas",objAreasLabels:["area","areas"],allObjAreas:"All areas",chooseObjAreas:"Select areas",objAreaNum:"Area №",objAreaName:"Area name",objAreaNoName:"No name",zeroAreaName:"System",objAreaComment:"Note",alarmAreas:"Areas with alarm",notAlarmAreas:"Areas without alarms",faultAreas:"Fault areas",faultAreasShort:"Fault",notFaultAreas:"Fault-free areas",guardedAreas:"Armed areas",notGuardedAreas:"Disarmed areas",objAreaStateNorm:"Normal",objZone:"Zone",objZones:"Zones",objInputZoneKey:"Input/Zone/Key",chooseObjZones:"Select zones",allZonesOfSelectedAreas:"All zones of selected areas",objZoneStateNorm:"Normal",objZoneStateViolated:"Violation",withAlarms:"With alarms",alarmWindowHeader:"There are unprocessed alarms on #n# #t#",alarmWindowHeaderNoAlarms:"There are no unprocessed alarms",turnOffSound:"Mute",turnOnSound:"Unmute",chooseAction:"Select an action",addComment:"Add comment",resolveAlarm:"Resolve alarm",noAlarms:"There are no alarms",guarded:"Armed",guardedPartly:"Armed partly",makeGuarded:"Arm",notGuarded:"Disarmed",notGuardedMulti:"Disarmed",makeNotGuarded:"Disarm",hasFault:"Fault",noFault:"Fault-free",viewAndResolveFaults:"View and resolve faults",viewFaults:"View faults",faultsList:"Fault list",resolveAllFaults:"Resolve all",resolveFault:"Resolve",resolveFaultConfirm:"Resolve the fault?",resolveAllFaultsConfirm:"Resolve all faults and close the list?",noFaultsOnObject:"No faults on the object.",systemFaultOrAlarm:"System",alertCode:"Event Code",alertMessage:"Event name",alertsGroup:"Event group",alertsGroups:"Event groups",allAlertsGroups:"All event groups",chooseAlertsGroups:"Select event groups",totalAlerts:"Total event",allAlerts:"All events",allAlertsOnObject:"All events on the object",allAlertsOffSelectedGroups:"All events of selected groups",chooseAlerts:"Select events",timeOfCreation:"Creation time",timeOfReceive:"Receipt time",sensorZoneKey:"Zone/Key",sensorZoneKeyName:"Zone/Key name",key:"key",gsmProvider:"Operator",objectStateScan:"Object state scan",stateScanProcessing:"State scanning",deviceAreaStates:{1:"alarm",2:"near fire alarm",4:"fire",8:"fault",16:"entrance delay",32:"exit delay"},deviceZoneStates:{1:"alarm zone",2:"near fire alarm",4:"fire",8:"fault",16:"entrance delay",64:"bypass",128:"battery discharge",256:"short circuit",512:"breakage",1024:"offline",2048:"tamper alarm",4096:"radio sensor's Primary Zone violation",8192:"radio sensor's Secondary  Zone violation"},objectStateScanResult:"Device status scan results",objectStateScanIdNotFound:"Scan ID not found",objectStateScanFailed:"Scan failed",noAreasData:"No data on Areas",rrTeam:"Rapid response team",rrTeamShort:"RRT",rrTeams:"Rapid response teams",loadingRRTGroupsList:"Loading list of RRT teams",allRRT:"All RRTs",addRRT:"Add RRT",addRRTGroup:"Add group of RRT objects",noRRT:"No RRT found",noRRTGroups:"No RRT object group found",selectedRRTGroups:"Selected object groups",deleteRRTGroupConfirmMsg:"Remove object group from RRT list?",searchRRT:"Search RRT",repeatSearch:"Search again",rrtCall:"Call",rrtNoCall:"No call",rrtCalled:"Call sent to RRT",rrtCallTime:"Called at",rrtArriveTime:"Arrived at",rrtCallAccepted:"Call accepted",rrtCallNotAccepted:"Call not accepted",rrtCancelCall:"Cancel RRT call",rrtCancelCallShort:"Cancel call",rrtCompleteCall:"Complete RRT call",rrtCompleteCallShort:"Complete call",rrtPerson:"Responsible person",rrtLocation:"Location",noRRTboundToObject:"No RRT assigned to the stationary object",rrtSelectManually:"Choose manually",responsible:{header:"Responsible",pass1:"Identification password",pass2:"Forced password",persons:{key:"Key №",name:"Name",phone1:"Phone 1",phone2:"Phone 2",comment:"Note",addNew:"Add a person",noData:"There are no responsible persons specified"},copyList:"Copy persons list",copyConfirm:"<p>Copy list of responsible persons from this object to selected objects?</p><p><strong>Attention!</strong> List of responsible persons will be replaced for selected objects.</p>"},notification:"Notification",notifications:"Notifications",newNotification:"New notification",addNotification:"Add notification",notificationName:"Notification name",notificationSwitchedOn:"Switched on",notificationSwitchedOff:"Switched off",notificationLimitReached:"Notification number limit reached.",notificationAddressesHelp:"Addresses should be comma separated or each address should be on new line.",notificationPhonesHelp:"Phone numbers can contain only numbers. Phone number length is from 9 to 15 characters including country code.",errNotificationName:"Enter the notification name.",errNotificationAddresses:"Enter at least one address.",errNotificationAddressesIncorrect:"One or more addresses are invalid.",errNotificationMaxAddresses:"Maximum #max# addresses are allowed.",errNotificationAlerts:"Select at least one event group or one event ContactID.",errNotificationAreas:"Select at least one area.",notificationDeleteConfirm:{msg:"Are you sure you want to delete notification #name#?",hdr:"Delete the notification?"},video:"Video",videoOnline:"Online",videoArchive:"Archive",camera:"Camera",connect:"Connect",cameraOnObject:"Video from the object #title#",noCamerasAdded:"No camera was added",cameraNotSelected:"Is not selected",addCamera:"Add a camera",cameraNameIvideon:"Camera name at Ivideon",errCamerasListLoad:"Failed to load camera list. Check account login and password on&nbsp;Ivideon.",errCamerasListEmpty:"No camera assigned to you account on&nbsp;Ivideon.",errCameraNotAvailable:"Previously assigned camera unavailable.",errCameraNotOnlineOrNotPaid:"Connection to the camera could not be established",errCameraPreview:"Failed to load the image.",showCamera:"Show video",showCameras:"Show cameras",showVideo:"Show video",ivideonInfo:"<p>GeoRitm allows image streaming from&nbsp;cameras, connected to&nbsp;the cloud service iVideon.</p><p>Enter login&nbsp;and&nbsp;password for&nbsp;the connection to&nbsp;the service&nbsp;iVideon in&nbsp;the object&nbsp;card and&nbsp;select the camera, which image&nbsp;will be&nbsp;available in&nbsp;properties of this&nbsp;object</p>.",videoLoadingArchive:"Archive loading...",errVideoArchiveLoading:"Failed to load archive entries data.",errVideoStreamNotFound:"Failed to establish a connection",errVideoUnknownError:"Unknown error",lname:"Last name",mname:"Middle name",namesOrder:["fname","mname","lname"],technician:"Technician",technicians:"Technicians",technicianNoRecords:"There are no technicians yet",technicianAdd:"Add technician",technicianCreate:"New technician",errEnterTechnicianName:"Please enter first name",errEnterTechnicianLastName:"Please enter last name",errEnterTechnicianNotSelected:"Select technician to switch into service",technicianDeleteConfirm:{msg:"Are you sure you want to delete the technician?",hdr:"Delete technician?"},technicianNotSelected:"Technician is not selected",technicianNotSet:"Technician is not assigned.",setServiceStatusForPeriod:"Temporary switching to service",setServiceStatusPeriodLabel:"For #n# #l#",setServiceStatusNoLimit:"Permanently",setServiceStatusTillDate:"To specified date",serviceLeftTime:"#t# left",errors:{callServerFailed:"Failed to load data for a server",serverConnection:"Failed to set a connection.<br />To try again press Ok.",serverConnectionTimeout:"Timeout of a server response.<br />To try again press Ok.",localStorageUnavailable:"Saving of the application data at a browser is not available. The operation can not be continued.",iosPrivateMode:'If You use Apple device, ensure that the "Private access" mode is enabled.',canNotSave:"Failed to save data",noSelectedZones:"There are no zones selected. Please select at least one geofence in the tree",startOrEndTimeIsAbsent:"Start time and/or end time is not specified",startMoreTnanEndTime:"Start time value should be less than end time value",startMoreTnanNow:"Start time value should be less than current time value",invalidTimeEntered:"Invalid time is specified",invalidDateOrTimeEntered:"Invalid data and/or time is specified",addAtLeastOneGroup:"Add at least one group.",invalidIMEI:"Incorrect IMEI is specified."},whichLabels:function(t){return 1==t?0:1},time:"time",date:"date",period:"period",hours:"hours",minutes:"minutes",hoursLabels:["hour","hours"],hours24Labels:["day","days"],minutesLabels:["minute","minutes"],secondsLabels:["second","second"],week:"week",week1:"week",curWeek:"Current week",prevWeek:"Previous week",month:"month",timeAgo:"#t# ago",timeFormat:"Time format",DateTime:{longFormat:"d.m.Y H:i:s",shortFormat:"d.m H:i",timeFormat:"H:i:s",inputDateFormat:"dd.mm.yy",indexes:{y:0,o:1,w:2,d:3,h:4,m:5,s:6},labels:["year","month","week","day","hour","minute","second","day"],labels1:["years","months","weeks","days","hours","minutes","seconds","days"],labels2:["years","months","weeks","days","hours","minutes","seconds","days"],labelsCompact:["yr","mo","w","d","h","min","s","d"],labelsCompact1:["yr","mo","w","d","h","min","s","d"],today:"Today",yesturday:"Yesterday",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fro","Sat"],firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],prepareDateField:function(t){var e=t.split(".");return e[2]+"-"+e[1]+"-"+e[0]}},speed:"speed",sec:"sec",km:"km",m:"m",kmh:"km/h",square:"square",perimeter:"perimeter",radius:"radius",course:"heading",altitude:"Altitude",ha:"ha",na:"na",ms2:"m/s^2",noData:"no data",hour:"h.",minute:"min.",areYouSure:"Are you sure?",cancelChanges:"Cancel the changes?",allChangesCancel:"If you cancel them, all completed changes will be lost.",msgConnectionLost:"Connection is lost",msgReconnecting:"Reconnection with the server",exitFromSystem:"Exit the system",msgServerConnectionLost:"Connection with the server is lost or session is timed out. You need to authorise again.",msgConfirmAction:"Please confirm the action",msgRedirectToLoginPage:"You will be automatically redirected to the authorisation page",clearUserSettings:"Clear all settings",clearUserSettingsConfirm:"All local settings will be cleared.<br />Then the page will be automatically reloaded.",commonSearchError:"Failed to complete a search. Please try again later.",totalLabel:"Total",chooseFile:"Select a file",showDashboard:"Show dashboard",showDashboardInfo:"Click the logo to show the dashboard",pleaseSelectFile:"Specify the file please",errorFileSize:"File size should not excess #s#",sort:"Filtering",sortByName:"By name",sortByObjectExtId:"By ID",emptyTreeMsg:"You do not have objects yet",successCommandSent:"The command is submitted to the server. It may take a few minutes to complete.",errorCommandSending:"Failed to submit the command.",commandSent:"The command is submitted"},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("_common/nls/ru-ru/common",{save:"Сохранить",apply:"Применить",saveAndClose:"Сохранить и закрыть","delete":"удалить",edit:"изменить",copy:"Копировать",build:"построить",rebuild:"перестроить",params:"Параметры",hasBeenBuilt:"построен",connection:"соединение",coords:"координаты",coordinatesTime:"Время фиксации",place:"Место",lat:"Широта",lon:"Долгота",address:"адрес",addresses:"адреса",addressNotFound:"Адрес не найден",canNotFindCoordsByAddress:"Не удалось определить координаты по адресу.",specifyAddress:"Введите адрес",distanceToAddress:"Расстояние до адреса",country:"Страна",region:"Район",city:"Нас. пункт",street:"Улица",house:"Дом",building:"Корпус",phone:"телефон",phones:"телефоны",comments:"комментарий",info:"информация",service:"сервис",row:"ряд",or:"или",and:"и",add:"добавить",change:"сменить",choose:"выбрать","new":"новый",next:"следующий",prev:"предыдущий",current:"текущий",nextShort:"след.",prevShort:"пред.",another:"другой",nearest:"ближайший",all:"все",online:"Онлайн",filteredOnly:"Фильтр",print:"Печать",pleaseWait:"Пожалуйста, подождите",fromDate:"с",from:"из",rangeFrom:"от",to:"до",upto:"до",till:"до",attention:"Внимание",hide:"Скрыть",hideAll:"Скрыть все",show:"показать",showAll:"Показать все",switchState:"Статус",switchedOn:"Включен",switchedOnShort:"Вкл.",switchedOff:"Отключен",switchedOffShort:"Откл.",switchOn:"Включить",switchOff:"Отключить",notChoosed:"Не выбран",notEntered:"Не указан",confirmation:"Подтверждение",cancel:"Отмена",submit:"Подтвердить","continue":"Продолжить",done:"Готово",toDate:"до",dataForDate:"Данные на",name:"имя",type:"тип",color:"цвет",power:"питание",powerOn:"Основное",powerOff:"Резервное",hardware:"Оборудование",objImage:"Картинка",changeImage:"Сменить картинку",chooseImage:"Выбрать картинку",chooseObjectImage:"Выберите картинку объекта",objServing:"Обслуживание",objServed:"Обслуживается",objNotServed:"Не обслуживается",user:"пользователь",username:"имя пользователя",login:"логин",password:"пароль",demo:"Демо",accountRightsAreLimited:"Права вашей учетной записи ограничены.",simCard:"SIM-карта",GSMConnection:"Соединение",GlonassGPS:"ГЛОНАСС/GPS",settings:"настройки",object:"объект",objects:"объекты",objectsLabels:["объект","объекта","объектов"],objectsLabels1:["объекте","объектах","объектах"],byObject:"по объекту",bySelectedObjects:"по выбранным объектам",byNSelectedObjects:"по #n# #type#",selectedObjects:"Выбрано объектов",nObjectsSelected:["Выбран #n# объект","Выбрано #n# объекта","Выбрано #n# объектов"],allObjects:"Все объекты",noWatchedObjectsMsg:"Не выбрано ни одного объекта",noWatchedVehiclesMsg:"Не выбрано ни одного мобильного объекта.",noWatchedStationaryMsg:"Не выбрано ни одного стационарного объекта.",openObjectCard:"Открыть карточку объекта",objectCardLoadingFailed:"Не удалось открыть карточку объекта",showExtentedInfo:"Показать расширенную информацию",showShortedInfo:"Показать краткую информацию",mapObjSearchMode:"Режим работы поиска на карте",mapObjSearchMode1:"Найденный объект становится единственным наблюдаемым",mapObjSearchMode2:"Найденный объект добавляется к наблюдаемым",objectsOnMap:"Объекты на карте",objectsViewType:"Вид объектов",infoInBaloon:"Информация в выноске",vehicles:"Мобильные объекты",vehiclesLabels:["мобильный объект","мобильных объекта","мобильных объектов"],byVehiclesLabels:["мобильному объекту","мобильным объектам"],stationary:"Стационарные объекты",stationaryLabels:["стационарный объект","стационарных объекта","стационарных объектов"],byStationaryLabels:["стационарному объекту","стационарным объектам"],objectTitleType:"Обозначение",objProps:"Свойства объекта",objState:"Состояние объекта",objStatus:"Статус",objStatuses:{1:"Обслуживается",0:"Не обслуживается",2:"Сервис"},objName:"Имя объекта",objTitle:"Наименование объекта",objIdNumber:"ID-номер объекта",objIdNumberShort:"ID-номер",objModel:"Марка/модель",licenseNumber:"Гос. номер",objYear:"Год выпуска",objVin:"VIN-номер",objGroup:"Группа объекта",objServerPassword:"Пароль на подключение к серверу",objOwner:"Владелец",objOwnerPass:"Ключ/Пароль",objContract:"Номер договора",objContractDate:"Дата договора",objHardwareType:"Тип прибора",objHardwareUnknown:"Не определен",objExtraHardware:"Дополнительное оборудование",objPhoto:"Фото объекта",objTrackReading:"Чтение трека",noPictures:"Пока нет ни одного изображения",addPicture:"Добавить изображение",deletePicture:"Удалить изображение",enterComment:"Введите комментарий",upload:"Загрузить",uploadFailed:"Не удалось загрузить файл.",confirmDeletePicture:"Уверены что хотите удалить изображение?",pictureHadBeenDeleted:"Изображение было удалено",noCaption:"Без заголовка",addObject:"Добавить объект",addChildGroup:"Добавить подгруппу",errAddGroupBefore:"Чтобы добавить объект, создайте хотя&nbsp;бы одну&nbsp;группу.",setupDevice:"Настроить прибор",errSetupLoad:"Не удается открыть окно настройки из-за ошибки сервера.",find:"найти",sortBy:"Сортировать по:",search:"Поиск",searchResultLable:"Найдено",searchNoResults:"Ничего не найдено",tableNoRecords:"Нет ни одной записи",searchObjects:"Поиск объектов",searchZones:"Поиск зон",nothingFoundByYourRequest:"По Вашему запросу ничего не найдено",findClosestObjects:"Поиск ближайших объектов",inRadius:"в радиусе",anotherRadius:"Другой радиус",noObjectsFound:"Не найдено ни одного объекта",report:"отчет",reports:"отчеты",reportParams:"Параметры отчета",buildReport:"Построить отчет",buildReportByGroup:"Построить отчет по группе",geozone:"геозона",geozones:"геозоны",pois:"Метки",traffic:"Пробки",error:"Ошибка",commonSuccessHeader:"Все в порядке",group:"Группа",groups:"Группы",addGroup:"Добавить группу",renameGroup:"Переименовать группу",enterGroupName:"Введите имя группы",distance:"Расстояние",maxDistance:"Максимальное расстояние",runDistance:"Пробег",close:"закрыть",clear:"очистить",reload:"перезагрузить",clearMap:"Очистить карту",printMap:"Печать карты",autozoom:"Автомасштабирование",zoomIn:"Приблизить",zoomOut:"Отдалить",mapPanUp:"Вверх",mapPanDown:"Вниз",mapPanLeft:"Влево",mapPanRight:"Вправо",mapRuler:"Линейка",mapName:"Карта #name#",map:"карта",showOnMap:"Показать на карте",showOnYandexMap:"Открыть в Яндекс-картах",showOnGoogleMap:"Открыть в Google-картах",satMapName:"Спутник #name#",hybridMapName:"Гибрид #name#",landMapName:"Рельеф #name#",transMapName:"Транспорт #name#",wikiMapName:"Народная #name#",specialMapName:"Дополнительная карта",removeFromMap:"Убрать с карты",zoomToObject:"Приблизить к объекту",routeBuilding:"Построение маршрута",routeHere:"Маршрут сюда",buildRoute:"Проложить маршрут",routeNoTrafficAlert:"Маршрут построен без учета пробок",errCanNotBuildRoute:"Не удалось проложить маршрут.",errNoRoutingOnMap:"На выбранной карте прокладка маршрута невозможна.",andMore:"и еще #q# #l#",logout:"выйти",chart:"график",showChart:"Показать график",hideChart:"Скрыть график",deviceInput:"Вход",deviceOut:"Выход",setDefaults:"установить по умолчанию",switchOffAll:"отключить все",notRecommended:"не рекомендуется",editHistory:"История изменений",settingsField:"Поле",settingOldValue:"Было",settingNewValue:"Стало",reportsNames:{run:"Отчет по пробегу",runShort:"Отчет по пробегу (краткий)",movepark:"Отчет по движению-стоянкам",speeding:"Отчет по превышению скорости",acceleration:"Отчет по агрессивности вождения",flow:"Отчет по расходу топлива",fuel:"Отчет по уровню топлива",fuel2:"Отчет по уровню топлива (Форма 2)",device:"Отчет по механизмам",device2:"Отчет по работе объектов",can:"Отчет по работе объектов (CAN)",zoneviz:"Отчет по посещению геозон",zoneex:"Отчет по выходам из геозон",zonevizcount:"Отчет по количеству посещений геозон",pass:"Отчет по пассажиропотоку",lostfix:"Отчёт по потере фиксации",objst:"Отчёт по состоянию объектов",alertssummary:"Сводный отчет по событиям и тревогам",alerts:"События и тревоги по объекту",temperature:"Отчет по нарушению температурных режимов",voltage:"Отчет по напряжению",engspeed:"Отчет по оборотам двигателя",discretes:"Отчет по дискретным параметрам",distance:"Отчет по расстоянию до объектов",guardscallcount:"Отчет по количеству выездов ГБР на объекты"},track:"трек",tracks:"треки",clearTracksList:"Очистить список",showTrackPoints:"Показывать точки треков",colorTracks:"Раскрашивать треки в зависимости от скорости",tracksCountText:"Построено #n#",showTrack:"Показать трек",hideTrack:"Скрыть трек",zoomToTrack:"Масштабировать по треку",removeTrack:"Удалить трек",removeEmptyTracks:"Удалить пустые треки",showHideTrack:"Показать/Скрыть",buildTrack:"Построить трек",buildTrackByGroup:"Построить трек по группе",pleaseBuildOneTrack:"Пожалуйста, постройте хотя бы один трек",severalTracksShownLeaveOneForZone:"На карте показано несколько треков. Пожалуйста, оставьте только один, чтобы построить зону",tooManyObjectsForTracks:"Выбрано много объектов. Одновременное построение треков возможно не более чем по #max# объектам",trackPlayer:"Проигрыватель трека",trackPlaySpeed:"Скорость проигравания",msgCanNotBuildTracks:"Не удалось построить треки в связи с ошибкой сервера. Пожалуйста попробуйте позже.",speedLessThan:"Скорость менее",speedFrom:"Скорость от",speedGreaterThan:"Скорость более",saveAsPlt:"Сохранить в файл (.plt)",parks:"Остановки",parkBegin:"начало",parkEnd:"окончание",parkTime:"время остановки",discret:"дискретный",discretSensor:"Датчик",discretSensors:"Дискретные датчики",discretParam:"Параметр",analogue:"аналоговый",analogueSensor:"Датчик",sensorValue:"Показания датчика",dataSource:"Источник данных",calculatedValue:"Расчетное значение",noDataForDay:"Нет данных за этот день",noDataForPeriod:"Нет данных за этот период",noDataForObject:"По этому объекту нет данных",dateInstall:"Дата установки",placeInstall:"Место установки",installer:"Установщик",imeiChangeConfirm:{msg:"Удаление или изменение IMEI-кода в свойствах объекта приведет к отключению от системы действующего прибора.",hdr:"Изменить IMEI?"},additionalInfo:"Дополнительная информация",currentState:"Состояние",turnOff:"Отключить",turnOn:"Включить",auto:"авто",autoMode:'Режим "Авто"',history:"История",alarm:"тревога",withAlarm:"с тревогой",alarms:"тревоги",objWithAlarms:"с тревогами",totalAlarms:"Всего тревог",alarmsShort:"Трев.",commentAlarmResolved:"Тревога сброшена",commentAllAlarmsOnObjResolved:"Все тревоги на объекте сброшены",commentAllAlarmsResolved:"Все тревоги сброшены",alert:"событие",alerts:"события",alertEvent:"Событие",objectAlertsAndLog:"События и журнал",alertsLog:"Лента событий",turnOnAlertsLog:"Включить ленту событий",alertsLogDepth:"Максимальное количество записей",alertsLogFilters:"Фильтры",stopAlertsLog:"Остановить",resumeAlertsLog:"Возобновить",objArea:"Раздел",objAreas:"Разделы",objAreasLabels:["раздел","раздела","разделов"],allObjAreas:"Все разделы",chooseObjAreas:"Выберите разделы",objAreaNum:"№ раздела",objAreaName:"Наименование раздела",objAreaNoName:"Без названия",zeroAreaName:"Система",objAreaComment:"Примечание",alarmAreas:"Разделы в тревоге",notAlarmAreas:"Разделы без тревог",faultAreas:"Разделы с неисправностями",faultAreasShort:"С неисправностями",notFaultAreas:"Исправные разделы",guardedAreas:"Разделы под охраной",notGuardedAreas:"Разделы снятые с охраны",objAreaStateNorm:"Норма",objZone:"Зона",objZones:"Зоны",objInputZoneKey:"Вход/Зона/Ключ",chooseObjZones:"Выберите зоны",allZonesOfSelectedAreas:"Все зоны выбранных разделов",objZoneStateNorm:"Норма",objZoneStateViolated:"Нарушение",withAlarms:"В тревоге",alarmWindowHeader:"Есть необработанные тревоги на #n# #t#",alarmWindowHeaderNoAlarms:"Необработанных тревог нет",turnOffSound:"Выключить звук",turnOnSound:"Включить звук",chooseAction:"Выбрать действие",addComment:"Добавить комментарий",resolveAlarm:"Сбросить тревогу",noAlarms:"Нет тревог",guarded:"Под охраной",guardedPartly:"Частично под охраной",makeGuarded:"Взять под охрану",notGuarded:"Снят с охраны",notGuardedMulti:"Сняты с охраны",makeNotGuarded:"Снять с охраны",hasFault:"Неисправность",noFault:"Исправен",viewAndResolveFaults:"Просмотр и сброс неисправностей",viewFaults:"Просмотр неисправностей",faultsList:"Список неисправностей",resolveAllFaults:"Сбросить все",resolveFault:"Сбросить",resolveFaultConfirm:"Сбросить неисправность?",resolveAllFaultsConfirm:"Сбросить все неисправности и закрыть список?",noFaultsOnObject:"На объекте нет неисправностей.",systemFaultOrAlarm:"Системная",alertCode:"Код события",alertMessage:"Наименование события",alertsGroup:"Группа событий",alertsGroups:"Группы событий",allAlertsGroups:"Все группы событий",chooseAlertsGroups:"Выберите группы событий",totalAlerts:"Всего событий",allAlerts:"Все события",allAlertsOnObject:"Все события по объекту",allAlertsOffSelectedGroups:"Все события выбранных групп",chooseAlerts:"Выберите события",timeOfCreation:"Время формирования",timeOfReceive:"Время получения",sensorZoneKey:"Зона/Ключ",sensorZoneKeyName:"Наименование зоны/ключа",key:"ключ",gsmProvider:"Оператор",objectStateScan:"Опрос состояния",stateScanProcessing:"Идет опрос состояния",deviceAreaStates:{1:"охранная тревога",2:"возможность пожара",4:"пожар",8:"неисправность",16:"задержка на вход",32:"задержка на выход"},deviceZoneStates:{1:"нарушение охранной зоны",2:"возможность пожара",4:"пожар",8:"неисправность",16:"задержка на вход",64:"обход",128:"разряд батареи",256:"короткое замыкание",512:"обрыв",1024:"нет связи",2048:"тамперный контакт",4096:"нарушение основной зоны радиоизвещателя",8192:"нарушение дополнительной зоны радиоизвещателя"},objectStateScanResult:"Результат опроса состояния прибора",objectStateScanIdNotFound:"Не найден идентификатор вызова",objectStateScanFailed:"Опрос завершился ошибкой",noAreasData:"Нет данных по разделам",rrTeam:"Группа быстрого реагирования",rrTeamShort:"ГБР",rrTeams:"Группы быстрого реагирования",loadingRRTGroupsList:"Загрузка списка групп ГБР",allRRT:"Все ГБР",addRRT:"Добавить ГБР",addRRTGroup:"Добавить группу объектов ГБР",noRRT:"Нет ни одной ГБР",noRRTGroups:"Нет ни одной группы объектов ГБР",selectedRRTGroups:"Выбранные группы объектов",deleteRRTGroupConfirmMsg:"Удалить группу объектов из списка ГБР?",searchRRT:"Поиск ГБР",repeatSearch:"Повторить поиск",rrtCall:"Вызов",rrtNoCall:"Нет вызова",rrtCalled:"Отправлен вызов ГБР",rrtCallTime:"Время вызова",rrtArriveTime:"Время прибытия",rrtCallAccepted:"Вызов принят",rrtCallNotAccepted:"Вызов не принят",rrtCancelCall:"Отмена вызова ГБР",rrtCancelCallShort:"Отменить вызов",rrtCompleteCall:"Завершение вызова ГБР",rrtCompleteCallShort:"Завершить вызов",rrtPerson:"Ответственный",rrtLocation:"Расположение",noRRTboundToObject:"Нет закрепленных за объектом ГБР",rrtSelectManually:"Выбрать вручную",responsible:{header:"Ответственные",pass1:"Пароль для идентификации",pass2:"Пароль под принуждением",persons:{key:"№ ключа",name:"ФИО ответственного лица",phone1:"Телефон 1",phone2:"Телефон 2",comment:"Примечание",addNew:"Добавить ответственного",noData:"Ответственные не указаны"},copyList:"Копировать список ответственных",copyConfirm:"<p>Копировать список ответственных этого объекта в выбранные объекты?</p><p><strong>Внимание!</strong> Список ответственных в выбранных объектах будет замещен.</p>"},notification:"Оповещение",notifications:"Оповещения",newNotification:"Новое оповещение",addNotification:"Добавить оповещение",notificationName:"Имя оповещения",notificationSwitchedOn:"Включено",notificationSwitchedOff:"Отключено",notificationLimitReached:"Достигнуто максимально допустимое количество оповещений.",notificationAddressesHelp:"Адреса следует вводить через запятую или каждый с новой строки.",notificationPhonesHelp:"Номера телефонов могут содержать только цифры, длина каждого номера от 9 до 15 символов, включая код страны.",errNotificationName:"Введите имя оповещения.",errNotificationAddresses:"Введите как минимум один адрес.",errNotificationAddressesIncorrect:"Один или несколько введенных адресов некорректны.",errNotificationMaxAddresses:"Разрешено добавить максимум #max# адресов.",errNotificationAlerts:"Выберите хотя бы одну группу событий или одно событие ContactID.",errNotificationAreas:"Выберите хотя бы один раздел.",notificationDeleteConfirm:{msg:"Вы точно хотите удалить оповещение #name#?",hdr:"Удалить оповещение?"},video:"Видео",videoOnline:"Онлайн",videoArchive:"Архив",camera:"Камера",connect:"Подключиться",cameraOnObject:"Видео с объекта #title#",noCamerasAdded:"Не добавлено ни одной камеры",cameraNotSelected:"Не выбрана",addCamera:"Добавить камеру",cameraNameIvideon:"Имя камеры на Ivideon",errCamerasListLoad:"Не удалось загрузить список камер, проверьте правильность логина и пароля от аккаунта на&nbsp;Ivideon.",errCamerasListEmpty:"К Вашему аккаунту на&nbsp;Ivideon не привязано ни одной камеры.",errCameraNotAvailable:"Ранее привязанная камера не доступна.",errCameraNotOnlineOrNotPaid:"Не удается установить подключение к видеокамере.",errCameraPreview:"Не удалось загрузить изображение.",showCamera:"Показать видео",showCameras:"Показать камеры",showVideo:"Показать видео",ivideonInfo:"<p>GeoRitm обеспечивает трансляцию изображения с&nbsp;видеокамер, подключенных к&nbsp;облачному сервису iVideon.</p><p>Укажите в&nbsp;карточке&nbsp;объекта логин&nbsp;и&nbsp;пароль для&nbsp;подключения к&nbsp;сервису&nbsp;iVideon и&nbsp;выберите видеокамеру, изображение&nbsp;которой будет&nbsp;доступно в&nbsp;свойствах этого&nbsp;объекта</p>.",videoLoadingArchive:"Загрузка архива...",errVideoArchiveLoading:"Не удалось загрузить данные об архивных записях.",errVideoStreamNotFound:"Не удалось установить соединение",lname:"Фамилия",mname:"Отчество",namesOrder:["lname","fname","mname"],technician:"Техник",technicians:"Техники",technicianNoRecords:"Пока нет ни одного техника",technicianAdd:"Добавить техника",technicianCreate:"Новый техник",errEnterTechnicianName:"Введите имя",errEnterTechnicianLastName:"Введите фамилию",errEnterTechnicianNotSelected:"Выберите техника для перевода в сервис",technicianDeleteConfirm:{msg:"Вы точно хотите удалить техника?",hdr:"Удалить техника?"},technicianNotSelected:"Техник не выбран",technicianNotSet:"Техник не назначен.",setServiceStatusForPeriod:"Перевод в сервис на время",setServiceStatusPeriodLabel:"На #n# #l#",setServiceStatusNoLimit:"Бессрочно",setServiceStatusTillDate:"До указанной даты",serviceLeftTime:"осталось #t#",errors:{callServerFailed:"Не удалось получить данные с сервера",serverConnection:"Не удалось установить соединение.<br />Нажмите Ok, чтобы повторить попытку.",serverConnectionTimeout:"Истекло время ожидани ответа сервера.<br />Нажмите Ok, чтобы повторить попытку.",localStorageUnavailable:"В браузере недоступно сохранение данных приложения. Дальнейшая работа невозможна.",iosPrivateMode:'Если Вы используете устройство Apple, проверьте, что режим "Частного доступа" выключен.',canNotSave:"Не удалось сохранить данные",noSelectedZones:"Не выбрано ни одной зоны. Пожалуйста, выберите хотя бы одну в дереве",startOrEndTimeIsAbsent:"Не указано время начала и/или время окончания",startMoreTnanEndTime:"Время начала должно быть меньше, чем время окончания",startMoreTnanNow:"Время начала должно быть меньше текущего времени",invalidTimeEntered:"Введено некорректное время",invalidDateOrTimeEntered:"Введены некорректные даты и/или время",addAtLeastOneGroup:"Добавьте хотя бы одну группу.",invalidIMEI:"Введен некорректный IMEI."},whichLabels:function(t){var e=t%10,i=Math.floor(t%100/10);
	return 1==t?0:e>=2&&4>=e&&1!=i?1:1==e&&1!=i?0:2},time:"время",date:"дата",period:"период",hours:"часы",minutes:"минуты",hours24Labels:["сутки","суток","суток"],hoursLabels:["час","часа","часов"],minutesLabels:["минута","минуты","минут"],secondsLabels:["секунда","секунды","секунд"],week:"неделя",week1:"неделю",curWeek:"Текущая неделя",prevWeek:"Предыдущая неделя",month:"месяц",timeFormat:"Формат времени",timeAgo:"#t# назад",DateTime:{longFormat:"d.m.Y H:i:s",shortFormat:"d.m H:i",timeFormat:"H:i:s",inputDateFormat:"dd.mm.yy",labels:["год","месяц","неделя","день","час","минута","секунда","сутки"],labels1:["года","месяца","недели","дня","часа","минуты","секунды","суток"],labels2:["лет","месяцев","недель","дней","часов","минут","секунд","суток"],labelsCompact:["г.","мес.","нед.","сут","ч","мин","с","сут"],labelsCompact1:["г","мес","нед","сут","час","мин","сек","сут"],today:"Сегодня",yesturday:"Вчера",dayNames:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesShort:["Вос","Пон","Втр","Срд","Чтв","Птн","Сбт"],firstDay:1,monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"]},speed:"скорость",sec:"сек",km:"км",m:"м",kmh:"км/ч",square:"площадь",perimeter:"периметр",radius:"радиус",course:"курс",altitude:"Высота",ha:"га",na:"нд",ms2:"м/с^2",noData:"нет данных",hour:"ч.",minute:"мин",areYouSure:"Вы уверены?",cancelChanges:"Отменить изменения?",allChangesCancel:"В случае отмены все выполненные изменения будут потеряны.",msgConnectionLost:"Соединение потеряно",msgReconnecting:"Восстановление соединения с сервером",exitFromSystem:"Выйти из системы",msgServerConnectionLost:"Потеряно соединение с сервером или истекло время сессии. Необходима повторная авторизация.",msgConfirmAction:"Пожалуйста, подтвердите действие",msgRedirectToLoginPage:"Вы будете автоматически направлены на страницу авторизации",clearUserSettings:"Сбросить все настройки",clearUserSettingsConfirm:"Все локальные настройки будут очищены.<br />После очистки страница перезагрузится автоматически.",commonSearchError:"Не удалось осуществить поиск. Пожалуйста попробуйте еще раз чуть позже.",totalLabel:"Всего",chooseFile:"Выберите файл",showDashboard:"Сводная информация",showDashboardInfo:"Для показа сводной информации нажмите на логотип",pleaseSelectFile:"Пожалуйста укажите файл",errorFileSize:"Размер файла не должен превышать #s#",sort:"Сортировка",sortByName:"По наименованию",sortByObjectExtId:"По ID-номеру",emptyTreeMsg:"У Вас пока нет объектов",successCommandSent:"Команда отправлена на сервер. Ее выполнение может занять несколько минут.",errorCommandSending:"Не удалось отправить команду.",commandSent:"Команда отправлена"}),define("util",["underscore","i18n!_common/nls/common"],function(t,e){function i(e,i,n){var s=function(){};s.prototype=i.prototype,e.prototype=new s,e.prototype.constructor=e,e.superclass=i.prototype;for(var n=t.union(["getInstance","getAncestors"],n||[]),o=n.length;o--;)i[n[o]]&&(e[n[o]]=i[n[o]]);i.__ancestors=i.__ancestors||[],i.__ancestors.push(e)}function n(e,i){t.each(i,function(t,n){!function(t){e[t]=function(){return i[t].apply(this,arguments)}}(n)})}function s(){this.reset()}String.prototype.ucFirst||(String.prototype.ucFirst=function(){return this.charAt(0).toUpperCase()+this.substr(1)}),!Number.prototype.padLeft&&(Number.prototype.padLeft=function(t,e){var i=String(this),n=t-i.length+1;return 0>n?i:Array(n).join(e||"0")+i}),t.extend(Math,{PI2:2*Math.PI,D2R:.017453292519943295,R2D:57.29577951308232,_round:function(t,e){e=parseInt(e),0>e&&(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i},atanh:function(t){return.5*Math.log((1+t)/(1-t))},getSquareDistance:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},getSquareSegmentDistance:function(t,e,i){var n,s=e.x,o=e.y,r=i.x-s,a=i.y-o;return(0!==r||0!==a)&&(n=((t.x-s)*r+(t.y-o)*a)/(r*r+a*a),n>1?(s=i.x,o=i.y):n>0&&(s+=r*n,o+=a*n)),r=t.x-s,a=t.y-o,r*r+a*a},simplifyRadialDistance:function(t,e){var i,n,s=t.length,o=t[0],r=[o];for(i=1;s>i;i++)n=t[i],Math.getSquareDistance(n,o)>e&&(r.push(n),o=n);return o!==n&&r.push(n),r},simplifyDouglasPeucker:function(t,e){var i,n,s,o,r=t.length,a=typeof Uint8Array!=void 0+""?Uint8Array:Array,l=new a(r),h=0,c=r-1,u=[],d=[],p=[];for(l[h]=l[c]=1;c;){for(n=0,i=h+1;c>i;i++)s=Math.getSquareSegmentDistance(t[i],t[h],t[c]),s>n&&(o=i,n=s);n>e&&(l[o]=1,u.push(h),d.push(o),u.push(o),d.push(c)),h=u.pop(),c=d.pop()}for(i=0;r>i;i++)l[i]&&p.push(t[i]);return p},findNearestPoint:function(t,e,i){for(var n=e.length,i=i||1/0,s=0,o=1/0,r=null;n--;)s=Math.sqrt(Math.getSquareDistance(t,e[n])),i>s&&o>s&&(r=n,o=s);return null===r?null:e[r]}}),t.extend(Date,{offsetToString:function(t){return 0==t?"+00:00":(t>0?"+":"-")+Math.floor(Math.abs(t)/60).padLeft(2)+":"+(Math.abs(t)%60).padLeft(2)},format:function(t,i){var n,s,o=this,r=e.DateTime.dayNames,a=e.DateTime.monthNames,l=/\\?(.?)/gi,h=function(t,e){return s[t]?s[t]():e},c=function(t,e){for(t=String(t);t.length<e;)t="0"+t;return t};return s={d:function(){return c(s.j(),2)},D:function(){return s.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return r[s.w()]},N:function(){return s.w()||7},S:function(){var t=s.j(),e=t%10;return 3>=e&&1==parseInt(t%100/10,10)&&(e=0),["st","nd","rd"][e-1]||"th"},w:function(){return n.getDay()},z:function(){var t=new Date(s.Y(),s.n()-1,s.j()),e=new Date(s.Y(),0,1);return Math.round((t-e)/864e5)},W:function(){var t=new Date(s.Y(),s.n()-1,s.j()-s.N()+3),e=new Date(t.getFullYear(),0,4);return c(1+Math.round((t-e)/864e5/7),2)},F:function(){return a[s.n()]},m:function(){return c(s.n(),2)},M:function(){return s.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(s.Y(),s.n(),0).getDate()},L:function(){var t=s.Y();return 0===t%4&0!==t%100|0===t%400},Y:function(){return n.getFullYear()},y:function(){return s.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return s.a().toUpperCase()},g:function(){return s.G()%12||12},G:function(){return n.getHours()},h:function(){return c(s.g(),2)},H:function(){return c(s.G(),2)},i:function(){return c(n.getMinutes(),2)},s:function(){return c(n.getSeconds(),2)},Z:function(){return 60*-n.getTimezoneOffset()},r:function(){return"D, d M Y H:i:s O".replace(l,h)}},this.date=function(t,e){return o=this,n=void 0===e?new Date:e instanceof Date?new Date(e):new Date(e),t.replace(l,h)},this.date(t,i)},sqlFormat:function(t){return this.format("Y-m-d H:i:s",t)},formatSeconds:function(t,i,n){var i=i||!0,s=e.DateTime,n=n||"hms",o=[],r="";if("hms"==n||"dhm"==n){var a=parseInt(t/86400),l=parseInt(t/3600)%24,h=parseInt(t/60)%60,c=Math.round(t%60);a>0&&(r=a+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(a)][3],o.push(r)),l>0&&(r=l+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(l)][4],o.push(r)),h>0&&(r=h+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(h)][5],o.push(r)),"hms"==n&&(r=c?c+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(c)][6]:0==o.join("").length?"0 "+s[i?"labelsCompact":"labels"+e.whichLabels(c)][6]:"",o.push(r))}else if("m"==n){var h=Math.round(100*(t/60))/100;r=h?h+"&nbsp;"+s[i?"labelsCompact":"labels"+e.whichLabels(h)][5]:"",o.push(r)}return o.join(" ")}});var o={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",encode:function(t){if("undefined"!=typeof btoa)return btoa(unescape(encodeURIComponent(t)));for(var e,i,n,s,o,r,a,l="",h=0;h<t.length;)e=t.charCodeAt(h++),i=t.charCodeAt(h++),n=t.charCodeAt(h++),s=e>>2,o=(3&e)<<4|i>>4,r=(15&i)<<2|n>>6,a=63&n,isNaN(i)?r=a=64:isNaN(n)&&(a=64),l=l+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(a);return l},decode:function(t){if("undefined"!=typeof atob)return decodeURIComponent(escape(atob(t)));var e,i,n,s,o,r,a,l="",h=0;for(t=t.replace(/[^A-Za-z0-9\-_\=]/g,"");h<t.length;)s=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),r=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),e=s<<2|o>>4,i=(15&o)<<4|r>>2,n=(3&r)<<6|a,l+=String.fromCharCode(e),64!=r&&(l+=String.fromCharCode(i)),64!=a&&(l+=String.fromCharCode(n));return l}};return s.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,s=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,r=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=s,this.m[2]=o,this.m[3]=r},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,s=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=n,this.m[2]=s,this.m[3]=o},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],s=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,s=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r},getMatrix:function(){return this.m},reset:function(){this.m=[1,0,0,1,0,0]}},{extend:i,include:n,Base64:o,Transform:s,testProp:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}}}),define("_libs/grids/SlickGrid-master/slick.core",["jquery"],function(){function t(){var t=!1,e=!1;this.stopPropagation=function(){t=!0},this.isPropagationStopped=function(){return t},this.stopImmediatePropagation=function(){e=!0},this.isImmediatePropagationStopped=function(){return e}}function e(){var e=[];this.subscribe=function(t){e.push(t)},this.unsubscribe=function(t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},this.notify=function(i,n,s){n=n||new t,s=s||this;for(var o,r=0;r<e.length&&!n.isPropagationStopped()&&!n.isImmediatePropagationStopped();r++)o=e[r].call(s,n,i);return o}}function i(){var t=[];this.subscribe=function(e,i){return t.push({event:e,handler:i}),e.subscribe(i),this},this.unsubscribe=function(e,i){for(var n=t.length;n--;)if(t[n].event===e&&t[n].handler===i)return t.splice(n,1),e.unsubscribe(i),void 0;return this},this.unsubscribeAll=function(){for(var e=t.length;e--;)t[e].event.unsubscribe(t[e].handler);return t=[],this}}function n(t,e,i,n){void 0===i&&void 0===n&&(i=t,n=e),this.fromRow=Math.min(t,i),this.fromCell=Math.min(e,n),this.toRow=Math.max(t,i),this.toCell=Math.max(e,n),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(t,e){return t>=this.fromRow&&t<=this.toRow&&e>=this.fromCell&&e<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function s(){this.__nonDataRow=!0}function o(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function r(){this.__groupTotals=!0,this.group=null}function a(){var t=null;this.isActive=function(e){return e?t===e:null!==t},this.activate=function(e){if(e!==t){if(null!==t)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!e.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!e.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";t=e}},this.deactivate=function(e){if(t!==e)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";t=null},this.commitCurrentEdit=function(){return t?t.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return t?t.cancelCurrentEdit():!0}}var l={Event:e,EventData:t,EventHandler:i,Range:n,NonDataRow:s,Group:o,GroupTotals:r,EditorLock:a,GlobalEditorLock:new a};return o.prototype=new s,o.prototype.equals=function(t){return this.value===t.value&&this.count===t.count&&this.collapsed===t.collapsed&&this.title===t.title},r.prototype=new s,l}),define("_libs/grids/SlickGrid-master/slick.grid",["jquery","_libs/grids/SlickGrid-master/slick.core","css!_libs/grids/SlickGrid-master/slick.grid.css"],function($,Slick,css){function SlickGrid(container,data,columns,options){function init(){if($container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,columnsById={};for(var t=0;t<columns.length;t++){var e=columns[t]=$.extend({},columnDefaults,columns[t]);columnsById[e.id]=t,e.minWidth&&e.width<e.minWidth&&(e.width=e.minWidth),e.maxWidth&&e.width>e.maxWidth&&(e.width=e.maxWidth)}if(options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller),$headers.width(getHeadersWidth()),$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller),$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller),$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),$canvas=$("<div class='grid-canvas' />").appendTo($viewport),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,viewportW=parseFloat($.css($container[0],"width",!0)),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.bind("selectstart.ui",function(t){return $(t.target).is("input,textarea")}),updateColumnCaches(),createColumnHeaders(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.bind("resize.slickgrid",resizeCanvas),$viewport.bind("click",handleClick).bind("scroll",handleScroll),$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave),$headerRowScroller.bind("scroll",handleHeaderRowScroll),$focusSink.add($focusSink2).bind("keydown",handleKeyDown),$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave))}function registerPlugin(t){plugins.unshift(t),t.init(self)}function unregisterPlugin(t){for(var e=plugins.length;e>=0;e--)if(plugins[e]===t){plugins[e].destroy&&plugins[e].destroy(),plugins.splice(e,1);break}}function setSelectionModel(t){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=t,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var t=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),e={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),e}function getHeadersWidth(){for(var t=0,e=0,i=columns.length;i>e;e++){var n=columns[e].width;t+=n}return t+=scrollbarDimensions.width,Math.max(t,viewportW)+1e3}function getCanvasWidth(){for(var t=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,e=0,i=columns.length;i--;)e+=columns[i].width;return options.fullWidthRows?Math.max(e,t):e}function updateCanvasWidth(t){var e=canvasWidth;canvasWidth=getCanvasWidth(),canvasWidth!=e&&($canvas.width(canvasWidth),$headerRow.width(canvasWidth),$headers.width(getHeadersWidth()),viewportHasHScroll=canvasWidth>viewportW-scrollbarDimensions.width),$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),(canvasWidth!=e||t)&&applyColumnWidths()}function disableSelection(t){t&&t.jquery&&t.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var t=1e6,e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,i=$("<div style='display:none' />").appendTo(document.body);;){var n=2*t;if(i.css("height",n),n>e||i.height()!==n)break;t=n}return i.remove(),t}function bindAncestorScrollEvents(){for(var t=$canvas[0];(t=t.parentNode)!=document.body&&null!=t;)if(t==$viewport[0]||t.scrollWidth!=t.clientWidth||t.scrollHeight!=t.clientHeight){var e=$(t);$boundAncestors=$boundAncestors?$boundAncestors.add(e):e,e.bind("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.unbind("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(t,e,i){if(initialized){var n=getColumnIndex(t);if(null!=n){var s=columns[n],o=$headers.children().eq(n);o&&(void 0!==e&&(columns[n].name=e),void 0!==i&&(columns[n].toolTip=i),trigger(self.onBeforeHeaderCellDestroy,{node:o[0],column:s}),o.attr("title",i||"").children().eq(0).html(e),trigger(self.onHeaderCellRendered,{node:o[0],column:s}))}}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(t){var e=getColumnIndex(t),i=$headerRow.children().eq(e);return i&&i[0]}function createColumnHeaders(){function t(){$(this).addClass("ui-state-hover")}function e(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var t=$(this).data("column");t&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:t})}),$headers.empty(),$headers.width(getHeadersWidth()),$headerRow.find(".slick-headerrow-column").each(function(){var t=$(this).data("column");t&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:t})}),$headerRow.empty();for(var i=0;i<columns.length;i++){var n=columns[i],s=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+n.name+"</span>").width(n.width-headerColumnWidthDiff).attr("id",""+uid+n.id).attr("title",n.toolTip||"").data("column",n).addClass(n.headerCssClass||"").appendTo($headers);if((options.enableColumnReorder||n.sortable)&&s.on("mouseenter",t).on("mouseleave",e),n.sortable&&(s.addClass("slick-header-sortable"),s.append("<span class='slick-sort-indicator' />")),trigger(self.onHeaderCellRendered,{node:s[0],column:n}),options.showHeaderRow){var o=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",n).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:o[0],column:n})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(t){if(t.metaKey=t.metaKey||t.ctrlKey,!$(t.target).hasClass("slick-resizable-handle")){var e=$(t.target).closest(".slick-header-column");if(e.length){var i=e.data("column");if(i.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var n=null,s=0;s<sortColumns.length;s++)if(sortColumns[s].columnId==i.id){n=sortColumns[s],n.sortAsc=!n.sortAsc;break}t.metaKey&&options.multiColumnSort?n&&sortColumns.splice(s,1):((t.shiftKey||t.metaKey)&&options.multiColumnSort||(sortColumns=[]),n?0==sortColumns.length&&sortColumns.push(n):(n={columnId:i.id,sortAsc:i.defaultSortAsc},sortColumns.push(n))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(t){return{sortCol:columns[getColumnIndex(t.columnId)],sortAsc:t.sortAsc}})},t):trigger(self.onSort,{multiColumnSort:!1,sortCol:i,sortAsc:n.sortAsc},t)}}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy"),$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:!0,start:function(t,e){$(e.helper).addClass("slick-header-column-active")},beforeStop:function(t,e){$(e.helper).removeClass("slick-header-column-active")},stop:function(t){if(!getEditorLock().commitCurrentEdit())return $(this).sortable("cancel"),void 0;for(var e=$headers.sortable("toArray"),i=[],n=0;n<e.length;n++)i.push(columns[getColumnIndex(e[n].replace(uid,""))]);setColumns(i),trigger(self.onColumnsReordered,{}),t.stopPropagation(),setupColumnResize()}})}function setupColumnResize(){var t,e,i,n,s,o,r,a,l;s=$headers.children(),s.find(".slick-resizable-handle").remove(),s.each(function(t){columns[t].resizable&&(void 0===a&&(a=t),l=t)}),void 0!==a&&s.each(function(h,c){a>h||options.forceFitColumns&&h>=l||(t=$(c),$("<div class='slick-resizable-handle' />").appendTo(c).bind("dragstart",function(t){if(!getEditorLock().commitCurrentEdit())return!1;n=t.pageX,$(this).parent().addClass("slick-header-column-active");var a=null,l=null;if(s.each(function(t,e){columns[t].previousWidth=$(e).outerWidth()}),options.forceFitColumns)for(a=0,l=0,e=h+1;e<s.length;e++)i=columns[e],i.resizable&&(null!==l&&(i.maxWidth?l+=i.maxWidth-i.previousWidth:l=null),a+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));var c=0,u=0;for(e=0;h>=e;e++)i=columns[e],i.resizable&&(null!==u&&(i.maxWidth?u+=i.maxWidth-i.previousWidth:u=null),c+=i.previousWidth-Math.max(i.minWidth||0,absoluteColumnMinWidth));null===a&&(a=1e5),null===c&&(c=1e5),null===l&&(l=1e5),null===u&&(u=1e5),r=n+Math.min(a,u),o=n-Math.min(c,l)}).bind("drag",function(t){var a,l,c=Math.min(r,Math.max(o,t.pageX))-n;if(0>c){for(l=c,e=h;e>=0;e--)i=columns[e],i.resizable&&(a=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<a?(l+=i.previousWidth-a,i.width=a):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,e=h+1;e<s.length;e++)i=columns[e],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0))}else{for(l=c,e=h;e>=0;e--)i=columns[e],i.resizable&&(l&&i.maxWidth&&i.maxWidth-i.previousWidth<l?(l-=i.maxWidth-i.previousWidth,i.width=i.maxWidth):(i.width=i.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,e=h+1;e<s.length;e++)i=columns[e],i.resizable&&(a=Math.max(i.minWidth||0,absoluteColumnMinWidth),l&&i.previousWidth+l<a?(l+=i.previousWidth-a,i.width=a):(i.width=i.previousWidth+l,l=0))}applyColumnHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths()}).bind("dragend",function(){var t;for($(this).parent().removeClass("slick-header-column-active"),e=0;e<s.length;e++)i=columns[e],t=$(s[e]).outerWidth(),i.previousWidth!==t&&i.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{})}))})}function getVBoxDelta(t){var e=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],i=0;return $.each(e,function(e,n){i+=parseFloat(t.css(n))||0}),i}function measureCellPaddingAndBorder(){var t,e=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],i=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];t=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,$.each(e,function(e,i){headerColumnWidthDiff+=parseFloat(t.css(i))||0}),$.each(i,function(e,i){headerColumnHeightDiff+=parseFloat(t.css(i))||0}),t.remove();var n=$("<div class='slick-row' />").appendTo($canvas);t=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(n),cellWidthDiff=cellHeightDiff=0,$.each(e,function(e,i){cellWidthDiff+=parseFloat(t.css(i))||0}),$.each(i,function(e,i){cellHeightDiff+=parseFloat(t.css(i))||0}),n.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var t=options.rowHeight-cellHeightDiff,e=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+t+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],i=0;i<columns.length;i++)e.push("."+uid+" .l"+i+" { }"),e.push("."+uid+" .r"+i+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=e.join(" "):$style[0].appendChild(document.createTextNode(e.join(" ")))}function getColumnCssRules(t){if(!stylesheet){for(var e=document.styleSheets,i=0;i<e.length;i++)if((e[i].ownerNode||e[i].owningElement)==$style[0]){stylesheet=e[i];break}if(!stylesheet)throw new Error("Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];for(var n,s,o=stylesheet.cssRules||stylesheet.rules,i=0;i<o.length;i++){var r=o[i].selectorText;(n=/\.l\d+/.exec(r))?(s=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesL[s]=o[i]):(n=/\.r\d+/.exec(r))&&(s=parseInt(n[0].substr(2,n[0].length-2),10),columnCssRulesR[s]=o[i])}}return{left:columnCssRulesL[t],right:columnCssRulesR[t]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var t=plugins.length;t--;)unregisterPlugin(plugins[t]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function trigger(t,e,i){return i=i||new Slick.EventData,e=e||{},e.grid=self,t.notify(e,i,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(t){return columnsById[t]}function autosizeColumns(){var t,e,i,n=[],s=0,o=0,r=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(t=0;t<columns.length;t++)e=columns[t],n.push(e.width),o+=e.width,e.resizable&&(s+=e.width-Math.max(e.minWidth,absoluteColumnMinWidth));for(i=o;o>r&&s;){var a=(o-r)/s;for(t=0;t<columns.length&&o>r;t++){e=columns[t];var l=n[t];if(!(!e.resizable||l<=e.minWidth||absoluteColumnMinWidth>=l)){var h=Math.max(e.minWidth,absoluteColumnMinWidth),c=Math.floor(a*(l-h))||1;c=Math.min(c,l-h),o-=c,s-=c,n[t]-=c}}if(i==o)break;i=o}for(i=o;r>o;){var u=r/o;for(t=0;t<columns.length&&r>o;t++)if(e=columns[t],e.resizable&&!(e.maxWidth<=e.width)){var d=Math.min(Math.floor(u*e.width)-e.width,e.maxWidth-e.width||1e6)||1;o+=d,n[t]+=d}if(i==o)break;i=o}var p=!1;for(t=0;t<columns.length;t++)columns[t].rerenderOnResize&&columns[t].width!=n[t]&&(p=!0),columns[t].width=n[t];applyColumnHeaderWidths(),updateCanvasWidth(!0),p&&(invalidateAllRows(),render())}function applyColumnHeaderWidths(){if(initialized){for(var t,e=0,i=$headers.children(),n=i.length;n>e;e++)t=$(i[e]),t.width()!==columns[e].width-headerColumnWidthDiff&&t.width(columns[e].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){return}function setSortColumn(t,e){setSortColumns([{columnId:t,sortAsc:e}])}function setSortColumns(t){sortColumns=t;var e=$headers.children();e.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),$.each(sortColumns,function(t,i){null==i.sortAsc&&(i.sortAsc=!0);var n=getColumnIndex(i.columnId);null!=n&&e.eq(n).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(i.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(t,e){selectedRows=[];for(var i={},n=0;n<e.length;n++)for(var s=e[n].fromRow;s<=e[n].toRow;s++){i[s]||(selectedRows.push(s),i[s]={});for(var o=e[n].fromCell;o<=e[n].toCell;o++)canCellBeSelected(s,o)&&(i[s][columns[o].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,i),trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},t)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var t=0,e=0,i=columns.length;i>e;e++)columnPosLeft[e]=t,columnPosRight[e]=t+columns[e].width,t+=columns[e].width}function setColumns(t){columns=t,columnsById={};for(var e=0;e<columns.length;e++){var i=columns[e]=$.extend({},columnDefaults,columns[e]);columnsById[i.id]=e,i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth)}updateColumnCaches(),initialized&&(invalidateAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeCanvas(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(t){getEditorLock().commitCurrentEdit()&&(makeActiveCellNormal(),options.enableAddRow!==t.enableAddRow&&invalidateRow(getDataLength()),options=$.extend(options,t),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),render())}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1)}function setData(t,e){data=t,invalidateAllRows(),updateRowCount(),e&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data.length}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow?1:0)}function getDataItem(t){return data.getItem?data.getItem(t):data[t]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(t){options.showTopPanel!=t&&(options.showTopPanel=t,t?$topPanelScroller.slideDown("fast",resizeCanvas):$topPanelScroller.slideUp("fast",resizeCanvas))}function setHeaderRowVisibility(t){options.showHeaderRow!=t&&(options.showHeaderRow=t,t?$headerRowScroller.slideDown("fast",resizeCanvas):$headerRowScroller.slideUp("fast",resizeCanvas))}function getContainerNode(){return $container.get(0)
}function getRowTop(t){return options.rowHeight*t-offset}function getRowFromPosition(t){return Math.floor((t+offset)/options.rowHeight)}function scrollTo(t){t=Math.max(t,0),t=Math.min(t,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var e=offset;page=Math.min(n-1,Math.floor(t/ph)),offset=Math.round(page*cj);var i=t-offset;if(offset!=e){var s=getVisibleRange(i);cleanupRows(s),updateRowPositions()}prevScrollTop!=i&&(vScrollDir=i+offset>prevScrollTop+e?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=i,trigger(self.onViewportChanged,{}))}function defaultFormatter(t,e,i){return null==i?"":(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(t,e){var i=data.getItemMetadata&&data.getItemMetadata(t),n=i&&i.columns&&(i.columns[e.id]||i.columns[getColumnIndex(e.id)]);return n&&n.formatter||i&&i.formatter||e.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(e)||options.defaultFormatter}function getEditor(t,e){var i=columns[e],n=data.getItemMetadata&&data.getItemMetadata(t),s=n&&n.columns;return s&&s[i.id]&&void 0!==s[i.id].editor?s[i.id].editor:s&&s[e]&&void 0!==s[e].editor?s[e].editor:i.editor||options.editorFactory&&options.editorFactory.getEditor(i)}function getDataItemValueForColumn(t,e){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(t,e):t[e.field]}function appendRowHtml(t,e,i,n){var s=getDataItem(e),o=n>e&&!s,r="slick-row"+(o?" loading":"")+(e===activeRow?" active":"")+(1==e%2?" odd":" even")+(0===e?" first":""),a=data.getItemMetadata&&data.getItemMetadata(e);a&&a.cssClasses&&(r+=" "+a.cssClasses),t.push("<div class='ui-widget-content "+r+"' style='top:"+getRowTop(e)+"px'>");for(var l,h,c=0,u=columns.length;u>c;c++){if(h=columns[c],l=1,a&&a.columns){var d=a.columns[h.id]||a.columns[c];l=d&&d.colspan||1,"*"===l&&(l=u-c)}if(columnPosRight[Math.min(u-1,c+l-1)]>i.leftPx){if(columnPosLeft[c]>i.rightPx)break;appendCellHtml(t,e,c,l,s)}l>1&&(c+=l-1)}t.push("</div>")}function appendCellHtml(t,e,i,n,s){var o=columns[i],r="slick-cell l"+i+" r"+Math.min(columns.length-1,i+n-1)+(o.cssClass?" "+o.cssClass:"");e===activeRow&&i===activeCell&&(r+=" active");for(var a in cellCssClasses)cellCssClasses[a][e]&&cellCssClasses[a][e][o.id]&&(r+=" "+cellCssClasses[a][e][o.id]);if(t.push("<div class='"+r+"'>"),s){var l=getDataItemValueForColumn(s,o);t.push(getFormatter(e,o)(e,i,l,o,s))}t.push("</div>"),rowsCache[e].cellRenderQueue.push(i),rowsCache[e].cellColSpans[i]=n}function cleanupRows(t){for(var e in rowsCache)(e=parseInt(e,10))!==activeRow&&(e<t.top||e>t.bottom)&&removeRowFromCache(e)}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var t in rowsCache)removeRowFromCache(t)}function removeRowFromCache(t){var e=rowsCache[t];e&&($canvas[0].removeChild(e.rowNode),delete rowsCache[t],delete postProcessedRows[t],renderedRows--,counter_rows_removed++)}function invalidateRows(t){var e,i;if(t&&t.length)for(vScrollDir=0,e=0,i=t.length;i>e;e++)currentEditor&&activeRow===t[e]&&makeActiveCellNormal(),rowsCache[t[e]]&&removeRowFromCache(t[e])}function invalidateRow(t){invalidateRows([t])}function updateCell(t,e){var i=getCellNode(t,e);if(i){var n=columns[e],s=getDataItem(t);currentEditor&&activeRow===t&&activeCell===e?currentEditor.loadValue(s):(i.innerHTML=s?getFormatter(t,n)(t,e,getDataItemValueForColumn(s,n),n,s):"",invalidatePostProcessingResults(t))}}function updateRow(t){var e=rowsCache[t];if(e){ensureCellNodesInRowsCache(t);var i=getDataItem(t);for(var n in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(n)){n=0|n;var s=columns[n],o=e.cellNodesByColumnIdx[n];t===activeRow&&n===activeCell&&currentEditor?currentEditor.loadValue(i):o.innerHTML=i?getFormatter(t,s)(t,n,getDataItemValueForColumn(i,s),s,i):""}invalidatePostProcessingResults(t)}}function getViewportHeight(){return parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){initialized&&(viewportH=options.autoHeight?options.rowHeight*getDataLengthIncludingAddNew():getViewportHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportW=parseFloat($.css($container[0],"width",!0)),options.autoHeight||$viewport.height(viewportH),options.forceFitColumns&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render())}function updateRowCount(){if(getDataLength(),initialized){numberOfRows=getDataLengthIncludingAddNew()+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var t=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&numberOfRows*options.rowHeight>viewportH;var e=getDataLengthIncludingAddNew()-1;for(var i in rowsCache)i>=e&&removeRowFromCache(i);activeCellNode&&activeRow>e&&resetActiveCell();var s=h;th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height),maxSupportedCssHeight>th?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==s&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var o=th-viewportH>=scrollTop+offset;0==th||0==scrollTop?page=offset=0:o?scrollTo(scrollTop+offset):scrollTo(th-viewportH),h!=s&&options.autoHeight&&resizeCanvas(),options.forceFitColumns&&t!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(t,e){return null==t&&(t=scrollTop),null==e&&(e=scrollLeft),{top:getRowFromPosition(t),bottom:getRowFromPosition(t+viewportH)+1,leftPx:e,rightPx:e+viewportW}}function getRenderedRange(t,e){var i=getVisibleRange(t,e),n=Math.round(viewportH/options.rowHeight),s=3;return-1==vScrollDir?(i.top-=n,i.bottom+=s):1==vScrollDir?(i.top-=s,i.bottom+=n):(i.top-=s,i.bottom+=s),i.top=Math.max(0,i.top),i.bottom=Math.min(getDataLengthIncludingAddNew()-1,i.bottom),i.leftPx-=viewportW,i.rightPx+=viewportW,i.leftPx=Math.max(0,i.leftPx),i.rightPx=Math.min(canvasWidth,i.rightPx),i}function ensureCellNodesInRowsCache(t){var e=rowsCache[t];if(e&&e.cellRenderQueue.length)for(var i=e.rowNode.lastChild;e.cellRenderQueue.length;){var n=e.cellRenderQueue.pop();e.cellNodesByColumnIdx[n]=i,i=i.previousSibling}}function cleanUpCells(t,e){var i=0,n=rowsCache[e],s=[];for(var o in n.cellNodesByColumnIdx)if(n.cellNodesByColumnIdx.hasOwnProperty(o)){o=0|o;var r=n.cellColSpans[o];(columnPosLeft[o]>t.rightPx||columnPosRight[Math.min(columns.length-1,o+r-1)]<t.leftPx)&&(e!=activeRow||o!=activeCell)&&s.push(o)}for(var a;null!=(a=s.pop());)n.rowNode.removeChild(n.cellNodesByColumnIdx[a]),delete n.cellColSpans[a],delete n.cellNodesByColumnIdx[a],postProcessedRows[e]&&delete postProcessedRows[e][a],i++}function cleanUpAndRenderCells(t){for(var e,i,n,s=[],o=[],r=0,a=t.top,l=t.bottom;l>=a;a++)if(e=rowsCache[a]){ensureCellNodesInRowsCache(a),cleanUpCells(t,a),i=0;var h=data.getItemMetadata&&data.getItemMetadata(a);h=h&&h.columns;for(var c=getDataItem(a),u=0,d=columns.length;d>u&&!(columnPosLeft[u]>t.rightPx);u++)if(null==(n=e.cellColSpans[u])){if(n=1,h){var p=h[columns[u].id]||h[u];n=p&&p.colspan||1,"*"===n&&(n=d-u)}columnPosRight[Math.min(d-1,u+n-1)]>t.leftPx&&(appendCellHtml(s,a,u,n,c),i++),u+=n>1?n-1:0}else u+=n>1?n-1:0;i&&(r+=i,o.push(a))}if(s.length){var f=document.createElement("div");f.innerHTML=s.join("");for(var m,g;null!=(m=o.pop());){e=rowsCache[m];for(var v;null!=(v=e.cellRenderQueue.pop());)g=f.lastChild,e.rowNode.appendChild(g),e.cellNodesByColumnIdx[v]=g}}}function renderRows(t){for(var e=$canvas[0],i=[],n=[],s=!1,o=getDataLength(),r=t.top,a=t.bottom;a>=r;r++)rowsCache[r]||(renderedRows++,n.push(r),rowsCache[r]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(i,r,t,o),activeCellNode&&activeRow===r&&(s=!0),counter_rows_rendered++);if(n.length){var l=document.createElement("div");l.innerHTML=i.join("");for(var r=0,a=n.length;a>r;r++)rowsCache[n[r]].rowNode=e.appendChild(l.firstChild);s&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function invalidatePostProcessingResults(t){delete postProcessedRows[t],postProcessFromRow=Math.min(postProcessFromRow,t),postProcessToRow=Math.max(postProcessToRow,t),startPostProcessing()}function updateRowPositions(){for(var t in rowsCache)rowsCache[t].rowNode.style.top=getRowTop(t)+"px"}function render(){if(initialized){var t=getVisibleRange(),e=getRenderedRange();cleanupRows(e),lastRenderedScrollLeft!=scrollLeft&&cleanUpAndRenderCells(e),renderRows(e),postProcessFromRow=t.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,t.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,h_render=null}}function handleHeaderRowScroll(){var t=$headerRowScroller[0].scrollLeft;t!=$viewport[0].scrollLeft&&($viewport[0].scrollLeft=t)}function handleScroll(){scrollTop=$viewport[0].scrollTop,scrollLeft=$viewport[0].scrollLeft;var t=Math.abs(scrollTop-prevScrollTop),e=Math.abs(scrollLeft-prevScrollLeft);if(e&&(prevScrollLeft=scrollLeft,$headerScroller[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScroller[0].scrollLeft=scrollLeft),t)if(vScrollDir=scrollTop>prevScrollTop?1:-1,prevScrollTop=scrollTop,viewportH>t)scrollTo(scrollTop+offset);else{var i=offset;page=h==viewportH?0:Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),i!=offset&&invalidateAllRows()}(e||t)&&(h_render&&clearTimeout(h_render),(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20)&&(options.forceSyncScrolling||Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW?render():h_render=setTimeout(render,50),trigger(self.onViewportChanged,{}))),trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){for(;postProcessToRow>=postProcessFromRow;){var t=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,e=rowsCache[t];if(e&&!(t>=getDataLength())){postProcessedRows[t]||(postProcessedRows[t]={}),ensureCellNodesInRowsCache(t);for(var i in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var n=columns[i];if(n.asyncPostRender&&!postProcessedRows[t][i]){var s=e.cellNodesByColumnIdx[i];s&&n.asyncPostRender(s,t,getDataItem(t),n),postProcessedRows[t][i]=!0}}return h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay),void 0}}}function updateCellCssStylesOnRenderedRows(t,e){var i,n,s,o;for(var r in rowsCache){if(o=e&&e[r],s=t&&t[r],o)for(n in o)s&&o[n]==s[n]||(i=getCellNode(r,getColumnIndex(n)),i&&$(i).removeClass(o[n]));if(s)for(n in s)o&&o[n]==s[n]||(i=getCellNode(r,getColumnIndex(n)),i&&$(i).addClass(s[n]))}}function addCellCssStyles(t,e){if(cellCssClasses[t])throw"addCellCssStyles: cell CSS hash with key '"+t+"' already exists.";cellCssClasses[t]=e,updateCellCssStylesOnRenderedRows(e,null),trigger(self.onCellCssStylesChanged,{key:t,hash:e})}function removeCellCssStyles(t){cellCssClasses[t]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[t]),delete cellCssClasses[t],trigger(self.onCellCssStylesChanged,{key:t,hash:null}))}function setCellCssStyles(t,e){var i=cellCssClasses[t];cellCssClasses[t]=e,updateCellCssStylesOnRenderedRows(e,i),trigger(self.onCellCssStylesChanged,{key:t,hash:e})}function getCellCssStyles(t){return cellCssClasses[t]}function flashCell(t,e,i){function n(t){t&&setTimeout(function(){s.queue(function(){s.toggleClass(options.cellFlashingCssClass).dequeue(),n(t-1)})},i)}if(i=i||100,rowsCache[t]){var s=$(getCellNode(t,e));n(4)}}function handleDragInit(t,e){var i=getCellFromEvent(t);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragInit,e,t);return t.isImmediatePropagationStopped()?n:!1}function handleDragStart(t,e){var i=getCellFromEvent(t);if(!i||!cellExists(i.row,i.cell))return!1;var n=trigger(self.onDragStart,e,t);return t.isImmediatePropagationStopped()?n:!1}function handleDrag(t,e){return trigger(self.onDrag,e,t)}function handleDragEnd(t,e){trigger(self.onDragEnd,e,t)}function handleKeyDown(t){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},t);var e=t.isImmediatePropagationStopped();if(!e)if(t.shiftKey||t.altKey||t.ctrlKey)9!=t.which||!t.shiftKey||t.ctrlKey||t.altKey||(e=navigatePrev());else if(27==t.which){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else 34==t.which?(navigatePageDown(),e=!0):33==t.which?(navigatePageUp(),e=!0):37==t.which?e=navigateLeft():39==t.which?e=navigateRight():38==t.which?e=navigateUp():40==t.which?e=navigateDown():9==t.which?e=navigateNext():13==t.which&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable()),e=!0);if(e){t.stopPropagation(),t.preventDefault();try{t.originalEvent.keyCode=0}catch(i){}}}function handleClick(t){currentEditor||(t.target!=document.activeElement||$(t.target).hasClass("slick-cell"))&&setFocus();var e=getCellFromEvent(t);!e||null!==currentEditor&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onClick,{row:e.row,cell:e.cell},t),t.isImmediatePropagationStopped()||activeCell==e.cell&&activeRow==e.row||!canCellBeActive(e.row,e.cell)||(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit())&&(scrollRowIntoView(e.row,!1),setActiveCellInternal(getCellNode(e.row,e.cell))))}function handleContextMenu(t){var e=$(t.target).closest(".slick-cell",$canvas);0!==e.length&&(activeCellNode!==e[0]||null===currentEditor)&&trigger(self.onContextMenu,{},t)}function handleDblClick(t){var e=getCellFromEvent(t);!e||null!==currentEditor&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onDblClick,{row:e.row,cell:e.cell},t),t.isImmediatePropagationStopped()||options.editable&&gotoCell(e.row,e.cell,!0))}function handleHeaderMouseEnter(t){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},t)}function handleHeaderMouseLeave(t){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},t)}function handleHeaderContextMenu(t){var e=$(t.target).closest(".slick-header-column",".slick-header-columns"),i=e&&e.data("column");trigger(self.onHeaderContextMenu,{column:i},t)}function handleHeaderClick(t){var e=$(t.target).closest(".slick-header-column",".slick-header-columns"),i=e&&e.data("column");i&&trigger(self.onHeaderClick,{column:i},t)}function handleMouseEnter(t){trigger(self.onMouseEnter,{},t)}function handleMouseLeave(t){trigger(self.onMouseLeave,{},t)}function cellExists(t,e){return!(0>t||t>=getDataLength()||0>e||e>=columns.length)}function getCellFromPoint(t,e){for(var i=getRowFromPosition(e),n=0,s=0,o=0;o<columns.length&&t>s;o++)s+=columns[o].width,n++;return 0>n&&(n=0),{row:i,cell:n-1}}function getCellFromNode(t){var e=/l\d+/.exec(t.className);if(!e)throw"getCellFromNode: cannot get cell - "+t.className;return parseInt(e[0].substr(1,e[0].length-1),10)}function getRowFromNode(t){for(var e in rowsCache)if(rowsCache[e].rowNode===t)return 0|e;return null}function getCellFromEvent(t){var e=$(t.target).closest(".slick-cell",$canvas);if(!e.length)return null;var i=getRowFromNode(e[0].parentNode),n=getCellFromNode(e[0]);return null==i||null==n?null:{row:i,cell:n}}function getCellNodeBox(t,e){if(!cellExists(t,e))return null;for(var i=getRowTop(t),n=i+options.rowHeight-1,s=0,o=0;e>o;o++)s+=columns[o].width;var r=s+columns[e].width;return{top:i,left:s,bottom:n,right:r}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){-1==tabbingDirection?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(t,e,i){scrollRowIntoView(t,i);var n=getColspan(t,e),s=columnPosLeft[e],o=columnPosRight[e+(n>1?n-1:0)],r=scrollLeft+viewportW;scrollLeft>s?($viewport.scrollLeft(s),handleScroll(),render()):o>r&&($viewport.scrollLeft(Math.min(s,o-$viewport[0].clientWidth)),handleScroll(),render())}function setActiveCellInternal(t,e){null!==activeCellNode&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active"));var i=activeCellNode!==t;activeCellNode=t,null!=activeCellNode?(activeRow=getRowFromNode(activeCellNode.parentNode),activeCell=activePosX=getCellFromNode(activeCellNode),null==e&&(e=activeRow==getDataLength()||options.autoEdit),$(activeCellNode).addClass("active"),$(rowsCache[activeRow].rowNode).addClass("active"),options.editable&&e&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay):makeActiveCellEditable())):activeRow=activeCell=null,i&&trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(t){}else if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}}function isCellPotentiallyEditable(t,e){return t<getDataLength()&&!getDataItem(t)?!1:columns[e].cannotTriggerInsert&&t>=getDataLength()?!1:getEditor(t,e)?!0:!1}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var t=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),t){var e=columns[activeCell],i=getFormatter(activeRow,e);activeCellNode.innerHTML=i(activeRow,activeCell,getDataItemValueForColumn(t,e),e,t),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(t){if(activeCellNode){if(!options.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(activeRow,activeCell)){var e=columns[activeCell],i=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:i,column:e})===!1)return setFocus(),void 0;getEditorLock().activate(editController),$(activeCellNode).addClass("editable"),t||(activeCellNode.innerHTML=""),currentEditor=new(t||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:e,item:i||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),i&&currentEditor.loadValue(i),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(t){var e={top:t.offsetTop,left:t.offsetLeft,bottom:0,right:0,width:$(t).outerWidth(),height:$(t).outerHeight(),visible:!0};e.bottom=e.top+e.height,e.right=e.left+e.width;for(var i=t.offsetParent;(t=t.parentNode)!=document.body;)e.visible&&t.scrollHeight!=t.offsetHeight&&"visible"!=$(t).css("overflowY")&&(e.visible=e.bottom>t.scrollTop&&e.top<t.scrollTop+t.clientHeight),e.visible&&t.scrollWidth!=t.offsetWidth&&"visible"!=$(t).css("overflowX")&&(e.visible=e.right>t.scrollLeft&&e.left<t.scrollLeft+t.clientWidth),e.left-=t.scrollLeft,e.top-=t.scrollTop,t===i&&(e.left+=t.offsetLeft,e.top+=t.offsetTop,i=t.offsetParent),e.bottom=e.top+e.height,e.right=e.left+e.width;return e}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var t=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(t.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(t)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(t,e){var i=t*options.rowHeight,n=(t+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(t+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(e?i:n),render()):t*options.rowHeight<scrollTop+offset&&(scrollTo(e?n:i),render())}function scrollRowToTop(t){scrollTo(t*options.rowHeight),render()}function scrollPage(t){var e=t*numVisibleRows;if(scrollTo((getRowFromPosition(scrollTop)+e)*options.rowHeight),render(),options.enableCellNavigation&&null!=activeRow){var i=activeRow+e;i>=getDataLengthIncludingAddNew()&&(i=getDataLengthIncludingAddNew()-1),0>i&&(i=0);for(var n=0,s=null,o=activePosX;activePosX>=n;)canCellBeActive(i,n)&&(s=n),n+=getColspan(i,n);null!==s?(setActiveCellInternal(getCellNode(i,s)),activePosX=o):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function getColspan(t,e){var i=data.getItemMetadata&&data.getItemMetadata(t);if(!i||!i.columns)return 1;var n=i.columns[columns[e].id]||i.columns[e],s=n&&n.colspan;return s="*"===s?columns.length-e:s||1}function findFirstFocusableCell(t){for(var e=0;e<columns.length;){if(canCellBeActive(t,e))return e;e+=getColspan(t,e)}return null}function findLastFocusableCell(t){for(var e=0,i=null;e<columns.length;)canCellBeActive(t,e)&&(i=e),e+=getColspan(t,e);return i}function gotoRight(t,e){if(e>=columns.length)return null;do e+=getColspan(t,e);while(e<columns.length&&!canCellBeActive(t,e));return e<columns.length?{row:t,cell:e,posX:e}:null}function gotoLeft(t,e){if(0>=e)return null;var i=findFirstFocusableCell(t);if(null===i||i>=e)return null;for(var n,s={row:t,cell:i,posX:i};;){if(n=gotoRight(s.row,s.cell,s.posX),!n)return null;if(n.cell>=e)return s;s=n}}function gotoDown(t,e,i){for(var n;;){if(++t>=getDataLengthIncludingAddNew())return null;for(n=e=0;i>=e;)n=e,e+=getColspan(t,e);if(canCellBeActive(t,n))return{row:t,cell:n,posX:i}}}function gotoUp(t,e,i){for(var n;;){if(--t<0)return null;for(n=e=0;i>=e;)n=e,e+=getColspan(t,e);if(canCellBeActive(t,n))return{row:t,cell:n,posX:i}}}function gotoNext(t,e,i){if(null==t&&null==e&&(t=e=i=0,canCellBeActive(t,e)))return{row:t,cell:e,posX:e};var n=gotoRight(t,e,i);if(n)return n;for(var s=null;++t<getDataLengthIncludingAddNew();)if(s=findFirstFocusableCell(t),null!==s)return{row:t,cell:s,posX:s};return null}function gotoPrev(t,e,i){if(null==t&&null==e&&(t=getDataLengthIncludingAddNew()-1,e=i=columns.length-1,canCellBeActive(t,e)))return{row:t,cell:e,posX:e};for(var n,s;!n&&!(n=gotoLeft(t,e,i));){if(--t<0)return null;e=0,s=findLastFocusableCell(t),null!==s&&(n={row:t,cell:s,posX:s})}return n}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(t){if(!options.enableCellNavigation)return!1;if(!activeCellNode&&"prev"!=t&&"next"!=t)return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var e={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=e[t];var i={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext},n=i[t],s=n(activeRow,activeCell,activePosX);if(s){var o=s.row==getDataLength();return scrollCellIntoView(s.row,s.cell,!o),setActiveCellInternal(getCellNode(s.row,s.cell)),activePosX=s.posX,!0}return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(t,e){return rowsCache[t]?(ensureCellNodesInRowsCache(t),rowsCache[t].cellNodesByColumnIdx[e]):null}function setActiveCell(t,e){initialized&&(t>getDataLength()||0>t||e>=columns.length||0>e||options.enableCellNavigation&&(scrollCellIntoView(t,e,!1),setActiveCellInternal(getCellNode(t,e),!1)))}function canCellBeActive(t,e){if(!options.enableCellNavigation||t>=getDataLengthIncludingAddNew()||0>t||e>=columns.length||0>e)return!1;var i=data.getItemMetadata&&data.getItemMetadata(t);if(i&&"boolean"==typeof i.focusable)return i.focusable;var n=i&&i.columns;return n&&n[columns[e].id]&&"boolean"==typeof n[columns[e].id].focusable?n[columns[e].id].focusable:n&&n[e]&&"boolean"==typeof n[e].focusable?n[e].focusable:columns[e].focusable}function canCellBeSelected(t,e){if(t>=getDataLength()||0>t||e>=columns.length||0>e)return!1;var i=data.getItemMetadata&&data.getItemMetadata(t);if(i&&"boolean"==typeof i.selectable)return i.selectable;var n=i&&i.columns&&(i.columns[columns[e].id]||i.columns[e]);return n&&"boolean"==typeof n.selectable?n.selectable:columns[e].selectable}function gotoCell(t,e,i){if(initialized&&canCellBeActive(t,e)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(t,e,!1);var n=getCellNode(t,e);setActiveCellInternal(n,i||t===getDataLength()||options.autoEdit),currentEditor||setFocus()}}function commitCurrentEdit(){var t=getDataItem(activeRow),e=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var i=currentEditor.validate();if(i.valid){if(activeRow<getDataLength()){var n={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(t,this.serializedValue),updateRow(this.row)},undo:function(){this.editor.applyValue(t,this.prevSerializedValue),updateRow(this.row)}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(t,e,n)):(n.execute(),makeActiveCellNormal()),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:t})}else{var s={};currentEditor.applyValue(s,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:s,column:e})}return!getEditorLock().isActive()}return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:i,row:activeRow,cell:activeCell,column:e}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(t){for(var e=[],i=columns.length-1,n=0;n<t.length;n++)e.push(new Slick.Range(t[n],0,t[n],i));return e}function getSelectedRows(){if(!selectionModel)throw"Selection model is not set";return selectedRows}function setSelectedRows(t){if(!selectionModel)throw"Selection model is not set";selectionModel.setSelectedRanges(rowsToRanges(t))}var defaults={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:defaultFormatter,forceSyncScrolling:!1},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2,$headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacer,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,absoluteColumnMinWidth,numberOfRows=0,tabbingDirection=1,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],h_editorLoader=null,h_render=null,h_postrender=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,counter_rows_rendered=0,counter_rows_removed=0;this.debug=function(){var t="";t+="\ncounter_rows_rendered:  "+counter_rows_rendered,t+="\ncounter_rows_removed:  "+counter_rows_removed,t+="\nrenderedRows:  "+renderedRows,t+="\nnumVisibleRows:  "+numVisibleRows,t+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,t+="\nn(umber of pages):  "+n,t+="\n(current) page:  "+page,t+="\npage height (ph):  "+ph,t+="\nvScrollDir:  "+vScrollDir,alert(t)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,getContainerNode:getContainerNode,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,navigatePageUp:navigatePageUp,navigatePageDown:navigatePageDown,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController}),init()
}$.extend(Slick,{Grid:SlickGrid});var scrollbarDimensions,maxSupportedCssHeight;return Slick}),define("_libs/grids/SlickGrid-master/slick.dataview",["jquery","_libs/grids/SlickGrid-master/slick.core"],function(t,e){function i(i){function n(){ye=!0}function s(){ye=!1,ie()}function o(t){we=t}function r(t){ae=t}function a(t){t=t||0;for(var e,i=t,n=pe.length;n>i;i++){if(e=pe[i][de],void 0===e)throw"Each data element must implement a unique 'id' property";me[e]=i}}function l(){for(var t,e=0,i=pe.length;i>e;e++)if(t=pe[e][de],void 0===t)throw"Each data element must implement a unique 'id' property"}function h(){return pe}function c(t,e){void 0!==e&&(de=e),pe=Se=t,me={},a(),l(),ie()}function u(t){void 0!=t.pageSize&&(ke=t.pageSize,Pe=ke?Math.min(Pe,Math.max(0,Math.ceil(Ie/ke)-1)):0),void 0!=t.pageNum&&(Pe=Math.min(t.pageNum,Math.max(0,Math.ceil(Ie/ke)-1))),Oe.notify(d(),null,ce),ie()}function d(){var t=ke?Math.max(1,Math.ceil(Ie/ke)):1;return{pageSize:ke,pageNum:Pe,totalRows:Ie,totalPages:t}}function p(t,e){be=e,re=t,oe=null,e===!1&&pe.reverse(),pe.sort(t),e===!1&&pe.reverse(),me={},a(),ie()}function f(t,e){be=e,oe=t,re=null;var i=Object.prototype.toString;Object.prototype.toString="function"==typeof t?t:function(){return this[t]},e===!1&&pe.reverse(),pe.sort(),Object.prototype.toString=i,e===!1&&pe.reverse(),me={},a(),ie()}function m(){re?p(re,be):oe&&f(oe,be)}function g(t){ve=t,i.inlineFilters&&(le=Y(),he=X()),ie()}function v(){return Me}function _(n){i.groupItemMetadataProvider||(i.groupItemMetadataProvider=new e.Data.GroupItemMetadataProvider),Ae=[],De=[],n=n||[],Me=n instanceof Array?n:[n];for(var s=0;s<Me.length;s++){var o=Me[s]=t.extend(!0,{},Te,Me[s]);o.getterIsAFn="function"==typeof o.getter,o.compiledAccumulators=[];for(var r=o.aggregators.length;r--;)o.compiledAccumulators[r]=Z(o.aggregators[r]);De[s]={}}ie()}function y(t,e,i){return null==t?(_([]),void 0):(_({getter:t,formatter:e,comparer:i}),void 0)}function b(t,e){if(!Me.length)throw new Error("At least one grouping must be specified before calling setAggregators().");Me[0].aggregators=t,Me[0].aggregateCollapsed=e,_(Me)}function w(t){return pe[t]}function x(t){return me[t]}function S(){if(!ge){ge={};for(var t=0,e=fe.length;e>t;t++)ge[fe[t][de]]=t}}function C(t){return S(),ge[t]}function T(t){return pe[me[t]]}function M(t){var e=[];S();for(var i=0;i<t.length;i++){var n=ge[t[i]];null!=n&&(e[e.length]=n)}return e}function A(t){for(var e=[],i=0;i<t.length;i++)t[i]<fe.length&&(e[e.length]=fe[t[i]][de]);return e}function D(t,e){if(void 0===me[t]||t!==e[de])throw"Invalid or non-matching id";pe[me[t]]=e,_e||(_e={}),_e[t]=!0,ie()}function L(t,e){pe.splice(t,0,e),a(t),ie()}function k(t){pe.push(t),a(pe.length-1),ie()}function P(t){var e=me[t];if(void 0===e)throw"Invalid id";delete me[t],pe.splice(e,1),a(e),ie()}function I(){return fe.length}function R(t){return fe[t]}function E(t){var e=fe[t];return void 0===e?null:e.__group?i.groupItemMetadataProvider.getGroupRowMetadata(e):e.__groupTotals?i.groupItemMetadataProvider.getTotalsRowMetadata(e):null}function O(t,e){if(null==t)for(var i=0;i<Me.length;i++)De[i]={},Me[i].collapsed=e;else De[t]={},Me[t].collapsed=e;ie()}function j(t){O(t,!0)}function F(t){O(t,!1)}function N(t,e,i){De[t][e]=Me[t].collapsed^i,ie()}function B(){var t=Array.prototype.slice.call(arguments),e=t[0];1==t.length&&-1!=e.indexOf(Le)?N(e.split(Le).length-1,e,!0):N(t.length-1,t.join(Le),!0)}function z(){var t=Array.prototype.slice.call(arguments),e=t[0];1==t.length&&-1!=e.indexOf(Le)?N(e.split(Le).length-1,e,!1):N(t.length-1,t.join(Le),!1)}function U(){return Ae}function V(t,i){for(var n,s,o,r=[],a=[],l=i?i.level+1:0,h=Me[l],c=0,u=h.predefinedValues.length;u>c;c++)s=h.predefinedValues[c],n=a[s],n||(n=new e.Group,n.value=s,n.level=l,n.groupingKey=(i?i.groupingKey+Le:"")+s,r[r.length]=n,a[s]=n);for(var c=0,u=t.length;u>c;c++)o=t[c],s=h.getterIsAFn?h.getter(o):o[h.getter],n=a[s],n||(n=new e.Group,n.value=s,n.level=l,n.groupingKey=(i?i.groupingKey+Le:"")+s,r[r.length]=n,a[s]=n),n.rows[n.count++]=o;if(l<Me.length-1)for(var c=0;c<r.length;c++)n=r[c],n.groups=V(n.rows,n);return r.sort(Me[l].comparer),r}function H(t){for(var i,n=Me[t.level],s=t.level==Me.length,o=new e.GroupTotals,r=n.aggregators.length;r--;)i=n.aggregators[r],i.init(),n.compiledAccumulators[r].call(i,!s&&n.aggregateChildGroups?t.groups:t.rows),i.storeResult(o);o.group=t,t.totals=o}function $(t,e){e=e||0;for(var i,n=Me[e],s=t.length;s--;)i=t[s],(!i.collapsed||n.aggregateCollapsed)&&(i.groups&&$(i.groups,e+1),n.aggregators.length&&(n.aggregateEmpty||i.rows.length||i.groups&&i.groups.length)&&H(i))}function W(t,e){e=e||0;for(var i,n=Me[e],s=n.collapsed,o=De[e],r=t.length;r--;)i=t[r],i.collapsed=s^o[i.groupingKey],i.title=n.formatter?n.formatter(i):i.value,i.groups&&(W(i.groups,e+1),i.rows=[])}function G(t,e){e=e||0;for(var i,n,s=Me[e],o=[],r=0,a=0,l=t.length;l>a;a++){if(n=t[a],o[r++]=n,!n.collapsed){i=n.groups?G(n.groups,e+1):n.rows;for(var h=0,c=i.length;c>h;h++)o[r++]=i[h]}n.totals&&s.displayTotalsRow&&(!n.collapsed||s.aggregateCollapsed)&&(o[r++]=n.totals)}return o}function q(t){var e=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/,i=t.toString().match(e);return{params:i[1].split(","),body:i[2]}}function Z(t){var e=q(t.accumulate),i=new Function("_items","for (var "+e.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+e.params[0]+" = _items[_i]; "+e.body+"}");return i.displayName=i.name="compiledAccumulatorLoop",i}function Y(){var t=q(ve),e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e),i=i.replace(/\$item\$/gi,t.params[0]),i=i.replace(/\$args\$/gi,t.params[1]);var n=new Function("_items,_args",i);return n.displayName=n.name="compiledFilter",n}function X(){var t=q(ve),e=t.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,e),i=i.replace(/\$item\$/gi,t.params[0]),i=i.replace(/\$args\$/gi,t.params[1]);var n=new Function("_items,_args,_cache",i);return n.displayName=n.name="compiledFilterWithCaching",n}function J(t,e){for(var i=[],n=0,s=0,o=t.length;o>s;s++)ve(t[s],e)&&(i[n++]=t[s]);return i}function K(t,e,i){for(var n,s=[],o=0,r=0,a=t.length;a>r;r++)n=t[r],i[r]?s[o++]=n:ve(n,e)&&(s[o++]=n,i[r]=!0);return s}function Q(t){if(ve){var e=i.inlineFilters?le:J,n=i.inlineFilters?he:K;we.isFilterNarrowing?Se=e(Se,ae):we.isFilterExpanding?Se=n(t,ae,Ce):we.isFilterUnchanged||(Se=e(t,ae))}else Se=ke?t:t.concat();var s;return ke?(Se.length<Pe*ke&&(Pe=Math.floor(Se.length/ke)),s=Se.slice(ke*Pe,ke*Pe+ke)):s=Se,{totalRows:Se.length,rows:s}}function te(t,e){var i,n,s,o=[],r=0,a=e.length;we&&we.ignoreDiffsBefore&&(r=Math.max(0,Math.min(e.length,we.ignoreDiffsBefore))),we&&we.ignoreDiffsAfter&&(a=Math.min(e.length,Math.max(0,we.ignoreDiffsAfter)));for(var l=r,h=t.length;a>l;l++)l>=h?o[o.length]=l:(i=e[l],n=t[l],(Me.length&&(s=i.__nonDataRow||n.__nonDataRow)&&i.__group!==n.__group||i.__group&&!i.equals(n)||s&&(i.__groupTotals||n.__groupTotals)||i[de]!=n[de]||_e&&_e[i[de]])&&(o[o.length]=l));return o}function ee(t){ge=null,(we.isFilterNarrowing!=xe.isFilterNarrowing||we.isFilterExpanding!=xe.isFilterExpanding)&&(Ce=[]);var e=Q(t);Ie=e.totalRows;var i=e.rows;Ae=[],Me.length&&(Ae=V(i),Ae.length&&($(Ae),W(Ae),i=G(Ae)));var n=te(fe,i);return fe=i,n}function ie(){if(!ye){var t=fe.length,e=Ie,i=ee(pe,ve);ke&&Pe*ke>Ie&&(Pe=Math.max(0,Math.ceil(Ie/ke)-1),i=ee(pe,ve)),_e=null,xe=we,we={},e!=Ie&&Oe.notify(d(),null,ce),t!=fe.length&&Re.notify({previous:t,current:fe.length},null,ce),i.length>0&&Ee.notify({rows:i},null,ce)}}function ne(t,e){function i(){if(o.length>0){n=!0;var i=s.mapIdsToRows(o);e||(o=s.mapRowsToIds(i)),t.setSelectedRows(i),n=!1}}var n,s=this,o=s.mapRowsToIds(t.getSelectedRows());t.onSelectedRowsChanged.subscribe(function(){n||(o=s.mapRowsToIds(t.getSelectedRows()))}),this.onRowsChanged.subscribe(i),this.onRowCountChanged.subscribe(i)}function se(t,e){function i(t){s={};for(var e in t){var i=fe[e][de];s[i]=t[e]}}function n(){if(s){o=!0,S();var i={};for(var n in s){var r=ge[n];void 0!=r&&(i[r]=s[n])}t.setCellCssStyles(e,i),o=!1}}var s,o;i(t.getCellCssStyles(e)),t.onCellCssStylesChanged.subscribe(function(t,n){o||e==n.key&&n.hash&&i(n.hash)}),this.onRowsChanged.subscribe(n),this.onRowCountChanged.subscribe(n)}var oe,re,ae,le,he,ce=this,ue={groupItemMetadataProvider:null,inlineFilters:!1},de="undefined"==typeof i.idProperty?"id":i.idProperty,pe=[],fe=[],me={},ge=null,ve=null,_e=null,ye=!1,be=!0,we={},xe={},Se=[],Ce=[],Te={getter:null,formatter:null,comparer:function(t,e){return t.value-e.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0},Me=[],Ae=[],De=[],Le=":|:",ke=0,Pe=0,Ie=0,Re=new e.Event,Ee=new e.Event,Oe=new e.Event;i=t.extend(!0,{},ue,i),t.extend(this,{beginUpdate:n,endUpdate:s,setPagingOptions:u,getPagingInfo:d,getItems:h,setItems:c,setFilter:g,sort:p,fastSort:f,reSort:m,setGrouping:_,getGrouping:v,groupBy:y,setAggregators:b,collapseAllGroups:j,expandAllGroups:F,collapseGroup:B,expandGroup:z,getGroups:U,getIdxById:x,getRowById:C,getItemById:T,getItemByIdx:w,mapRowsToIds:A,mapIdsToRows:M,setRefreshHints:o,setFilterArgs:r,refresh:ie,updateItem:D,insertItem:L,addItem:k,deleteItem:P,syncGridSelection:ne,syncGridCellCssStyles:se,getLength:I,getItem:R,getItemMetadata:E,onRowCountChanged:Re,onRowsChanged:Ee,onPagingInfoChanged:Oe})}function n(t){this.field_=t,this.init=function(){this.count_=0,this.nonNullCount_=0,this.sum_=0},this.accumulate=function(t){var e=t[this.field_];this.count_++,null!=e&&""!==e&&0/0!==e&&(this.nonNullCount_++,this.sum_+=parseFloat(e))},this.storeResult=function(t){t.avg||(t.avg={}),0!=this.nonNullCount_&&(t.avg[this.field_]=this.sum_/this.nonNullCount_)}}function s(t){this.field_=t,this.init=function(){this.min_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(null==this.min_||e<this.min_)&&(this.min_=e)},this.storeResult=function(t){t.min||(t.min={}),t.min[this.field_]=this.min_}}function o(t){this.field_=t,this.init=function(){this.max_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(null==this.max_||e>this.max_)&&(this.max_=e)},this.storeResult=function(t){t.max||(t.max={}),t.max[this.field_]=this.max_}}function r(t){this.field_=t,this.init=function(){this.sum_=null},this.accumulate=function(t){var e=t[this.field_];null!=e&&""!==e&&0/0!==e&&(this.sum_+=parseFloat(e))},this.storeResult=function(t){t.sum||(t.sum={}),t.sum[this.field_]=this.sum_}}return t.extend(e,{Data:{DataView:i,Aggregators:{Avg:n,Min:s,Max:o,Sum:r}}}),e}),define("_libs/charts/jqChart/src/js/jquery.jqChart.dev",["jquery"],function(t){!function(e){function i(t){this.callback=t,this.animations=[]}function n(t){function e(){n?(i(),Te(e),s=!0,n=!1):s=!1}var i=t,n=!1,s=!1;this.kick=function(){n=!0,s||e()},this.end=function(t){var e=i;t&&(s?(i=n?function(){e(),t()}:t,n=!0):t())}}function s(t,e,i,n,s){defaults={enabled:!0,delayTime:0,duration:2},t&&(this.enabled=!(t.enabled===!1),this.delayTime=t.delayTime||0,this.duration=t.duration||2,this.from=n,this.to=s,this.object=e,this.option=i)}function o(t,e,i,n,o){s.call(this,t,e,i,n,o)}function r(t){this.view=t}function a(t){r.call(this,t)}function l(t){t&&(this.shapes=[],this.mouseDownTools=[],this.mouseMoveTools=[],this.touchStartTools=[],this.touchMoveTools=[],this.defaultTool=new a(this),this.currentTool=this.defaultTool,this._createElements(t))}function h(t){this.defaults={location:"left",labels:{visible:!0,fillStyle:"black",lineWidth:1,font:"11px sans-serif",position:"outside",showLastLabel:!0,showFirstLabel:!0,hAlign:"center",vAlign:"center"},bands:null,title:{text:void 0,font:"14px sans-serif",margin:2},strokeStyle:"black",lineWidth:1,margin:5,visible:!0,reversed:!1,zoomEnabled:!1},this._initDefs(t),this.setOptions(t)}function c(){}function u(){}function d(){this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.visible=!0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowBlur=0,this.shadowOffsetX=0,this.shadowOffsetY=0}function p(t,e,i,n){d.call(this),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.useHitTestArea=!0}function f(t,e,i,n){d.call(this),this.x=t,this.y=e,this.width=i,this.height=n,this.cornerRadius=0}function m(t,e,i,n){d.call(this),this.x=t,this.y=e,this.width=i,this.height=n}function g(t,e,i,n,s){d.call(this),this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=s,this.width=this.height=2*i}function v(t,e,i){d.call(this),this.x=t,this.y=e,this.radius=i,this.width=this.height=2*i}function _(t,e,i,n,s){d.call(this),this.x=t,this.y=e,this.radius=i,this.startAngle=n,this.endAngle=s,this.width=this.height=2*i;var o=(n+s)/2,r=t+i*Math.cos(o),a=e+i*Math.sin(o);this.center=this.tooltipOrigin={x:r,y:a}}function y(){d.call(this)}function b(t,e,i){y.call(this),this.pts=t,this.closed=i,e&&(this.isBoundsHitTest=e,this.calculateBounds(t))}function w(t,e){y.call(this),t&&(this.closed=e,this.pts=t,this.calculateBounds(t))}function x(t,i,n,s){if(y.call(this),this.pts=t,this.crossPos=i,this.vertical=n||!1,this.isCurve=s||!1,t&&t.length>=2){var o=[];e.merge(o,t),n?e.merge(o,[i,t[t.length-1],i,t[1]]):e.merge(o,[t[t.length-2],i,t[0],i]),this.calculateBounds(o)}}function S(t,i,n,s){y.call(this),t&&(this.pts1=t,this.pts2=i,this.pts=[],e.merge(this.pts,t),s||e.merge(this.pts,c.reversePoints(i)),this.calculateBounds(this.pts),this.center=null,this.isCurve=n||!1)}function C(t){y.call(this),this.pts=t,this.calculateBounds(t)}function T(t,e,i){this.text=t,this.x=e,this.y=i,this.width=0,this.height=0,this.strokeStyle=null,this.textBaseline="middle",this.font="10px sans-serif",this.textAlign="left"}function M(t,e,i){this.x=t,this.y=e,this.src=i}function A(t){d.call(this),this.shapes=t}function D(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}function L(){}function k(t){this.renderShadows=t}function P(t,e){null==this.canvas&&(this.canvas=t,this.ctx=this._getContext(this.canvas)),this.chart=e}function I(t){this.defaults={text:"",font:"14px sans-serif",fillStyle:"black",lineWidth:0,margin:6},this.x=0,this.y=0,this.setOptions(t)}function R(t){var i=e.extend(!1,{},this.defaults,{hAlign:"left",vAlign:"top"});this.defaults=i,this.chart=t}function E(t){this.defaults={visible:!0,strokeStyle:"black",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,cornerRadius:10,padding:4},this.x=0,this.y=0,this.setOptions(t)}function O(t){this.defaults={strokeStyle:"black",lineWidth:1,length:6,position:"outside",visible:!0,zIndex:2,offset:.4},this.setOptions(t)}function j(t){a.call(this,t)}function F(t){r.call(this,t)}function N(t){r.call(this,t)}function B(t){r.call(this,t)}function z(t){this.pluginClass="ui-jqchart",this.tooltipClass="ui-jqchart-tooltip",l.call(this,t),this.timer=new n(e.proxy(this.partialUpdate,this)),this.storyboard=new i(e.proxy(this._renderShapes,this)),this.defaultTool=new j(this),this.currentTool=this.defaultTool,this.mouseDownTools.push(new N(this)),this.mouseDownTools.push(new F(this)),this.touchMoveTools.push(new B(this))}function U(t,e,i,n,s,o){d.call(this),this.high=e,this.low=i,this.open=n,this.close=s,this.x=t-o/2,this.width=o,this.height=Math.abs(e-i),this.y=Math.min(e,i),this.isUp=n>s,this.tooltipOrigin={x:t,y:Math.min(e,i)},this.center={x:t,y:(n+s)/2},this.createElements&&this.createElements(t,e,i,n,s,o)}function V(t,e,i,n,s,o){U.call(this,t,e,i,n,s,o)}function H(t){this.colorsDefault=["#418CF0","#FCB441","#E0400A","#056492","#BFBFBF","#1A3B69","#FFE382","#129CDD","#CA6B4B","#005CDB","#F3D288","#506381","#F1B9A8","#E0830A","#7893BE"],this.colorsGrayScale=$(),this.defaults={type:"default"},this.setOptions(t)}function $(){for(var t=16,e=[],i=0;t>i;i++){var n=200-11*i;n=n.toString();var s="rgb("+n+","+n+","+n+")";e.push(s)}return e}function W(t){this.chart=t,this.defaults={visibility:"auto",resetZoomTooltipText:"Reset Zoom (100%)",zoomingTooltipText:"Zoom in to selection area",panningTooltipText:"Pan the chart",hAlign:"right",vAlign:"top"}}function G(t){this.defaults={lineCap:"butt",lineJoin:"miter",miterLimit:10,lineWidth:1,size:8,offset:0,linkLineWidth:1,type:"circle"},this.setOptions(t)}function q(t){this.defaults={strokeStyle:"gray",lineWidth:1,visible:!0},this.setOptions(t)}function Z(t){this.defaults={strokeStyle:"gray",lineWidth:1,title:{margin:2,hAlign:"left",vAlign:"top"}},this.setOptions(t)}function Y(t){this.defaults={lineWidth:0,fillStyle:"gray",title:{margin:2,hAlign:"left",vAlign:"top"}},this.setOptions(t)}function X(t){this.defaults={location:"right",title:{text:void 0,margin:0},border:{padding:2,strokeStyle:"gray",cornerRadius:6},margin:4,visible:!0,font:"12px sans-serif",textLineWidth:0},this._itemMargin=4,this.setOptions(t)}function J(t){this.defaults={font:"12px sans-serif",textFillStyle:"black",textLineWidth:0},this.lblMargin=4,this.setOptions(t)}function K(t){this.chart=t,this.border=new E,this.border.cornerRadius=0,this.border.lineWidth=0,this.isMouseOver=!1}function Q(t,e){this.chart=t,e&&this.setOptions(e)}function te(t){this.setOptions(t)}function ee(t){var i=e.extend(!0,{},this.defaults,{lineWidth:2,markers:{},xValuesField:void 0,yValuesField:void 0});this.defaults=i,te.call(this,t)}function ie(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function ne(t){ie.call(this,t)}function se(t){this.isVertical=!0,te.call(this,t)}function oe(t){te.call(this,t)}function re(t){var i=e.extend(!0,{},this.defaults,{explodedRadius:10});this.defaults=i,te.call(this,t)}function ae(t){var i=e.extend(!0,{},this.defaults,{markers:{type:"diamond"}});this.defaults=i,te.call(this,t)}function le(t){ee.call(this,t)}function he(t){ee.call(this,t)}function ce(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function ue(t){var i=e.extend(!0,{},this.defaults,{stackedGroupName:""});this.defaults=i,oe.call(this,t)}function de(t){var i=e.extend(!0,{},this.defaults,{stackedGroupName:""});this.defaults=i,se.call(this,t)}function pe(t){ue.call(this,t)}function fe(t){de.call(this,t)}function me(t){oe.call(this,t)}function ge(t){se.call(this,t)}function ve(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null});this.defaults=i,te.call(this,t)}function _e(t){var i=e.extend(!0,{},this.defaults,{lineWidth:0,markers:null,xValuesField:void 0,fromValuesField:void 0,toValuesField:void 0});this.defaults=i,te.call(this,t)}function ye(t,e){this.chart=t,e&&this.setOptions(e)}function be(t){h.call(this,t)}function we(t){be.call(this,t),this.DataType="CategoryAxis"}function xe(t){be.call(this,t),this.DataType="LinearAxis"}function Se(t){xe.call(this,t),this.DataType="DateTimeAxis"}function Ce(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype}e.fn.jqChart=function(t,i,n){if("object"==typeof t)i=t;else if("string"==typeof t){if(t=t.toLowerCase(),e.fn.jqChart.methods[t])return e.fn.jqChart.methods[t].call(this,i,n);e.error("Method "+method+" does not exist on jQuery.jqChart")}var s=this.data("data");return s||(s=new z(this),this.data("data",s)),s._processOptions(i),this},e.fn.jqChart.methods={chart:function(){return this.data("data")},destroy:function(){var t=this.data("data");t&&(t.destroy(),this.removeData("data"))},options:function(){var t=this.data("data");if(t)return t.options},option:function(t,e){var i=this.data("data");if(i){if(!e)return i.options[t];i.options[t]=e,i._processOptions(i.options)}},update:function(t){var i=this.data("data");if(!i)return this;var n=e.extend(!1,{},i.options,t||{});i._processOptions(n)},todataurl:function(t){var e=this.data("data");return e?e.toDataURL(t):null},highlightdata:function(t){var e=this.data("data");e&&e.highlightData(t)},ismouseover:function(){var t=this.data("data");return t?t.isMouseOver:!1},exporttoimage:function(t){var e=this.data("data");e&&e.exportToImage(t)},exporttopdf:function(t){var e=this.data("data");e&&e.exportToPdf(t)}},e.fn.jqChart.defaults={title:{margin:8,font:"22px sans-serif"},tooltips:{disabled:!1,type:"normal",borderColor:"auto",snapArea:25,highlighting:!0,highlightingFillStyle:"rgba(204, 204, 204, 0.5)",highlightingStrokeStyle:"rgba(204, 204, 204, 0.5)"},crosshairs:{enabled:!1,snapToDataPoints:!0,hLine:{visible:!0,strokeStyle:"red"},vLine:{visible:!0,strokeStyle:"red"}},globalAlpha:1,mouseInteractionMode:"panning",selectionRect:{fillStyle:"rgba(125,125,125,0.2)",strokeStyle:"gray",lineWidth:0},shadows:{enabled:!1,shadowColor:"#cccccc",shadowBlur:8,shadowOffsetX:2,shadowOffsetY:2},watermark:{hAlign:"right",vAlign:"bottom"},noDataMessage:{text:"No data available",font:"20px sans-serif"},exportConfig:{server:"http://www.jqchart.com/export/default.aspx",method:"post"}},e.fn.jqChart.labelFormatter=function(t,i){return t?e.jqChartSprintf(t,i):String(i)},e.fn.jqMouseCapture=function(t){var i=e(document);return this.each(function(){var n=e(this),s={};n.mousedown(function(e){var o;t.move&&(o=function(e){t.move.call(n,e,s)},i.mousemove(o));var r,a=function(){t.move&&i.unbind("mousemove",o),i.unbind("mouseup",r)};return r=t.up?function(e){return a(),t.up.call(n,e,s)}:a,i.mouseup(r),e.preventDefault(),t.down.call(n,e,s)})}),this},e.jqChartSprintf=function(){function t(t,e,i,n){var s=t.length>=e?"":Array(1+e-t.length>>>0).join(i);return n?t+s:s+t}function i(e,i,n,s,o){var r=s-e.length;return r>0&&(e=n||!o?t(e,s," ",n):e.slice(0,i.length)+t("",r,"0",!0)+e.slice(i.length)),e}function n(e,n,s,o,r,a,l){var h=e>>>0;return s=s&&h&&{2:"0b",8:"0",16:"0x"}[n]||"",e=s+t(h.toString(n),a||0,"0",!1),i(e,s,o,r,l)}function s(t,e,n,s,o){return null!=s&&(t=t.slice(0,s)),i(t,"",e,n,o)}var o=arguments,r=0,a=o[r++];return a.replace(e.jqChartSprintf.regex,function(e,a,l,h,c,u,d){if("%%"==e)return"%";for(var p=!1,f="",m=!1,g=!1,v=0;l&&v<l.length;v++)switch(l.charAt(v)){case" ":f=" ";break;case"+":f="+";break;case"-":p=!0;break;case"0":m=!0;break;case"#":g=!0}if(h=h?"*"==h?+o[r++]:"*"==h.charAt(0)?+o[h.slice(1,-1)]:+h:0,0>h&&(h=-h,p=!0),!isFinite(h))throw new Error("sprintf: (minimum-)width must be finite");u=u?"*"==u?+o[r++]:"*"==u.charAt(0)?+o[u.slice(1,-1)]:+u:"fFeE".indexOf(d)>-1?6:"d"==d?0:void 0;var _=a?o[a.slice(0,-1)]:o[r++];switch(d){case"s":return s(String(_),p,h,u,m);case"c":return s(String.fromCharCode(+_),p,h,u,m);case"b":return n(_,2,g,p,h,u,m);case"o":return n(_,8,g,p,h,u,m);case"x":return n(_,16,g,p,h,u,m);case"X":return n(_,16,g,p,h,u,m).toUpperCase();case"u":return n(_,10,g,p,h,u,m);case"i":case"d":var y=parseInt(+_),b=0>y?"-":f;return _=b+t(String(Math.abs(y)),u,"0",!1),i(_,b,p,h,m);case"e":case"E":case"f":case"F":case"g":case"G":var y=+_,b=0>y?"-":f,w=["toExponential","toFixed","toPrecision"]["efg".indexOf(d.toLowerCase())],x=["toString","toUpperCase"]["eEfFgG".indexOf(d)%2];return _=b+Math.abs(y)[w](u),i(_,b,p,h,m)[x]();default:return e}})},e.jqChartSprintf.regex=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,e.jqChartDateFormatter=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,s=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(o,r,a){var l=e.jqChartDateFormat,h=l.amPm;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(r=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");r=String(l.masks[r]||r||"ddd mmm dd yyyy HH:MM:ss"),"UTC:"==r.slice(0,4)&&(r=r.slice(4),a=!0);var c=a?"getUTC":"get",u=o[c+"Date"](),d=o[c+"Day"](),p=o[c+"Month"](),f=o[c+"FullYear"](),m=o[c+"Hours"](),g=o[c+"Minutes"](),v=o[c+"Seconds"](),_=o[c+"Milliseconds"](),y=a?0:o.getTimezoneOffset(),b={d:u,dd:s(u),ddd:l.dayNames[d],dddd:l.dayNames[d+7],m:p+1,mm:s(p+1),mmm:l.monthNames[p],mmmm:l.monthNames[p+12],yy:String(f).slice(2),yyyy:f,h:m%12||12,hh:s(m%12||12),H:m,HH:s(m),M:g,MM:s(g),s:v,ss:s(v),l:s(_,3),L:s(_>99?Math.round(_/10):_),t:12>m?h[0].charAt(0)||"":h[1].charAt(0)||"",tt:12>m?h[0]:h[1],T:12>m?h[2].charAt(0)||"":h[3].charAt(0)||"",TT:12>m?h[2]:h[3],Z:a?"UTC":(String(o).match(i)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+s(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:l.s(u)};return r.replace(t,function(t){return t in b?b[t]:t.slice(1,t.length-1)})}}(),e.jqChartDateFormat={masks:{shortDate:"m/d/yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT"},dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],amPm:["am","pm","AM","PM"],s:function(t){return 11>t||t>13?["st","nd","rd","th"][Math.min((t-1)%10,3)]:"th"},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},i.prototype={begin:function(){if(!l.use_excanvas){var t=this.animations;if(t&&0!=t.length){this.stopped=!1;for(var e=new Date,i=0;i<t.length;i++){var n=t[i];n.begin(e)}this.animate()}}},animate:function(){if(!this.stopped){for(var t=this.animations,i=new Date,n=!1,s=0;s<t.length;s++){var o=t[s],r=o.animate(i);n=n||r}n&&(this.callback(),Te(e.proxy(this.animate,this)))}},stop:function(){this.stopped=!0},clear:function(){this.animations=[]},addAnimation:function(t){this.animations.push(t)}};var Te=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}();s.prototype={begin:function(t){this.startTime=u.addSeconds(t,this.delayTime),this.endTime=u.addSeconds(this.startTime,this.duration),this.timeDiff=this.endTime.getTime()-this.startTime.getTime(),this.valueDiff=this.to-this.from,this.object[this.option]=this.from,this.lastIsSet=!1},animate:function(t){if(t>=this.endTime)return this.lastIsSet?!1:(this.object[this.option]=this.to,this.lastIsSet=!0,!0);if(t>this.startTime){var e=t.getTime()-this.startTime.getTime(),i=this.from+this.valueDiff*e/this.timeDiff;i===this.to&&(this.lastIsSet=!0),this.object[this.option]=i}return!0}},o.prototype=new s,o.constructor=o,o.prototype.begin=function(t){this.startTime=u.addSeconds(t,this.delayTime),this.endTime=u.addSeconds(this.startTime,this.duration),this.object[this.option]=this.from,this.lastIsSet=!1},o.prototype.animate=function(t){return t>=this.endTime?this.lastIsSet?!1:(this.object[this.option]=this.to,this.lastIsSet=!0,!0):!0},r.prototype={canStart:function(){return!1},start:function(){},keyDown:function(){},keyUp:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},touchStart:function(){},touchMove:function(){},touchEnd:function(){},mouseWheel:function(){},stop:function(){},stopTool:function(){this.view.currentTool==this&&this.view.setCurrentTool(null)}},a.prototype=new r,a.constructor=a,a.prototype.mouseDown=function(t){for(var e=this.view.mouseDownTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}},a.prototype.mouseMove=function(t){for(var e=this.view.mouseMoveTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processMouseMove(t)},a.prototype.touchStart=function(t){for(var e=this.view.touchStartTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processTouchStart(t)},a.prototype.touchMove=function(t){for(var e=this.view.touchMoveTools,i=0;i<e.length;i++){var n=e[i];if(n.canStart(t))return this.view.setCurrentTool(n),void 0}this.view._processTouchMove(t)},l.setShadows=function(t,e,i){if(i){var n=i.options.shadows;t.shadowColor=c.isNull(e.shadowColor)?n.shadowColor:e.shadowColor,t.shadowBlur=c.isNull(e.shadowBlur)?n.shadowBlur:e.shadowBlur,t.shadowOffsetX=c.isNull(e.shadowOffsetX)?n.shadowOffsetX:e.shadowOffsetX,t.shadowOffsetY=c.isNull(e.shadowOffsetY)?n.shadowOffsetY:e.shadowOffsetY}},l.support_canvas=function(){return!!document.createElement("canvas").getContext},l.use_excanvas=l.support_canvas()?!1:!0,l.isTouchDevice=!!("ontouchstart"in window),l.isGestureDevice=!!("ongesturestart"in window),l.checkIfRetinaDisplay=function(){var t="(-webkit-min-device-pixel-ratio: 1.5),                      (min--moz-device-pixel-ratio: 1.5),                      (-o-min-device-pixel-ratio: 3/2),                      (min-resolution: 1.5dppx)";return window.devicePixelRatio>1?!0:window.matchMedia&&window.matchMedia(t).matches?!0:!1},l.isRetinaDisplay=l.checkIfRetinaDisplay(),l.prototype={_createElements:function(t){this.elem=t;var i=this;t.mouseenter(function(t){i._mouseEnter(t)}),t.mouseleave(function(t){i._mouseLeave(t)}),t.jqMouseCapture({down:e.proxy(i._mouseDown,this),move:e.proxy(i._mouseMove,this),up:e.proxy(i._mouseUp,this)}),t.mousemove(function(t){i.isMouseDown||i._mouseMove(t)}),t.keydown(function(t){i._keyDown(t)}),t.keyup(function(t){i._keyUp(t)}),t.resize(function(){i._resize()}),e(window).bind("resize.jqChart",function(){i._resize()}),e(window.document).bind("keydown.jqChart",function(t){i._keyDown(t)}),t.bind("mousewheel",function(t,e,n,s){i._mouseWheel(t,e,n,s)}),l.isTouchDevice&&(t.bind("touchstart",function(t){i._touchStart(t)}),t.bind("touchmove",function(t){i._touchMove(t)}),t.bind("touchend",function(t){i._touchEnd(t)})),this.canvas=this._createCanvas(),this.tooltip=this._createTooltip(),this.shapeRenderer=new P(this.canvas,this),this.ctx=this.shapeRenderer.ctx},_setOptions:function(){this.locOffset=null;var t=this.elem;this.originalCursor="auto",t.hasClass(this.pluginClass)||t.addClass(this.pluginClass),"static"==t.css("position")&&t.css("position","relative"),this.tooltip.hasClass(this.tooltipClass)||this.tooltip.addClass(this.tooltipClass)},_createHighlightRenderer:function(){if(l.use_excanvas){this.hlCanvas=this._createCanvas(!0);var t=e('<div style="position:absolute"></div>');this.elem.append(t),t.append(this.hlCanvas),this.hlRenderer=new P(this.hlCanvas,this),this.hlRenderer.div=t}else this.hlCanvas=this._createCanvas(),this.hlRenderer=new P(this.hlCanvas,this);this.hlRenderer.isHighlighting=!0},_createCanvas:function(t){var i=document.createElement("canvas");return i.width=10,i.height=10,e(i).css({position:"absolute",left:0,top:0}),l.use_excanvas&&(window.G_vmlCanvasManager.init_(document),window.G_vmlCanvasManager.initElement(i)),t||this.elem.append(i),i},_setCanvasSize:function(t,e,i){t.width=e,t.height=i},_setRetinaDispOpts:function(t,e,i){t.setAttribute("width",2*e),t.setAttribute("height",2*i);var n=t.getContext("2d");n.scale(2,2)},_createTooltip:function(){var t=e('<div style="position:absolute;display:none"></div>');return this.elem.append(t),t},_addTrialWatermark:function(t){var e=window.location.host.indexOf("www.jquerychart.com");if(-1==e&&(e=window.location.host.indexOf("www.jqchart.com"),-1==e)){var i=new T("www.jqchart.com");i.chart=this,i.font="14px sans-serif",i.fillStyle="gray",i.measure(this.ctx),i.x=this._width-i.width-16,i.y=this._height-i.height,t.push(i)
}},_measure:function(){},_arrange:function(){},_keyDown:function(t){this.currentTool.keyDown(t)},_keyUp:function(t){this.currentTool.keyUp(t)},_mouseEnter:function(){this.isMouseOver=!0},_mouseLeave:function(){this._clearRenderers(),this.locOffset=null,this.isMouseOver=!1},_mouseDown:function(t){null!=this._oldShape&&this._triggerShapeEvent("MouseDown",this._oldShape),this.isMouseDown=!0,this.currentTool.mouseDown(t)},_mouseMove:function(t){this._initMouseInput(t),this._processMouseEvents(),this.currentTool.mouseMove(t)},_mouseUp:function(t){null!=this._oldShape&&this._triggerShapeEvent("MouseUp",this._oldShape),this.isMouseDown=!1,this.currentTool.mouseUp(t)},_mouseWheel:function(t,e,i,n){this.currentTool.mouseWheel(t,e,i,n)},_touchStart:function(t){this._initTouchInput(t),this.isTouchOver=!0,this._processTouchEvents(),this.currentTool.touchStart(t)},_touchMove:function(t){this._initTouchInput(t);var e=this.touchInput[0];this.isTouchOver=this.contains(e.locX,e.locY),this._processTouchEvents(),this.currentTool.touchMove(t)},_touchEnd:function(t){this._initTouchInput(t),null!=this._oldShape&&(this._triggerShapeEvent("TouchEnd",this._oldShape),this._oldShape=null),this.currentTool.touchEnd(t)},_initMouseInput:function(t){this.isMouseOver=!0;var e=t.pageX,i=t.pageY;this.locOffset||(this.locOffset=this.elem.offset());var n=this.locOffset,s=e-n.left,o=i-n.top,r={x:e,y:i,locX:s,locY:o};this.mouseInput=r},_initTouchInput:function(t){var e=t.originalEvent.touches;this.locOffset||(this.locOffset=this.elem.offset());for(var i=this.locOffset,n=[],s=0;s<e.length;s++){var o=e[s],r=o.pageX,a=o.pageY,l=r-i.left,h=a-i.top;n.push({x:r,y:a,locX:l,locY:h})}this.touchInput=n},getAllTouches:function(t){for(var i=["touches","changedTouches"],n=[],s=0;s<i.length;s++)for(var o=t.originalEvent[i[s]],r=0;r<o.length;r++){var a=o[r];-1==e.inArray(a,n)&&n.push(a)}return n},_resize:function(){var t=this.elem,e=t.width(),i=t.height();if(e!=this._width||i!=this._height){var n=this.options;n&&(c.isNull(n.width)||(n.width=e),c.isNull(n.height)||(n.height=i)),this._setOptions(this.options)}},_clearRenderers:function(){this._oldTShapes&&(this._oldTShapes=null,this.elem.trigger("dataHighlighting",null)),this._oldShape=null,this._resetCursor(),this.hideTooltip(),this.hlRenderer&&this.hlRenderer._clear()},_processMouseMove:function(){this._processTooltips(this.mouseInput)},_processMouseEvents:function(){var t=this.mouseInput,e=this.hitTest(t.locX,t.locY);null!=this._oldShape&&this._oldShape==e?this._triggerShapeEvent("MouseMove",this._oldShape):(null!=this._oldShape&&(this._triggerShapeEvent("MouseLeave",this._oldShape),this._oldShape.cursor&&this._resetCursor()),null!=e&&(this._triggerShapeEvent("MouseEnter",e),e.cursor&&this.elem.css("cursor",e.cursor)),this._oldShape=e)},_processTouchEvents:function(){var t=this.touchInput[0];if(t){var e=this.hitTest(t.locX,t.locY);null!=this._oldShape&&this._oldShape==e?this._triggerShapeEvent("TouchMove",this._oldShape):(null!=this._oldShape&&this._triggerShapeEvent("TouchEnd",this._oldShape),null!=e&&this._triggerShapeEvent("TouchStart",e),this._oldShape=e)}},_processTooltips:function(t){var e=this.hasTooltips,i=this.hasHighlighting;if(e||i){var n=this.options.tooltips.snapArea,s=this._getTooltipShapes(t.locX,t.locY,n,t),o=!0;null!=this._oldTShapes&&c.compareArrays(this._oldTShapes,s)?o=!1:(null!=s&&(this._initTooltip(s),this._highlightShapes(s)),s&&(this._oldTShapes=s)),s&&e&&o&&this._setTooltipPos(s,t)}},_setTooltipPos:function(t,i){var n=this.tooltip.outerWidth(!0),s=this.tooltip.outerHeight(!0),o=this._width,r=this._height,a=t[0]._getTooltipPosition(i,n,s,o,r),l=a.y,h=t.length;h>1&&(l=0,e.each(t,function(){l+=this._getTooltipPosition(i,n,s,o,r).y}),l/=h),l=c.fitInRange(l,0,r-s),this.tooltip.stop(),this.tooltip.animate({left:a.x,top:l},100)},_processTouchStart:function(){this._processTooltips(this.touchInput[0])},_processTouchMove:function(){this._processTooltips(this.touchInput[0])},_initTooltip:function(t){if(this.hasTooltips&&t&&t.length){var i,n=t.length,s="";if(1==n?i=t[0].context:(i=[],e.each(t,function(){i.push(this.context)})),i){var o=new e.Event("tooltipFormat");this.elem.trigger(o,[i]),s=o.result?o.result:this._getTooltipText(t),this.tooltip.html(s);var r=this.options.tooltips;1==n&&r.borderColor&&("auto"==r.borderColor&&this.tooltip.css("border-color",t[0].getTooltipColor()),this.tooltip.css("border-color",r.borderColor)),r.background&&this.tooltip.css("background",r.background),this.showTooltip()}}},_highlightShapes:function(t){if(this.hasHighlighting){this.hlRenderer._clear();var i=this.options.tooltips,n=[];e.each(t,function(t,e){var s=e._createHighlightShape(i.highlightingFillStyle,i.highlightingStrokeStyle);n.push(s)});var s;1==n.length?(s=n[0].context,s.shape=n[0]):(s=[],e.each(n,function(){s.push(this.context),s.shape=this}));var o=new e.Event("dataHighlighting");this.elem.trigger(o,[s]),o.result!==!1&&(l.use_excanvas?this.hlRenderer._render(n):(this.hlRenderer.ctx.save(),this._setClip&&this._setClip(this.hlRenderer.ctx),this.hlRenderer._render(n),this.hlRenderer.ctx.restore()))}},_getClosestShape:function(t,e,i){for(var n=t[0],s=1;s<t.length;s++){var o=t[s];0==d.compare(n,o,i,e)&&(n=o)}return n},_getTooltip:function(){return"Tooltip"},_getTooltipText:function(t){var i="",n=this;return e.each(t,function(){i+=n._getTooltip(this)}),i},_getTooltipShapes:function(t,e,i,n){i||(i=0);for(var s=[],o=this.shapes.length-1;o>=0;o--){var r=this.shapes[o];if(r.context&&!r.isLegendItem&&!r.isAxisLabel){var a=r.hitTest(n.locX,n.locY,i);"function"==typeof r.hitTestNonHV&&(a=r.hitTestNonHV(n.locX,n.locY,i)),a===!0?s.push(r):a&&s.push(a)}}var l=this._getClosestShape(s,i,n);return l?[l]:null},_resetCursor:function(){this.elem.css("cursor")!=this.originalCursor&&this.elem.css("cursor",this.originalCursor)},_triggerShapeEvent:function(t,e){e.context.shape=e,this.elem.trigger("dataPoint"+t,e.context)},_exportToImage:function(t,i){t=t||{};var n=e.extend({},i,t);if(n.type=t.type||"image/png",t.fileName)n.fileName=t.fileName;else switch(n.type){case"image/jpeg":n.fileName="jqChart.jpg";break;case"image/png":default:n.fileName="jqChart.png"}var s=this.toJSON(n);this._doRequest(n.server,"canvas="+s,n.method)},_exportToPdf:function(t,i){t=t||{};var n=e.extend({},i,t);n.type="application/pdf",n.fileName=t.fileName||"chart.pdf";var s=this.toJSON(n);this._doRequest(n.server,"canvas="+s,n.method)},_toJSON:function(t,e){var i=this,n="{type:'"+e.type+"',fileName:'"+e.fileName+"'";n+=",width:"+i._width+",height:"+i._height+",shapes:[";for(var s=0;s<t.length;s++){var o=t[s].toJSON();o&&(n+="{"+o+"}",s!=t.length-1&&(n+=","))}return n+"]}"},_doRequest:function(e,i,n){if(e&&i){i="string"==typeof i?i:t.param(i);var s="";t.each(i.split("&"),function(){var t=this.split("=");s+='<input type="hidden" name="'+t[0]+'" value="'+t[1]+'" />'}),t('<form action="'+e+'" method="'+(n||"post")+'">'+s+"</form>").appendTo("body").submit().remove()}},getCurrentTool:function(){return this.currentTool},setCurrentTool:function(t){this.currentTool!=t&&(null!=this.currentTool&&this.currentTool.stop(),this.currentTool=t?t:this.defaultTool,this.currentTool&&this.currentTool.start())},contains:function(t,e){return t>=0&&t<=this._width&&e>=0&&e<=this._height},hitTest:function(t,e,i){i||(i=0);for(var n=this.shapes.length-1;n>=0;n--){var s=this.shapes[n];if(s.context&&s.hitTest(t,e,i))return s}},showTooltip:function(){this.tooltip.show()},hideTooltip:function(){this.tooltip.hide()},stringFormat:function(t,i){return e.jqChartSprintf(i,t)},clear:function(){this._clearRenderers(),this.shapeRenderer._clear()},render:function(){},destroy:function(){var t=this.elem;t.empty(),t.unbind(),e(window).unbind("resize.jqChart"),e(window.document).unbind("keydown.jqChart"),this.options,t.hasClass(this.pluginClass)&&t.removeClass(this.pluginClass)},toDataURL:function(t){return l.use_excanvas?null:this.canvas.toDataURL(t)},getShapesPerData:function(t){var i=[],n=this.shapes;return e.each(t,function(){var t=this;e.each(n,function(){this.context&&this.context.dataItem==t&&i.push(this)})}),i},highlightData:function(t){if(!t)return this._clearRenderers(),null;var e=this.getShapesPerData(t);if(0==e.length)return null;this._highlightShapes(e),this._initTooltip(e);var i=e[0].getCenter();return this._setTooltipPos(e,{locX:i.x,locY:i.y}),e}},h.prototype={_initDefs:function(){e.extend(this,{maxInter200Px:8,lblMargin:4,crossOffsetX:0,crossOffsetY:0,origin:0,length:300,x:0,y:0})},_calculateActualInterval:function(t,e){if(this.interval)return this.interval;var i=1;this.getOrientation&&"x"!=this.getOrientation()||(i=.8);for(var n=i*this.maxInter200Px,s=Math.max(this.length*n/200,1),o=e-t,r=o/s,a=Math.pow(10,Math.floor(c.log10(r))),l=[10,5,2,1],h=0;h<l.length;h++){var u=l[h],d=a*u;if(o/d>s)break;r=d}return r},_setVisibleRanges:function(){this.actualVisibleMinimum=c.isNull(this.visibleMinimum)?this.actualMinimum:this.visibleMinimum,this.actualVisibleMaximum=c.isNull(this.visibleMaximum)?this.actualMaximum:this.visibleMaximum,"date"==e.type(this.actualVisibleMinimum)&&(this.actualVisibleMinimum=this.actualVisibleMinimum.getTime()),"date"==e.type(this.actualVisibleMaximum)&&(this.actualVisibleMaximum=this.actualVisibleMaximum.getTime()),this.options&&(this.options.visibleMinimum=this.visibleMinimum,this.options.visibleMaximum=this.visibleMaximum)},_setMinMax:function(t,e){this.logarithmic?(this.actualMinimum=c.isNull(this.minimum)?t:c.log(this.minimum,this.logBase),this.actualMaximum=c.isNull(this.maximum)?e:c.log(this.maximum,this.logBase)):(this.actualMinimum=c.isNull(this.minimum)?t:this.minimum,this.actualMaximum=c.isNull(this.maximum)?e:this.maximum)},_getNextPosition:function(t,e){return c.round(t+e)},_getMarkInterval:function(t,e){var i;return i=t.interval?t.interval:e?this.actualInterval:this.actualInterval/2},_getIntervals:function(t,e){var i=0;e&&e.intervalOffset&&(i=e.intervalOffset);for(var n=[],s=this._getIntervalStart(this.actualVisibleMinimum,t),o=s+i;o<=this.actualVisibleMaximum;o=this._getNextPosition(o,t))n.push(o);return n},_getIntervalStart:function(t,e){var i=t-this.getCrossing(),n=this._alignToInterval(i,e);return t>n&&(n=this._alignToInterval(i+e,e)),n},_alignToInterval:function(t,e){return c.round(c.round(Math.floor(t/e))*e)+this.getCrossing()},_createLabel:function(t,i){var n=new T(t);return n.isAxisLabel=!0,n.context={chart:this.chart,axis:this,text:t},e.extend(n,i),this.chart.elem.trigger("axisLabelCreating",n),n.measure(this.chart.ctx),n},_getLabelIntervals:function(t,e){return this._getIntervals(t,e)},_measureRotatedLabels:function(t){for(var e=this.isAxisVertical,i=0,n=0,s=0;s<t.length;s++){var o=t[s],r=Math.sqrt(o.width*o.width+o.height*o.height),a=o.rotationAngle;if(e){var l=Math.abs(Math.cos(a)*r);i=Math.max(i,l)}else{var h=Math.abs(Math.sin(a)*r);n=Math.max(n,h)}}return"inside"==this.labels.position?(this.lblsW=i,this.lblsH=n,{w:0,h:0}):{w:i,h:n}},_correctLabelsPositions:function(t){var e=0,i=0,n=this.reversed===!0,s="inside"==this.labels.position,o=this.isAxisVertical,r=this.lblMargin;if(o){for(var a=[],l=0;l<t.length;l++){var h=t[l],c=!1,u=h.y;switch(h.textBaseline){case"middle":u-=h.height/2;break;case"bottom":u-=h.height}var d=0;for(d=0;d<a.length;d++){var p=a[d];if(c=n?u>p.y+p.h:p.y>u+h.height){p.y=u,p.h=h.height,p.w=Math.max(p.w,h.width+r),p.labels.push(h);break}}0==c&&(a[d]={y:u,h:h.height,w:h.width+r,labels:[h]})}var f="right"==this.location;f=s?!f:f,e=0;for(var l=0;l<a.length;l++){for(var p=a[l],d=0;d<p.labels.length;d++){var h=p.labels[d];f?h.x+=e:h.x-=e}e+=p.w}}else{for(var a=[],l=0;l<t.length;l++){var h=t[l],m=h.x;switch(h.textAlign){case"center":m-=h.width/2;break;case"right":m-=h.width}var c=!1,d=0;for(d=0;d<a.length;d++){var p=a[d];if(c=n?p.x>m+h.width+r:m>p.x+p.w+r){p.x=m,p.w=h.width,p.h=Math.max(p.h,h.height+r),p.labels.push(h),c=!0;break}}0==c&&(a[d]={x:m,w:h.width,h:h.height+r,labels:[h]})}var g="bottom"==this.location;g=s?!g:g,i=0;for(var l=0;l<a.length;l++){for(var p=a[l],d=0;d<p.labels.length;d++){var h=p.labels[d];g?h.y+=i:h.y-=i}i+=p.h}}return"inside"==this.labels.position?(this.lblsW=e,this.lblsH=i,{w:0,h:0}):{w:e,h:i}},_removeOverlappedLabels:function(t){var e=0,i=0,n=0,s=0,o=0,r=0,a=0,l=Ae;this.reversed===!0,"inside"==this.labels.position;var h=this.isAxisVertical,c=this.lblMargin,u=2*c;if(h)for(var d=0;d<t.length;d++){var p=d;this.reversed&&(p=t.length-d-1);var f=t[p],m=f.y;switch(f.textBaseline){case"middle":m-=f.height/2;break;case"bottom":m-=f.height}r=f.y,a=r+f.height+u,l>a?(l=r,e=Math.max(e,f.width+c)):f.visible=!1}else for(var d=0;d<t.length;d++){var p=d;this.reversed&&(p=t.length-d-1);var f=t[p],g=f.x;switch(f.textAlign){case"center":g-=f.width/2;break;case"right":g-=f.width}n=f.x,s=n+f.width+u,n>o?(o=s,i=Math.max(i,f.height+c)):f.visible=!1}return"inside"==this.labels.position?(this.lblsW=e,this.lblsH=i,{w:0,h:0}):{w:e,h:i}},_measure:function(){var t=0;this.zoomEnabled&&(t=this.rangeSlider.breadth);var e={w:0,h:0};if(this.labels)if(this.labels.angle)e=this._measureRotatedLabels(this._getLabels());else switch(this.labels.resolveOverlappingMode){case"hide":e=this._removeOverlappedLabels(this._getLabels());break;case"multipleRows":default:e=this._correctLabelsPositions(this._getLabels())}this.title._measure();var i=this.title.height+t+this.lineWidth/2;this.isAxisVertical?e.w+=i:e.h+=i;var n=this.margin+this._getMaxOutsideTickMarksLength();if(this.isAxisVertical){if(0==this.isCustomWidth){var s=e.w+n;if(this.width!=s)return this.width=s,!0}}else if(0==this.isCustomHeight){var o=e.h+n;if(this.height!=o)return this.height=o,!0}return!1},_arrange:function(){var t=this.x,e=this.y,i=this.x+this.width,n=this.y+this.height;switch(this.location){case"left":i=t=this.x+this.width;break;case"right":i=t=this.x;break;case"top":n=e=this.y+this.height;break;case"bottom":n=e=this.y}if(this.title.text)switch(this.location){case"left":this.title.rotX=this.x,this.title.rotY=this.y+(this.height+this.title.width)/2,this.title.rotationAngle=c.radians(-90);break;case"right":this.title.rotX=this.x+this.width,this.title.rotY=this.y+(this.height-this.title.width)/2,this.title.rotationAngle=c.radians(90);break;case"top":this.title.x=this.x+(this.width-this.title.width)/2,this.title.y=this.y;break;case"bottom":this.title.x=this.x+(this.width-this.title.width)/2,this.title.y=this.y+this.height-this.title.height}this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.offset=this.lineWidth/2},_updateOrigin:function(){this.isAxisVertical?(this.origin=this.y,this.length=this.height):(this.origin=this.x,this.length=this.width)},_render:function(){var t=[];if(this.bands&&this.bands.length){var i=this._getBands();e.merge(t,i)}var n=this._getTickMarks(this.minorTickMarks,!1);e.merge(t,n);var s=this._getTickMarks(this.majorTickMarks,!0);e.merge(t,s);var o=this._getMainLine();t.push(o);var r=this._getLabels();if(this.labels&&!this.labels.angle)switch(this.labels.resolveOverlappingMode){case"hide":this._removeOverlappedLabels(r);break;case"multipleRows":default:this._correctLabelsPositions(r)}return this._filterLabels(r),this.title._render(t),e.merge(t,r),{postShapes:t,contextShapes:r}},_getBands:function(){for(var t,e,i=[],n=pos21=pos12=pos22=anotherSize=0,s=this.getOrientation(),o=0,r=this.bands.length;r>o;++o)if(e=this.bands[o],!(e.length<2)){if("x"==s){if(n=this.getPosition(e[0]),pos12=this.getPosition(e[1]),n>=this.x2||pos12<=this.x1)continue;n=Math.max(n,this.x1),pos12=Math.min(pos12,this.x2),t=new f(n,this.sharedAxis.y1,pos12-n,this.sharedAxis.height)}else{if(pos12=this.getPosition(e[0]),n=this.getPosition(e[1]),n<=this.y1||pos12>=this.y2)continue;pos12=Math.min(pos12,this.y2),n=Math.max(n,this.y1),t=new f(this.sharedAxis.x1,n,this.sharedAxis.width,n-pos12)}t.strokeStyle=null,t.fillStyle=e[2]||"rgba(0,0,0,0.2)",i[o]=t}return i},_getMainLine:function(){var t=this.crossOffsetX,e=this.crossOffsetY,i=new p(this.x1+t,this.y1+e,this.x2+t,this.y2+e);return i.strokeStyle=this.strokeStyle,i.lineWidth=this.lineWidth,i.strokeDashArray=this.strokeDashArray,i},_getMaxInsideTickMarksLength:function(){var t=0;return null!=this.minorTickMarks&&this.minorTickMarks.visible&&this.minorTickMarks.isInside()&&(t=Math.max(t,this.minorTickMarks.length)),null!=this.majorTickMarks&&this.majorTickMarks.visible&&this.majorTickMarks.isInside()&&(t=Math.max(t,this.majorTickMarks.length)),t},_getMaxOutsideTickMarksLength:function(){var t=0;return null!=this.minorTickMarks&&this.minorTickMarks.visible&&!this.minorTickMarks.isInside()&&(t=Math.max(t,this.minorTickMarks.length)),null!=this.majorTickMarks&&this.majorTickMarks.visible&&!this.majorTickMarks.isInside()&&(t=Math.max(t,this.majorTickMarks.length)),t},_getLabels:function(){var t=this.labels;if(null==t||t.visible===!1)return[];var e="inside"==t.position,i=this.lblMargin,n=this.offset,s=this.crossOffsetX,o=this.crossOffsetY,r=this.isAxisVertical;(r&&"center"==t.vAlign||!r&&"center"==t.hAlign)&&(i+=e?this._getMaxInsideTickMarksLength()+this.lineWidth/2:this._getMaxOutsideTickMarksLength());var a=[],l=this._getMarkInterval(t,!0);if(!l)return[];for(var h=this._getLabelIntervals(l,t),u=h.length,d=t.showFirstLabel,p=t.showLastLabel,f=0;u>f;f++)if((d||0!=f)&&(p||f!=u-1)){var m=h[f],g=this.getLabel(m),v=this._createLabel(g,t),_=this.getPosition(m);switch(this.location){case"left":switch(e?v.x=this.x+this.width+i+s:(v.x=this.x+this.width-i-n+s,v.textAlign="right"),v.y=_,t.vAlign){case"bottom":v.textBaseline="top";break;case"top":v.textBaseline="bottom"}if(this.labels.angle){var y=Math.min(90,Math.max(-90,this.labels.angle)),b=c.radians(y);v.rotX=v.x,v.rotY=v.y,v.rotationAngle=b}break;case"right":switch(e?(v.x=this.x-i+s,v.textAlign="right"):v.x=this.x+i+n+s,v.y=_,t.vAlign){case"bottom":v.textBaseline="top";break;case"top":v.textBaseline="bottom"}if(this.labels.angle){var y=Math.min(90,Math.max(-90,this.labels.angle)),b=c.radians(y);v.rotX=v.x,v.rotY=v.y,v.rotationAngle=b}break;case"top":switch(v.x=_,v.y=e?this.y+this.height+i+v.height/2+o:this.y+this.height-i-v.height/2-n+o,v.textBaseline="middle",t.hAlign){case"center":v.textAlign="center";break;case"left":v.textAlign="right";break;case"right":v.textAlign="left"}if(this.labels.angle){var y=Math.min(90,Math.max(-90,this.labels.angle));v.flip=y>0,y>0&&(y=-180+y);var b=c.radians(y),w=Math.sqrt(v.width*v.width+v.height*v.height);v.rotX=v.x+.5*Math.cos(b)*w,v.rotY=v.y+.5*Math.sin(b)*w,v.rotationAngle=b}break;case"bottom":switch(v.x=_,v.y=e?this.y-i-v.height/2+o:this.y+i+v.height/2+n+o,v.textBaseline="middle",t.hAlign){case"center":v.textAlign="center";break;case"left":v.textAlign="right";break;case"right":v.textAlign="left"}if(this.labels.angle){var y=Math.min(90,Math.max(-90,this.labels.angle));v.flip=0>y,0>y&&(y=180+y);var b=c.radians(y),w=Math.sqrt(v.width*v.width+v.height*v.height);v.rotX=v.x+.5*Math.cos(b)*w,v.rotY=v.y+.5*Math.sin(b)*w,v.rotationAngle=b}}a.push(v)}return a},_filterLabels:function(t){if(this.labels&&"inside"==this.labels.position)for(var i=this.chart.gridArea,n=i.x,s=i.y,o=i.width,r=i.height,a=t.length-1;a>=0;a--){var l=t[a];if(!l.isInRect(n,s,o,r)){var h=e.inArray(l,t);t.splice(h,1)}}},_getTickMarks:function(t,e){if(null==t||1!=t.visible)return[];for(var i,n,s,o,r=[],a=this.crossOffsetX,l=this.crossOffsetY,h=this.offset,c="inside"==t.position,u=this._getMarkInterval(t,e),d=t.length,f=this._getIntervals(u,t,e),m=0;m<f.length;m++){var g=this.getPosition(f[m]);switch(this.location){case"left":n=o=g,s=c?this.x+this.width+d+this.lineWidth/2+a:this.x+this.width-h+a,i=s-d;break;case"right":n=o=g,i=c?this.x-d-this.lineWidth/2+a:this.x+h+a,s=i+d;break;case"top":i=s=g,o=c?this.y+this.height+d+this.lineWidth/2+l:this.y+this.height-h+l,n=o-d;break;case"bottom":i=s=g,o=c?this.y-d-this.lineWidth/2+l:this.y+h+l,n=o+d}var v=new p(i,n,s,o);t._setLineSettings(v),r.push(v)}return r},_setChart:function(t){this.chart=t,this.title.chart=t},_getValue:function(t){return t},getCrossing:function(){return this.crossing||0},_initRadialMeasures:function(){var t;this.chart.options.halfPolar?(t=Math.min(2*this.width-10,this.height),this.cx=this.x+10):(t=Math.min(this.width,this.height),this.cx=this.x+this.width/2),this.cy=this.y+this.height/2,this.radius=t/2},getZoom:function(){if(!this.actualMaximum)return 1;var t=this.actualMaximum-this.actualMinimum,e=this.actualVisibleMaximum-this.actualVisibleMinimum,i=e/t;return i},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i),this.options=t,t&&(this.isCustomWidth=null!=t.width,this.isCustomHeight=null!=t.height),this.majorTickMarks=new O(i.majorTickMarks),i.minorTickMarks&&(this.minorTickMarks=new O(i.minorTickMarks),this.minorTickMarks.major=this.majorTickMarks),i.majorGridLines&&(this.majorGridLines=new q(i.majorGridLines)),i.minorGridLines&&(this.minorGridLines=new q(i.minorGridLines),this.minorGridLines.major=this.majorGridLines),this.isAxisVertical=this.isVertical(),this.title=new I(i.title)},getPosition:function(t){var e=this.actualVisibleMaximum,i=this.actualVisibleMinimum,n=this.length/(e-i)*(t-i),s=this.reversed===!0,o=this.isAxisVertical;return o&&s===!1||o===!1&&s?n=this.origin+this.length-n:n+=this.origin,n},getValue:function(t){var e=this.actualVisibleMaximum,i=this.actualVisibleMinimum,n=(t-this.origin)*(e-i)/this.length+i,s=this.reversed===!0,o=this.isAxisVertical;return(o&&s===!1||o===!1&&s)&&(n=i+e-n),n},getLabel:function(t){var i=null;null!=this.labels&&(i=this.labels.stringFormat);var n=e.fn.jqChart.labelFormatter(i,t);return n},isVertical:function(){return"left"==this.location||"right"==this.location?!0:!1},isValueVisible:function(t){return this.logarithmic&&(t=c.log(t,this.logBase)),t>=this.actualVisibleMinimum&&t<=this.actualVisibleMaximum},isInVisibleRange:function(t){var e=this.visibleMinimum,i=this.visibleMaximum;return c.isNull(e)||c.isNull(i)?!0:(this.logarithmic&&(e=c.log(e,this.logBase),i=c.log(i,this.logBase)),t>=e&&i>=t)}};var Me=-Number.MAX_VALUE,Ae=Number.MAX_VALUE;c.isNull=function(t){return null===t||void 0===t},c.roundH=function(t){return Math.round(t)-.5},c.round=function(t){var e=1/t;if(Math.abs(e)>1e4){var i=c.log10(Math.abs(e));if(i>13)return t}var n=t.toPrecision(14),s=parseFloat(n);return s},c.log10=function(t){return Math.log(t)/Math.LN10},c.log=function(t,e){return Math.log(t)/Math.log(e)},c.radians=function(t){return t*(Math.PI/180)},c.fitInRange=function(t,e,i){return e>t?t=e:t>i&&(t=i),t},c.sum=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i];return e},c.compareArrays=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},c.rotatePointAt=function(t,e,i,n,s){var o=Math.sin(i),r=Math.cos(i),a=t-n,l=e-s,h=n+a*r-l*o,c=s+a*o+l*r;return{x:h,y:c}},c.rotatePointsAt=function(t,e,i,n){for(var s=[],o=0;o<t.length;o+=2){var r=c.rotatePointAt(t[o],t[o+1],e,i,n);s.push(r.x),s.push(r.y)}return s},c.reversePoints=function(t){for(var e=[],i=t.length-2;i>=0;i-=2)e.push(t[i]),e.push(t[i+1]);return e},c.trimPoints=function(t){for(var e=t.slice(0),i=e.length;i>1&&(c.isNull(e[0])||c.isNull(e[1]));)e.splice(0,2),i=e.length;for(;i>1&&(c.isNull(e[i-2])||c.isNull(e[i-1]));)e.splice(i-2,2),i=e.length;return e},c.processDataField=function(t,i){if(!i)return null;var n,s,o,r=e.isPlainObject(i);r?(n=i.name,s=i.type,o=i.convert):n=i;for(var a,l,h=[],c=0;c<t.length;c++){if(a=t[c],l=a[n],o)l=o(l);else if(s)switch(s){case"numeric":"string"==typeof l&&(l=parseFloat(l));break;case"dateTime":"string"==typeof l&&(l=new Date(l))}h.push(l)}return h},c.mergeArraysXY=function(t,e){if(!t||0==t.length)return e;for(var i=[],n=0;n<t.length;n++){var s=[];s.push(t[n]),i.push(s)}for(var o,r=i.length,n=0;n<e.length;n++)if(o=e[n],r>n){var s=i[n];s.push(o)}else{var s=[null,o];i.Add(s)}return i},c.mergeArrays=function(t){for(var e=t.length,i=[],n=0;e>n;n++){var s=t[n];if(null==s)return null;for(var o=i.length,r=0;r<s.length;r++){var a=s[r];if(o>r){var l=i[r];l[n]=a}else{var l=[];l[n]=a,i.push(l)}}}return i},u.ticksInDay=864e5,u.getDaysInMonth=function(t,e){return 1==e?29==new Date(t,1,29).getDate()?29:28:[31,void 0,31,30,31,30,31,31,30,31,30,31][e]},u.addSeconds=function(t,e){var i=new Date(t.getTime()+1e3*e);return i},u.addDays=function(t,e){e=Math.max(e,1);var i=new Date(t.getTime());return i.setDate(t.getDate()+e),i},u.addYears=function(t,e){var i=new Date(t.getTime());return i.setFullYear(t.getFullYear()+e),i},u.addMonths=function(t,e){var i=new Date(t.getTime()),n=i.getDate();return i.setDate(1),i.setMonth(i.getMonth()+e),i.setDate(Math.min(n,u.getDaysInMonth(i.getFullYear(),i.getMonth()))),i},u.getDayOfWeek=function(t){var e=t.getDay();return 0===e?7:e},u.fromDays=function(t){return t*u.ticksInDay},u.fromHours=function(t){return 1e3*60*60*t},u.fromMinutes=function(t){return 1e3*60*t},u.fromSeconds=function(t){return 1e3*t},u.roundToDay=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());return e},d.compare=function(t,e,i,n){if(!t.useHitTestArea&&!e.useHitTestArea)return!0;if(t.useHitTestArea&&!e.useHitTestArea)return t.hitTest(i.locX,i.locY,n/3);if(t.hitTest(i.locX,i.locY,0))return!0;var s=t.getCenter(i),o=e.getCenter(i),r=i.locX-s.x,a=i.locY-s.y,l=Math.sqrt(r*r+a*a);r=i.locX-o.x,a=i.locY-o.y;var h=Math.sqrt(r*r+a*a);return h>=l},d.getColorFromFillStyle=function(t){if(null==t)return"#dddddd";if("string"==typeof t)return t;if(t.colorStops&&t.colorStops[0]){var e=t.colorStops[0].color;return"white"!=e&&"#ffffff"!=e?e:t.colorStops[1].color}return"#dddddd"},d.prototype.hitTest=function(){return!1},d.prototype.boundsHitTest=function(t,e,i){return this.useHitTestArea||(i=0),t>=this.x-i&&t<=this.x+this.width+i&&e>=this.y-i&&e<=this.y+this.height+i},d.prototype.render=function(t,e){e||this.setProperties(t)},d.prototype.renderDashedLine=function(t,e,i,n,s,o){var r=function(t,e){return Math.round(t)<=Math.round(e)},a=function(t,e){return Math.round(t)>=Math.round(e)},l=function(t,e){return Math.min(t,e)},h=function(t,e){return Math.max(t,e)},c={thereYet:a,cap:l},u={thereYet:a,cap:l};o.beginPath(),e-n>0&&(u.thereYet=r,u.cap=h),t-i>0&&(c.thereYet=r,c.cap=h),o.moveTo(t,e);for(var d=t,p=e,f=0,m=!0,g=s.length;!c.thereYet(d,i)||!u.thereYet(p,n);){var v=Math.atan2(n-e,i-t),_=s[f];d=c.cap(i,d+Math.cos(v)*_),p=u.cap(n,p+Math.sin(v)*_),m?o.lineTo(d,p):o.moveTo(d,p),f=(f+1)%g,m=!m}null!=this.strokeStyle&&this.lineWidth>0&&o.stroke()},d.prototype.setProperties=function(t){t.fillStyle=this._createGradient(t,this.fillStyle)||"#000000",t.strokeStyle=this.strokeStyle||"#000000",t.lineWidth=this.lineWidth||0,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY},d.prototype.calculateBounds=function(t){if(null!=t){for(var e=Ae,i=Ae,n=Me,s=Me,o=0;o<t.length;o+=2){var r=t[o],a=t[o+1];e=Math.min(e,r),i=Math.min(i,a),n=Math.max(n,r),s=Math.max(s,a)}this.x=e,this.y=i,this.width=n-e,this.height=s-i,this.center=this.getCenter()}},d.prototype.getCenter=function(){return this.center?this.center:{x:this.x+this.width/2,y:this.y+this.height/2}},d.prototype.getTooltipColor=function(){return d.getColorFromFillStyle(this.fillStyle)},d.prototype.fillStyleToJSON=function(t){if("string"==typeof t||null==this.width||null==this.height||null==this.x||null==this.y)return"'"+t+"'";var e="{type:'"+t.type+"'";c.isNull(t.x0)||(e+=",x0:"+t.x0),c.isNull(t.x1)||(e+=",x1:"+t.x1),c.isNull(t.y0)||(e+=",y0:"+t.y0),c.isNull(t.y1)||(e+=",y1:"+t.y1),"radialGradient"==t.type&&(c.isNull(t.r0)||(e+=",r0:"+t.r0),c.isNull(t.r1)||(e+=",r1:"+t.r1)),e+=",colorStops:[";for(var i=t.colorStops.length,n=0;i>n;n++){var s=t.colorStops[n];e+="{color:'"+s.color+"'",c.isNull(s.offset)||(e+=",offset:"+s.offset),e+="}",n!=i-1&&(e+=",")}return e+="]}"},d.prototype.arrayToJSON=function(t){for(var e,i="[",n=0;n<t.length;n++)e=t[n],i+=e,n!=t.length-1&&(i+=",");return i+"]"},d.prototype.toJSON=function(){var t=this,e="";return t.lineWidth&&(e=",lineWidth:"+t.lineWidth),t.fillStyle&&(e+=",fillStyle:"+t.fillStyleToJSON(t.fillStyle)),t.strokeStyle&&(e+=",strokeStyle:'"+t.strokeStyle+"'"),t.visible||(e+=",visible:"+t.visible),"rgba(0, 0, 0, 0)"!=t.shadowColor&&(e+=",shadowColor:'"+t.shadowColor+"'"),t.shadowBlur&&(e+=",shadowBlur:"+t.shadowBlur),t.shadowOffsetX&&(e+=",shadowOffsetX:"+t.shadowOffsetX),t.shadowOffsetY&&(e+=",shadowOffsetY:"+t.shadowOffsetY),t.strokeDashArray&&(e+=",strokeDashArray:"+t.arrayToJSON(t.strokeDashArray)),e},d.prototype._createGradient=function(t,i){var n=this.x,s=this.y;if(null==i||"string"==typeof i||null==this.width||null==this.height||null==n||null==s)return i;this.xOffset&&(n+=this.xOffset),this.yOffset&&(s+=this.yOffset);var o,r={x0:0,y0:0,x1:1,y1:1,r0:0,r1:1};switch(e.extend(r,i),i.type){case"radialGradient":var a=n+r.x0*this.width,l=s+r.y0*this.height,h=r.r0*this.width/2,c=n+r.x1*this.width,u=s+r.y1*this.height,d=r.r1*this.width/2;o=t.createRadialGradient(a,l,h,c,u,d);break;default:var p=n+r.x0*this.width,f=s+r.y0*this.height,m=n+r.x1*this.width,g=s+r.y1*this.height;o=t.createLinearGradient(p,f,m,g)}var v=r.colorStops;if(null!=v)for(var _=0;_<v.length;_++){var y=v[_];o.addColorStop(y.offset||0,y.color)}return o},d.prototype._createHighlightShape=function(t,i){var n=new d;return e.extend(n,this),n.fillStyle=n.highlightingFillStyle||t,this instanceof p&&(n.strokeStyle=n.highlightingStrokeStyle||i),n},d.prototype._getTooltipPosition=function(t,e,i,n,s){var o=this._getTooltipOrigin(t);return this._getTooltipPositionFromOrigin(o.x,o.y,e,i,n,s)},d.prototype._getTooltipOrigin=function(){return this.tooltipOrigin?this.tooltipOrigin:{x:this.x+this.width/2,y:this.y}},d.prototype._getTooltipPositionFromOrigin=function(t,e,i,n){var s=15,o=t-i-s,r=e-n+10;return 0>o&&(o=Math.max(0,t+s)),0>r&&(r=Math.max(0,e-s)),{x:o,y:r}},d.prototype._getAnimationPoints=function(t,e){if(t.length==e)return t;var i=e%2;e-=i;var n=t.slice(0,e);i/=2;var s=t[e-2],o=t[e-1],r=t[e],a=t[e+1];return c.isNull(o)||c.isNull(a)||(r=s+(r-s)*i,a=o+(a-o)*i,n.push(r),n.push(a)),n},p.prototype=new d,p.constructor=new p,p.prototype.hitTest=function(t,e,i){var n=this.x1,s=this.y1,o=this.x2,r=this.y2,a=Math.max(i,Math.max(3,this.lineWidth/2));if(n==o){var l=t+1;return l>n-a&&o+a>l&&e>=s-a&&r+a>=e?!0:!1}if(s==r){var h=e+.5;return t>=n-a&&o+a>=t&&h>s-a&&r+a>h?!0:!1}return!1},p.prototype.hitTestNonHV=function(t,e,i){var n=this.x1,s=this.y1,o=this.x2,r=this.y2;o>n?(this.x=n,this.width=o-n):(this.x=o,this.width=n-o),r>s?(this.y=s,this.width=r-s):(this.y=r,this.width=s-r);var a,l,h,c=o-n,u=r-s;0==c?(a=1,l=0,h=-n):0==u?(a=0,l=-1,h=-s):Math.abs(c)<Math.abs(u)?(a=1,l=c/u,h=-((n*r-s*o)/u)):(a=-(u/c),l=-1,h=-((s*o-n*r)/c));var d=Math.sqrt(a*a+l*l),p=(a*t-l*e+h)/d,f=Math.max(i,3);return Math.abs(p)<f?!0:!1},p.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=Math.floor(this.lineWidth%2)?c.roundH:Math.round;this.dontRound&&(i=function(t){return t});var n=i(this.x1),s=i(this.y1),o=i(this.x2),r=i(this.y2);if(this.xOffset&&(n+=this.xOffset,o+=this.xOffset),this.yOffset&&(s+=this.yOffset,r+=this.yOffset),this.rotationAngle&&!c.isNull(this.rotX)&&!c.isNull(this.rotY)){var a=c.rotatePointsAt([n,s,o,r],this.rotationAngle,this.rotX,this.rotY);n=a[0],s=a[1],o=a[2],r=a[3]}if(this.strokeDashArray)return this.renderDashedLine(n,s,o,r,this.strokeDashArray,t),void 0;t.beginPath(),t.moveTo(n,s),t.lineTo(o,r),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},p.prototype.toJSON=function(){var t=this,e="type:'line',x1:"+t.x1+",y1:"+t.y1+",x2:"+t.x2+",y2:"+t.y2;return e+=d.prototype.toJSON.call(this)},f.prototype=new d,f.constructor=new f,f.prototype.hitTest=function(t,e,i){return this.boundsHitTest(t,e,i)},f.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=null!=this.strokeStyle&&this.lineWidth>0,n=i&&Math.floor(this.lineWidth%2)?c.roundH:Math.round,s=this.correction||0;s=Math.round(s);var o=n(this.x),r=n(this.y),a=Math.round(this.width),l=Math.round(this.height);
	this.context,this.xDecrease&&(a-=this.xDecrease,this.isAnimReversed&&(o+=this.xDecrease)),this.yDecrease&&(l-=this.yDecrease,this.isAnimReversed&&(r+=this.yDecrease)),this.xOffset&&(o+=this.xOffset),this.yOffset&&(r+=this.yOffset),0>=a||0>=l||(0==this.cornerRadius?f.renderRectPath(t,o,r,a,l):this.renderRoundedRectPath(t,o,r,a,l),null!=this.fillStyle&&t.fill(),i&&t.stroke())}},f.renderRectPath=function(t,e,i,n,s){t.beginPath(),t.moveTo(e,i),t.lineTo(e+n,i),t.lineTo(e+n,i+s),t.lineTo(e,i+s),t.closePath()},f.prototype.renderRoundedRectPath=function(t,e,i,n,s){var o=this.cornerRadius,r=Math.PI/2;t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+n-o,i),t.arc(e+n-o,i+o,o,-r,0,!1),t.lineTo(e+n,i+s-o),t.arc(e+n-o,i+s-o,o,0,r,!1),t.lineTo(e+o,i+s),t.arc(e+o,i+s-o,o,r,2*r,!1),t.lineTo(e,i+o),t.arc(e+o,i+o,o,2*r,-r,!1),t.closePath()},f.prototype.toJSON=function(){var t=this,e="type:'rectangle',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return t.cornerRadius&&(e+=",cornerRadius:"+t.cornerRadius),e+=d.prototype.toJSON.call(this)},m.prototype=new d,m.constructor=new m,m.prototype.hitTest=function(t,e,i){if(0==this.boundsHitTest(t,e,i))return!1;var n=(this.width+i)/2,s=(this.height+i)/2,o=this.x+n,r=this.y+s,a=t-o,l=e-r,h=a*a/(n*n),c=l*l/(s*s);return 1>=h+c},m.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=this.x,n=this.y,s=this.width,o=this.height;this.xOffset&&(i+=this.xOffset),this.yOffset&&(n+=this.yOffset);var r=.5522848*(this.width/2),a=.5522848*(this.height/2),l=i+s,h=n+o,c=i+s/2,u=n+o/2;t.beginPath(),t.moveTo(i,u),t.bezierCurveTo(i,u-a,c-r,n,c,n),t.bezierCurveTo(c+r,n,l,u-a,l,u),t.bezierCurveTo(l,u+a,c+r,h,c,h),t.bezierCurveTo(c-r,h,i,u+a,i,u),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},m.prototype.toJSON=function(){var t=this,e="type:'ellipse',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return e+=d.prototype.toJSON.call(this)},g.prototype=new d,g.constructor=new g,g.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e),t.beginPath();var i=Math.max(0,this.radius);t.arc(Math.round(this.x+i),Math.round(this.y+i),Math.round(i),this.startAngle,this.endAngle,!1),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},g.prototype.toJSON=function(){var t=this,e="type:'arc',x:"+t.x+",y:"+t.y+",radius:"+t.radius+",startAngle:"+t.startAngle+",endAngle:"+t.endAngle;return e+=d.prototype.toJSON.call(this)},v.prototype=new d,v.constructor=new v,v.prototype.hitTest=function(t,e,i){this.useHitTestArea||(i=0);var n=this.x+this.width/2,s=this.y+this.height/2,o=Math.pow(t-n,2)+Math.pow(e-s,2);return o>Math.pow(this.radius+i,2)?!1:!0},v.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e),t.beginPath();var i=Math.max(0,this.radius);t.arc(Math.round(this.x+i),Math.round(this.y+i),Math.round(i),0,2*Math.PI,!1),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},v.prototype.toJSON=function(){var t=this,e="type:'circle',x:"+t.x+",y:"+t.y+",radius:"+t.radius;return e+=d.prototype.toJSON.call(this)},_.prototype=new d,_.constructor=new _,_.prototype.hitTest=function(t,e){var i=this.x,n=this.y,s=Math.pow(t-i,2)+Math.pow(e-n,2);if(s>Math.pow(this.radius,2))return!1;var o=i-t,r=n-e,a=Math.atan2(r,o)+Math.PI;return a>3*Math.PI/2&&(a-=2*Math.PI),a>=this.startAngle&&a<this.endAngle?!0:!1},_.prototype.render=function(t,e){if(this.visible&&this.startAngle!=this.endAngle){d.prototype.render.call(this,t,e),t.beginPath();var i=Math.round(this.x),n=Math.round(this.y),s=this.startAngle,o=this.endAngle;if(l.use_excanvas){var r=2*Math.PI-125e-6;o-s>=r&&(o=s+r)}t.moveTo(i,n),t.arc(i,n,Math.round(this.radius),s,o,!1),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}},_.prototype.toJSON=function(){var t=this,e="type:'pieSlice',x:"+t.x+",y:"+t.y+",radius:"+t.radius+",startAngle:"+t.startAngle+",endAngle:"+t.endAngle;return e+=d.prototype.toJSON.call(this)},y.prototype=new d,y.constructor=new y,y.prototype.hitTest=function(t,e,i){var n=this.context;if(!n||!n.points)return this.boundsHitTest(t,e,i);for(var s,o,r,a=this.pts,l=Math.pow(i,2),h=-1,c=Ae,u=this.isStepLine?4:2,d=0;d<a.length;d+=u)s=a[d],o=a[d+1],r=Math.pow(t-s,2)+Math.pow(e-o,2),r>c||r>l||(c=r,h=d);return-1==h?!1:this.createHighlightMark(h)},y.prototype.createHighlightMark=function(t){if(-1==t)return null;var i=this.context,n=this.pts,s=t/2;this.isStepLine&&(s/=2);var o=i.points[s],r=5,a=new v(n[t]-r,n[t+1]-r,r);return a.fillStyle=a.highlightingFillStyle=this.strokeStyle,a.strokeStyle="white",a.lineWidth=1,a.useHitTestArea=!0,a.context={series:i.series,chart:i.chart},e.extend(a.context,o),a},y.prototype.getCenter=function(t){if(this.center)return this.center;var e=this.context;if(!e||!e.points)return{x:this.x+this.width/2,y:this.y+this.height/2};for(var i,n=this.pts,s=0,o=Ae,r=t.locX,a=this.isStepLine?4:2,l=0;l<n.length;l+=a)i=Math.abs(n[l]-r),o>i&&(o=i,s=l);return{x:n[s],y:n[s+1],mark:this.createHighlightMark(s)}},y.prototype.getLength=function(){return this.pts.length},b.prototype=new y,b.constructor=new b,b.prototype.renderPoints=function(t,e,i){var n=e.length;if(!(2>=n)){if(this.strokeDashArray)return this.renderDashed(t,e),void 0;for(var s="connect"!=this.nullHandling,o=!0,r=2;n>r;r+=2){var a=e[r];if(null!=a){var l=e[r+1];o?(t.lineTo(a,l),0!=r%1e3||i||(null!=this.strokeStyle&&this.lineWidth>0&&t.stroke(),t.beginPath(),t.moveTo(a,l))):(t.beginPath(),t.moveTo(a,l),o=!0)}else s&&(null!=this.strokeStyle&&this.lineWidth>0&&t.stroke(),o=!1)}}},b.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=c.trimPoints(this.pts);if(this.closed&&(i.push(i[0]),i.push(i[1])),!c.isNull(this.length)){var n=this.closed?this.length+2:this.length;i=this._getAnimationPoints(i,n)}var s=i.length;if(!(2>=s)){if(this.xOffset){i=i.slice(0);for(var o=0;o<i.length;o+=2)i[o]+=this.xOffset}if(this.yOffset){i=i.slice(0);for(var o=1;o<i.length;o+=2)i[o]+=this.yOffset}t.beginPath(),t.moveTo(i[0],i[1]),this.renderPoints(t,i),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},b.prototype.renderDashed=function(t,e){for(var i,n,s=e.length,o="connect"!=this.nullHandling,r=this.strokeDashArray,a=!1,l=0;s>l;l+=2){var h=e[l];if(null!=h){var c=e[l+1];a?(this.renderDashedLine(i,n,h,c,r,t),i=h,n=c):(i=h,n=c,a=!0)}else o&&(a=!1)}},b.prototype.toJSON=function(){var t=this,e="type:'polyline',pts:"+t.arrayToJSON(t.pts);return this.nullHandling&&(e+=",nullHandling:'"+t.nullHandling+"'"),t.closed&&(e+=",closed:"+t.closed),e+=d.prototype.toJSON.call(this)},w.prototype=new y,w.constructor=new w,w.prototype.renderPoints=function(t,i){var n=.4,s=this.closed,o=[];e.merge(o,i);var r=[],a=o.length;if(!(2>=a)){if(4==a)return t.lineTo(o[2],o[3]),void 0;if(s){o.push(o[0],o[1],o[2],o[3]),o.unshift(o[a-1]),o.unshift(o[a-1]);for(var l=0;a>l;l+=2)r=r.concat(this.getControlPoints(o[l],o[l+1],o[l+2],o[l+3],o[l+4],o[l+5],n));r=r.concat(r[0],r[1]);for(var l=2;a+2>l;l+=2)t.bezierCurveTo(r[2*l-2],r[2*l-1],r[2*l],r[2*l+1],o[l+2],o[l+3])}else{for(var l=0;a-4>l;l+=2)r=r.concat(this.getControlPoints(o[l],o[l+1],o[l+2],o[l+3],o[l+4],o[l+5],n));t.quadraticCurveTo(r[0],r[1],o[2],o[3]);for(var l=2;a-5>l;l+=2)t.bezierCurveTo(r[2*l-2],r[2*l-1],r[2*l],r[2*l+1],o[l+2],o[l+3]);t.quadraticCurveTo(r[2*a-10],r[2*a-9],o[a-2],o[a-1])}}},w.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=c.trimPoints(this.pts);c.isNull(this.length)||(i=this._getAnimationPoints(i,this.length));var n=i.length;4>n||(t.beginPath(),t.moveTo(i[0],i[1]),this.renderPoints(t,i),this.closed&&(t.closePath(),null!=this.fillStyle&&t.fill()),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke())}},w.prototype.getControlPoints=function(t,e,i,n,s,o,r){var a=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)),l=Math.sqrt(Math.pow(s-i,2)+Math.pow(o-n,2)),h=r*a/(a+l),c=r-h,u=i+h*(t-s),d=n+h*(e-o),p=i-c*(t-s),f=n-c*(e-o);return[u,d,p,f]},w.prototype.toJSON=function(){var t=this,e="type:'curve',pts:"+t.arrayToJSON(t.pts);return t.closed&&(e+=",closed:"+t.closed),e+=d.prototype.toJSON.call(this)},x.prototype=new y,x.constructor=new x,x.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=c.trimPoints(this.pts);c.isNull(this.length)||(i=this._getAnimationPoints(i,this.length));var n=i.length;if(!(2>=n)){var s;this.isCurve?s=new w(i):(s=new b(i),s.nullHandling="connect"),t.beginPath(),t.moveTo(i[0],i[1]),s.renderPoints(t,i,!0),this.vertical?(t.lineTo(this.crossPos,i[i.length-1]),t.lineTo(this.crossPos,i[1])):(t.lineTo(i[i.length-2],this.crossPos),t.lineTo(i[0],this.crossPos)),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},x.prototype.toJSON=function(){var t=this,e="type:'area',pts:"+t.arrayToJSON(t.pts)+",crossPos:"+t.crossPos+",vertical:"+t.vertical;return t.isCurve&&(e+=",isCurve:"+t.isCurve),e+=d.prototype.toJSON.call(this)},S.prototype=new y,S.constructor=new S,S.prototype.getLength=function(){return this.pts1.length},S.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=this.pts1,n=this.pts2;c.isNull(this.length)||(i=this._getAnimationPoints(i,this.length),n=this._getAnimationPoints(n,this.length)),n=c.reversePoints(n);var s=i.length;if(!(2>s)){var o;o=this.isCurve?new w(i):new b(i),t.beginPath(),t.moveTo(i[0],i[1]),o.renderPoints(t,i,!0),t.lineTo(n[0],n[1]),o=this.isCurve?new w(n):new b(n),o.renderPoints(t,n,!0),t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},S.prototype.toJSON=function(){var t=this,e="type:'rangeShape',pts1:"+t.arrayToJSON(t.pts1)+",pts2:"+t.arrayToJSON(t.pts2);return t.isCurve&&(e+=",isCurve:"+t.isCurve),e+=d.prototype.toJSON.call(this)},C.prototype=new y,C.constructor=new C,C.prototype.hitTest=function(t,e,i){var n=this.context;if(n&&n.points)return y.prototype.hitTest.call(this,t,e,i);var s=this.boundsHitTest(t,e,i);if(0==s)return!1;if(this.isBoundsHitTest&&i)return!0;for(var o,r,a,l,h=this.pts,c=!1,u=h.length,d=0,p=0;u>p;p+=2)d+=2,d==u&&(d=0),o=h[p],r=h[p+1],a=h[d],l=h[d+1],(e>r&&l>=e||e>l&&r>=e)&&t>o+(e-r)/(l-r)*(a-o)&&(c=!c);return c},C.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=this.pts,n=i.length;if(!(4>n)){if(this.xOffset){i=i.slice(0);for(var s=0;s<i.length;s+=2)i[s]+=this.xOffset}if(this.yOffset){i=i.slice(0);for(var s=1;s<i.length;s+=2)i[s]+=this.yOffset}!this.rotationAngle||c.isNull(this.rotX)||c.isNull(this.rotY)||(i=c.rotatePointsAt(i,this.rotationAngle,this.rotX,this.rotY));var o=Math.floor(this.lineWidth%2)?c.roundH:Math.round;this.dontRound&&(o=function(t){return t}),t.beginPath(),t.moveTo(o(i[0]),o(i[1]));for(var s=2;n>s;s+=2)t.lineTo(o(i[s]),o(i[s+1]));t.closePath(),null!=this.fillStyle&&t.fill(),null!=this.strokeStyle&&this.lineWidth>0&&t.stroke()}}},C.prototype.toJSON=function(){var t=this,e="type:'polygon',pts:"+t.arrayToJSON(t.pts);return e+=d.prototype.toJSON.call(this)},T.prototype=new d,T.constructor=T,T.prototype.render=function(t,e){if(this.visible){d.prototype.render.call(this,t,e);var i=c.roundH(this.x),n=c.roundH(this.y);!this.rotationAngle||c.isNull(this.rotX)||c.isNull(this.rotY)?(this.renderBg(t),null!=this.fillStyle&&t.fillText(this.text,i,n),null!=this.strokeStyle&&t.strokeText(this.text,i,n)):(t.save(),t.translate(this.rotX,this.rotY),t.rotate(this.rotationAngle),this.flip&&t.scale(-1,-1),this.renderBg(t),null!=this.fillStyle&&t.fillText(this.text,0,0),null!=this.strokeStyle&&t.strokeText(this.text,0,0),t.restore())}},T.prototype.renderBg=function(t){var e=this.background;if(e){var i=c.roundH(this.x),n=c.roundH(this.y);this.width||this.measure(t);var s=Math.round(this.width),o=Math.round(this.height);t.fillStyle=this._createGradient(t,e)||"#000000";var r=this._correctXY(i,n,s,o);f.renderRectPath(t,r.x,r.y,s,o),t.fill(),t.fillStyle=this._createGradient(t,this.fillStyle)||"#000000"}},T.prototype.measure=function(t){this.setProperties(t);var e=t.measureText(this.text),i=parseFloat(this.font)||0,n=e.width;return this.width=n,this.height=i,{width:n,height:i}},T.prototype._correctXY=function(t,e,i,n){switch(this.textAlign){case"center":t-=i/2;break;case"right":t-=i}switch(this.textBaseline){case"middle":e-=n/2;break;case"bottom":e-=n}return{x:t,y:e}},T.prototype.isInRect=function(t,e,i,n){var s=this.x,o=this.y,r=this.width,a=this.height;switch(this.textAlign){case"center":s-=r/2;break;case"right":s-=r}switch(this.textBaseline){case"middle":o-=a/2;break;case"bottom":o-=a}return s>=t&&o>=e&&t+i>=s+r&&e+n>=o+a},T.prototype.intersectWith=function(t,e,i,n){var s=this.x,o=this.y,r=this.width,a=this.height,l=this._correctXY(s,o,r,a);return s=l.x,o=l.y,s+r>t&&t+i>s&&o+a>e&&e+n>o},T.prototype.setProperties=function(t){d.prototype.setProperties.call(this,t),t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline},T.prototype.hitTest=function(t,e,i){if(!this.isLegendItem&&!this.isAxisLabel)return!1;var n=this.width,s=this.height;switch(this.textAlign){case"center":t+=n/2;break;case"right":t+=n}switch(this.textBaseline){case"middle":e+=s/2;break;case"bottom":e+=s}return this.boundsHitTest(t,e,i)},T.prototype.toJSON=function(){var t=this;if(!t.text||""==t.text)return!1;var e="type:'textBlock',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height+",text:'"+t.text+"'";return e+=",font:'"+t.font+"'",e+=",textBaseline:'"+t.textBaseline+"'",e+=",textAlign:'"+t.textAlign+"'",c.isNull(t.rotationAngle)||(e+=",rotationAngle:"+t.rotationAngle),c.isNull(t.rotX)||(e+=",rotX:"+t.rotX),c.isNull(t.rotY)||(e+=",rotY:"+t.rotY),t.flip&&(e+=",flip:"+t.flip),e+=d.prototype.toJSON.call(this)},M.prototype=new d,M.constructor=M,M.prototype.hitTest=function(t,e,i){return this.boundsHitTest(t,e,i)},M.prototype.render=function(t){if(this.visible){var e=new Image,i=this.x,n=this.y,s=this;e.onload=function(){var o=e.width,r=e.height;i-=o/2,n-=r/2,s.x=i,s.y=n,s.offsetX&&(i+=s.offsetX),s.offsetY&&(n+=s.offsetY),s.width=o,s.height=r,t.drawImage(e,i,n)},e.src=this.src}},M.prototype._createHighlightShape=function(t){var e=new f;return e.context=this.context,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e.fillStyle=t,e.strokeStyle="gray",e},A.prototype=new d,A.constructor=new A,A.prototype.hitTest=function(t,e,i){for(var n=this.shapes,s=0;s<n.length;s++){var o=n[s];if(o.hitTest(t,e,i))return!0}return!1},A.prototype._getTooltipOrigin=function(t){return{x:t.locX,y:t.locY}},A.prototype.render=function(t){if(this.visible){d.prototype.render.call(this,t);for(var e=this.shapes,i=0;i<e.length;i++){var n=e[i];n.render(t,!0)}}},D.prototype.toJSON=function(){var t=this,e="type:'clip',x:"+t.x+",y:"+t.y+",width:"+t.width+",height:"+t.height;return e},L.prototype.toJSON=function(){var t="type:'resetClip'";return t},k.prototype.toJSON=function(){var t=this,e="type:'shadows',renderShadows:"+t.renderShadows;return e},P.prototype._getContext=function(t){return t.getContext?t.getContext("2d"):null},P.emptyColor="rgba(0, 0, 0, 0)",P.prototype._render=function(t){var e=this.offsetX||this.offsetY,i=this.chart.options,n=this.ctx;c.isNull(i.globalAlpha)||(n.globalAlpha=i.globalAlpha),e&&(n.save(),n.translate(this.offsetX,this.offsetY));for(var s=0;s<t.length;s++){var o=t[s];if(o)if(this.isHighlighting||!o.context||!o.context.series||o.isLegendItem||o instanceof T||this.chart.elem.trigger("shapeRendering",o),o.src&&this.isExcanvas)o.offsetX=this.offsetX,o.offsetY=this.offsetY,n.translate(-this.offsetX,-this.offsetY),o.render(n),n.translate(this.offsetX,this.offsetY);else{var r=o.shadowColor;o.shadowColor=P.emptyColor,o.render(n),o.shadowColor=r}}e&&n.restore()},P.prototype._renderShadows=function(t){if(!l.use_excanvas){var e=this.offsetX&&this.offsetY,i=this.chart.options;if(i.shadows&&i.shadows.enabled){var n=this.ctx;c.isNull(i.globalAlpha)||(n.globalAlpha=i.globalAlpha),e&&(n.save(),n.translate(this.offsetX,this.offsetY));for(var s=0;s<t.length;s++){var o=t[s];o&&o.shadowColor&&"rgba(0, 0, 0, 0)"!=o.shadowColor&&o.render(n)}e&&n.restore()}}},P.prototype._clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},I.prototype._render=function(t){null!=this.text&&(this.textBlock.x=this.x+this.margin,this.textBlock.y=this.y+this.margin,this.textBlock.rotX=this.rotX,this.textBlock.rotY=this.rotY,this.textBlock.rotationAngle=this.rotationAngle,t.push(this.textBlock))},I.prototype._measure=function(){var t;if(!this.text)return this.width=0,this.height=0,void 0;t=this.textBlock.measure(this.chart.ctx);var e=2*this.margin;this.width=t.width+e,this.height=t.height+e},I.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i),this.textBlock=new T(this.text),this.textBlock.textBaseline="top",this.textBlock.font=this.font,this.textBlock.fillStyle=this.fillStyle,this.textBlock.strokeStyle=this.strokeStyle,this.textBlock.lineWidth=this.lineWidth},R.prototype=new I,R.constructor=R,R.prototype._render=function(t){var e=this.chart;if(null!=this.text&&e){var i=e._width,n=e._height,s=this.margin+this.textBlock.width/2,o=this.margin;switch(this.hAlign){case"center":s+=(i-this.width)/2;break;case"right":s+=i-this.width}switch(this.vAlign){case"center":o+=(n-this.height)/2;break;case"bottom":o+=n-this.height}this.textBlock.textAlign="center",this.textBlock.x=s,this.textBlock.y=o,this.textBlock.rotX=s,this.textBlock.rotY=o,this.textBlock.rotationAngle=this.angle,t.push(this.textBlock)}},E.prototype._setShapeSettings=function(t){t.fillStyle=this.fillStyle,this.visible?(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.cornerRadius=this.cornerRadius):t.lineWidth=0},E.prototype._render=function(t){var e=this.visible?this.lineWidth/2:0,i=this.x+e,n=this.y+e,s=this.width-2*e,o=this.height-2*e,r=new f(i,n,s,o);this._setShapeSettings(r),t.push(r)},E.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},E.prototype.getPaddings=function(){var t={left:0,right:0,top:0,bottom:0};if(!this.visible)return t;var i,n,s,o,r=this.lineWidth+this.cornerRadius/2,a=this.padding;return e.isPlainObject(a)?(i=a.left||0,n=a.top||0,s=a.right||0,o=a.bottom||0):i=n=s=o=a||0,t.left=i+r,t.top=n+r,t.right=s+r,t.bottom=o+r,t},O.prototype.isInside=function(){return"inside"==this.position},O.prototype._setLineSettings=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},O.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},j.prototype=new a,j.constructor=j,j.prototype.mouseWheel=function(t,e){if(e){var i=this.view.axes.getZoomableAxes();i.length>0&&t.preventDefault();for(var n=0;n<i.length;n++)i[n]._mouseWheelZoom(e);this.view.partialDelayedUpdate()}},F.prototype=new r,F.constructor=F,F.prototype.canStart=function(t){return"zooming"!=this.view.options.mouseInteractionMode?!1:this.view.gridArea.isMouseOver?this.view.canZoom?(t.preventDefault(),!0):!1:!1},F.prototype.start=function(){this.view._clearRenderers(),this.zoomableAxes=this.view.axes.getZoomableAxes(),this.mouseInput1=this.view.mouseInput,this.currCursor=this.view.elem.css("cursor").toString(),this.view.canZoomHor&&this.view.canZoomVer?this.view.elem.css("cursor","crosshair"):this.view.canZoomHor?this.view.elem.css("cursor","e-resize"):this.view.elem.css("cursor","s-resize")},F.prototype.mouseMove=function(){var t=this.view.mouseInput;this.view._renderSelectionRect(this.mouseInput1,t)},F.prototype.mouseUp=function(){var t=this.mouseInput1,e=this.view.mouseInput,i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);if(i>1||n>1){for(var s=this.zoomableAxes,o=0;o<s.length;o++)s[o]._scaleToRegion(t,e);this.view.partialDelayedUpdate()}this.stopTool()},F.prototype.keyDown=function(t){27==t.which&&(t.preventDefault(),this.stopTool())},F.prototype.stop=function(){this.zoomableAxes=null,this.view._clearSelectionRect(),this.view.elem.css("cursor",this.currCursor),r.prototype.stop.call(this)},N.prototype=new r,N.constructor=N,N.prototype.canStart=function(t){return"panning"!=this.view.options.mouseInteractionMode?!1:this.view.gridArea.isMouseOver?this.view.canZoom?(t.preventDefault(),!0):!1:!1},N.prototype.start=function(){this.zoomableAxes=this.view.axes.getZoomableAxes(),this.oldMouseInput=this.view.mouseInput,this.currCursor=this.view.originalCursor;var t=this.view.originalCursor=e.browser&&e.browser.mozilla?"-moz-grabbing":"move";this.view.elem.css("cursor",t)},N.prototype.mouseMove=function(){this.zoomableAxes;for(var t=this.view.mouseInput,e=this.zoomableAxes,i=this.oldMouseInput.locX-t.locX,n=this.oldMouseInput.locY-t.locY,s=0;s<e.length;s++)e[s]._moveVisibleRange(i,n);this.oldMouseInput=t,this.view.partialDelayedUpdate()},N.prototype.mouseUp=function(){this.stopTool()},N.prototype.stop=function(){this.zoomableAxes=null,this.view.originalCursor=this.currCursor,this.view._resetCursor(),r.prototype.stop.call(this)},B.prototype=new r,B.constructor=B,B.prototype.canStart=function(t){if(!this.view.canZoom)return!1;for(var e=this.view.touchInput,i=0;i<e.length;i++){var n=e[i];if(!this.view.gridArea._contains(n.locX,n.locY))return!1}return t.preventDefault(),!0},B.prototype.start=function(){this.zoomableAxes=this.view.axes.getZoomableAxes(),this.oldTouchInput=this.view.touchInput},B.prototype.touchMove=function(t){if(t.preventDefault(),!this.oldTouchInput)return this.oldTouchInput=this.view.touchInput,void 0;var e=this.view.touchInput.length;if(!(e>2)){var i=!1;2==e&&(i=!0),this.isScaling!=i&&(this.oldTouchInput=this.view.touchInput,this.isScaling=i),i?this.doScale(t):this.doPan(t)}},B.prototype.touchEnd=function(){0==this.view.touchInput.length?this.stopTool():this.oldTouchInput=null},B.prototype.stop=function(){this.zoomableAxes=null,this.oldTouchInput=null,r.prototype.stop.call(this)},B.prototype.doPan=function(){for(var t=this.zoomableAxes,e=this.view.touchInput,i=e[0],n=this.oldTouchInput[0],s=n.locX-i.locX,o=n.locY-i.locY,r=0;r<t.length;r++)t[r]._moveVisibleRange(s,o);this.oldTouchInput=e,this.view.partialDelayedUpdate()},B.prototype.doScale=function(){var t=this.view.touchInput;if(!this.oldTouchInput||2!=this.oldTouchInput.length)return this.oldTouchInput=t,void 0;for(var e=this.getTwoTouchPointData(this.oldTouchInput),i=this.getTwoTouchPointData(t),n=this.zoomableAxes,s=0;s<n.length;s++)n[s]._scaleVisibleRange(e,i);this.oldTouchInput=t,this.view.partialDelayedUpdate()},B.prototype.getTwoTouchPointData=function(t){var e={x1:t[0].locX,y1:t[0].locY,x2:t[1].locX,y2:t[1].locY};return e.centerX=(e.x1+e.x2)/2,e.centerY=(e.y1+e.y2)/2,e.dx=Math.abs(e.x2-e.x1),e.dy=Math.abs(e.y2-e.y1),e},z.prototype=new l,z.constructor=z,z.prototype._createElements=function(t){if(l.prototype._createElements.call(this,t),l.use_excanvas){this.areaCanvas=this._createCanvas(!0);var i=e('<div style="position:absolute"></div>');this.elem.append(i),i.append(this.areaCanvas),this.areaRenderer=new P(this.areaCanvas,this),this.areaRenderer.div=i,this.areaRenderer.isExcanvas=!0,this.upperCanvas=this._createCanvas(!0);var n=e('<div style="position:absolute"></div>');this.elem.append(n),n.append(this.upperCanvas),this.upperRenderer=new P(this.upperCanvas,this),this.upperRenderer.div=n,this.upperRenderer.isExcanvas=!0}this.chCanvas=this._createCanvas(),this.chRenderer=new P(this.chCanvas,this),this._createHighlightRenderer(),this.gridArea=new K(this),this.border=new E,this.paletteColors=new H,this.title=new I,this.title.chart=this,this.legend=new X,this.legend.chart=this,this.watermark=new R(this),this.toolbar=new W(this),this.noDataMessage=new I,this.noDataMessage.chart=this,this.series=new Q(this),this.axes=new ye(this)},z.prototype._processOptions=function(t){var i=this;t=t||{},i.arrDataSource=null;var n=t.dataSource;if(n&&e.isArray(n))return i.arrDataSource=n,i._setOptions(t),void 0;if(e.isPlainObject(n)&&n.ajax){var s=n.ajax,o={};return e.extend(o,s),o.success=function(t){i.arrDataSource=t},o.complete=function(){i._setOptions(t)},e.ajax(o),void 0}i._setOptions(t)},z.prototype._setOptions=function(t){if(this.elem&&0!=this.elem.length){var i=t||{};"string"==typeof i.title&&(i.title={text:i.title}),i.title=i.title||{},i.title=e.extend({},e.fn.jqChart.defaults.title,i.title),i.crosshairs=e.extend(!0,{},e.fn.jqChart.defaults.crosshairs,i.crosshairs),i.tooltips=e.extend(!0,{},e.fn.jqChart.defaults.tooltips,i.tooltips),i.shadows=e.extend(!0,{},e.fn.jqChart.defaults.shadows,i.shadows),i.selectionRect=e.extend(!0,{},e.fn.jqChart.defaults.selectionRect,i.selectionRect),i.watermark=e.extend(!0,{},e.fn.jqChart.defaults.watermark,i.watermark),"string"==typeof i.noDataMessage&&(i.noDataMessage={text:i.noDataMessage}),i.noDataMessage=e.extend(!0,{},e.fn.jqChart.defaults.noDataMessage,i.noDataMessage),i.globalAlpha=c.isNull(i.globalAlpha)?e.fn.jqChart.defaults.globalAlpha:i.globalAlpha,i.mouseInteractionMode=i.mouseInteractionMode||e.fn.jqChart.defaults.mouseInteractionMode,this.hasCrosshairs=i.crosshairs.enabled===!0,this.hasTooltips=i.tooltips&&!i.tooltips.disabled,this.hasHighlighting=i.tooltips&&i.tooltips.highlighting,this.options=i,l.prototype._setOptions.call(this,i);var n=t||{};n.width?this.elem.css("width",n.width):0==this.elem.width()&&this.elem.css("width","400px"),n.height?this.elem.css("height",n.height):0==this.elem.height()&&this.elem.css("height","250px");var s=this._width=this.elem.width(),o=this._height=this.elem.height(),i=this.options;this.border.setOptions(i.border),this.border.fillStyle=i.background||this.border.fillStyle,this.gridArea.fillStyle=i.chartAreaBackground,this.paletteColors.setOptions(i.paletteColors),this.title.setOptions(i.title),this.legend.setOptions(i.legend),this.watermark.setOptions(i.watermark),this.toolbar.setOptions(i.toolbar),this.noDataMessage.setOptions(i.noDataMessage),this.series.setOptions(i.series),this.axes.setOptions(i.axes),this._setCanvasSize(this.canvas,s,o),this._setCanvasSize(this.chCanvas,s,o),this._setCanvasSize(this.hlCanvas,s,o),this.areaCanvas&&this._setCanvasSize(this.areaCanvas,s,o),this.upperCanvas&&this._setCanvasSize(this.upperCanvas,s,o),this.update()}},z.prototype._mouseEnter=function(t){l.prototype._mouseEnter.call(this,t),this.toolbar.show()},z.prototype._mouseLeave=function(t){l.prototype._mouseLeave.call(this,t),this.toolbar.hide()},z.prototype._measure=function(){return this.title._measure(),this.legend._measure(),this.watermark._measure(),this.noDataMessage._measure(),this.axes._measure()},z.prototype._arrange=function(){var t=this._width,e=this._height;this.border.width=t,this.border.height=e;var i=this.border.getPaddings();t-=i.left+i.right,e-=i.top+i.bottom;var n=i.left,s=i.top+this.title.height,o=this.axes._getTotalWidth(),r=this.axes._getTotalHeight();switch(this.legend._isHorizontal()?(this.gridArea.width=Math.round(t-o),this.gridArea.height=Math.round(e-(r+this.title.height+this.legend.height))):(this.gridArea.width=Math.round(t-(o+this.legend.width)),this.gridArea.height=Math.round(e-(r+this.title.height))),this.legend.location){case"left":n+=this.legend.width;break;case"top":s+=this.legend.height}for(var a=this.axes.verCrossingAxis,l=this.axes.horCrossingAxis,h=this.axes._getAxesInLoc("left"),c=h.length-1;c>=0;c--){var u=h[c];u.x=n,u.height=this.gridArea.height,l||(n=Math.ceil(n+u.width))}this.gridArea.x=n,n+=this.gridArea.width;for(var d=this.axes._getAxesInLoc("right"),c=0;c<d.length;c++){var u=d[c];u.x=n,u.height=this.gridArea.height,l||(n=Math.ceil(n+u.width))}for(var p=this.axes._getAxesInLoc("top"),c=p.length-1;c>=0;c--){var u=p[c];u.x=this.gridArea.x,u.y=s,u.width=this.gridArea.width,a||(s=Math.ceil(s+u.height))}this.gridArea.y=s,s+=this.gridArea.height;for(var f=this.axes._getAxesInLoc("bottom"),c=0;c<f.length;c++){var u=f[c];u.x=this.gridArea.x,u.y=s,u.width=this.gridArea.width,a||(s=Math.ceil(s+u.height))}for(var m=h.concat(d),c=0;c<m.length;c++){var u=m[c];u.y=this.gridArea.y}for(var f=this.axes._getAxesInLoc("radial"),c=0;c<f.length;c++){var u=f[c];u.x=this.gridArea.x,u.y=this.gridArea.y,u.width=this.gridArea.width,u.height=this.gridArea.height}switch(this.title.x=i.left+(t-this.title.width)/2,this.title.y=i.top,this.legend.location){case"bottom":this.legend.x=i.left+(t-this.legend.width)/2,this.legend.y=i.top+e-this.legend.height;break;case"left":this.legend.x=i.left,this.legend.y=i.top+this.gridArea.y+(this.gridArea.height-this.legend.height)/2;break;case"top":this.legend.x=i.left+(t-this.legend.width)/2,this.legend.y=i.top+this.title.height;break;case"right":default:this.legend.x=i.left+t-this.legend.width,this.legend.y=this.gridArea.y+(this.gridArea.height-this.legend.height)/2}this.gridArea._arrange(),this.axes._arrange(),this.legend._arrange(),this.noDataMessage.x=i.left+(t-this.noDataMessage.width)/2,this.noDataMessage.y=i.top+(e-this.noDataMessage.height)/2},z.prototype._processMouseMove=function(){var t=this.mouseInput;if(this.gridArea){var e=this.gridArea._contains(t.locX,t.locY);this.gridArea.isMouseOver!=e&&(e||this._clearRenderers(),this.gridArea.isMouseOver=e)}this._processMouseEvents(),this.gridArea.isMouseOver&&(this._processTooltips(t),this._initCrosshairs(t))},z.prototype._initTouchInput=function(t){l.prototype._initTouchInput.call(this,t);var e=this.touchInput[0];if(this.gridArea&&e){var i=this.gridArea._contains(e.locX,e.locY);this.gridArea.isTouchOver!=i&&(i||this._clearRenderers(),this.gridArea.isTouchOver=i)}},z.prototype._processTouchStart=function(t){if(this.gridArea.isTouchOver){var e=this.touchInput[0];t.preventDefault(),this._processTooltips(e),this._initCrosshairs(e)}},z.prototype._processTouchMove=function(t){if(this.gridArea.isTouchOver){var e=this.touchInput[0];t.preventDefault(),this._processTouchEvents(),this._processTooltips(e),this._initCrosshairs(e)}},z.prototype._clearRenderers=function(){l.prototype._clearRenderers.call(this),this.chRenderer&&this.chRenderer._clear()},z.prototype._getClosestShapeAtX=function(t,e){for(var i=null,n=Ae,s=e.locX,o=t.length-1;o>=0;o--){var r=t[o];if(r.context&&!r.isLegendItem&&!r.isAxisLabel){var a=r.context.series;if(!a.tooltips||!a.tooltips.disabled){var l=r.getCenter(e),h=Math.abs(l.x-s);n>h&&(n=h,i=r,l.mark&&(i=l.mark))}}}return i},z.prototype._getClosestShapeAtY=function(t,e){for(var i=null,n=Ae,s=e.locY,o=t.length-1;o>=0;o--){var r=t[o],a=r.getCenter(e).y,l=Math.abs(a-s);n>l&&(n=l,i=r)}return i},z.prototype._getShapesAtX=function(t,i,n,s){for(var o=[i],r=[i.context.series],a=[0],l=0;l<n.length;l++){var h=n[l];if(h!=i&&h.context&&!h.isLegendItem&&!h.isAxisLabel){var c=h.context.series,u=e.inArray(c,r);if(0!=u){var d=h.getCenter(s),p=Math.abs(t-d.x);if(!(p>=3))if(-1==u)d.mark?o.push(d.mark):o.push(h),r.push(c),a.push(p);else{var f=a[u];f>p&&(o[u]=d.mark?d.mark:h,a[u]=p)}}}}return o},z.prototype._getTooltipShapes=function(t,i,n,s){var o=null,r=this.options.tooltips;if("shared"==r.type){var a=this._getClosestShapeAtX(this.shapes,s);a&&(o=this._getShapesAtX(a.getCenter(s).x,a,this.shapes,s))}else o=l.prototype._getTooltipShapes.call(this,t,i,n,s);return o&&(series=this.series.items,o.sort(function(t,i){var n=e.inArray(t.context.series,series),s=e.inArray(i.context.series,series);return n-s})),o},z.prototype._getTooltip=function(t){return t.context.series._getTooltip(t.context)},z.prototype._getTooltipText=function(t){for(var i="",n=this,s=[],o=0;o<t.length;o++){var r=t[o];if(r.context.series){var a=r.context.series.realXAxis;if(a&&r.context.x&&-1==e.inArray(a,s)){var l=a._getTooltip(r.context.x);i+=l,s.push(a)}}}return e.each(t,function(){var t=n._getTooltip(this);t&&(i+=t)}),i},z.prototype._initCrosshairs=function(t){if(this.hasCrosshairs){var e=this.options.crosshairs,i=t.locX,n=t.locY;if(e.snapToDataPoints){var s=this._getClosestShapeAtX(this.shapes,t);if(s){var o=this._getShapesAtX(s.getCenter(t).x,s,this.shapes,t);if(s=this._getClosestShapeAtY(o,t)){var r=s.getCenter(t);i=r.x,n=r.y}}}this._renderCrosshairs(i,n)}},z.prototype._renderCrosshairs=function(t,i){if(this.hasCrosshairs){var n=this.gridArea;
	if(n._contains(t,i)){var s=this.options.crosshairs,o=[];if(s.hLine&&s.hLine.visible){var r=new p(n.x,i,n.x+n.width,i);s.hLine&&e.extend(r,s.hLine),o.push(r)}if(s.vLine&&s.vLine.visible){var a=new p(t,n.y,t,n.y+n.height);s.vLine&&e.extend(a,s.vLine),o.push(a)}this.chRenderer._clear(),this.chRenderer._render(o)}}},z.prototype._renderSelectionRect=function(t,i){var n=this.gridArea,s=n.fitHor(t.locX),o=n.fitVer(t.locY),r=n.fitHor(i.locX),a=n.fitVer(i.locY);this.canZoomVer?this.canZoomHor||(s=n.x,r=n.x+n.width):(o=n.y,a=n.y+n.height);var l=Math.min(s,r),h=Math.min(o,a),c=Math.abs(s-r),u=Math.abs(o-a),d=new f(l,h,c,u);e.extend(d,this.options.selectionRect),this.chRenderer._clear(),this.chRenderer._render([d])},z.prototype._clearSelectionRect=function(){this.chRenderer._clear()},z.prototype._initZooming=function(){var t=this;t.canZoomVer=!1,t.canZoomHor=!1,e.each(this.axes.items,function(){this.zoomEnabled&&"radial"!=this.location&&(this.isAxisVertical?t.canZoomVer=!0:t.canZoomHor=!0)}),this.canZoom=this.canZoomVer||this.canZoomHor},z.prototype._triggerShapeEvent=function(t,e){var i=e.isLegendItem?"legendItem":"dataPoint";e.isAxisLabel&&(i="axisLabel"),e.context.shape=e,this.elem.trigger(i+t,e.context)},z.prototype.setOptions=function(){},z.prototype.clear=function(){l.prototype.clear.call(this),l.use_excanvas&&(this.areaRenderer._clear(),this.upperRenderer._clear())},z.prototype._setClip=function(t){var e=this.gridArea;t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()},z.prototype._createShapes=function(){var t={},i=[],n=this.gridArea,s=t.shapes=[];if(this.border._render(s),this.hasData){this.title._render(s);var o=this.legend._render(s);t.gaShapes=[],n._render(t.gaShapes),t.axesShapes=[];var r=this.axes._render(t.axesShapes);t.postAxisShapes=r.postShapes;var a=t.nonGridAreaSerShapes=[];this.series._render(a);var l=t.serShapes=[],h=n._renderSeries(l);e.merge(a,h),e.merge(i,l),e.merge(i,a),e.merge(i,o),e.merge(i,r.contextShapes)}else this.noDataMessage._render(s);s=t.ws=[],this.watermark._render(s),this.shapes=i,this.allShapes=t},z.prototype._renderShapes=function(){var t=l.isRetinaDisplay,i=this._width,n=this._height;t&&(this._setRetinaDispOpts(this.canvas,i,n),this._setRetinaDispOpts(this.chCanvas,i,n),this._setRetinaDispOpts(this.hlCanvas,i,n)),this.shapeRenderer._clear(),l.use_excanvas&&(this.areaRenderer._clear(),this.upperRenderer._clear()),this.gridArea;var s=this.allShapes;if(this.shapeRenderer._render(s.shapes),this.hasData){var o=s.gaShapes;l.use_excanvas?this.areaRenderer._render(o):(this.ctx.save(),this._setClip(this.ctx),this.shapeRenderer._renderShadows(o),this.shapeRenderer._render(o),this.ctx.restore());var r=s.serShapes;r.length>0&&this.elem.trigger("seriesShapesRendering",[r]),l.use_excanvas?this.areaRenderer._render(r):(this.ctx.save(),this._setClip(this.ctx),this.shapeRenderer._renderShadows(r),this.shapeRenderer._render(r),this.ctx.restore());var a;a=l.use_excanvas?this.upperRenderer:this.shapeRenderer,a._render(s.axesShapes);var h=s.nonGridAreaSerShapes;h.length>0&&this.elem.trigger("seriesShapesRendering",[h]),a._renderShadows(h),a._render(h),a._render(s.postAxisShapes)}this.shapeRenderer._render(s.ws),t&&(e(this.canvas).css({width:i,height:n}),e(this.chCanvas).css({width:i,height:n}),e(this.hlCanvas).css({width:i,height:n}))},z.prototype.stringFormat=function(t,i){return"date"==e.type(t)?e.jqChartDateFormatter(t,i):e.jqChartSprintf(i,t)},z.prototype.render=function(){this._clearRenderers(),this._createShapes(),this._renderShapes()},z.prototype.findAxis=function(t){return this.axes?this.axes.find(t):void 0},z.prototype.update=function(){this.hasData=this.series.hasData(),this.series._initData(),this.axes._initSeriesAxes(),this.axes._initSeries(),this._initZooming(),this.axes._initRanges(),this.series._initVisibleData(),this.series._initColors(),this.legend._init(),this.axes._resetWH(),this.axes._initCrossingAxes();for(var t=!1,e=0;10>e&&(t=this._measure(),this._arrange(),this.axes._updateOrigins(),this.axes._initRanges(),this.axes._updateCrossings(),this.axes._correctOrigins(),0!=t);e++);this.toolbar._init(),this.render(),this.storyboard.begin()},z.prototype.partialDelayedUpdate=function(){this.timer.kick()},z.prototype.partialUpdate=function(){this.series._initVisibleData(),this.axes._resetWH();var t=!1;this.axes._initRanges();for(var e=0;10>e&&(t=this._measure(),this._arrange(),this.axes._updateOrigins(),this.axes._initRanges(),this.axes._updateCrossings(),this.axes._correctOrigins(),0!=t);e++);this.render()},z.prototype.highlightData=function(t){var e=l.prototype.highlightData.call(this,t);if(e){var i=e[0].getCenter();this._renderCrosshairs(i.x,i.y)}},z.prototype.destroy=function(){this.axes.clear(),l.prototype.destroy.call(this)},z.prototype.exportToImage=function(t){this._exportToImage(t,e.fn.jqChart.defaults.exportConfig)},z.prototype.exportToPdf=function(t){this._exportToPdf(t,e.fn.jqChart.defaults.exportConfig)},z.prototype.toJSON=function(t){var i=this.gridArea,n=this.options.shadows,s=n&&n.enabled,o=new D(i.x,i.y,i.width,i.height),r=new L,n=new k(!0),a=new k(!1),l=this.allShapes,h=[];return e.merge(h,l.shapes),this.hasData&&(h.push(o),s&&(h.push(n),e.merge(h,l.gaShapes),h.push(a)),e.merge(h,l.gaShapes),h.push(r),e.merge(h,l.axesShapes),h.push(o),s&&(h.push(n),e.merge(h,l.serShapes),h.push(a)),e.merge(h,l.serShapes),h.push(r),s&&(h.push(n),e.merge(h,l.nonGridAreaSerShapes),h.push(a)),e.merge(h,l.nonGridAreaSerShapes),e.merge(h,l.postAxisShapes)),e.merge(h,l.ws),this._toJSON(h,t)},U.prototype=new d,U.constructor=new U,U.prototype.createElements=function(t,e,i,n,s,o){var r=[],a=o/2,l=new p(t,e,t,i);r.push(l),l=new p(t-a,n,t,n),r.push(l),l=new p(t,s,t+a,s),r.push(l),this.items=r},U.prototype.hitTest=function(t,e,i){if(i)return this.boundsHitTest(t,e,i);for(var n=0;n<this.items.length;n++){var s=this.items[n];if(s.hitTest(t,e,i))return!0}return!1},U.prototype.render=function(t){if(this.visible){d.prototype.render.call(this,t);for(var e=0;e<this.items.length;e++){var i=this.items[e];this.setProperties(i),this.isUp?this.priceUpStrokeStyle&&(i.strokeStyle=this.priceUpStrokeStyle):this.priceDownStrokeStyle&&(i.strokeStyle=this.priceDownStrokeStyle),i.render(t)}}},U.prototype._createHighlightShape=function(t,i){var n=new U;return e.extend(n,this),n.fillStyle=t,n.priceUpFillStyle=t,n.priceDownFillStyle=t,n.strokeStyle=i,n.lineWidth+=2,n},U.prototype.getTooltipColor=function(){return this.isUp&&this.priceUpStrokeStyle?d.getColorFromFillStyle(this.priceUpStrokeStyle):this.priceDownStrokeStyle?d.getColorFromFillStyle(this.priceDownStrokeStyle):d.prototype.getTooltipColor.call(this)},U.prototype.toJSON=function(){var t=this,e="type:'stock',x:"+t.x+",width:"+t.width+",high:"+t.high+",low:"+t.low+",open:"+t.open+",close:"+t.close;return t.priceUpStrokeStyle&&(e+=",priceUpStrokeStyle:'"+t.priceUpStrokeStyle+"'"),t.priceDownStrokeStyle&&(e+=",priceDownStrokeStyle:'"+t.priceDownStrokeStyle+"'"),e+=d.prototype.toJSON.call(this)},V.prototype=new U,V.constructor=new V,V.prototype.createElements=function(t,e,i,n,s,o){var r=[],a=Math.floor(o/2),t=Math.round(t),l=Math.round(n),h=Math.round(s);if(l>h){var c=h;h=l,l=c}if(e>i){var c=i;i=e,e=c}if(h-l>=1){var u=new f(t-a,l,2*a,h-l);u.useHitTestArea=!0,r.push(u)}else{var d=new p(t-a,l,t+a,l);r.push(d)}var d=new p(t,e,t,l);r.push(d);var d=new p(t,h,t,i);r.push(d),this.items=r},V.prototype.render=function(t){if(this.visible){d.prototype.render.call(this,t);for(var e=0;e<this.items.length;e++){var i=this.items[e];this.setProperties(i),i instanceof f&&(i.fillStyle=this.isUp?this.priceUpFillStyle:this.priceDownFillStyle),i.render(t)}}},V.prototype.getTooltipColor=function(){return this.isUp?d.getColorFromFillStyle(this.priceUpFillStyle):d.getColorFromFillStyle(this.priceDownFillStyle)},V.prototype.toJSON=function(){var t=this,e="type:'candlestick',x:"+t.x+",width:"+t.width+",high:"+t.high+",low:"+t.low+",open:"+t.open+",close:"+t.close;return t.priceUpFillStyle&&(e+=",priceUpFillStyle:"+t.fillStyleToJSON(t.priceUpFillStyle)),t.priceDownFillStyle&&(e+=",priceDownFillStyle:"+t.fillStyleToJSON(t.priceDownFillStyle)),e+=d.prototype.toJSON.call(this)},H.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},H.prototype.getColor=function(t){var e=this.getColors(this.type),i=e.length;return t%=i,e[t]},H.prototype.getColors=function(t){switch(t.toLowerCase()){case"customcolors":return this.customColors;case"grayscale":return this.colorsGrayScale;case"default":default:return this.colorsDefault}},W.prototype={setOptions:function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},_init:function(){var t=this.toolbar,i=this.chart;if("hidden"==this.visibility||"auto"==this.visibility&&!i.canZoom)return t&&(t.remove(),this.toolbar=null),void 0;t||(this.toolbar=t=e('<ul onselectstart="return false;" class="ui-jqchart-toolbar ui-widget ui-widget-content ui-corner-all"></ul>'),this._addButtons(),t.hide(),i.elem.append(t),t.mousedown(function(t){return t.preventDefault(),!1}),t.mouseenter(function(t){return i._clearRenderers(),t.preventDefault(),!1}),t.mousemove(function(t){return t.preventDefault(),!1}));var n=t.outerWidth(),s=t.outerHeight(),o=i.gridArea,r=o.x,a=o.y;switch(this.hAlign){case"center":r+=(o.width-n)/2;break;case"right":r+=o.width-n}switch(this.vAlign){case"center":a+=(o.height-s)/2;break;case"bottom":a+=o.height-s}t.css({left:r,top:a}),"visible"==this.visibility&&t.show()},_addButtons:function(){var t=this.toolbar,i=this.chart,n=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-arrow-4-diag'></span></li>");t.append(n),this._addHover(n),n.attr("title",this.resetZoomTooltipText),n.mousedown(function(t){t.preventDefault();for(var e=i.axes.items,n=0;n<e.length;n++)e[n].resetZoom();return i.partialDelayedUpdate(),!1});var s=e("<li class='ui-jqchart-toolbar-separator'></li>");t.append(s);var o=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-arrow-4'></span></li>");t.append(o),this._addHover(o),o.attr("title",this.panningTooltipText),o.mousedown(function(t){return t.preventDefault(),i.options.mouseInteractionMode="panning",o.addClass("ui-state-active"),r.removeClass("ui-state-active"),!1});var r=e("<li class='ui-corner-all ui-widget-header'><span class='ui-icon ui-icon-zoomin'></span></li>");switch(t.append(r),this._addHover(r),r.attr("title",this.zoomingTooltipText),r.mousedown(function(t){return t.preventDefault(),i.options.mouseInteractionMode="zooming",o.removeClass("ui-state-active"),r.addClass("ui-state-active"),!1}),i.options.mouseInteractionMode){case"zooming":r.addClass("ui-state-active");break;default:o.addClass("ui-state-active")}},_addHover:function(t){t.hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})},show:function(){this.toolbar&&"auto"==this.visibility&&this.toolbar.stop(!0,!0).fadeIn("slow")},hide:function(){this.toolbar&&"auto"==this.visibility&&this.toolbar.stop(!0,!0).fadeOut("slow")}},G.prototype._setShapeSettings=function(t){t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.cursor=this.cursor},G.prototype._setLineSettings=function(t){t.lineWidth=this.linkLineWidth,t.strokeStyle=this.linkLineStrokeStyle},G.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},G.prototype.getSize=function(){return{width:this.size,height:this.size}},G.prototype.getShape=function(t,e,i,n){if(this.visible===!1)return null;var s=2*i,o=null;switch(this.type){case"circle":o=new v(t-i,e-i,i);break;case"rectangle":o=new f(t-i,e-i,s,s);break;case"diamond":var r=[];r.push(t),r.push(e-i),r.push(t+i),r.push(e),r.push(t),r.push(e+i),r.push(t-i),r.push(e),o=new C(r),o.isBoundsHitTest=!0;break;case"triangle":var r=[];r.push(t),r.push(e-i),r.push(t+i),r.push(e+i),r.push(t-i),r.push(e+i),o=new C(r),o.isBoundsHitTest=!0;break;case"line":o=new p(t-i,e,t+i,e);break;case"plus":var r=[];r.push(t-i),r.push(e),r.push(t+i),r.push(e),r.push(null),r.push(null),r.push(t),r.push(e-i),r.push(t),r.push(e+i),o=new b(r,!0);break;case"image":if(!n)return null;o=new M(t,e,n)}return o.useHitTestArea=!0,o.center={x:Math.round(t),y:Math.round(e)},o},G.prototype.isVisible=function(){return this.visible!==!1&&"none"!=this.type},q.prototype._setLineSettings=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},q.prototype.setOptions=function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i)},Z.prototype={_setLineSettings:function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i)}},Y.prototype={_setShapeSettings:function(t){t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.strokeDashArray=this.strokeDashArray},setOptions:function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i)}},X.prototype._isHorizontal=function(){return"top"==this.location||"bottom"==this.location?!0:!1},X.prototype._init=function(){if(this.items=[],0!=this.visible)if(this.customItems)for(var t=0;t<this.customItems.length;t++){var i=this.customItems[t];null!=i&&"string"==typeof i.text&&(i.text={text:i.text});var n={marker:{type:"rectangle",fillStyle:"#418CF0"}};i=e.extend(!0,{},n,i||{});var s=new G(i.marker);i.marker=s;var o={};e.extend(o,i),o.text=i.text.text,o.font=i.text.font||"12px sans-serif",o.textFillStyle=i.text.fillStyle||"black",o.textStrokeStyle=i.text.strokeStyle,o.textLineWidth=i.text.lineWidth,o.context={chart:this.chart,title:o.text},o.cursor=this.itemsCursor;var r=new J(o);r.chart=this.chart,this.items.push(r)}else for(var a={font:this.font,textStrokeStyle:this.textStrokeStyle,textFillStyle:this.textFillStyle,textLineWidth:this.textLineWidth,cursor:this.itemsCursor},l=this.chart.series.items,t=0;t<l.length;t++){var h=l[t];h.visible&&e.merge(this.items,h._getLegendItems(a))}},X.prototype._measure=function(){if(0==this.visible)return this.width=0,this.height=0,void 0;var t=this.paddings=this.border.getPaddings();this.title._measure();var e=this.title.width,i=this.title.height;this.title.text&&(i+=t.top);for(var n=this._isHorizontal(),s=0,o=0,r=0,a=0;a<this.items.length;a++){var l=this.items[a];l._measure(),n?(s+=l.width+this._itemMargin,o=Math.max(o,l.height),r=Math.max(r,l.width+this._itemMargin)):(s=Math.max(s,l.width),o+=l.height)}var h=2*this.margin+t.left+t.right,c=2*this.margin+t.top+t.bottom,u=this.chart.border.getPaddings(),d=this.chart._width-u.left-u.right-h;if(n&&s>d){var p=Math.floor(d/r)||1,f=Math.ceil(this.items.length/p);this.rows=p,this.cellHeight=o+this._itemMargin,this.cellWidth=r,s=p*r,o=f*o+(f-1)*this._itemMargin}else this.rows=0;e=Math.max(e,s),i+=o,this.width=this.isCustomWidth||e+h,this.height=this.isCustomHeight||i+c},X.prototype._arrange=function(){if(0!=this.visible){var t=this.x+this.margin,e=this.y+this.margin,i=2*this.margin;this.border.x=t,this.border.y=e;var n=this.width-i;this.border.width=n,this.border.height=this.height-i;var s=this.paddings;n-=s.left+s.right,t+=s.left,e+=s.top,this.title.text&&(this.title.x=t+(n-this.title.width)/2,this.title.y=e,e+=this.title.height+s.top);for(var o=this._isHorizontal(),r=this.rows,a=0;a<this.items.length;a++){var l=this.items[a];l.x=t,l.y=e,o?r?(l.x+=a%r*this.cellWidth,l.y+=Math.floor(a/r)*this.cellHeight):t+=l.width+this._itemMargin:e+=l.height,l._arrange()}}},X.prototype._render=function(t){if(0==this.visible)return[];this.border._render(t),this.title._render(t);for(var i=[],n=0;n<this.items.length;n++){var s=this.items[n],o=s._render(t);e.merge(i,o)}return i},X.prototype.setOptions=function(t){null!=t&&"string"==typeof t.title&&(t.title={text:t.title},e.extend(t.title,this.defaults.title));var i=e.extend(!0,{},this.defaults,t||{});e.extend(this,i),this.margin=i.margin,t&&(this.isCustomWidth=t.width,this.isCustomHeight=t.height),this.border=new E(i.border),this.border.fillStyle=this.background||this.border.fillStyle,this.title=new I(i.title),this.title.chart=this.chart},J.prototype._measure=function(){var t;t=this.text?this.textBlock.measure(this.chart.ctx):{width:0,height:0},this.width=t.width+this.marker.size+this.lblMargin,this.height=t.height},J.prototype._arrange=function(){var t=this.marker.size/2,e=this.x+t,i=this.y+t+(this.height-this.marker.size)/2;this.markerShape=this.marker.getShape(e,i,t),this.markerShape&&(this.marker._setShapeSettings(this.markerShape),this.markerShape.context=this.context,this.markerShape.cursor=this.cursor,this.markerShape.isLegendItem=!0),this.textBlock.x=this.x+this.marker.size+this.lblMargin,this.textBlock.y=this.y},J.prototype._render=function(t){var i=[];return this.markerShape&&i.push(this.markerShape),this.textBlock&&i.push(this.textBlock),e.merge(t,i),i},J.prototype.setOptions=function(t){var i=e.extend(!1,{},this.defaults,t||{});e.extend(this,i),this.textBlock=new T(this.text),this.textBlock.textBaseline="top",this.textBlock.font=this.font,this.textBlock.fillStyle=this.textFillStyle,this.textBlock.strokeStyle=this.textStrokeStyle,this.textBlock.lineWidth=this.textLineWidth,this.textBlock.cursor=this.cursor,this.textBlock.context=this.context,this.textBlock.isLegendItem=!0},K.prototype._arrange=function(){var t=this.x,e=this.y;this.border.x=t,this.border.y=e,this.border.width=this.width,this.border.height=this.height,this._arrangeRenderer(this.chart.areaRenderer),this._arrangeRenderer(this.chart.hlRenderer)},K.prototype._arrangeRenderer=function(t){if(l.use_excanvas){var e=this.x,i=this.y,n=t.canvas,s=t.div,o=Math.max(this.width,0),r=Math.max(this.height,0);s.css({left:e,top:i,width:o,height:r}),n.width=o,n.height=r,t.offsetX=-e,t.offsetY=-i}},K.prototype._render=function(t){this.border.fillStyle=this.fillStyle,this.border._render(t);var i=this._renderPlots(t);this._renderGridLines(t),e.merge(t,i)},K.prototype._renderSeries=function(t){for(var i=this.chart.series.items,n=[],s=0;s<i.length;s++){var o=i[s];if(!o.notInGridArea){var r=o._render(t);r&&e.merge(n,r)}}return n},K.prototype._renderStripes=function(t){for(var i=this.chart.axes.items,n=0;n<i.length;n++){var s=i[n],o=this._getStripes(s);e.merge(t,o)}},K.prototype._renderPlots=function(t){for(var i=[],n=this.chart.axes.items,s=0;s<n.length;s++){var o=n[s],r=this._getPlotBands(o);r&&(e.merge(t,r.shapes),e.merge(i,r.texts));var a=this._getPlotLines(o);a&&(e.merge(t,a.shapes),e.merge(i,a.texts))}return i},K.prototype._renderGridLines=function(t){for(var i=this.chart.axes.items,n=0;n<i.length;n++){var s=i[n],o=s.majorGridLines;null==o&&"y"==s.getOrientation()&&(o=new q,null!=s.minorGridLines&&(s.minorGridLines.major=o));var r=this._getGridLines(s,s.minorGridLines,!1);e.merge(t,r);var a=this._getGridLines(s,o,!0);e.merge(t,a)}},K.prototype._getStripes=function(t){var i=t.stripes;if(null==i||1!=e.isArray(i))return[];var n=this,s=[];return e.each(i,function(){var e,i=new Stripe(this);e=i.interval?i.interval:2*t.actualInterval;var o;o=i.width?i.width:t.actualInterval;for(var r=i.lineWidth,a=r/2,l=t._getIntervals(e,i,!0),h=0;h<l.length;h++){var c=l[h];if(!(c>=t.actualVisibleMaximum)){var u,d=t.getPosition(c),p=t._getNextPosition(c,o),m=t.getPosition(p);u=t.isAxisVertical?new f(n.x+a,Math.min(d,m),n.width-r,Math.abs(m-d)):new f(Math.min(d,m),n.y+a,Math.abs(m-d),n.height-r),i._setSettings(u),s.push(u)}}}),s},K.prototype._getGridLines=function(t,e,i){if("radial"==t.location||null==e||1!=e.visible)return[];for(var n,s,o,r,a=[],l=t._getMarkInterval(e,i),h=t._getIntervals(l,e,i),c=0;c<h.length;c++){var u=t.getPosition(h[c]);t.isAxisVertical?(s=r=u,n=this.x,o=n+this.width):(n=o=u,s=this.y,r=s+this.height);var d=new p(n,s,o,r);e._setLineSettings(d),a.push(d)}return a},K.prototype._getPlotLines=function(t){var i=t.plotLines;if(null==i||1!=e.isArray(i))return null;for(var n=this,s=[],o=[],r=0;r<i.length;r++){var a=new Z;t.isAxisVertical||(a.defaults.title.hAlign="right"),a.setOptions(i[r]);var l=a.lineWidth/2,h=t.getPosition(a.value),u=new I(a.title);if(u.chart=this.chart,u._measure(),t.isAxisVertical){switch(y1=y2=h,x1=this.x,x2=x1+this.width,u.x=x1,u.y=y1,u.hAlign){case"center":u.x=n.x+(n.width-u.width)/2;break;case"right":u.x=n.x+n.width-u.width}switch(u.vAlign){case"bottom":u.y+=l;break;case"center":u.y-=u.height/2;break;case"top":u.y-=u.height+l}}else{switch(x1=x2=h,y1=this.y,y2=y1+this.height,u.x=x1,u.y=y1,u.hAlign){case"right":u.x+=l;break;case"center":u.x-=u.height/2;break;case"left":u.x-=u.height+l}switch(u.vAlign){case"center":u.y+=(n.height-u.width)/2;break;case"bottom":u.y+=n.height-u.width}u.rotX=u.x+u.height-u.margin,u.rotY=u.y+u.margin,u.rotationAngle=c.radians(90)}var d=new p(x1,y1,x2,y2);a._setLineSettings(d),s.push(d),u._render(o)}return{shapes:s,texts:o}},K.prototype._getPlotBands=function(t){var i=t.plotBands;if(null==i||1!=e.isArray(i))return null;for(var n=this,s=[],o=[],r=0;r<i.length;r++){var a=new Y;t.isAxisVertical||(a.defaults.title.hAlign="right"),a.setOptions(i[r]);var l,h,u,d,p=a.lineWidth,m=p/2,g=t.getPosition(a.from),v=t.getPosition(a.to);t.isAxisVertical?(l=n.x+m,h=Math.min(g,v),u=n.width-p,d=Math.abs(v-g)):(l=Math.min(g,v),h=n.y+m,u=Math.abs(v-g),d=n.height-p);var _=new f(l,h,u,d);a._setShapeSettings(_),s.push(_);var y=new I(a.title);if(y.chart=this.chart,y._measure(),t.isAxisVertical){switch(y.x=l,y.y=h,y.hAlign){case"center":y.x+=(u-y.width)/2;break;case"right":y.x+=u-y.width}switch(y.vAlign){case"center":y.y+=(d-y.height)/2;break;case"bottom":y.y+=d-y.height}}else{switch(y.x=l,y.y=h,y.hAlign){case"center":y.x+=(u-y.height)/2;break;case"right":y.x+=u-y.height}switch(y.vAlign){case"center":y.y+=(d-y.width)/2;break;case"bottom":y.y+=d-y.width}y.rotX=y.x+y.height-y.margin,y.rotY=y.y+y.margin,y.rotationAngle=c.radians(90)}y._render(o)}return{shapes:s,texts:o}},K.prototype._contains=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},K.prototype.getRight=function(){return this.x+this.width},K.prototype.fitHor=function(t){return c.fitInRange(t,this.x,this.getRight())},K.prototype.fitVer=function(t){return c.fitInRange(t,this.y,this.y+this.height)},Q.prototype.setOptions=function(t){if(this.items=[],0!=e.isArray(t)){for(var i=0;i<t.length;i++){var n=t[i];if(null!=n){var s,o=n.type||"column";switch(o=o.toLowerCase()){case"area":s=new ie(n);break;case"splinearea":s=new ne(n);break;case"bar":s=new se(n);break;case"line":s=new ee(n);break;case"stepline":s=new he(n);break;case"steparea":s=new ce(n);break;case"spline":s=new le(n);break;case"pie":s=new re(n);break;case"scatter":s=new ae(n);break;case"stackedcolumn":s=new ue(n);break;case"stackedbar":s=new de(n);break;case"stacked100column":s=new pe(n);break;case"stacked100bar":s=new fe(n);break;case"rangecolumn":s=new me(n);break;case"rangebar":s=new ge(n);break;case"band":s=new BandSeries(n);break;case"verticalarea":s=new ve(n);break;case"range":s=new _e(n);break;case"column":default:s=new oe(n)}s.type=o,s.chart=this.chart,this.items.push(s)}}this._processData()}},Q.prototype._processData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._processData()}},Q.prototype._initData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._initData()}},Q.prototype._initVisibleData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.visible&&i._initVisibleData()}},Q.prototype._initCategories=function(){for(var t=[],e=0,i=0,n=this.items,s=0;s<n.length;s++){var o=n[s];if(o.visible&&o.categories){for(i=e;i<o.categories.length;i++){var r=o.categories[i];t.push(r)}e=i}}this.categories=t},Q.prototype._initRanges=function(){for(var t=Ae,e=Me,i=Ae,n=Me,s=this.items,o=0;o<s.length;o++){var r=s[o];r.visible&&(t>r.min&&(t=r.min),e<r.max&&(e=r.max),i>r.minX&&(i=r.minX),n<r.maxX&&(n=r.maxX))}this.min=t,this.max=e,this.minX=i,this.maxX=n},Q.prototype._findClusters=function(t,e){for(var i=-1,n=0,s=this.items,o=0;o<s.length;o++){var r=s[o];r.visible&&(r==t&&(i=n),r.type==e&&n++)}return{index:i,count:n}},Q.prototype._findStackedClusters=function(t,i){for(var n=t.stackedGroupName,s=this._getStackedGroupsFromType(i),o=e.inArray(n,s),r=s.length,a=-1,l=0,h=this.items,c=0;c<h.length;c++){var u=h[c];u.visible&&(u==t&&(a=l),u.type==i&&u.stackedGroupName==n&&l++)}return{index:a,count:l,groupIndex:o,groupCount:r}},Q.prototype._getSeriesFromType=function(t){for(var e=[],i=this.items,n=0;n<i.length;n++){var s=i[n];s.visible&&s.type==t&&e.push(s)}return e},Q.prototype._getStackedSeriesFromType=function(t,e){for(var i=[],n=this.items,s=0;s<n.length;s++){var o=n[s];o.visible&&o.type==t&&o.stackedGroupName==e&&i.push(o)}return i},Q.prototype._getStackedGroupsFromType=function(t){var i=[];return e.each(this.items,function(){if(this.visible&&this.type==t){var n=e.inArray(this.stackedGroupName,i);-1==n&&i.push(this.stackedGroupName)}}),i},Q.prototype._initColors=function(){for(var t=this.chart.paletteColors,e=this.items,i=0;i<e.length;i++){var n=e[i];n._initColors(t.getColor(i),t)}},Q.prototype._getPixelMargins=function(t){for(var e=0,i=0,n=this.items,s=0;s<n.length;s++){var o=n[s];if(o.visible){var r=o._getPixelMargins(t);e=Math.max(e,r.left),i=Math.max(i,r.right)}}return{left:e,right:i}},Q.prototype._isAnchoredToOrigin=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];if(i.visible&&i._isAnchoredToOrigin())return!0}return!1},Q.prototype._render=function(t){for(var e=this.items,i=0;i<e.length;i++){var n=e[i];n.visible&&n.notInGridArea&&n._render(t)}},Q.prototype.getSeries=function(t){return this.items[t]},Q.prototype.hasData=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];if(i.visible&&i.hasData())return!0}return!1},te.prototype={_getMarker:function(t,e,i,n,s){null==i&&(i=this.markers.size/2);var o=this.markers.getShape(t,e,i,s);return null==o?null:(this.markers._setShapeSettings(o),this._setMarkerSettings(o),o)},_addMarker:function(t,e,i,n,s){var o=this._correctMarkerPosition(t,e,n),r=this._getMarker(o.x,o.y,i,n,s),a=this.markers.offset,l=null;return a&&(l=new p(t,e,o.x,o.y),this.markers._setLineSettings(l),this._setMarkerLinkLineSettings(l)),{marker:r,line:l,offset:o.offset}},_correctMarkerPosition:function(t,e,i){var n=this.markers.offset;if(n){var s=i>=this.realYAxis.getCrossing();e=s?e-n:e+n}return{x:t,y:e,offset:n}},_addMarkerAndLabel:function(t,e,i,n,s,o,r,a,l,h){var c=0,u=r?r:s;if(h||(h={chart:this.chart,series:this,dataItem:this.arrData[s],index:s,x:this.realXAxis._getValue(u),y:a}),this.markers&&this.markers.isVisible()&&this.realYAxis.isValueVisible(a)){var d=h.dataItem[2],p=this._addMarker(i,n,null,a,d);p.marker&&(p.marker.context=h,p.line&&t.push(p.line),t.push(p.marker),c=this.markers.offset,this._addShapeAnimation(p.marker,s,o))}if(this.labels&&this.labels.visible!==!1){var f=this._getLabelValue(a,s);"percentage"==this.labels.valueType&&(f=h.percentage);var m=this._getDataPointLabel(a,i,n,l+c,f);m.context=h,this.chart.elem.trigger("dataPointLabelCreating",m),e.push(m),this._addShapeAnimation(m,s,o)}},_getAnimation:function(){return this.animation||this.chart.options.animation},_addShapeAnimation:function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var s=new o(n,t,"visible",!1,!0),r=s.duration/i,a=s.delayTime+e*r;s.delayTime=a,s.duration=r,this.chart.storyboard.addAnimation(s)}},_addLengthAnimation:function(t){var e=this._getAnimation();if(e&&e.enabled!==!1){var i=new s(e,t,"length",0,t.getLength());this.chart.storyboard.addAnimation(i)}},_setMarkerSettings:function(t){t.fillStyle=t.fillStyle||this.fillStyle,t.cursor=t.cursor||this.cursor;var e=this.chart.options.shadows;c.isNull(t.shadowColor)&&(t.shadowColor=c.isNull(this.shadowColor)?e.shadowColor:this.shadowColor),c.isNull(t.shadowBlur)&&(t.shadowBlur=c.isNull(this.shadowBlur)?e.shadowBlur:this.shadowBlur),c.isNull(t.shadowOffsetX)&&(t.shadowOffsetX=c.isNull(this.shadowOffsetX)?e.shadowOffsetX:this.shadowOffsetX),c.isNull(t.shadowOffsetY)&&(t.shadowOffsetY=c.isNull(this.shadowOffsetY)?e.shadowOffsetY:this.shadowOffsetY)},_setMarkerLinkLineSettings:function(t){t.strokeStyle=t.strokeStyle||this.markers.strokeStyle||this.fillStyle},_setShapeSettings:function(t,e){t.fillStyle=this.fillStyles&&!c.isNull(e)?this.fillStyles[e%this.fillStyles.length]:this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.lineJoin=this.lineJoin,t.miterLimit=this.miterLimit,t.strokeDashArray=this.strokeDashArray,l.setShadows(t,this,this.chart),t.nullHandling=this.nullHandling,t.cursor=this.cursor},_getXAxisType:function(){var t=this.arrData;if(0==e.isArray(t))return"none";for(var i=0;i<t.length;i++){var n=t[i];if(null!=n){if(0==e.isArray(n))return"CategoryAxis";var s=n[0];if(null!=s){var o=e.type(s);switch(o){case"number":return"LinearAxis";case"date":return"DateTimeAxis";case"string":return"CategoryAxis";default:return"none"}}}}return"none"},_resolveAxisType:function(t){var e=t.location;if(e){if(this.isVertical){if("bottom"==e||"top"==e)return}else if("left"==e||"right"==e)return;var i=this._getXAxisType();switch(i){case"LinearAxis":t.type="linear";break;case"DateTimeAxis":t.type="dateTime";break;case"CategoryAxis":t.type="category"}}},_processData:function(){if(this.arrData=null,this.data)return this.arrData=this.data,void 0;var t=this.chart.arrDataSource;if(t){var e=this.xValuesField,i=this.yValuesField,n=c.processDataField(t,e),s=c.processDataField(t,i);s&&(this.arrData=c.mergeArraysXY(n,s))}},_processDataXYZ:function(){if(this.arrData=null,this.data)return this.arrData=this.data,void 0;var t=this.chart.arrDataSource;if(t){var e=this.xValuesField,i=this.fromValuesField,n=this.toValuesField,s=c.processDataField(t,e),o=c.processDataField(t,i),r=c.processDataField(t,n);s&&o&&r&&(this.arrData=c.mergeArrays([s,o,r]))}},_initXYData:function(){for(var t=this.arrData,e=Ae,i=Me,n=Ae,s=Me,o=t.length,r=0;o>r;r++){var a=t[r];if(null!=a){var l=a[0];n>l&&(n=l),l>s&&(s=l);var h=a[1];c.isNull(h)||(e>h&&(e=h),h>i&&(i=h))}}this.min=e,this.max=i,this.minX=n,this.maxX=s},_initCatValueData:function(){for(var t=this.arrData,i=Ae,n=Me,s=[],o=t.length,r=0;o>r;r++){var a=t[r];if(null!=a){var l=a;0==e.isArray(a)?s.push((r+1).toString()):(s.push(a[0]),l=a[1]),c.isNull(l)||(i>l&&(i=l),l>n&&(n=l))}else s.push((r+1).toString())}this.min=i,this.max=n,this.categories=s},_initDateValueData:function(){for(var t=this.arrData,e=Ae,i=Me,n=Ae,s=Me,o=t.length,r=0;o>r;r++){var a=t[r];if(null!=a){var l=a[0].getTime();n>l&&(n=l),l>s&&(s=l);var h=a[1];c.isNull(h)||(e>h&&(e=h),h>i&&(i=h))}}this.min=e,this.max=i,this.minX=n,this.maxX=s},_initXYDataRange:function(t,i){for(var n=this.arrData,s=Ae,o=Me,r=Ae,a=Me,l=n.length,h=0;l>h;h++){var c=n[h];if(null!=c&&0!=e.isArray(c)){var u=c[0];r>u&&(r=u),u>a&&(a=u);for(var d=t;i>d;d++){var p=c[d];s>p&&(s=p),p>o&&(o=p)}}}this.min=s,this.max=o,this.minX=r,this.maxX=a},_initCatValueDataRange:function(t,i,n){for(var s=this.arrData,o=Ae,r=Me,a=[],l=s.length,h=0;l>h;h++){var c=s[h];if(null!=c){var u=c[0];(n||-1==e.inArray(u,a))&&a.push(u);for(var d=t;i>d;d++){var p=c[d];o>p&&(o=p),p>r&&(r=p)}}else a.push((h+1).toString())}this.min=o,this.max=r,this.categories=a},_initDateValueDataRange:function(t,i){for(var n=this.arrData,s=Ae,o=Me,r=Ae,a=Me,l=n.length,h=0;l>h;h++){var c=n[h];if(null!=c&&0!=e.isArray(c)){var u=c[0].getTime();r>u&&(r=u),u>a&&(a=u);for(var d=t;i>d;d++){var p=c[d];s>p&&(s=p),p>o&&(o=p)}}}this.min=s,this.max=o,this.minX=r,this.maxX=a},_initData:function(){var t=this._getXAxisType();switch(this.xAxisType=t,t){case"LinearAxis":return this._initXYData(),void 0;case"DateTimeAxis":return this._initDateValueData(),void 0;case"CategoryAxis":return this._initCatValueData(),void 0
}},_initVisibleData:function(){var t=this._getXAxisType();switch(this.xAxisType=t,t){case"LinearAxis":case"DateTimeAxis":return this._initVisibleXYData(),void 0;case"CategoryAxis":return this._initVisibleCatValueData(),void 0}},_initVisibleXYData:function(){if(!this.realYAxis.zoomEnabled){var t=this.realXAxis,e=t.visibleMinimum||t.minimum,i=t.visibleMaximum||t.maximum,n=!c.isNull(e),s=!c.isNull(i);if(n||s){t.skipEmptyDays&&(e=t._addEmptyDaysOffset(e),i=t._addEmptyDaysOffset(i));for(var o=this.arrData,r=Ae,a=Me,l=o.length,h=0;l>h;h++){var u=o[h];if(null!=u){var d=u[1];if(!c.isNull(d)){var p=u[0];n&&e>p||s&&p>i||(r>d&&(r=d),d>a&&(a=d))}}}this.min=r,this.max=a}}},_initVisibleCatValueData:function(){if(!this.realYAxis.zoomEnabled){var t=this.realXAxis,i=t.visibleMinimum||t.minimum,n=t.visibleMaximum||t.maximum,s=!c.isNull(i),o=!c.isNull(n);if(s||o){for(var r=this.arrData,a=Ae,l=Me,h=r.length,u=0;h>u;u++){var d=r[u];if(null!=d){var p=d;e.isArray(d)&&(p=d[1]),c.isNull(p)||s&&i>u+1||o&&u>n||(a>p&&(a=p),p>l&&(l=p))}}this.min=a,this.max=l}}},_initVisibleCatValueDataRange:function(t,e){if(!this.realYAxis.zoomEnabled){var i=this.realXAxis,n=i.visibleMinimum||i.minimum,s=i.visibleMaximum||i.maximum,o=!c.isNull(n),r=!c.isNull(s);if(o||r){for(var a=this.arrData,l=Ae,h=Me,u=a.length,d=0;u>d;d++){var p=a[d];if(null!=p&&!(o&&n>d+1||r&&d>s))for(var f=t;e>f;f++){var m=p[f];l>m&&(l=m),m>h&&(h=m)}}this.min=l,this.max=h}}},_initVisibleXYDataRange:function(t,e){if(!this.realYAxis.zoomEnabled){var i=this.realXAxis,n=i.visibleMinimum||i.minimum,s=i.visibleMaximum||i.maximum,o=!c.isNull(n),r=!c.isNull(s);if(o||r){i.skipEmptyDays&&(n=i._addEmptyDaysOffset(n),s=i._addEmptyDaysOffset(s));for(var a=this.arrData,l=Ae,h=Me,u=a.length,d=0;u>d;d++){var p=a[d];if(null!=p){var f=p[0];if(!(o&&n>f||r&&f>s))for(var m=t;e>m;m++){var g=p[m];l>g&&(l=g),g>h&&(h=g)}}}this.min=l,this.max=h}}},_initStackedData:function(t){var i=this._getXAxisType();this.xAxisType=i;var n=this.arrData;if(0!=e.isArray(n)){var s=this.chart.series._findStackedClusters(this,t),o=this.chart.series._getStackedSeriesFromType(t,this.stackedGroupName),r=this._calcStackedData(n,s,o);e.extend(this,r)}},_initVisibleStackedData:function(t){var i=this._getXAxisType();this.xAxisType=i;var n=this.arrData;if(0!=e.isArray(n)){var s=this.chart.series._findStackedClusters(this,t),o=this.chart.series._getStackedSeriesFromType(t,this.stackedGroupName),r=this._calcVisibleStackedData(n,s,o);e.extend(this,r)}},_calcStackedData:function(t,i,n){for(var s=Ae,o=Me,r=Ae,a=Me,l=[],h=t.length,c={},u=0;h>u;u++){var d=t[u];if(null!=d){if("CategoryAxis"==this.xAxisType)0==e.isArray(d)?l.push((u+1).toString()):l.push(d[0]);else{var p=d[0];"date"==e.type(p)&&(p=p.getTime()),r>p&&(r=p),p>a&&(a=p)}for(var f=this._getXValue(d,u),m={positive:0,negative:0},g=null,v=i.index-1;v>=0;v--)if(g=n[v].dataValues[f]){m.positive=g.positive,m.negative=g.negative;break}e.isArray(d)&&(d=d[1]),m.actualValue=d,d>0?(m.positive+=d,m.value=m.positive):0>d?(m.negative+=d,m.value=m.negative):m.value=null!=g?g.value:0,c[f]=m,o=Math.max(o,m.value),s=Math.min(s,m.value)}else l.push((u+1).toString())}var _={min:s,max:o,dataValues:c};return"CategoryAxis"==this.xAxisType?_.categories=l:(_.minX=r,_.maxX=a),_},_calcVisibleStackedData:function(t,i,n){if(!this.realYAxis.zoomEnabled){var s=this.realXAxis,o=s.visibleMinimum||s.minimum,r=s.visibleMaximum||s.maximum,a=!c.isNull(o),l=!c.isNull(r);if(a||l){s.skipEmptyDays&&(o=s._addEmptyDaysOffset(o),r=s._addEmptyDaysOffset(r));for(var h=Ae,u=Me,d=t.length,p={},f=0;d>f;f++){var m=t[f];if(null!=m){if("CategoryAxis"==this.xAxisType){if(a&&o>f+1||l&&f>r)continue}else{var g=m[0];if(a&&o>g||l&&g>r)continue}for(var v=this._getXValue(m,f),_={positive:0,negative:0},y=null,b=i.index-1;b>=0;b--)if(y=n[b].dataValues[v]){_.positive=y.positive,_.negative=y.negative;break}e.isArray(m)&&(m=m[1]),_.actualValue=m,m>0?(_.positive+=m,_.value=_.positive):0>m?(_.negative+=m,_.value=_.negative):_.value=null!=y?y.value:0,p[v]=_,u=Math.max(u,_.value),h=Math.min(h,_.value)}}var w={min:h,max:u,dataValues:p};return w}}},_createXAxis:function(){var t,e={location:"bottom",orientation:"x"};switch(this.xAxisType){case"DateTimeAxis":t=new Se(e);break;case"CategoryAxis":t=new we(e);break;default:t=new xe(e)}return t.chart=this.chart,t},_createYAxis:function(){var t=new xe({location:"left",orientation:"y"});return t.chart=this.chart,t},_initXAxis:function(t){var e=this._findXAxis(t);null==e&&(e=this._createXAxis(),t.push(e)),this.realXAxis=e},_initYAxis:function(t){var e=this._findYAxis(t);null==e&&(e=this._createYAxis(),t.push(e)),this.realYAxis=e},_initSharedAxes:function(){this.realXAxis&&this.realYAxis&&(this.realXAxis.sharedAxis=this.realYAxis,this.realYAxis.sharedAxis=this.realXAxis)},_findAxis:function(t,e){if(null!=e)for(var i=0;i<t.length;i++){var n=t[i];if(n.name==e)return n}return null},_findXAxis:function(t){var e=this._findAxis(t,this.axisX);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"x"==e.getOrientation(this)&&!e.isVertical()&&e.DataType==this.xAxisType)return e;return null},_findYAxis:function(t){var e=this._findAxis(t,this.axisY);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"y"==e.getOrientation(this)&&0!=e.isVertical()&&"LinearAxis"==e.DataType)return e;return null},_getLegendItems:function(t){var i,n=[];if(null!=this.title)i=this.title;else{var s=e.inArray(this,this.chart.series.items)+1;i="Series "+s.toString()}var o=new G;switch(o.fillStyle=this.fillStyle,o.lineWidth=this.lineWidth,o.strokeStyle=this.strokeStyle,this.type){case"line":case"trendline":o.type="line";break;case"scatter":o.fillStyle=this.fillStyle,o.lineWidth=0,this.markers&&(o.type=this.markers.type)}var r={chart:this.chart,series:this};t=e.extend(!1,{},t,{context:r,text:i,marker:o});var a=new J(t);return a.chart=this.chart,a.series=this,n.push(a),n},_initColors:function(t){this.fillStyle=this.fillStyle||t,this.strokeStyle=this.strokeStyle||t},_getPixelMargins:function(t){var i,n=4,s=0;this.markers?(i=this.markers.getSize(),s=this.markers.offset):i={width:0,height:0};var o;if(this.labels&&this.labels.visible!==!1){var r=new T("TEST");e.extend(r,this.labels),o=r.measure(this.chart.ctx)}else o={width:0,height:0};var a,l=t.isVertical(),h=this.isVertical;if(a=l?i.height/2+o.height+n:i.width/2+o.width+n,h&&!l||!h&&l){a+=s,a*=1.25;var c=a/t.length;a*=1+c}return a="x"==t.getOrientation(this)?Math.max(a,6):Math.max(a,12),{left:a,right:a}},_isAnchoredToOrigin:function(){return!1},_getLabelText:function(t){var i=e.fn.jqChart.labelFormatter(this.labels.stringFormat,t);return i},_getLabelValue:function(t,e){switch(this.labels.valueType){case"percentage":t=this.getPercentage(t,e)}return t},_getDataPointLabel:function(t,i,n,s,o){var r=t>=this.realYAxis.getCrossing(),a=this._getLabelText(o),h=new T(a);return l.setShadows(h,this,this.chart),e.extend(h,this.labels),h.measure(this.chart.ctx),h.textAlign="center",h.x=i,r?(h.y=n-s,h.textBaseline="bottom"):(h.y=n+s,h.textBaseline="top"),h},_getTotal:function(t,i){for(var n=this.chart.series._getSeriesFromType(t),s=0,o=0,r=0;r<n.length;r++){var a=n[r],l=a.arrData;if(null!=l){var h=l[i];e.isArray(h)&&(h=h[1]),null!=h&&(h>0?s+=h:o+=h)}}return{positive:s,negative:o}},_getStackedTotal:function(t,e){for(var i=0,n=0,s=0;s<t.length;s++){var o=t[s],r=o.dataValues[e];r&&(r.actualValue>0?i+=r.actualValue:n+=r.actualValue)}return{positive:i,negative:n}},_getPrevStackedPosition:function(t,e,i,n,s,o){for(var r=e-1;r>=0;r--){var a=t[r].dataValues[i];if(a){var l=this._scaleValue(t,a.value,i);if(o){if(a.value==a.positive)return s.getPosition(l)}else if(a.value==a.negative)return s.getPosition(l)}}return n},_getXValue:function(t,i){var n;return this.arrData,"CategoryAxis"==this.xAxisType?n=0==e.isArray(t)?(i+1).toString():t[0]:(n=t[0],"date"==e.type(n)&&(n=n.getTime())),n=n?n.toString():""},_getTooltip:function(t){var e="<b>"+t.y+"</b><br/>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},_calcColumnScale:function(t){for(var i=[],n=0;n<t.length;n++)e.merge(i,t[n].arrData||[]);i.sort(function(t,e){return t[0]-e[0]});for(var s,o,r=Ae,n=0;n<i.length-1;n++)s=i[n][0],"date"==e.type(s)&&(s=s.getTime()),o=i[n+1][0],"date"==e.type(o)&&(o=o.getTime()),s!=o&&(r=Math.min(r,o-s));var a=this.realXAxis,l=a.series,h=l.maxX-l.minX;return a.skipEmptyDays&&(h-=a.totalEmptyDaysTicks),h=Math.min(.5,r/h)},_getSeriesFromThisType:function(){return this.chart.series._getSeriesFromType(this.type)},_render:function(t){if(this.arrData)switch(this.xAxisType){case"LinearAxis":case"DateTimeAxis":return this._renderLinearData(t);case"CategoryAxis":return this._renderCatData(t)}},hasData:function(){return!!this.arrData},getPercentage:function(t,e){var i=this._getTotal(this.type,e),n=t>0?i.positive:i.negative;return t=0!=n?100*Math.abs(t)/Math.abs(n):0},setOptions:function(t){var i=e.extend({},this.defaults,t||{});e.extend(this,i),null!=i.markers&&(this.markers=new G(i.markers))},defaults:{nullHandling:"break",lineCap:"butt",lineJoin:"round",miterLimit:10,pointWidth:.6,visible:!0,lineWidth:1,strokeStyle:null}},ee.prototype=new te,ee.constructor=ee,ee.prototype._renderCatData=function(t){for(var i,n,s,o,r=this.arrData,a=r.length,l=null!=this.markers&&this.markers.isVisible(),h=[],u=[],d=[],p=[],f=l?this.markers.size/2:0,m=0;a>m;m++){var g=r[m];if(null!==g){if(s=i=m+.5,0==e.isArray(g))o=g;else if(o=g[1],c.isNull(o)){h.push(null),h.push(null),l||u.push(null);continue}i=this.realXAxis.getPosition(i),n=this.realYAxis.getPosition(o),h.push(i),h.push(n),l||u.push({dataItem:g,index:m,x:this.realXAxis._getValue(m),y:o}),this.realYAxis.isValueVisible(o)!==!1&&this._addMarkerAndLabel(d,p,i,n,m,a,null,o,f)}else h.push(null),h.push(null),l||u.push(null)}var v=this._createShape(h,t);return!l&&v?v.context={chart:this.chart,series:this,points:u}:e.merge(t,d),p},ee.prototype._renderLinearData=function(t){var i=this.arrData,n=i.length,s=null!=this.markers&&this.markers.isVisible(),o=null!=this.labels&&this.labels.visible!==!1;if(n>1e3&&0==s&&0==o)return this._renderLargeXYData(t),void 0;for(var r,a,l,h,u=[],d=[],p=[],f=[],m=s?this.markers.size/2:0,g=0;n>g;g++){var v=i[g];null!==v?(l=v[0],h=v[1],c.isNull(l)||c.isNull(h)?(u.push(null),u.push(null),s||d.push(null)):(r=this.realXAxis.getPosition(l),a=this.realYAxis.getPosition(h),u.push(r),u.push(a),s||d.push({dataItem:v,index:g,x:l,y:h}),this.realYAxis.isValueVisible(h)!==!1&&this._addMarkerAndLabel(p,f,r,a,g,n,l,h,m))):(u.push(null),u.push(null),s||d.push(null))}var _=this._createShape(u,t);return!s&&_?_.context={chart:this.chart,series:this,points:d}:e.merge(t,p),f},ee.prototype._renderLargeXYData=function(t){for(var e,i,n,s,o,r,a,l=this.arrData,h=l.length,c=this.chart.gridArea.width,u=this.chart.gridArea.height,d=this.realXAxis,p=this.realYAxis,f=2*(d.actualVisibleMaximum-d.actualVisibleMinimum)/c,m=2*(p.actualVisibleMaximum-p.actualVisibleMinimum)/u,g=[],v=0,_=0,y=0,b=0,w=[],x=0;h>x;x++)o=l[x],null!==o?(n=o[0],s=o[1],null!==s?(r=v-n,a=_-s,y+=0>r?-r:r,b+=0>a?-a:a,f>y&&m>b||(y=0,b=0,v=n,_=s,e=d.getPosition(n),i=p.getPosition(s),g.push(e),g.push(i),w.push({dataItem:o,index:x,x:n,y:s}))):(g.push(null),g.push(null),w.push(null))):(g.push(null),g.push(null),w.push(null));var S=this._createShape(g,t);S&&(S.context={chart:this.chart,series:this,points:w})},ee.prototype._createShape=function(t,e){var i=new b(t);return this._setShapeSettings(i),e.push(i),this._addLengthAnimation(i),i},ie.prototype=new ee,ie.constructor=ie,ie.prototype._createShape=function(t,i){var n=[];e.merge(n,t);var s=new b(n);this._setShapeSettings(s);var o=this.chart.gridArea,r=o.y,a=o.y+o.height,l=this.realYAxis.getCrossingPosition();l=c.fitInRange(l,r,a);var h=new x(t,l);return this._setShapeSettings(h),h.lineWidth=0,i.push(h),i.push(s),this._addLengthAnimation(h),this._addLengthAnimation(s),s},ie.prototype._isAnchoredToOrigin=function(){return!0},ne.prototype=new ie,ne.constructor=ne,ne.prototype._createShape=function(t,i){var n=[];e.merge(n,t);var s=new w(n);this._setShapeSettings(s);var o=this.chart.gridArea,r=o.y,a=o.y+o.height,l=this.realYAxis.getCrossingPosition();l=c.fitInRange(l,r,a);var h=new x(t,l,!1,!0);return this._setShapeSettings(h),h.lineWidth=0,i.push(h),i.push(s),this._addLengthAnimation(h),this._addLengthAnimation(s),s},se.prototype=new te,se.constructor=se,se.prototype._createXAxis=function(){var t,e={location:"left",orientation:"x"};switch(this.xAxisType){case"DateTimeAxis":t=new Se(e);break;case"CategoryAxis":t=new we(e);break;default:t=new xe(e)}return t.chart=this.chart,t},se.prototype._createYAxis=function(){var t=new xe({location:"bottom",orientation:"y"});return t.chart=this.chart,t},se.prototype._findXAxis=function(t){var e=this._findAxis(t,this.axisX);if(null!=e)return e;var i;i=this.categories?we:xe;for(var n=0;n<t.length;n++)if(e=t[n],"x"==e.getOrientation(this)&&0!=e.isVertical()&&e instanceof i)return e;return null},se.prototype._findYAxis=function(t){var e=this._findAxis(t,this.axisY);if(null!=e)return e;for(var i=0;i<t.length;i++)if(e=t[i],"y"==e.getOrientation(this)&&!e.isVertical()&&e instanceof xe)return e;return null},se.prototype._renderCatData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.x,o=s+n.width,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=this.chart.series._findClusters(this,this.type),l=i.length,h=n.height/this.realXAxis.getZoom(),u=h/l,d=u/a.count,p=Math.round(this.pointWidth*d),m=a.count*p,g=(u-m)/2;g=Math.round(g+a.index*p),p=Math.max(p,1);for(var v,_,y=[],b=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,x=0;l>x;x++){var S=i[x];if(null!=S){var C,T=x;if(C=0==e.isArray(S)?S:S[1],null!=C){_=Math.round(this.realXAxis.getCatPosition(T)-g-p),v=Math.round(this.realYAxis.getPosition(C));var M,A=v;if(r>=v){M=r-v;var D=n.x-10;if(D>v){var L=D-v;v+=L,M-=L}}else{M=v-r,v=r;var k=n.getRight()+10;v+M>k&&(M=k-v)}var P={chart:this.chart,series:this,dataItem:i[x],index:x,x:this.realXAxis._getValue(x),y:C},I=new f(v,_,M,p);I.context=P,I.center={x:Math.round(A),y:Math.round(_+p/2)},this._setShapeSettings(I,x),t.push(I),this._addAnimation(I,x,l),_+=p/2,this._addMarkerAndLabel(y,b,A,_,x,l,null,C,w,P)}}}return e.merge(t,y),b},se.prototype._renderLinearData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.x,o=s+n.width,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=i.length,l=n.height/this.realXAxis.getZoom(),h=this._getSeriesFromThisType(),u=this._calcColumnScale(h)*l,d=this.pointWidth*u;d=Math.max(d,1);for(var p,m,g=[],v=[],_=this.markers&&this.markers.isVisible()?this.markers.size/2:0,y=0;a>y;y++){var b=i[y];if(null!=b&&0!=e.isArray(b)){var w=b[0],x=b[1];if(null!=w&&null!=x){var S={chart:this.chart,series:this,dataItem:i[y],index:y,x:w,y:x};m=this.realXAxis.getPosition(w),p=Math.round(this.realYAxis.getPosition(x));var C,T=p;if(r>=p){C=r-p;var M=n.x-10;if(M>p){var A=M-p;p+=A,C-=A}}else{C=p-r,p=r;var D=n.getRight()+10;p+C>D&&(C=D-p)}var L=m-d/2,k=new f(p,L,C,d);k.context=S,k.center={x:Math.round(T),y:Math.round(L+d/2)},this._setShapeSettings(k,y),t.push(k),this._addAnimation(k,y,a),this._addMarkerAndLabel(g,v,T,m,y,a,null,x,_,S)}}}return e.merge(t,g),v},se.prototype._addAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"xDecrease",t.width,0);this._setIsAnimReversed(t);var r=o.duration/i,a=o.delayTime+e*r;o.delayTime=a,o.duration=r,this.chart.storyboard.addAnimation(o)}},se.prototype._setIsAnimReversed=function(t){var e=t.context.y<this.realYAxis.getCrossing(),i=this.realYAxis.reversed;t.isAnimReversed=!i&&e||i&&!e},se.prototype._correctMarkerPosition=function(t,e,i){var n=this.markers.offset;if(n){var s=i>=this.realYAxis.getCrossing();t=s?t+n:t-n}return{x:t,y:e}},se.prototype._getPixelMargins=function(t){if(0==t.isVertical()){var e=te.prototype._getPixelMargins.call(this,t),i=t.length/10,n=Math.max(i,e.left),s=Math.max(i,e.right);return{left:n,right:s}}if(null==this.arrData)return{left:0,right:0};var o=4,r=this._getSeriesFromThisType(),a=this._calcColumnScale(r),l=t.length,h=.5*a*l+o;return{left:h,right:h}},se.prototype._isAnchoredToOrigin=function(){return!0},se.prototype._getDataPointLabel=function(t,i,n,s,o){var r=t<=this.realYAxis.getCrossing(),a=this._getLabelText(o),h=new T(a);l.setShadows(h,this,this.chart),e.extend(h,this.labels),h.measure(this.chart.ctx),h.y=n;var c=this.chart.gridArea;if(r)h.x=i-s,h.textAlign="right",h.x-h.width<c.x+4&&(h.x=c.x+h.width+4);else{h.x=i+s,h.textAlign="left";var u=c.getRight()-4;h.x+h.width>u&&(h.x=u-h.width)}return h},se.prototype._initColors=function(t){this.fillStyle=this.fillStyle||t},oe.prototype=new te,oe.constructor=oe,oe.prototype._renderCatData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.y,o=n.y+n.height,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=this.chart.series._findClusters(this,this.type),l=i.length,h=n.width/this.realXAxis.getZoom(),u=h/l,d=u/a.count,p=Math.round(this.pointWidth*d),m=a.count*p,g=(u-m)/2;g=Math.round(g+a.index*p),p=Math.max(p,1);for(var v,_,y=[],b=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2:0,x=0;l>x;x++){var S=i[x];if(null!=S){v=x;var C;if(C=0==e.isArray(S)?S:S[1],null!=C){v=Math.round(this.realXAxis.getCatPosition(v)+g),_=Math.round(this.realYAxis.getPosition(C));var T,M=_;r>=_?T=r-_:(T=_-r,_=r);var A={chart:this.chart,series:this,dataItem:i[x],index:x,x:this.realXAxis._getValue(x),y:C},D=new f(v,_,p,T);D.context=A,D.center={x:Math.round(v+p/2),y:Math.round(M)},this._setShapeSettings(D,x),t.push(D),this._addAnimation(D,x,l),this.realYAxis.isValueVisible(C)!==!1&&(v+=p/2,this._addMarkerAndLabel(y,b,v,M,x,l,null,C,w,A))}}}return e.merge(t,y),b},oe.prototype._renderLinearData=function(t){var i=this.arrData,n=this.chart.gridArea,s=n.y,o=n.y+n.height,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=i.length,l=n.width/this.realXAxis.getZoom(),h=this._getSeriesFromThisType(),u=this._calcColumnScale(h)*l,d=this.pointWidth*u;d=Math.max(d,1);for(var p,m,g=[],v=[],_=this.markers&&this.markers.isVisible()?this.markers.size/2:0,y=0;a>y;y++){var b=i[y];if(null!=b&&0!=e.isArray(b)){p=b[0];var w=b[1];if(null!=p&&null!=w){var x={chart:this.chart,series:this,dataItem:i[y],index:y,x:p,y:w};p=this.realXAxis.getPosition(p),m=Math.round(this.realYAxis.getPosition(w));var S,C=m;r>=m?S=r-m:(S=m-r,m=r);var T=p-d/2,M=new f(T,m,d,S);M.context=x,M.center={x:Math.round(T+d/2),y:Math.round(C)},this._setShapeSettings(M,y),t.push(M),this._addAnimation(M,y,a),this.realYAxis.isValueVisible(w)!==!1&&this._addMarkerAndLabel(g,v,p,C,y,a,null,w,_,x)}}}return e.merge(t,g),v},oe.prototype._addAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"yDecrease",t.height,0);this._setIsAnimReversed(t);var r=o.duration/i,a=o.delayTime+e*r;o.delayTime=a,o.duration=r,this.chart.storyboard.addAnimation(o)}},oe.prototype._setIsAnimReversed=function(t){var e=t.context.y>=this.realYAxis.getCrossing(),i=this.realYAxis.reversed;t.isAnimReversed=!i&&e||i&&!e},oe.prototype._getPixelMargins=function(t){if(t.isVertical()){var e=te.prototype._getPixelMargins.call(this,t),i=t.length/10,n=Math.max(i,e.left),s=Math.max(i,e.right);return{left:n,right:s}}if(null==this.arrData)return{left:0,right:0};var o=4,r=this._getSeriesFromThisType(),a=this._calcColumnScale(r),l=t.length,h=.5*a*l+o;return{left:h,right:h}},oe.prototype._isAnchoredToOrigin=function(){return!0},oe.prototype._initColors=function(t){this.fillStyle=this.fillStyle||t},re.prototype=new te,re.constructor=re,re.prototype._initXAxis=function(){},re.prototype._initYAxis=function(){},re.prototype._initVisibleData=function(){},re.prototype._processData=function(){if(this.arrData=null,this.data)return this.arrData=this.data,this.expIndexes=this.explodedSlices,void 0;var t=this.chart.arrDataSource;if(t){var e=this.dataLabelsField,i=this.dataValuesField,n=c.processDataField(t,e),s=c.processDataField(t,i);this.arrData=c.mergeArraysXY(n,s),this.expIndexes=[];for(var o=0;o<t.length;o++){var r=t[o],a=r[this.explodedField];a&&this.expIndexes.push(o)}}},re.prototype._getYValues=function(){for(var t=[],i=this.arrData,n=i.length,s=0;n>s;s++){var o=i[s];if(null!=o){var r;r=0==e.isArray(o)?o:o[1],t.push(Math.abs(r))}}return t},re.prototype._render=function(t){var i=this.arrData;if(i){var n,s=this.chart.gridArea,o=s.width,r=s.height,a=this._getYValues(),l=c.sum(a),h=a.length,u=10;if(n=r>o?o/2-u:r/2-u,this.expIndexes&&this.expIndexes.length>0&&(n-=this.explodedRadius),!(0>n)){for(var d,p=s.x+o/2,f=s.y+r/2,m=2*Math.PI/l,g=-Math.PI/2,v=this.fillStyles,y=this.explodedRadius,b=0;h>b;b++){var w=a[b],x=100*w/l,S=g+w*m,C=p,M=f;if(d=this.isExploded(b)){var A=(g+S)/2;M=f+y*Math.sin(A),C=p+y*Math.cos(A)}var D=new _(C,M,n,g,S);this._setShapeSettings(D),D.fillStyle=v?v[b%v.length]:this.palette.getColor(b);var L={chart:this.chart,series:this,dataItem:i[b],index:b,value:w,percentage:x};D.context=L,t.push(D),this._addSliceAnimation(D,b,h),g=S}if(this.labels&&this.labels.visible!==!1)for(var k=[],g=-Math.PI/2,b=0;h>b;b++){var w=a[b],x=100*w/l,P=w,S=g+w*m;switch(this.labels.valueType){case"percentage":P=x}if(0!=w){var I=this._getLabelText(P),R=new T(I);R.textBaseline="top",e.extend(R,this.labels);var E=R.measure(this.chart.ctx),C=p,M=f;if(d=this.isExploded(b)){var A=(g+S)/2;M=f+y*Math.sin(A),C=p+y*Math.cos(A)}var O=this._getSliceCenter(C,M,(g+S)/2,.6*n);R.x=O.x-E.width/2,R.y=O.y-E.height/2;var j=this.isOverlap(R,k);j||(R.context={chart:this.chart,series:this,dataItem:i[b],index:b,value:w,percentage:x},this.chart.elem.trigger("dataPointLabelCreating",R),t.push(R),k.push(R),this._addShapeAnimation(R,b,h),g=S)}}}}},re.prototype.isExploded=function(t){var i=this.expIndexes;return i&&i.length?-1!=e.inArray(t,i):!1},re.prototype.isOverlap=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if(n.intersectWith(t.x,t.y,t.width,t.height))return!0}return!1},re.prototype._getSliceCenter=function(t,e,i,n){return{x:t+n*Math.cos(i),y:e+n*Math.sin(i)}},re.prototype._getLegendItems=function(t){var i=[],n=this.arrData;if(!n)return i;for(var s,o=this._getYValues(),r=n.length,a=0;r>a;a++){var l=n[a];if(null!=l){if(0==e.isArray(l)){var h=a+1;s=h.toString()}else s=l[0];var c=new G;c.fillStyle=this.palette.getColor(a);var u={chart:this.chart,series:this,dataItem:l,index:a,value:o[a]};t=e.extend(!1,{},t,{context:u,text:s,marker:c});var d=new J(t);d.chart=this.chart,d.series=this,i.push(d)}}return i},re.prototype._initColors=function(t,e){this.palette=e},re.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>",n=t.dataItem[0];return n&&(i=n+"<br/>"+i),i},re.prototype._addSliceAnimation=function(t,e,i){var n=this._getAnimation();if(n&&n.enabled!==!1){var o=new s(n,t,"endAngle",t.startAngle,t.endAngle),r=o.duration/i,a=o.delayTime+e*r;o.delayTime=a,o.duration=r,this.chart.storyboard.addAnimation(o)}},re.prototype.getTotal=function(){var t=this._getYValues(),e=c.sum(t);return e},re.prototype.getPercentage=function(t){var e=this.getTotal();return 100*t/e},ae.prototype=new ee,ae.constructor=ae,ae.prototype._createShape=function(){return null},le.prototype=new ee,le.constructor=le,le.prototype._createShape=function(t,e){var i=new w(t);return this._setShapeSettings(i),e.push(i),this._addLengthAnimation(i),i},he.prototype=new ee,he.constructor=he,he.prototype._createShape=function(t,e){for(var i,n,s=[],o=t.length,r=0;o>r&&(i=t[r],n=t[r+1],s.push(i),s.push(n),!(r>=o-2));r+=2)s.push(t[r+2]),s.push(n);var a=new b(s);return a.isStepLine=!0,this._setShapeSettings(a),e.push(a),this._addLengthAnimation(a),a},ce.prototype=new ee,ce.constructor=ce,ce.prototype._createShape=function(t,i){for(var n,s,o=[],r=t.length,a=0;r>a&&(n=t[a],s=t[a+1],o.push(n),o.push(s),!(a>=r-2));a+=2)o.push(t[a+2]),o.push(s);var l=[];e.merge(l,o);var h=new b(l);h.isStepLine=!0,this._setShapeSettings(h);var u=this.chart.gridArea,d=u.y,p=u.y+u.height,f=this.realYAxis.getCrossingPosition();f=c.fitInRange(f,d,p);var m=new x(o,f);return m.isStepLine=!0,this._setShapeSettings(m),m.lineWidth=0,i.push(m),i.push(h),this._addLengthAnimation(m),this._addLengthAnimation(h),h},ue.prototype=new oe,ue.constructor=ue,ue.prototype._initData=function(){this._initStackedData(this.type)},ue.prototype._initVisibleData=function(){this._initVisibleStackedData(this.type)},ue.prototype._renderCatData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.y,o=n.y+n.height,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=this.chart.series._findStackedClusters(this,this.type),l=i.length,h=n.width/this.realXAxis.getZoom(),u=h/l,d=u/a.groupCount,p=Math.round(this.pointWidth*d),m=a.groupCount*p,g=(u-m)/2;g=Math.round(g+a.groupIndex*p),p=Math.max(p,1);for(var v,_,y,b=[],w=[],x=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),S=this.markers&&this.markers.isVisible()?this.markers.size/2:0,C=0;l>C;C++)if(y=i[C],null!=y){var T=this._getXValue(y,C);if(y=this.dataValues[T],null!=y){var M=this._scaleValue(x,y.value,T);v=C,v=Math.round(this.realXAxis.getCatPosition(v)+g),_=Math.round(this.realYAxis.getPosition(M));var A,D=this._getPrevStackedPosition(x,a.index,T,r,this.realYAxis,M>=0),L=_;D>=_?A=D-_:(A=_-D,_=D);var k=y.actualValue,P=this._getStackedTotal(x,T),I=k>0?P.positive:P.negative,R=0!=I?100*Math.abs(k)/Math.abs(I):0,E={chart:this.chart,series:this,dataItem:i[C],index:C,value:k,x:this.realXAxis._getValue(C),y:M,percentage:R},O=new f(v,_,p,A);if(O.context=E,O.center={x:Math.round(v+p/2),y:Math.round(L)},this._setShapeSettings(O,C),t.push(O),this._addAnimation(O,a.index,a.count),v+=p/2,this.markers&&this.realYAxis.isValueVisible(M)){var j=this._getMarker(v,L,null,M);j.context=E,b.push(j),this._addShapeAnimation(j,a.index,a.count)}if(this.labels&&this.labels.visible!==!1&&0!=y.actualValue){var F=k;switch(this.labels.valueType){case"percentage":F=R}var N="outside"==this.labels.position,B=N?S:-A/2,z=this._getDataPointLabel(y.actualValue,v,L,B,F);N||(z.textBaseline="middle"),z.context=E,this.chart.elem.trigger("dataPointLabelCreating",z),w.push(z),this._addShapeAnimation(z,a.index,a.count)}}}return e.merge(t,b),w}},ue.prototype._renderLinearData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.y,o=n.y+n.height,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);for(var a,l,h,u=this.chart.series._findStackedClusters(this,this.type),d=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),p=i.length,m=n.width/this.realXAxis.getZoom(),g=this._calcColumnScale(d)*m,v=this.pointWidth*g,_=[],y=[],b=this.markers&&this.markers.isVisible()?this.markers.size/2:0,w=0;p>w;w++)if(h=i[w],null!=h){var x=this._getXValue(h,w);if(h=this.dataValues[x],null!=h){var S=this._scaleValue(d,h.value,x);a=i[w][0],a=Math.round(this.realXAxis.getPosition(a)),l=Math.round(this.realYAxis.getPosition(S));var C,T=this._getPrevStackedPosition(d,u.index,x,r,this.realYAxis,S>=0),M=l;T>=l?C=T-l:(C=l-T,l=T);var A=h.actualValue,D=this._getStackedTotal(d,x),L=A>0?D.positive:D.negative,k=0!=L?100*Math.abs(A)/Math.abs(L):0,P={chart:this.chart,series:this,dataItem:i[w],index:w,value:A,x:i[w][0],y:S,percentage:k},I=a-v/2,R=new f(I,l,v,C);if(R.context=P,R.center={x:Math.round(a+v/2),y:Math.round(M)},this._setShapeSettings(R,w),t.push(R),this._addAnimation(R,u.index,u.count),this.markers&&this.realYAxis.isValueVisible(S)){var E=this._getMarker(a,M,null,S);E.context=P,_.push(E),this._addShapeAnimation(E,u.index,u.count)}if(this.labels&&this.labels.visible!==!1&&0!=h.actualValue){var O=A;switch(this.labels.valueType){case"percentage":O=k}var j="outside"==this.labels.position,F=j?b:-C/2,N=this._getDataPointLabel(h.actualValue,a,M,F,O);j||(N.textBaseline="middle"),N.context=P,this.chart.elem.trigger("dataPointLabelCreating",N),y.push(N),this._addShapeAnimation(N,u.index,u.count)}}}return e.merge(t,_),y}},ue.prototype._getSeriesFromThisType=function(){return this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName)},ue.prototype._getTooltip=function(t){var e="<b>"+t.value+"</b><br/>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},ue.prototype._scaleValue=function(t,e){return e},de.prototype=new se,de.constructor=de,de.prototype._initData=function(){this._initStackedData(this.type)},de.prototype._initVisibleData=function(){this._initVisibleStackedData(this.type)},de.prototype._renderCatData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.x,o=s+n.width,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);var a=this.chart.series._findStackedClusters(this,this.type),l=i.length,h=n.height/this.realXAxis.getZoom(),u=h/l,d=u/a.groupCount,p=Math.round(this.pointWidth*d),m=a.groupCount*p,g=(u-m)/2;g=Math.round(g+a.groupIndex*p),p=Math.max(p,1);for(var v,_,y,b=[],w=[],x=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),S=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,C=0;l>C;C++)if(y=i[C],null!=y){var T=this._getXValue(y,C);if(y=this.dataValues[T],null!=y){var M=this._scaleValue(x,y.value,T);v=C,_=Math.round(this.realXAxis.getCatPosition(v)-g-p),v=Math.round(this.realYAxis.getPosition(M));var A,D=this._getPrevStackedPosition(x,a.index,T,r,this.realYAxis,M>=0),L=v;D>=v?A=D-v:(A=v-D,v=D);var k=y.actualValue,P=this._getStackedTotal(x,T),I=k>0?P.positive:P.negative,R=0!=I?100*Math.abs(k)/Math.abs(I):0,E={chart:this.chart,series:this,dataItem:i[C],index:C,value:k,x:this.realXAxis._getValue(C),y:M,percentage:R},O=new f(v,_,A,p);if(O.context=E,O.center={x:Math.round(L),y:Math.round(_+p/2)},this._setShapeSettings(O,C),t.push(O),this._addAnimation(O,a.index,a.count),_+=p/2,this.markers&&this.realYAxis.isValueVisible(M)){var j=this._getMarker(L,_,null,M);j.context=E,b.push(j),this._addShapeAnimation(j,a.index,a.count)}if(this.labels&&this.labels.visible!==!1&&0!=y.actualValue){var F=k;switch(this.labels.valueType){case"percentage":F=R}var N="outside"==this.labels.position,B=N?S:-A/2,z=this._getDataPointLabel(y.actualValue,L,_,B,F);N||(z.textBaseline="middle",z.textAlign="center"),z.context=E,this.chart.elem.trigger("dataPointLabelCreating",z),w.push(z),this._addShapeAnimation(z,a.index,a.count)}}}return e.merge(t,b),w}},de.prototype._renderLinearData=function(t){var i=this.arrData;if(i){var n=this.chart.gridArea,s=n.x,o=s+n.width,r=this.realYAxis.getCrossingPosition();r=c.fitInRange(r,s,o),r=Math.round(r);for(var a,l,h,u=this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName),d=this.chart.series._findStackedClusters(this,this.type),p=i.length,m=n.height/this.realXAxis.getZoom(),g=this._getSeriesFromThisType(),v=this._calcColumnScale(g)*m,_=this.pointWidth*v,y=[],b=[],w=this.markers&&this.markers.isVisible()?this.markers.size/2+2:2,x=0;p>x;x++)if(h=i[x],null!=h){var S=this._getXValue(h,x);if(h=this.dataValues[S],null!=h){var C=this._scaleValue(u,h.value,S);a=i[x][0],l=Math.round(this.realXAxis.getCatPosition(a)),a=Math.round(this.realYAxis.getPosition(C));var T,M=this._getPrevStackedPosition(u,d.index,S,r,this.realYAxis,C>=0),A=a;M>=a?T=M-a:(T=a-M,a=M);var D=h.actualValue,L=this._getStackedTotal(u,S),k=D>0?L.positive:L.negative,P=0!=k?100*Math.abs(D)/Math.abs(k):0,I={chart:this.chart,series:this,dataItem:i[x],index:x,value:D,x:i[x][0],y:C,percentage:P},R=l-_/2,E=new f(a,R,T,_);if(E.context=I,E.center={x:Math.round(A),y:Math.round(l+_/2)},this._setShapeSettings(E,x),t.push(E),this._addAnimation(E,d.index,d.count),this.markers&&this.realYAxis.isValueVisible(C)){var O=this._getMarker(A,l,null,C);O.context=I,y.push(O),this._addShapeAnimation(O,d.index,d.count)}if(this.labels&&this.labels.visible!==!1&&0!=h.actualValue){var j=D;switch(this.labels.valueType){case"percentage":j=P}var F="outside"==this.labels.position,N=F?w:-T/2,B=this._getDataPointLabel(h.actualValue,A,l,N,j);
	F||(B.textBaseline="middle",B.textAlign="center"),B.context=I,this.chart.elem.trigger("dataPointLabelCreating",B),b.push(B),this._addShapeAnimation(B,d.index,d.count)}}}return e.merge(t,y),b}},de.prototype._getSeriesFromThisType=function(){return this.chart.series._getStackedSeriesFromType(this.type,this.stackedGroupName)},de.prototype._getTooltip=function(t){var e="<b>"+t.value+"</b><br/>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<span style="color:'+i+'">'+this.title+"</span>: "+e}return e},de.prototype._scaleValue=function(t,e){return e},pe.prototype=new ue,pe.constructor=pe,pe.prototype._initVisibleData=function(){ue.prototype._initVisibleData.call(this),this.min=0,this.max=100},pe.prototype._getPixelMargins=function(t){if(t.isVertical()||null==this.arrData)return{left:0,right:0};var e=4,i=this._getSeriesFromThisType(),n=this._calcColumnScale(i),s=t.length,o=.5*n*s+e;return{left:o,right:o}},pe.prototype._scaleValue=function(t,e,i){var n=this._getStackedTotal(t,i).positive||1;return 100*e/n},pe.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>";if(this.title){var n=d.getColorFromFillStyle(this.fillStyle);i='<span style="color:'+n+'">'+this.title+"</span>: "+i}return i},fe.prototype=new de,fe.constructor=de,fe.prototype._initVisibleData=function(){de.prototype._initVisibleData.call(this),this.min=0,this.max=100},fe.prototype._getPixelMargins=function(t){if(0==t.isVertical()||null==this.arrData)return{left:0,right:0};var e=4,i=this._getSeriesFromThisType(),n=this._calcColumnScale(i),s=t.length,o=.5*n*s+e;return{left:o,right:o}},fe.prototype._scaleValue=function(t,e,i){var n=this._getStackedTotal(t,i).positive||1;return 100*e/n},fe.prototype._getTooltip=function(t){var e=this.chart.stringFormat(t.percentage,"%.2f%%"),i="<b>"+t.value+" ("+e+")"+"</b><br/>";if(this.title){var n=d.getColorFromFillStyle(this.fillStyle);i='<span style="color:'+n+'">'+this.title+"</span>: "+i}return i},me.prototype=new oe,me.constructor=me,me.prototype._initXYData=function(){this._initXYDataRange(1,3)},me.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3)},me.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},me.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},me.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},me.prototype._processData=function(){this._processDataXYZ()},me.prototype._renderCatData=function(t){for(var i,n,s,o,r,a,l=this.arrData,h=this.chart.gridArea,c=this.categories,u=c.length,d=h.width/this.realXAxis.getZoom(),p=d/u,m=Math.round(this.pointWidth*p),g=Math.round((p-m)/2),v=0;v<l.length;v++){var _=l[v];if(null!=_){var y=e.inArray(_[0],c);o=y>-1?y:v,r=_[1],a=_[2],i=Math.round(this.realXAxis.getCatPosition(o)+g),n=Math.round(this.realYAxis.getPosition(r)),s=Math.round(this.realYAxis.getPosition(a));var b={chart:this.chart,series:this,dataItem:l[v],index:v,catIndex:o,x:this.realXAxis._getValue(o),from:r,to:a},w=Math.min(n,s),x=Math.abs(n-s),S=new f(i,w,m,x);S.context=b,this._setShapeSettings(S,v),t.push(S),this._addAnimation(S,v,u)}}},me.prototype._renderLinearData=function(t){for(var i,n,s,o,r,a,l=this.arrData,h=this.chart.gridArea,c=l.length,u=h.width/this.realXAxis.getZoom(),d=this._getSeriesFromThisType(),p=this._calcColumnScale(d)*u,m=this.pointWidth*p,g=0;c>g;g++){var v=l[g];if(null!=v&&0!=e.isArray(v)){o=v[0],r=v[1],a=v[2];var _={chart:this.chart,series:this,dataItem:l[g],index:g,catIndex:g,x:o,from:r,to:a};i=this.realXAxis.getPosition(o),n=Math.round(this.realYAxis.getPosition(r)),s=Math.round(this.realYAxis.getPosition(a));var y=i-m/2,b=Math.min(n,s),w=Math.abs(n-s),x=new f(y,b,m,w);x.context=_,this._setShapeSettings(x,g),t.push(x)}}},me.prototype._setIsAnimReversed=function(t){var e=t.context,i=this.realYAxis.reversed;t.isAnimReversed=!i&&e.from<e.to||i&&e.from>e.to},me.prototype._setShapeSettings=function(t){te.prototype._setShapeSettings.call(this,t,t.context.catIndex),t.context.from<=t.context.to?(this.priceUpStrokeStyle&&(t.strokeStyle=this.priceUpStrokeStyle),this.priceUpFillStyle&&(t.fillStyle=this.priceUpFillStyle)):(this.priceDownStrokeStyle&&(t.strokeStyle=this.priceDownStrokeStyle),this.priceDownFillStyle&&(t.fillStyle=this.priceDownFillStyle))},me.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},ge.prototype=new se,ge.constructor=ge,ge.prototype._initXYData=function(){this._initXYDataRange(1,3)},ge.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3)},ge.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},ge.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},ge.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},ge.prototype._processData=function(){this._processDataXYZ()},ge.prototype._renderCatData=function(t){for(var i,n,s,o,r,a,l=this.arrData,h=this.chart.gridArea,c=this.categories,u=c.length,d=h.height/this.realXAxis.getZoom(),p=d/u,m=this.pointWidth*p,g=Math.round((p-m)/2),v=0;v<l.length;v++){var _=l[v];if(null!=_){var y=e.inArray(_[0],c);o=y>-1?y:v,r=_[1],a=_[2],s=Math.round(this.realXAxis.getCatPosition(o)-g-m),i=Math.round(this.realYAxis.getPosition(r)),n=Math.round(this.realYAxis.getPosition(a));var b={chart:this.chart,series:this,dataItem:l[v],index:v,catIndex:o,x:this.realXAxis._getValue(o),from:r,to:a},w=Math.min(i,n),x=Math.abs(i-n),S=new f(w,s,x,m);S.context=b,this._setShapeSettings(S,v),t.push(S),this._addAnimation(S,v,u)}}},ge.prototype._renderLinearData=function(t){for(var i,n,s,o,r,a,l=this.arrData,h=this.chart.gridArea,c=l.length,u=h.height/this.realXAxis.getZoom(),d=this._getSeriesFromThisType(),p=this._calcColumnScale(d)*u,m=this.pointWidth*p,g=0;c>g;g++){var v=l[g];if(null!=v&&0!=e.isArray(v)){o=v[0],r=v[1],a=v[2];var _={chart:this.chart,series:this,dataItem:l[g],index:g,catIndex:g,x:o,from:r,to:a};s=this.realXAxis.getPosition(o),i=Math.round(this.realYAxis.getPosition(r)),n=Math.round(this.realYAxis.getPosition(a));var y=s-m/2,b=Math.min(i,n),w=Math.abs(i-n),x=new f(b,y,w,m);x.context=_,this._setShapeSettings(x,g),t.push(x),this._addAnimation(x,g,c)}}},ge.prototype._setIsAnimReversed=function(t){var e=t.context,i=this.realYAxis.reversed;t.isAnimReversed=!i&&e.from>e.to||i&&e.from<e.to},ge.prototype._setShapeSettings=function(t){te.prototype._setShapeSettings.call(this,t,t.context.catIndex),t.context.from<=t.context.to?(this.priceUpStrokeStyle&&(t.strokeStyle=this.priceUpStrokeStyle),this.priceUpFillStyle&&(t.fillStyle=this.priceUpFillStyle)):(this.priceDownStrokeStyle&&(t.strokeStyle=this.priceDownStrokeStyle),this.priceDownFillStyle&&(t.fillStyle=this.priceDownFillStyle))},ge.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},_e.prototype=new te,_e.constructor=_e,_e.prototype._initXYData=function(){this._initXYDataRange(1,3)},_e.prototype._initCatValueData=function(){this._initCatValueDataRange(1,3,!0)},_e.prototype._initDateValueData=function(){this._initDateValueDataRange(1,3)},_e.prototype._initVisibleCatValueData=function(){this._initVisibleCatValueDataRange(1,3)},_e.prototype._initVisibleXYData=function(){this._initVisibleXYDataRange(1,3)},_e.prototype._processData=function(){this._processDataXYZ()},_e.prototype._renderCatData=function(t){for(var i,n,s,o,r,a,l=this.arrData,h=l.length,c=null!=this.markers&&this.markers.isVisible(),u=[],d=[],p=[],f=[],m=[],g=c?this.markers.size/2:0,v=0;h>v;v++){var _=l[v];null!==_?(o=v+.5,r=_[1],a=_[2],i=this.realXAxis.getPosition(o),n=this.realYAxis.getPosition(r),s=this.realYAxis.getPosition(a),u.push(i),u.push(n),d.push(i),d.push(s),c||(p[v]=p[2*h-v-1]={dataItem:_,index:v,x:o,from:r,to:a}),this._addMarkersAndLabels(f,m,i,n,s,v,h,null,r,a,g)):(u.push(null),u.push(null),d.push(null),d.push(null),c||p.push(null))}var y=this._createShape(u,d,t);return!c&&y?y.context={chart:this.chart,series:this,points:p}:e.merge(t,f),m},_e.prototype._renderLinearData=function(t){var i=this.arrData,n=i.length,s=null!=this.markers&&this.markers.isVisible();null!=this.labels&&this.labels.visible!==!1;for(var o,r,a,l,h,c,u=[],d=[],p=[],f=[],m=[],g=s?this.markers.size/2:0,v=0;n>v;v++){var _=i[v];null!==_?(l=_[0],h=_[1],c=_[2],o=this.realXAxis.getPosition(l),r=this.realYAxis.getPosition(h),a=this.realYAxis.getPosition(c),u.push(o),u.push(r),d.push(o),d.push(a),s||(p[v]=p[2*n-v-1]={dataItem:_,index:v,x:l,from:h,to:c}),this._addMarkersAndLabels(f,m,o,r,a,v,n,null,h,c,g)):(pts.push(null),pts.push(null),s||p.push(null))}var y=this._createShape(u,d,t);return!s&&y?y.context={chart:this.chart,series:this,points:p}:e.merge(t,f),m},_e.prototype._createShape=function(t,e,i){var n=new S(t,e);return this._setShapeSettings(n),i.push(n),this._addLengthAnimation(n),n},_e.prototype._addMarkersAndLabels=function(t,e,i,n,s,o,r,a,l,h,c){var u=0,d=a?a:o;if(this.markers&&this.markers.isVisible()){var p={chart:this.chart,series:this,dataItem:data[o],index:o,x:this.realXAxis._getValue(d),from:l,to:h};u=this.markers.offset;var f=p.dataItem[3],m=this._addMarker(i,n,null,l,f);m.marker&&(m.marker.context=p,m.line&&t.push(m.line),t.push(m.marker),this._addShapeAnimation(m.marker,o,r)),m=this._addMarker(i,s,null,h,f),m.marker&&(m.marker.context=p,m.line&&t.push(m.line),t.push(m.marker),this._addShapeAnimation(m.marker,o,r))}if(this.labels&&this.labels.visible!==!1){var g=this._getLabelValue(l,o),v=this._getDataPointLabel(l,i,n,c+u,g,l>h),p={chart:this.chart,series:this,dataItem:data[o],index:o};v.context=p,this.chart.elem.trigger("dataPointLabelCreating",v),e.push(v),this._addShapeAnimation(v,o,r),g=this._getLabelValue(h,o),v=this._getDataPointLabel(h,i,s,c+u,g,h>l),v.context=p,this.chart.elem.trigger("dataPointLabelCreating",v),e.push(v),this._addShapeAnimation(v,o,r)}},_e.prototype._getDataPointLabel=function(t,i,n,s,o,r){var a=this._getLabelText(o),h=new T(a);return l.setShadows(h,this,this.chart),e.extend(h,this.labels),h.measure(this.chart.ctx),h.textAlign="center",h.x=i,r?(h.y=n-s,h.textBaseline="bottom"):(h.y=n+s,h.textBaseline="top"),h},_e.prototype._getTooltip=function(t){var e="From: <b>"+t.from.toString()+"</b><br/>"+"To: <b>"+t.to.toString()+"</b>";if(this.title){var i=d.getColorFromFillStyle(this.fillStyle);e='<div style="color:'+i+'">'+this.title+"</div>"+e}return e},ye.prototype.setOptions=function(t){this.clear(),t=t||{};for(var e=[],i=0;i<t.length;i++){var n=t[i];this._resolveType(n);var s;switch(n.type){case"category":s=new we(n);break;case"dateTime":s=new Se(n);break;case"linear":default:s=new xe(n)}s._setChart(this.chart),e.push(s)}this.userAxes=e},ye.prototype._resolveType=function(t){if(!t.type){var e=this.chart.series.items;e.length<1||e[0]._resolveAxisType(t)}},ye.prototype._initSeriesAxes=function(){var t=[];e.merge(t,this.userAxes);for(var i=this.chart.series.items,n=0;n<i.length;n++){var s=i[n];s.visible&&(s._initXAxis(t),s._initYAxis(t),s._initSharedAxes())}this.items=t},ye.prototype._initSeries=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._initSeries()}},ye.prototype._initRanges=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._initRange()}},ye.prototype._resetWH=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i.isCustomWidth||(i.width=0,i.height=0)}},ye.prototype._measure=function(){for(var t=this.items,e=!1,i=0;i<t.length;i++){var n=t[i],s=n._measure();e=e||s}return e},ye.prototype._arrange=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._arrange()}},ye.prototype._getAxesInLoc=function(t){for(var e=[],i=this.items,n=0;n<i.length;n++){var s=i[n];s.location==t&&e.push(s)}return e},ye.prototype._getVAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];n.isVertical()&&t.push(n)}return t},ye.prototype._getHAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];0==n.isVertical()&&t.push(n)}return t},ye.prototype._getTotalWidth=function(){if(this.horCrossingAxis)return 0;for(var t=0,e=this.items,i=0;i<e.length;i++){var n=e[i];n.isVertical()&&(t+=n.width)}return t},ye.prototype._getTotalHeight=function(){if(this.verCrossingAxis)return 0;for(var t=0,e=this.items,i=0;i<e.length;i++){var n=e[i];0==n.isVertical()&&(t+=n.height)}return t},ye.prototype._render=function(t){for(var i=this.items,n=[],s=[],o=0;o<i.length;o++){var r=i[o],a=r._render(t);a.postShapes&&e.merge(n,a.postShapes),a.contextShapes&&e.merge(s,a.contextShapes)}return{postShapes:n,contextShapes:s}},ye.prototype._updateOrigins=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._updateOrigin()}},ye.prototype._correctOrigins=function(){for(var t=this.items,e=0;e<t.length;e++){var i=t[e];i._correctOrigin&&i._correctOrigin()}},ye.prototype._updateCrossings=function(){var t=this.verCrossingAxis,e=this.horCrossingAxis;if(t)for(var i=t.getPosition(t.crossing),n=this._getHAxes(),s=0;s<n.length;s++){var o=n[s];o.crossOffsetY=i-o.y,"top"==o.location&&(o.crossOffsetY-=o.height)}if(e)for(var i=e.getPosition(e.crossing),r=this._getVAxes(),s=0;s<r.length;s++){var o=r[s];o.crossOffsetX=i-o.x,"left"==o.location&&(o.crossOffsetX-=o.width)}},ye.prototype._initCrossingAxes=function(){for(var t=this._getVAxes(),e=this._getHAxes(),i=null,n=null,s=0;s<t.length;s++){var o=t[s];if(!c.isNull(o.crossing)){n=o;break}}for(var s=0;s<e.length;s++){var o=e[s];if(!c.isNull(o.crossing)){i=o;break}}this.horCrossingAxis=i,this.verCrossingAxis=n},ye.prototype.getZoomableAxes=function(){for(var t=[],e=this.items,i=0;i<e.length;i++){var n=e[i];n.zoomEnabled&&t.push(n)}return t},ye.prototype.find=function(t){var e=this.items;if(null!=t)for(var i=0;i<e.length;i++){var n=e[i];if(n.name==t)return n}return null},ye.prototype.clear=function(){this.items&&e.each(this.items,function(){this.clear()})},Ce(be,h),be.prototype._initDefs=function(){h.prototype._initDefs.call(this);var t=e.extend(!0,{},this.defaults,{rangeSlider:{visible:!0,breadth:20},margin:5,strokeStyle:"black",lineWidth:1,zoomEnabled:!1,visible:!0});this.defaults=t},be.prototype._initSeries=function(){for(var t=new Q(null,this.chart),e=this.chart.series.items,i=0;i<e.length;i++){var n=e[i];(n.realXAxis==this||n.realYAxis==this)&&t.items.push(n)}this.series=t},be.prototype._setVisibleRanges=function(){if(h.prototype._setVisibleRanges.call(this),this.jqRangeSlider){var t=(this.actualMaximum-this.actualMinimum)/10;this.jqRangeSlider.jqRangeSlider("update",{minimum:this.actualMinimum,maximum:this.actualMaximum,smallChange:t,largeChange:2*t,minRange:t/100,range:{minimum:this.actualVisibleMinimum,maximum:this.actualVisibleMaximum}})}},be.prototype._arrange=function(){if(h.prototype._arrange.call(this),!this.zoomEnabled)return this.clear(),void 0;var t=this.rangeSlider.breadth;if(this.rangeSlider.visible!==!1){this.offset+=t;var i=this.offset;if(!this.jqRangeSlider){var n=e('<div style="position:absolute"></div>').jqRangeSlider({}),s=this;n.bind("rangeChanging",function(t,e){s._sliderZoom(e)}),n.bind("rangeChanged",function(t,e){s._sliderZoom(e)}),this.chart.elem.append(n),this.jqRangeSlider=n}var o;switch(this.location){case"left":o={left:this.x+this.width-i,top:this.y,width:t,height:this.height};break;case"right":o={left:this.x+this.lineWidth/2,top:this.y,width:t,height:this.height};break;case"top":o={left:this.x,top:this.y+this.height-i,width:this.width,height:t};break;case"bottom":o={left:this.x,top:this.y+this.lineWidth/2,width:this.width,height:t}}if(o){var r=this.isAxisVertical?"vertical":"horizontal";this.jqRangeSlider.css(o).jqRangeSlider("update",{orientation:r,reversed:this.reversed})}}},be.prototype._moveVisibleRange=function(t,e){var i=this.isAxisVertical,n=this.actualVisibleMinimum,s=this.actualVisibleMaximum,o=s-n,r=0;r=i?-o*e/this.length:o*t/this.length,this.reversed&&(r=-r),r=Math.max(r,this.actualMinimum-n),r=Math.min(r,this.actualMaximum-s),this.visibleMinimum=n+r,this.visibleMaximum=s+r,this._setVisibleRanges(),this._zoom()},be.prototype._mouseWheelZoom=function(t){var e=this.actualVisibleMinimum,i=this.actualVisibleMaximum,n=(this.actualMaximum-this.actualMinimum)/1e3,s=50*t*n;if(e=Math.max(this.actualMinimum,e+s),i=Math.min(this.actualMaximum,i-s),e>i-n){n/=2;var o=(e+i)/2;e=o-n,i=o+n}this.visibleMinimum=e,this.visibleMaximum=i,this._setVisibleRanges(),this._zoom()},be.prototype._scaleVisibleRange=function(t,e){var i,n,s,o=this.actualVisibleMinimum,r=this.actualVisibleMaximum,a=r-o,l=this.getZoom(),h=this.isAxisVertical;if(h){i=t.dy/e.dy;var c=e.y1-t.y1,u=e.y2-t.y2;if(n=-a*u/this.length/l,s=-a*c/this.length/l,t.y1>t.y2){var d=n;n=s,s=d}}else{i=t.dx/e.dx;var p=e.x1-t.x1,f=e.x2-t.x2;if(n=a*p/this.length/l,s=a*f/this.length/l,t.x1>t.x2){var d=n;n=s,s=d}}if(this.reversed){var d=n;n=-s,s=-d}var m=(o+r)/2,g=(this.actualMaximum-this.actualMinimum)/1e3;o=Math.max(this.actualMinimum,o-n),r=Math.min(this.actualMaximum,r-s),o>r-g&&(g/=2,o=m-g,r=m+g),this.visibleMinimum=o,this.visibleMaximum=r,this._setVisibleRanges(),this._zoom()},be.prototype._scaleToRegion=function(t,e){var i,n,s=this.chart.gridArea,o=s.fitHor(t.locX),r=s.fitVer(t.locY),a=s.fitHor(e.locX),l=s.fitVer(e.locY),h=this.reversed;this.isAxisVertical?h?(i=Math.min(r,l),n=Math.max(r,l)):(i=Math.max(r,l),n=Math.min(r,l)):h?(i=Math.max(o,a),n=Math.min(o,a)):(i=Math.min(o,a),n=Math.max(o,a)),i=this.getValue(i),n=this.getValue(n);var c=(this.actualMaximum-this.actualMinimum)/1e3;if(c>n-i){var u=(c-(n-i))/2;i-=u,n+=u}this.visibleMinimum=i,this.visibleMaximum=n,this._setVisibleRanges(),this._zoom()},be.prototype._sliderZoom=function(t){this.visibleMinimum=this.options.visibleMinimum=t.minimum,this.visibleMaximum=this.options.visibleMaximum=t.maximum,this.chart.partialDelayedUpdate(),this._zoom()},be.prototype._zoom=function(){this.chart.elem.trigger("axisZoom",{chart:this.chart,axis:this})},be.prototype._getTooltip=function(t){return"<b>"+t+"</b><br/>"},be.prototype.getCatPosition=function(t){return h.prototype.getPosition.call(this,t)},be.prototype.resetZoom=function(){this.zoomEnabled&&(this.visibleMinimum=this.actualMinimum,this.visibleMaximum=this.actualMaximum,this._setVisibleRanges(),this._zoom())},be.prototype.clear=function(){this.jqRangeSlider&&(this.jqRangeSlider.jqRangeSlider("destroy"),this.jqRangeSlider.remove(),this.jqRangeSlider=null)},Ce(we,be),we.prototype.getCategories=function(){if(this.categories)return this.categories;var t=this.chart.arrDataSource;if(!t)return null;var e=this.categoriesField,i=c.processDataField(t,e);return i},we.prototype._initRange=function(){var t=this.series;t._initCategories();var e=t.categories;this.arrCats=this.getCategories();var i=e.length;this.arrCats&&(i=Math.max(i,this.arrCats.length));var n=0,s=i;c.isNull(this.minimum)||(n=this.minimum),c.isNull(this.maximum)||(s=this.maximum),this.actualMinimum=n,this.actualMaximum=s,this._setVisibleRanges(),this.actualInterval=this.interval||1,this.seriesCategories=e},we.prototype._getLabelIntervals=function(t,e){var i=0;e&&e.intervalOffset&&(i=e.intervalOffset);for(var n=[],s=Math.round(this.actualVisibleMinimum),o=this._getIntervalStart(s,t)+.5,r=o+i;r<=this.actualVisibleMaximum;r=c.round(r+t))n.push(r);return n},we.prototype._getIntervalCount=function(){return this.arrCats.length},we.prototype._getValue=function(t){var e,i=Math.round(t);return e=this.arrCats&&i<this.arrCats.length?this.arrCats[i]:this.seriesCategories[i]},we.prototype.getLabel=function(t){var i;if("string"==e.type(t))i=t;else{var n=Math.round(t-.5);i=this.arrCats&&n<this.arrCats.length?this.arrCats[n]:this.seriesCategories[n]}return i=i||"",be.prototype.getLabel.call(this,i)},we.prototype.getCatPosition=function(t){return this.reversed&&t++,h.prototype.getPosition.call(this,t)},we.prototype.getOrientation=function(){return"x"},Ce(xe,be),xe.prototype._initDefs=function(){be.prototype._initDefs.call(this);var t=e.extend(!0,{},this.defaults,{extendRangeToOrigin:!1,logarithmic:!1,logBase:10,labels:{resolveOverlappingMode:"hide"}});this.defaults=t},xe.prototype._initRange=function(){var t=this.series;t._initRanges();var e,i;"x"==this.getOrientation()?(e=t.minX,i=t.maxX):(e=t.min,i=t.max),e==Ae&&i==Me&&(e=0,i=10);var n=this._addPlotsInRange(e,i);e=n.min,i=n.max,c.isNull(this.minimum)||(e=this.minimum),c.isNull(this.maximum)||(i=this.maximum),this.skipEmptyDays&&(i-=this.totalEmptyDaysTicks);var s=Math.abs(i-e);0==s&&(s=1);var o=0,r=0,a=t._getPixelMargins(this);this.isAxisVertical?(a.left=c.isNull(this.bottomMargin)?a.left+.5:this.bottomMargin,a.right=c.isNull(this.topMargin)?a.right+.5:this.topMargin):(a.left=c.isNull(this.leftMargin)?a.left+.5:this.leftMargin,a.right=c.isNull(this.rightMargin)?a.right+.5:this.rightMargin);var l=s/this.length;o=l*a.left,r=l*a.right,this.logarithmic===!0&&(o=Math.max(0,c.log(o,this.logBase)),r=Math.max(0,c.log(r,this.logBase)));var h=e-o,u=i+r,d=this.series._isAnchoredToOrigin(),p=this.getCrossing();if(d&&"y"==this.getOrientation()&&(e>=p&&p>h?h=p:p>=i&&u>p&&(u=p)),this.extendRangeToOrigin&&(h>p?h=p:p>u&&(u=p)),this.logarithmic===!0){var f=1;f>h&&(h=f),h=c.log(h,this.logBase),u=c.log(u,this.logBase);var m=this._calculateActualIntervalLogarithmic(h,u);h=c.round(Math.floor(h/m)*m),u=c.round(Math.ceil(u/m)*m)}this._setMinMax(h,u),this._setVisibleRanges(),this.actualInterval=this.logarithmic===!0?this._calculateActualIntervalLogarithmic(this.actualVisibleMinimum,this.actualVisibleMaximum):this._calculateActualInterval(this.actualVisibleMinimum,this.actualVisibleMaximum)},xe.prototype._addPlotsInRange=function(t,e){var i=this.plotLines;if(i)for(var n=0;n<i.length;n++){var s=i[n].value;t=Math.min(t,s),e=Math.max(e,s)}var o=this.plotBands;if(o)for(var n=0;n<o.length;n++){var r=o[n].from,a=o[n].to;t=Math.min(t,r),e=Math.max(e,r),t=Math.min(t,a),e=Math.max(e,a)}return{min:t,max:e}},xe.prototype._calculateActualIntervalLogarithmic=function(t,e){if(this.interval)return this.interval;var i=(e-t)/3,n=Math.floor(c.log10(Math.abs(i)));return 0==n&&(n=1),c.round(Math.floor(i/n)*n)},xe.prototype._getIntervals=function(t,e,i){if(this.customTickMarks)return this.customTickMarks;if(this.logarithmic===!1)return be.prototype._getIntervals.call(this,t,e);if(i===!1)return this._getLogarithmicMinorIntervals(t,e);var n=0;e&&e.intervalOffset&&(n=e.intervalOffset);for(var s=[],o=this._getIntervalStart(this.actualVisibleMinimum,t),r=o+n;r<=this.actualVisibleMaximum;r=c.round(r+t))s.push(Math.pow(this.logBase,r));return s},xe.prototype._getLogarithmicMinorIntervals=function(t,e){for(var i=this._getMarkInterval(e.major,!0),n=this._getIntervals(i,e.major,!0),s=[],o=null,r=0;r<n.length;r++){var a=n[r];if(null!=o){var l=o,h=a;if(h>l){var u=l;l=h,h=u}for(var d=(l-h)*t/10,p=h+d;l>p;)s.push(c.round(p)),p+=d;o=a}else o=a}return s},xe.prototype._getIntervalCount=function(){return Math.ceil(this.actualMaximum-this.actualMinimum)},xe.prototype.getCrossingPosition=function(){return this.getPosition(this.getCrossing())},xe.prototype.getOrientation=function(t){var e=this.isVertical();if(this.series)for(var i=0;i<this.series.items.length;i++)t=this.series.items[i];return t&&t.isVertical&&(e=!e),e?"y":"x"},xe.prototype.getPosition=function(t){1==this.logarithmic&&(t=c.log(t,this.logBase));var e=be.prototype.getPosition.call(this,t);return e},Se.prototype=new xe,Se.constructor=Se,Se.prototype._initDefs=function(){xe.prototype._initDefs.call(this);var t=e.jqChartDateFormat.masks,i=e.extend(!0,{},this.defaults,{labels:{yearsIntervalStringFormat:"yyyy",monthsIntervalStringFormat:t.shortDate,weeksIntervalStringFormat:t.shortDate,daysIntervalStringFormat:t.shortDate,hoursIntervalStringFormat:t.shortDate+" "+t.shortTime,minutesIntervalStringFormat:t.shortTime,secondsIntervalStringFormat:t.longTime,millisecondsIntervalStringFormat:t.longTime},skipEmptyDays:!1});this.defaults=i},Se.prototype._initRange=function(){this.skipEmptyDays?(this.emptyDays=this._getEmptyDays(),this.totalEmptyDaysTicks=this.emptyDays.length*u.ticksInDay):this.totalEmptyDaysTicks=0,xe.prototype._initRange.call(this),this._initActualStringFormat()},Se.prototype._setMinMax=function(t,i){this.actualMinimum=null!=this.minimum?"date"==e.type(this.minimum)?this.minimum.getTime():this.minimum:t,this.actualMaximum=null!=this.maximum?"date"==e.type(this.minimum)?this.maximum.getTime():this.maximum:i},Se.prototype._calculateActualInterval=function(t,e){this.skipEmptyDays&&(e+=this.totalEmptyDaysTicks);var i=this._calculateDateTimeInterval(t,e);return this.actualIntervalType=null!=this.intervalType?this.intervalType:this.type,null!=this.interval&&(i=this.interval),i},Se.prototype._calculateDateTimeInterval=function(t,e){var i=e-t,n=.8*this.maxInter200Px,s=Math.max(1,this.length),o=s/(2e3/n),r=i/o;this.type="year";var a=r/6e4;if(1>=a){if(10>=r)return this.type="milliseconds",1;if(50>=r)return this.type="milliseconds",4;if(200>=r)return this.type="milliseconds",20;if(500>=r)return this.type="milliseconds",50;var l=r/1e3;if(7>=l)return this.type="seconds",1;if(15>=l)return this.type="seconds",2;if(30>=l)return this.type="seconds",5;if(60>=l)return this.type="seconds",10}else if(2>=a)return this.type="seconds",20;if(3>=a)return this.type="seconds",30;if(10>=a)return this.type="minutes",1;if(20>=a)return this.type="minutes",2;if(60>=a)return this.type="minutes",5;if(120>=a)return this.type="minutes",10;if(180>=a)return this.type="minutes",30;if(720>=a)return this.type="hours",1;if(1440>=a)return this.type="hours",4;if(2880>=a)return this.type="hours",6;if(4320>=a)return this.type="hours",12;if(14400>=a)return this.type="days",1;if(28800>=a)return this.type="days",2;if(43200>=a)return this.type="days",3;if(87840>=a)return this.type="weeks",1;if(219600>=a)return this.type="weeks",2;if(527040>=a)return this.type="months",1;if(1054080>=a)return this.type="months",3;if(2108160>=a)return this.type="months",6;this.type="years";var h=a/60/24/365;return 5>h?1:10>h?2:Math.floor(h/5)},Se.prototype._getNextPosition=function(t,e){return this._incrementDateTime(t,e,this.actualIntervalType)},Se.prototype._incrementDateTime=function(t,e,i){var n=new Date(t),s=0;if("days"==i)n=u.addDays(n,e);else if("hours"==i)s=u.fromHours(e);else if("milliseconds"==i)s=e;else if("seconds"==i)s=u.fromSeconds(e);else if("minutes"==i)s=u.fromMinutes(e);else if("weeks"==i)n=u.addDays(n,7*e);else if("months"==i){var o=!1;if(n.getDate()==u.getDaysInMonth(n.getFullYear(),n.getMonth())&&(o=!0),n=u.addMonths(n,Math.floor(e)),s=u.fromDays(30*(e-Math.floor(e))),o&&0==s){var r=u.getDaysInMonth(n.getFullYear(),n.getMonth());n=u.addDays(n,r-n.getDate())}}else"years"==i&&(n=u.addYears(n,Math.floor(e)),s=u.fromDays(365*(e-Math.floor(e))));return n.getTime()+s},Se.prototype._getIntervalStart=function(t,e,i){if(null==i)return t;var n=new Date(t);if(e>0&&1!=e&&"months"==i&&12>=e&&e>1){for(var s=n,o=new Date(n.getFullYear(),0,1,0,0,0);n>o;)s=o,o=u.addMonths(o,e);return n=s,n.getTime()}switch(i){case"years":var r=n.getFullYear()/e*e;0>=r&&(r=1),n=new Date(r,0,1,0,0,0);break;case"months":var a=n.getMonth()/e*e;0>a&&(a=0),n=new Date(n.getFullYear(),a,1,0,0,0);break;case"days":var l=n.getDate()/e*e;0>=l&&(l=1),n=new Date(n.getFullYear(),n.getMonth(),l,0,0,0);break;case"hours":var h=n.getHours()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),h,0,0);break;case"minutes":var c=n.getMinutes()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),c,0);break;case"seconds":var d=n.getSeconds()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),d,0);break;case"milliseconds":var p=n.getMilliseconds()/e*e;n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),p);break;case"weeks":n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0),n=u.addDays(n,-u.getDayOfWeek(n))}return n.getTime()},Se.prototype._initActualStringFormat=function(){if(this.labels&&this.labels.visible!==!1){if(this.labels.stringFormat)return this.actualStringFormat=this.labels.stringFormat,void 0;switch(this.actualIntervalType){case"years":this.actualStringFormat=this.labels.yearsIntervalStringFormat;break;case"months":this.actualStringFormat=this.labels.monthsIntervalStringFormat;break;case"weeks":this.actualStringFormat=this.labels.weeksIntervalStringFormat;break;case"days":this.actualStringFormat=this.labels.daysIntervalStringFormat;break;case"hours":this.actualStringFormat=this.labels.hoursIntervalStringFormat;break;case"minutes":this.actualStringFormat=this.labels.minutesIntervalStringFormat;break;case"seconds":this.actualStringFormat=this.labels.secondsIntervalStringFormat;break;case"milliseconds":this.actualStringFormat=this.labels.millisecondsIntervalStringFormat;break;default:this.actualStringFormat="default"}}},Se.prototype._getIntervals=function(t,e){if(this.customTickMarks)return this.customTickMarks;var i=[],n=this.actualVisibleMinimum,s=this.actualVisibleMaximum;this.skipEmptyDays&&(n=this._addEmptyDaysOffset(n),s=this._addEmptyDaysOffset(s));for(var o=this._getIntervalStart(n,t,this.actualIntervalType);n>o;)o=this._incrementDateTime(o,t,this.actualIntervalType);if(e&&e.intervalOffset){var r=this.actualIntervalType,a=e.intervalOffset;e.intervalOffsetType&&(r=e.intervalOffsetType),o=this._incrementDateTime(o,a,r)}for(var l=o;s>=l;l=this._incrementDateTime(l,t,this.actualIntervalType)){var h=this._getNextNonEmptyDay(l);h&&(this.skipEmptyDays&&h>l&&(l=h),i.push(h))}return i},Se.prototype._getIntervalCount=function(){var t=this.actualMaximum-this.actualMinimum;return t=Math.ceil(t/u.ticksInDay)},Se.prototype._getNextNonEmptyDay=function(t){if(!this.emptyDays)return t;var i=e.inArray(t,this.emptyDays);if(-1==i)return t;var n=u.addDays(new Date(t),1),s=this.actualMaximum;this.skipEmptyDays&&(s+=this.totalEmptyDaysTicks);for(var o=n;s>=o;o=u.addDays(o,1)){var r=o.getTime();if(i=e.inArray(r,this.emptyDays),-1==i)return r}return null},Se.prototype._getEmptyDaysOffset=function(t){if(!this.emptyDays)return 0;for(var e=0,i=0;i<this.emptyDays.length;i++){var n=this.emptyDays[i];if(!(t>n))break;e++}return e*u.ticksInDay},Se.prototype._addEmptyDaysOffset=function(t){if(c.isNull(t))return null;var e=t+this._getEmptyDaysOffset(t),i=this._getEmptyDaysOffset(e)-this._getEmptyDaysOffset(t);for(t=e,e+=i;i;)i=this._getEmptyDaysOffset(e)-this._getEmptyDaysOffset(t),t=e,e+=i;return e},Se.prototype._getEmptyDays=function(){for(var t=[],e=0;e<this.series.items.length;e++){var i=this.series.items[e];0==e?t=this._getEmptyDaysFromSeries(i):this._excludeDaysFromSeries(i,t)}return t},Se.prototype._getEmptyDaysFromSeries=function(t){var i=[],n=[];e.merge(n,t.arrData),n.sort(function(t,e){return t[0]-e[0]});for(var s=u.roundToDay(n[0][0]),o=1;o<n.length;o++){for(var r=u.roundToDay(n[o][0]),a=(r-s)/u.ticksInDay,l=1;a>l;l++)i.push(u.addDays(s,l).getTime());s=r}return i},Se.prototype._excludeDaysFromSeries=function(t,i){e.each(t.arrData,function(t,n){var s=u.roundToDay(n[0]).getTime(),o=e.inArray(s,i);-1!=o&&i.splice(o,1)})},Se.prototype._getTooltip=function(t){var i=e.jqChartDateFormat.masks,n="";return 0!=t.getSeconds()?n+=i.shortDate+" "+i.longTime:0!=t.getHours()||0!=t.getMinutes()?n+=i.shortDate+" "+i.shortTime:n=i.shortDate,t=this.chart.stringFormat(t,n),"<b>"+t+"</b><br/>"},Se.prototype.getPosition=function(t){"date"==e.type(t)&&(t=t.getTime());var i=0;this.skipEmptyDays&&(i=this._getEmptyDaysOffset(t));var n=xe.prototype.getPosition.call(this,t-i);return n},Se.prototype.getLabel=function(t){if(this.labels&&this.labels.visible!==!1&&this.actualStringFormat){var i=new Date(t);return e.jqChartDateFormatter(i,this.actualStringFormat)}}}(t)}),define("_libs/charts/jqChart/src/js/jquery.jqRangeSlider.js",["jquery"],function(t){!function(t){function e(t){function e(){s?(i(),n(e),o=!0,s=!1):o=!1}var i=t,s=!1,o=!1;this.kick=function(){s=!0,!o&&e()},this.end=function(t){var e=i;
	t&&(o?(i=s?function(){e(),t()}:t,s=!0):t())}}function i(i){this._init(i),this.isTouchDevice=!!("ontouchstart"in window),this.timer=new e(t.proxy(this._arrangeElements,this))}t.fn.jqRangeSlider=function(e,n,s){if("object"==typeof e)n=e;else if("string"==typeof e){if(e=e.toLowerCase(),t.fn.jqRangeSlider.methods[e])return t.fn.jqRangeSlider.methods[e].call(this,n,s);t.error("Method "+method+" does not exist on jQuery.jqRangeSlider")}var o=this.data("data");return o||(o=new i(this),this.data("data",o)),o._setOptions(n),this},t.fn.jqRangeSlider.methods={rangeslider:function(){return this.data("data")},destroy:function(){var t=this.data("data");t&&(t.destroy(),this.removeData("data"))},options:function(){var t=this.data("data");return t?t.options:void 0},option:function(t,e){var i=this.data("data");if(i){if(!e)return i.options[t];i.options[t]=e,i._setOptions(i.options)}},update:function(e){var i=this.data("data");if(!i)return this;var n=t.extend(!1,{},i.options,e||{});return i._setOptions(n),this},preview:function(){var t=this.data("data");return t?"horizontal"==t.orientation?t.bgHor:t.bgVer:null}},t.fn.jqRangeSlider.defaults={orientation:"horizontal",mode:"normal",minimum:0,maximum:100,minRange:0,range:{minimum:null,maximum:null},smallChange:10,largeChange:20,reversed:!1},t.fn.jqMouseCapture=function(e){var i=t(document);return this.each(function(){var n=t(this),s={};n.mousedown(function(t){var o;e.move&&(o=function(t){e.move.call(n,t,s)},i.mousemove(o));var r,a=function(){e.move&&i.unbind("mousemove",o),i.unbind("mouseup",r)};return r=e.up?function(t){return a(),e.up.call(n,t,s)}:a,i.mouseup(r),t.preventDefault(),e.down.call(n,t,s)})}),this};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(function(){t()},25)}}();i.prototype={_init:function(t){this.elem=t,t.addClass("ui-jqrangeslider ui-widget"),"static"==t.css("position")&&t.css("position","relative")},_createElements:function(){var t=this.elem;t.children().remove(),"horizontal"==this.orientation?this._createHorElements(t):this._createVerElements(t)},_createHorElements:function(e){var i=this;this.bgHor=t("<div class='ui-jqrangeslider-background-horizontal'></div>").css("top",0).css("left",0),e.append(this.bgHor),this.bgHorLeft=t("<div class='ui-jqrangeslider-background-horizontal-left'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgHorLeft),this.bgHorRight=t("<div class='ui-jqrangeslider-background-horizontal-right'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgHorRight),this.arrowLeft=t("<div class='ui-jqrangeslider-arrow-left ui-corner-left ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowLeft),this._addHover(this.arrowLeft),this.arrowIconLeft=t("<span class='ui-jqrangeslider-arrow-icon-left ui-icon ui-icon-circle-triangle-w'></span>"),this.arrowLeft.append(this.arrowIconLeft),this.arrowRight=t("<div class='ui-jqrangeslider-arrow-right ui-corner-right ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowRight),this._addHover(this.arrowRight),this.arrowIconRight=t("<span class='ui-jqrangeslider-arrow-icon-right ui-icon ui-icon-circle-triangle-e'></span>"),this.arrowRight.append(this.arrowIconRight),this.sliderHor=t("<div class='ui-jqrangeslider-slider-horizontal'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startDragHor,this),move:t.proxy(i._draggingHor,this),up:t.proxy(i._stopDragHor,this)}),e.append(this.sliderHor),this.handleLeft=t("<div class='ui-jqrangeslider-handle-left ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeLeft,this),move:t.proxy(i._resizeLeft,this),up:t.proxy(i._stopResizeLeft,this)}),e.append(this.handleLeft),this._addHover(this.handleLeft),this.handleIconLeft=t("<span class='ui-jqrangeslider-handle-icon-left ui-icon ui-icon-grip-solid-vertical'></span>"),this.handleLeft.append(this.handleIconLeft),this.handleRight=t("<div class='ui-jqrangeslider-handle-right ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeRight,this),move:t.proxy(i._resizeRight,this),up:t.proxy(i._stopResizeRight,this)}),e.append(this.handleRight),this._addHover(this.handleRight),this.handleIconRight=t("<span class='ui-jqrangeslider-handle-icon-right ui-icon ui-icon-grip-solid-vertical'></span>"),this.handleRight.append(this.handleIconRight),"preview"!=this.mode&&(this.bgHorLeft.addClass("ui-widget-content"),this.bgHorRight.addClass("ui-widget-content"),this.sliderHor.addClass("ui-widget-header")),this.isTouchDevice&&(this.bgHorLeft.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.bgHorRight.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.arrowLeft.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.arrowRight.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.sliderHor.bind("touchstart",function(t){i._startDragHor(t,!0)}).bind("touchmove",function(t){i._draggingHor(t,!0)}).bind("touchend",function(t){i._stopDragHor(t)}),this.handleLeft.bind("touchstart",function(t){i._startResizeLeft(t,!0)}).bind("touchmove",function(t){i._resizeLeft(t,!0)}).bind("touchend",function(t){i._stopResizeLeft(t)}),this.handleRight.bind("touchstart",function(t){i._startResizeRight(t,!0)}).bind("touchmove",function(t){i._resizeRight(t,!0)}).bind("touchend",function(t){i._stopResizeRight(t)}))},_createVerElements:function(e){var i=this;this.bgVer=t("<div class='ui-jqrangeslider-background-vertical'></div>").css("top",0).css("left",0),e.append(this.bgVer),this.bgVerBottom=t("<div class='ui-jqrangeslider-background-vertical-bottom'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgVerBottom),this.bgVerTop=t("<div class='ui-jqrangeslider-background-vertical-top'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(t){i._largeScrollStart(t),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.bgVerTop),this.arrowBottom=t("<div class='ui-jqrangeslider-arrow-bottom ui-corner-bottom ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowBottom),this._addHover(this.arrowBottom),this.arrowIconBottom=t("<span class='ui-jqrangeslider-arrow-icon-bottom ui-icon ui-icon-circle-triangle-s'></span>"),this.arrowBottom.append(this.arrowIconBottom),this.arrowTop=t("<div class='ui-jqrangeslider-arrow-top ui-corner-top ui-widget-header'></div>").css("top",0).css("left",0).jqMouseCapture({down:function(){i.scrolling=!0,i.scrollingCount=0,i._scrollRight()},up:t.proxy(i._stopScroll,this)}),e.append(this.arrowTop),this._addHover(this.arrowTop),this.arrowIconTop=t("<span class='ui-jqrangeslider-arrow-icon-top ui-icon ui-icon-circle-triangle-n'></span>"),this.arrowTop.append(this.arrowIconTop),this.sliderVer=t("<div class='ui-jqrangeslider-slider-vertical'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startDragVer,this),move:t.proxy(i._draggingVer,this),up:t.proxy(i._stopDragVer,this)}),e.append(this.sliderVer),this.handleBottom=t("<div class='ui-jqrangeslider-handle-bottom ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeBottom,this),move:t.proxy(i._resizeBottom,this),up:t.proxy(i._stopResizeBottom,this)}),e.append(this.handleBottom),this._addHover(this.handleBottom),this.handleIconBottom=t("<span class='ui-jqrangeslider-handle-icon-bottom ui-icon ui-icon-grip-solid-horizontal'></span>"),this.handleBottom.append(this.handleIconBottom),this.handleTop=t("<div class='ui-jqrangeslider-handle-top ui-state-default'></div>").css("top",0).css("left",0).jqMouseCapture({down:t.proxy(i._startResizeTop,this),move:t.proxy(i._resizeTop,this),up:t.proxy(i._stopResizeTop,this)}),e.append(this.handleTop),this._addHover(this.handleTop),this.handleIconTop=t("<span class='ui-jqrangeslider-handle-icon-top ui-icon ui-icon-grip-solid-horizontal'></span>"),this.handleTop.append(this.handleIconTop),"preview"!=this.mode&&(this.bgVerBottom.addClass("ui-widget-content"),this.bgVerTop.addClass("ui-widget-content"),this.sliderVer.addClass("ui-widget-header")),this.isTouchDevice&&(this.bgVerBottom.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.bgVerTop.bind("touchstart",function(t){t.preventDefault(),i._largeScrollStart(t,!0),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.arrowBottom.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollLeft()}).bind("touchend",function(){i._stopScroll()}),this.arrowTop.bind("touchstart",function(t){t.preventDefault(),i.scrolling=!0,i.scrollingCount=0,i._scrollRight()}).bind("touchend",function(){i._stopScroll()}),this.sliderVer.bind("touchstart",function(t){i._startDragVer(t,!0)}).bind("touchmove",function(t){i._draggingVer(t,!0)}).bind("touchend",function(t){i._stopDragVer(t)}),this.handleBottom.bind("touchstart",function(t){i._startResizeBottom(t,!0)}).bind("touchmove",function(t){i._resizeBottom(t,!0)}).bind("touchend",function(t){i._stopResizeBottom(t)}),this.handleTop.bind("touchstart",function(t){i._startResizeTop(t,!0)}).bind("touchmove",function(t){i._resizeTop(t,!0)}).bind("touchend",function(t){i._stopResizeTop(t)}))},_setOptions:function(e){var i=t.extend(!0,{},t.fn.jqRangeSlider.defaults,e||{});this.options=i,i.range||(i.range={}),(this.orientation!=i.orientation||this.mode!=i.mode)&&(this.orientation=i.orientation,this.mode=i.mode,this._createElements());var n=i.range;n.minimum=null===n.minimum||void 0===n.minimum?i.minimum:n.minimum,n.maximum=null===n.maximum||void 0===n.maximum?i.maximum:n.maximum,this.lastChange=t.extend({},n),this._arrange()},_arrange:function(){this.timer.kick()},_arrangeElements:function(){"horizontal"==this.orientation?this._arrangeHor():this._arrangeVer()},_arrangeHor:function(){var t=this.options,e=t.range,i=this.elem,n=i.width(),s=i.height(),o=this.arrowLeft.outerWidth(),r=this.arrowRight.outerWidth(),a=this.handleLeft.outerWidth(),l=this.handleRight.outerWidth();this._outerH(this.arrowLeft,s),this._outerH(this.arrowRight,s).css("left",n-r),this.arrowIconLeft.css({top:(this.arrowLeft.height()-this.arrowIconLeft.height())/2,left:(this.arrowLeft.width()-this.arrowIconLeft.width())/2}),this.arrowIconRight.css({top:(this.arrowRight.height()-this.arrowIconRight.height())/2,left:(this.arrowRight.width()-this.arrowIconRight.width())/2});var h=o,c=n-h-r-a-l;this.innerW=c,this._outerH(this.bgHor,s).css("left",h+a),this._outerW(this.bgHor,c);var u=Math.round(this._map(e.minimum,c)),d=Math.round(c-this._map(e.maximum,c));if(t.reversed){var p=u;u=d,d=p}h+=u,c-=u+d,this._outerH(this.handleLeft,s).css("left",h),this._outerH(this.handleRight,s).css("left",h+c+a),this.handleIconLeft.css({top:(this.handleLeft.height()-this.handleIconLeft.height())/2,left:(this.handleLeft.width()-this.handleIconLeft.width())/2}),this.handleIconRight.css({top:(this.handleRight.height()-this.handleIconRight.height())/2,left:(this.handleRight.width()-this.handleIconRight.width())/2}),this._outerH(this.sliderHor,s).css("left",h+a),this._outerW(this.sliderHor,c),this._outerH(this.bgHorLeft,s).css("left",o),this._outerW(this.bgHorLeft,h-o),h+=c+a+l,this._outerH(this.bgHorRight,s).css("left",h),this._outerW(this.bgHorRight,n-h-r)},_arrangeVer:function(){var t=this.options,e=t.range,i=this.elem,n=i.width(),s=i.height(),o=this.arrowBottom.outerHeight(),r=this.arrowTop.outerHeight(),a=this.handleBottom.outerHeight(),l=this.handleTop.outerHeight();this._outerW(this.arrowBottom,n).css("top",s-o),this._outerW(this.arrowTop,n),this.arrowIconBottom.css({top:(this.arrowBottom.height()-this.arrowIconBottom.height())/2,left:(this.arrowBottom.width()-this.arrowIconBottom.width())/2}),this.arrowIconTop.css({top:(this.arrowTop.height()-this.arrowIconTop.height())/2,left:(this.arrowTop.width()-this.arrowIconTop.width())/2});var h=r,c=s-h-o-a-l;this.innerH=c,this._outerW(this.bgVer,n).css("top",h+l),this._outerH(this.bgVer,c);var u=Math.round(this._map(e.minimum,c)),d=Math.round(c-this._map(e.maximum,c));if(t.reversed){var p=u;u=d,d=p}h+=d,c-=u+d,this._outerW(this.handleTop,n).css("top",h),this._outerW(this.handleBottom,n).css("top",h+c+l),this.handleIconBottom.css({top:(this.handleBottom.height()-this.handleIconBottom.height())/2,left:(this.handleBottom.width()-this.handleIconBottom.width())/2}),this.handleIconTop.css({top:(this.handleTop.height()-this.handleIconTop.height())/2,left:(this.handleTop.width()-this.handleIconTop.width())/2}),this._outerW(this.sliderVer,n).css("top",h+l),this._outerH(this.sliderVer,c),this._outerW(this.bgVerTop,n).css("top",r),this._outerH(this.bgVerTop,h-r),h+=c+a+l,this._outerW(this.bgVerBottom,n).css("top",h),this._outerH(this.bgVerBottom,s-h-o)},_map:function(t,e){var i=this.options,n=i.maximum-i.minimum,s=t-i.minimum,o=e*s/n;return o=Math.min(o,e),o=Math.max(o,0)},_trigger:function(e,i){var n=this.options.range,s=this.lastChange;(this.startMin!==n.minimum||this.startMax!==n.maximum)&&(i||s.minimum!==n.minimum||s.maximum!==n.maximum)&&(this.startMin=null,this.startMax=null,this.elem.trigger(e,{minimum:n.minimum,maximum:n.maximum}),t.extend(s,n))},_startChange:function(){this.valueMin=this.startMin=this.options.range.minimum,this.valueMax=this.startMax=this.options.range.maximum},_largeScrollStart:function(t,e){e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i,n=t.pageX,s=t.pageY,o=this.elem.offset(),r=n-o.left,a=s-o.top,l=this.options,h=l.maximum-l.minimum;"horizontal"==this.orientation?(r-=parseFloat(this.bgHor.css("left")),i=l.minimum+h*r/this.innerW):(a-=parseFloat(this.bgVer.css("top")),i=l.maximum-h*a/this.innerH),l.reversed&&(i=l.minimum+l.maximum-i),this.endScrollValue=i},_moveLeft:function(){var t=this.options,e=t.range.maximum-t.range.minimum,i=t.range.minimum-t.smallChange;i=Math.max(t.minimum,i);var n=i+e;return t.range.minimum=i,t.range.maximum=n,this._arrange(),this._trigger("rangeChanged"),this.endScrollValue&&(i+n)/2<this.endScrollValue?!0:!1},_moveRight:function(){var t=this.options,e=t.range.maximum-t.range.minimum,i=t.range.maximum+t.smallChange;i=Math.min(t.maximum,i);var n=i-e;return t.range.minimum=n,t.range.maximum=i,this._arrange(),this._trigger("rangeChanged"),this.endScrollValue&&(n+i)/2>this.endScrollValue?!0:!1},_scrollLeft:function(){if(this.scrolling){var e;if(e=this.options.reversed?this._moveRight():this._moveLeft())return this.endScrollValue=null,void 0;var i=this.scrollingCount?100:200;this.scrollingCount++,setTimeout(t.proxy(this._scrollLeft,this),i)}},_scrollRight:function(){if(this.scrolling){var e;if(e=this.options.reversed?this._moveLeft():this._moveRight())return this.endScrollValue=null,void 0;var i=this.scrollingCount?100:200;this.scrollingCount++,setTimeout(t.proxy(this._scrollRight,this),i)}},_stopScroll:function(){this.scrolling=!1},_startDragHor:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.dragging=!0,this.pos=t.pageX,this._startChange(),this.sliderHor.addClass("ui-jqrangeslider-slider-horizontal-dragging")},_draggingHor:function(t,e){if(this.dragging){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerW;n.reversed&&(o=-o),o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.maximum-this.valueMax),n.range.minimum=this.valueMin+o,n.range.maximum=this.valueMax+o,this._arrange(),this._trigger("rangeChanging")}},_stopDragHor:function(t){t.preventDefault(),this.dragging=!1,this.sliderHor.removeClass("ui-jqrangeslider-slider-horizontal-dragging"),this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startDragVer:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.dragging=!0,this.pos=t.pageY,this._startChange(),this.sliderVer.addClass("ui-jqrangeslider-slider-vertical-dragging")},_draggingVer:function(t,e){if(this.dragging){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerH;n.reversed&&(o=-o),o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.maximum-this.valueMax),n.range.minimum=this.valueMin+o,n.range.maximum=this.valueMax+o,this._arrange(),this._trigger("rangeChanging")}},_stopDragVer:function(t){t.preventDefault(),this.dragging=!1,this.sliderVer.removeClass("ui-jqrangeslider-slider-vertical-dragging"),this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeLeft:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageX,this._startChange()},_resizeLeft:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=n.maximum-n.minimum,o=s*i/this.innerW,r=this.options.minRange;n.reversed?(o=-o,o=Math.min(o,n.maximum-this.valueMax),o=Math.max(o,n.range.minimum-this.valueMax+r),n.range.maximum=this.valueMax+o):(o=Math.max(o,n.minimum-this.valueMin),o=Math.min(o,n.range.maximum-this.valueMin-r),n.range.minimum=this.valueMin+o),this._arrange(),this._trigger("rangeChanging")}},_stopResizeLeft:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeBottom:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageY,this._startChange()},_resizeBottom:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,r=o*i/this.innerH;n.reversed?(r=-r,r=Math.min(r,n.maximum-this.valueMax),r=Math.max(r,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+r):(r=Math.max(r,n.minimum-this.valueMin),r=Math.min(r,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+r),this._arrange(),this._trigger("rangeChanging")}},_stopResizeBottom:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeRight:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageX,this._startChange()},_resizeRight:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=t.pageX-this.pos,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,r=o*i/this.innerW;n.reversed?(r=-r,r=Math.max(r,n.minimum-this.valueMin),r=Math.min(r,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+r):(r=Math.min(r,n.maximum-this.valueMax),r=Math.max(r,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+r),this._arrange(),this._trigger("rangeChanging")}},_stopResizeRight:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_startResizeTop:function(t,e){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),this.resize=!0,this.pos=t.pageY,this._startChange()},_resizeTop:function(t,e){if(this.resize){t.preventDefault(),e&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]);var i=this.pos-t.pageY,n=this.options,s=this.options.minRange,o=n.maximum-n.minimum,r=o*i/this.innerH;n.reversed?(r=-r,r=Math.max(r,n.minimum-this.valueMin),r=Math.min(r,n.range.maximum-this.valueMin-s),n.range.minimum=this.valueMin+r):(r=Math.min(r,n.maximum-this.valueMax),r=Math.max(r,n.range.minimum-this.valueMax+s),n.range.maximum=this.valueMax+r),this._arrange(),this._trigger("rangeChanging")}},_stopResizeTop:function(t){t.preventDefault(),this.resize=!1,this._trigger("rangeChanged",!0),this.valueMin=null,this.valueMax=null},_outerH:function(e,i){var n=["Top","Bottom"];return t.each(n,function(){i-=parseFloat(e.css("border"+this+"Width"))||0}),i=Math.max(0,i),e.height(i),e},_outerW:function(e,i){var n=["Left","Right"];return t.each(n,function(){i-=parseFloat(e.css("border"+this+"Width"))||0}),i=Math.max(0,i),e.width(i),e},_addHover:function(e){e.hover(function(){t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")})},destroy:function(){var t=this.elem;t.children().remove(),t.removeClass("ui-jqrangeslider ui-widget")}}}(t)}),define("_libs/charts/Chart",["jquery","./jqChart/src/js/jquery.jqChart.dev","./jqChart/src/js/jquery.jqRangeSlider.js","css!./jqChart/css/jquery.jqChart.css","css!./jqChart/css/jquery.jqRangeSlider.css"],function(t){function e(e,s){this.el=t(e),this.options=t.extend({},i,s||{}),this._chart=null,n.build.call(this)}e.DEFAULT_LINE_WIDTH=2;var i={title:!1,height:350,border:{lineWidth:0},legend:{visible:!1},crosshairs:{enabled:!1,hLine:!1,vLine:{strokeStyle:"#cc0a0c"}},axes:[{type:"dateTime",location:"bottom",strokeStyle:"black",lineWidth:1,margin:0,zoomEnabled:!0,labels:{stringFormat:"HH:MM dd.mm",fillStyle:"black",font:"10px sans-serif",angle:0},bands:null},{type:"linear",location:"left",margin:0,minimum:0,majorGridLines:{lineWidth:1,strokeStyle:"#dadada",interval:1}}],series:[],toolbar:{visibility:"auto",resetZoomTooltipText:"1:1",zoomingTooltipText:"Zoom in to selection area",panningTooltipText:"Pan the chart"}};e.getDefaults=function(){return i},e.setWidth=function(e,i){t(e).jqChart("option","width",i)},e.destroy=function(e){t(e).jqChart("destroy")},t.extend(e.prototype,{getChart:function(){return this._chart}});var n={build:function(){this.el&&this.el.length&&(this.el.jqChart(this.options),this._chart=this.el.jqChart("chart"))}};return e}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("EasyPieChart",[],e):t.EasyPieChart=e()}(this,function(){var t=function(t,e){var i,n=document.createElement("canvas");"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n);var s=n.getContext("2d");n.width=n.height=e.size,t.appendChild(n);var o=1;window.devicePixelRatio>1&&(o=window.devicePixelRatio,n.style.width=n.style.height=[e.size,"px"].join(""),n.width=n.height=e.size*o,s.scale(o,o)),s.translate(e.size/2,e.size/2),s.rotate((-0.5+e.rotate/180)*Math.PI);var r=(e.size-e.lineWidth)/2;e.scaleColor&&e.scaleLength&&(r-=e.scaleLength+2),Date.now=Date.now||function(){return+new Date};var a=function(t,e,i){i=Math.min(Math.max(0,i||1),1),s.beginPath(),s.arc(0,0,r,0,2*Math.PI*i,!1),s.strokeStyle=t,s.lineWidth=e,s.stroke()},l=function(){var t,i,n=24;s.lineWidth=1,s.fillStyle=e.scaleColor,s.save();for(var n=24;n>0;--n)0===n%6?(i=e.scaleLength,t=0):(i=.6*e.scaleLength,t=e.scaleLength-i),s.fillRect(-e.size/2+t,0,i,1),s.rotate(Math.PI/12);s.restore()},h=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),c=function(){e.scaleColor&&l(),e.trackColor&&a(e.trackColor,e.lineWidth)};this.clear=function(){s.clearRect(e.size/-2,e.size/-2,e.size,e.size)},this.draw=function(t){e.scaleColor||e.trackColor?s.getImageData&&s.putImageData?i?s.putImageData(i,0,0):(c(),i=s.getImageData(0,0,e.size*o,e.size*o)):(this.clear(),c()):this.clear(),s.lineCap=e.lineCap;var n;n="function"==typeof e.barColor?e.barColor(t):e.barColor,t>0&&a(n,e.lineWidth,t/100)}.bind(this),this.animate=function(t,i){var n=Date.now();e.onStart(t,i);var s=function(){var o=Math.min(Date.now()-n,e.animate),r=e.easing(this,o,t,i-t,e.animate);this.draw(r),e.onStep(t,i,r),o>=e.animate?e.onStop(t,i):h(s)}.bind(this);h(s)}.bind(this)},e=function(e,i){var n={barColor:"#ef1e25",trackColor:"#f9f9f9",scaleColor:"#dfe0e0",scaleLength:5,lineCap:"round",lineWidth:3,size:110,rotate:0,animate:1e3,easing:function(t,e,i,n,s){return e/=s/2,1>e?n/2*e*e+i:-n/2*(--e*(e-2)-1)+i},onStart:function(){},onStep:function(){},onStop:function(){}};if("undefined"!=typeof t)n.renderer=t;else{if("undefined"==typeof SVGRenderer)throw new Error("Please load either the SVG- or the CanvasRenderer");n.renderer=SVGRenderer}var s={},o=0,r=function(){this.el=e,this.options=s;for(var t in n)n.hasOwnProperty(t)&&(s[t]=i&&"undefined"!=typeof i[t]?i[t]:n[t],"function"==typeof s[t]&&(s[t]=s[t].bind(this)));s.easing="string"==typeof s.easing&&"undefined"!=typeof jQuery&&jQuery.isFunction(jQuery.easing[s.easing])?jQuery.easing[s.easing]:n.easing,this.renderer=new s.renderer(e,s),this.renderer.draw(o),e.dataset&&e.dataset.percent?this.update(parseFloat(e.dataset.percent)):e.getAttribute&&e.getAttribute("data-percent")&&this.update(parseFloat(e.getAttribute("data-percent")))}.bind(this);this.update=function(t){return t=parseFloat(t),s.animate?this.renderer.animate(o,t):this.renderer.draw(t),o=t,e.dataset&&e.dataset.percent?e.dataset.percent=t:e.getAttribute&&e.getAttribute("data-percent")&&e.setAttribute("data-percent",t),this}.bind(this),r()};return e}),define("_libs/charts/ragAndFunnel/ragAndFunnel",function(){}),define("fileDownload",["jquery"],function(t){var e=/[<>&\r\n"']/gm,i={"<":"lt;",">":"gt;","&":"amp;","\r":"#13;","\n":"#10;",'"':"quot;","'":"apos;"};t.extend({fileDownload:function(n,s){function o(){if(-1!=document.cookie.indexOf(d.cookieName+"="+d.cookieValue))return v.onSuccess(n),document.cookie=d.cookieName+"=; expires="+new Date(1e3).toUTCString()+"; path="+d.cookiePath,a(!1),void 0;if(y||_)try{var e=y?y.document:r(_);if(e&&null!=e.body&&e.body.innerHTML.length){var i=!0;if(w&&w.length){var s=t(e.body).contents().first();s.length&&s[0]===w[0]&&(i=!1)}if(i)return v.onFail(e.body.innerHTML,n),a(!0),void 0}}catch(l){return v.onFail("",n),a(!0),void 0}setTimeout(o,d.checkInterval)}function r(t){var e=t[0].contentWindow||t[0].contentDocument;return e.document&&(e=e.document),e}function a(t){setTimeout(function(){y&&(c&&y.close(),h&&(y.focus(),t&&y.close()))},0)}function l(t){return t.replace(e,function(t){return"&"+i[t]})}var h,c,u,d=t.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},prepareCallback:function(){},successCallback:function(){},failCallback:function(){},httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},s),p=new t.Deferred,f=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase();/ip(ad|hone|od)/.test(f)?h=!0:-1!==f.indexOf("android")?c=!0:u=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(f)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(f.substr(0,4));var m=d.httpMethod.toUpperCase();if(c&&"GET"!==m)return t().dialog?t("<div>").html(d.androidPostUnsupportedMessageHtml).dialog(d.dialogOptions):alert(d.androidPostUnsupportedMessageHtml),p.reject();var g=null,v={onPrepare:function(e){d.preparingMessageHtml?g=t("<div>").html(d.preparingMessageHtml).dialog(d.dialogOptions):d.prepareCallback&&d.prepareCallback(e)},onSuccess:function(t){g&&g.dialog("close"),d.successCallback(t),p.resolve(t)},onFail:function(e,i){g&&g.dialog("close"),d.failMessageHtml&&t("<div>").html(d.failMessageHtml).dialog(d.dialogOptions),d.failCallback(e,i),p.reject(e,i)}};v.onPrepare(n),null!==d.data&&"string"!=typeof d.data&&(d.data=t.param(d.data));var _,y,b,w;if("GET"===m){if(null!==d.data){var x=n.indexOf("?");-1!==x?"&"!==n.substring(n.length-1)&&(n+="&"):n+="?",n+=d.data}h||c?(y=window.open(n),y.document.title=d.popupWindowTitle,window.focus()):u?window.location(n):_=t("<iframe>").hide().prop("src",n).appendTo("body")}else{var S="";null!==d.data&&t.each(d.data.replace(/\+/g," ").split("&"),function(){var t=this.split("="),e=d.encodeHTMLEntities?l(decodeURIComponent(t[0])):decodeURIComponent(t[0]);if(e){var i=d.encodeHTMLEntities?l(decodeURIComponent(t[1])):decodeURIComponent(t[1]);S+='<input type="hidden" name="'+e+'" value="'+i+'" />'}}),u?(w=t("<form>").appendTo("body"),w.hide().prop("method",d.httpMethod).prop("action",n).html(S)):(h?(y=window.open("about:blank"),y.document.title=d.popupWindowTitle,b=y.document,window.focus()):(_=t("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),b=r(_)),b.write("<html><head></head><body><form method='"+d.httpMethod+"' action='"+n+"'>"+S+"</form>"+d.popupWindowTitle+"</body></html>"),w=t(b).find("form")),w.submit()}return setTimeout(o,d.checkInterval),p.promise()}})}),function(t,e,i){var n=function(n){function s(t){var e,i,o={};n.each(t,function(n){(e=n.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(e[1]+" ")&&(i=n.replace(e[0],e[2].toLowerCase()),o[i]=n,"o"===e[1]&&s(t[n]))}),t._hungarianMap=o}function o(t,e,r){t._hungarianMap||s(t);var a;n.each(e,function(s){a=t._hungarianMap[s],a===i||!r&&e[a]!==i||("o"===a.charAt(0)?(e[a]||(e[a]={}),n.extend(!0,e[a],e[s]),o(t[a],e[a],r)):e[a]=e[s])
})}function r(t){var e=$e.defaults.oLanguage,i=t.sZeroRecords;!t.sEmptyTable&&i&&"No data available in table"===e.sEmptyTable&&Re(t,t,"sZeroRecords","sEmptyTable"),!t.sLoadingRecords&&i&&"Loading..."===e.sLoadingRecords&&Re(t,t,"sZeroRecords","sLoadingRecords"),t.sInfoThousands&&(t.sThousands=t.sInfoThousands),(t=t.sDecimal)&&Ve(t)}function a(t){ci(t,"ordering","bSort"),ci(t,"orderMulti","bSortMulti"),ci(t,"orderClasses","bSortClasses"),ci(t,"orderCellsTop","bSortCellsTop"),ci(t,"order","aaSorting"),ci(t,"orderFixed","aaSortingFixed"),ci(t,"paging","bPaginate"),ci(t,"pagingType","sPaginationType"),ci(t,"pageLength","iDisplayLength"),ci(t,"searching","bFilter")}function l(t){ci(t,"orderable","bSortable"),ci(t,"orderData","aDataSort"),ci(t,"orderSequence","asSorting"),ci(t,"orderDataType","sortDataType")}function h(t){var t=t.oBrowser,e=n("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(n("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(n('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),i=e.find(".test");t.bScrollOversize=100===i[0].offsetWidth,t.bScrollbarLeft=1!==i.offset().left,e.remove()}function c(t,e,n,s,o,r){var a,l=!1;for(n!==i&&(a=n,l=!0);s!==o;)t.hasOwnProperty(s)&&(a=l?e(a,t[s],s,t):t[s],l=!0,s+=r);return a}function u(t,i){var s=$e.defaults.column,o=t.aoColumns.length,s=n.extend({},$e.models.oColumn,s,{nTh:i?i:e.createElement("th"),sTitle:s.sTitle?s.sTitle:i?i.innerHTML:"",aDataSort:s.aDataSort?s.aDataSort:[o],mData:s.mData?s.mData:o,idx:o});t.aoColumns.push(s),s=t.aoPreSearchCols,s[o]=n.extend({},$e.models.oSearch,s[o]),d(t,o,null)}function d(t,e,s){var r=t.aoColumns[e],e=t.oClasses,a=n(r.nTh);if(!r.sWidthOrig){r.sWidthOrig=a.attr("width")||null;var h=(a.attr("style")||"").match(/width:\s*(\d+[pxem%])/);h&&(r.sWidthOrig=h[1])}s!==i&&null!==s&&(l(s),o($e.defaults.column,s),s.mDataProp!==i&&!s.mData&&(s.mData=s.mDataProp),s.sType&&(r._sManualType=s.sType),s.className&&!s.sClass&&(s.sClass=s.className),n.extend(r,s),Re(r,s,"sWidth","sWidthOrig"),"number"==typeof s.iDataSort&&(r.aDataSort=[s.iDataSort]),Re(r,s,"aDataSort"));var s=r.mData,c=T(s),u=r.mRender?T(r.mRender):null,h=function(t){return"string"==typeof t&&-1!==t.indexOf("@")};r._bAttrSrc=n.isPlainObject(s)&&(h(s.sort)||h(s.type)||h(s.filter)),r.fnGetData=function(t,e){var i=c(t,e);return r.mRender&&e&&""!==e?u(i,e,t):i},r.fnSetData=M(s),t.oFeatures.bSort||(r.bSortable=!1,a.addClass(e.sSortableNone)),t=-1!==n.inArray("asc",r.asSorting),a=-1!==n.inArray("desc",r.asSorting),r.bSortable&&(t||a)?t&&!a?(r.sSortingClass=e.sSortableAsc,r.sSortingClassJUI=e.sSortJUIAscAllowed):!t&&a?(r.sSortingClass=e.sSortableDesc,r.sSortingClassJUI=e.sSortJUIDescAllowed):(r.sSortingClass=e.sSortable,r.sSortingClassJUI=e.sSortJUI):(r.sSortingClass=e.sSortableNone,r.sSortingClassJUI="")}function p(t){if(!1!==t.oFeatures.bAutoWidth){var e=t.aoColumns;fe(t);for(var i=0,n=e.length;n>i;i++)e[i].nTh.style.width=e[i].sWidth}e=t.oScroll,(""!==e.sY||""!==e.sX)&&de(t),Fe(t,null,"column-sizing",[t])}function f(t,e){var i=v(t,"bVisible");return"number"==typeof i[e]?i[e]:null}function m(t,e){var i=v(t,"bVisible"),i=n.inArray(e,i);return-1!==i?i:null}function g(t){return v(t,"bVisible").length}function v(t,e){var i=[];return n.map(t.aoColumns,function(t,n){t[e]&&i.push(n)}),i}function _(t){var e,n,s,o,r,a,l,h,c,u=t.aoColumns,d=t.aoData,p=$e.ext.type.detect;for(e=0,n=u.length;n>e;e++)if(l=u[e],c=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){for(s=0,o=p.length;o>s;s++){for(r=0,a=d.length;a>r&&(c[r]===i&&(c[r]=x(t,r,e,"type")),h=p[s](c[r],t),!(!h||"html"===h));r++);if(h){l.sType=h;break}}l.sType||(l.sType="string")}}function y(t,e,s,o){var r,a,l,h,c,d,p=t.aoColumns;if(e)for(r=e.length-1;r>=0;r--){d=e[r];var f=d.targets!==i?d.targets:d.aTargets;for(n.isArray(f)||(f=[f]),a=0,l=f.length;l>a;a++)if("number"==typeof f[a]&&0<=f[a]){for(;p.length<=f[a];)u(t);o(f[a],d)}else if("number"==typeof f[a]&&0>f[a])o(p.length+f[a],d);else if("string"==typeof f[a])for(h=0,c=p.length;c>h;h++)("_all"==f[a]||n(p[h].nTh).hasClass(f[a]))&&o(h,d)}if(s)for(r=0,t=s.length;t>r;r++)o(r,s[r])}function b(t,e,i,s){var o=t.aoData.length,r=n.extend(!0,{},$e.models.oRow,{src:i?"dom":"data"});r._aData=e,t.aoData.push(r);for(var e=t.aoColumns,r=0,a=e.length;a>r;r++)i&&S(t,o,r,x(t,o,r)),e[r].sType=null;return t.aiDisplayMaster.push(o),t.oFeatures.bDeferRender||I(t,o,i,s),o}function w(t,e){var i;return e instanceof n||(e=n(e)),e.map(function(e,n){return i=P(t,n),b(t,i.data,n,i.cells)})}function x(t,e,n,s){var n=t.aoColumns[n],o=t.aoData[e]._aData,r=n.fnGetData(o,s);if(r===i)return t.iDrawError!=t.iDraw&&null===n.sDefaultContent&&(Ie(t,0,"Requested unknown parameter "+("function"==typeof n.mData?"{function}":"'"+n.mData+"'")+" for row "+e,4),t.iDrawError=t.iDraw),n.sDefaultContent;if(r!==o&&null!==r||null===n.sDefaultContent){if("function"==typeof r)return r()}else r=n.sDefaultContent;return null===r&&"display"==s?"":r}function S(t,e,i,n){t.aoColumns[i].fnSetData(t.aoData[e]._aData,n)}function C(t){return n.map(t.match(/(\\.|[^\.])+/g),function(t){return t.replace("\\.",".")})}function T(t){if(n.isPlainObject(t)){var e={};return n.each(t,function(t,i){i&&(e[t]=T(i))}),function(t,n,s){var o=e[n]||e._;return o!==i?o(t,n,s):t}}if(null===t)return function(t){return t};if("function"==typeof t)return function(e,i,n){return t(e,i,n)};if("string"==typeof t&&(-1!==t.indexOf(".")||-1!==t.indexOf("[")||-1!==t.indexOf("("))){var s=function(t,e,n){var o,r;if(""!==n){r=C(n);for(var a=0,l=r.length;l>a;a++){if(n=r[a].match(ui),o=r[a].match(di),n){for(r[a]=r[a].replace(ui,""),""!==r[a]&&(t=t[r[a]]),o=[],r.splice(0,a+1),r=r.join("."),a=0,l=t.length;l>a;a++)o.push(s(t[a],e,r));t=n[0].substring(1,n[0].length-1),t=""===t?o:o.join(t);break}if(o)r[a]=r[a].replace(di,""),t=t[r[a]]();else{if(null===t||t[r[a]]===i)return i;t=t[r[a]]}}}return t};return function(e,i){return s(e,i,t)}}return function(e){return e[t]}}function M(t){if(n.isPlainObject(t))return M(t._);if(null===t)return function(){};if("function"==typeof t)return function(e,i){t(e,"set",i)};if("string"==typeof t&&(-1!==t.indexOf(".")||-1!==t.indexOf("[")||-1!==t.indexOf("("))){var e=function(t,n,s){var o,s=C(s);o=s[s.length-1];for(var r,a,l=0,h=s.length-1;h>l;l++){if(r=s[l].match(ui),a=s[l].match(di),r){for(s[l]=s[l].replace(ui,""),t[s[l]]=[],o=s.slice(),o.splice(0,l+1),r=o.join("."),a=0,h=n.length;h>a;a++)o={},e(o,n[a],r),t[s[l]].push(o);return}a&&(s[l]=s[l].replace(di,""),t=t[s[l]](n)),(null===t[s[l]]||t[s[l]]===i)&&(t[s[l]]={}),t=t[s[l]]}o.match(di)?t[o.replace(di,"")](n):t[o.replace(ui,"")]=n};return function(i,n){return e(i,n,t)}}return function(e,i){e[t]=i}}function A(t){return ri(t.aoData,"_aData")}function D(t){t.aoData.length=0,t.aiDisplayMaster.length=0,t.aiDisplay.length=0}function L(t,e,n){for(var s=-1,o=0,r=t.length;r>o;o++)t[o]==e?s=o:t[o]>e&&t[o]--;-1!=s&&n===i&&t.splice(s,1)}function k(t,e,n,s){var o,r=t.aoData[e];if("dom"!==n&&(n&&"auto"!==n||"dom"!==r.src)){var a=r.anCells;if(a)for(n=0,o=a.length;o>n;n++)a[n].innerHTML=x(t,e,n,"display")}else r._aData=P(t,r).data;if(r._aSortData=null,r._aFilterData=null,t=t.aoColumns,s!==i)t[s].sType=null;else for(n=0,o=t.length;o>n;n++)t[n].sType=null;R(r)}function P(t,e){var i,s,o,r,a=[],l=[],h=e.firstChild,c=0,u=t.aoColumns,d=function(t,e,i){"string"==typeof t&&(e=t.indexOf("@"),-1!==e&&(t=t.substring(e+1),o["@"+t]=i.getAttribute(t)))},p=function(t){s=u[c],r=n.trim(t.innerHTML),s&&s._bAttrSrc?(o={display:r},d(s.mData.sort,o,t),d(s.mData.type,o,t),d(s.mData.filter,o,t),a.push(o)):a.push(r),l.push(t),c++};if(h)for(;h;)i=h.nodeName.toUpperCase(),("TD"==i||"TH"==i)&&p(h),h=h.nextSibling;else for(l=e.anCells,h=0,i=l.length;i>h;h++)p(l[h]);return{data:a,cells:l}}function I(t,i,n,s){var o,r,a,l,h,c=t.aoData[i],u=c._aData,d=[];if(null===c.nTr){for(o=n||e.createElement("tr"),c.nTr=o,c.anCells=d,o._DT_RowIndex=i,R(c),l=0,h=t.aoColumns.length;h>l;l++)a=t.aoColumns[l],r=n?s[l]:e.createElement(a.sCellType),d.push(r),(!n||a.mRender||a.mData!==l)&&(r.innerHTML=x(t,i,l,"display")),a.sClass&&(r.className+=" "+a.sClass),a.bVisible&&!n?o.appendChild(r):!a.bVisible&&n&&r.parentNode.removeChild(r),a.fnCreatedCell&&a.fnCreatedCell.call(t.oInstance,r,x(t,i,l,"display"),u,i,l);Fe(t,"aoRowCreatedCallback",null,[o,u,i])}c.nTr.setAttribute("role","row")}function R(t){var e=t.nTr,i=t._aData;if(e){if(i.DT_RowId&&(e.id=i.DT_RowId),i.DT_RowClass){var s=i.DT_RowClass.split(" ");t.__rowc=t.__rowc?hi(t.__rowc.concat(s)):s,n(e).removeClass(t.__rowc.join(" ")).addClass(i.DT_RowClass)}i.DT_RowData&&n(e).data(i.DT_RowData)}}function E(t){var e,i,s,o,r,a=t.nTHead,l=t.nTFoot,h=0===n("th, td",a).length,c=t.oClasses,u=t.aoColumns;for(h&&(o=n("<tr/>").appendTo(a)),e=0,i=u.length;i>e;e++)r=u[e],s=n(r.nTh).addClass(r.sClass),h&&s.appendTo(o),t.oFeatures.bSort&&(s.addClass(r.sSortingClass),!1!==r.bSortable&&(s.attr("tabindex",t.iTabIndex).attr("aria-controls",t.sTableId),Me(t,r.nTh,e))),r.sTitle!=s.html()&&s.html(r.sTitle),Be(t,"header")(t,s,r,c);if(h&&B(t.aoHeader,a),n(a).find(">tr").attr("role","row"),n(a).find(">tr>th, >tr>td").addClass(c.sHeaderTH),n(l).find(">tr>th, >tr>td").addClass(c.sFooterTH),null!==l)for(t=t.aoFooter[0],e=0,i=t.length;i>e;e++)r=u[e],r.nTf=t[e].cell,r.sClass&&n(r.nTf).addClass(r.sClass)}function O(t,e,s){var o,r,a,l,h=[],c=[],u=t.aoColumns.length;if(e){for(s===i&&(s=!1),o=0,r=e.length;r>o;o++){for(h[o]=e[o].slice(),h[o].nTr=e[o].nTr,a=u-1;a>=0;a--)!t.aoColumns[a].bVisible&&!s&&h[o].splice(a,1);c.push([])}for(o=0,r=h.length;r>o;o++){if(t=h[o].nTr)for(;a=t.firstChild;)t.removeChild(a);for(a=0,e=h[o].length;e>a;a++)if(l=u=1,c[o][a]===i){for(t.appendChild(h[o][a].cell),c[o][a]=1;h[o+u]!==i&&h[o][a].cell==h[o+u][a].cell;)c[o+u][a]=1,u++;for(;h[o][a+l]!==i&&h[o][a].cell==h[o][a+l].cell;){for(s=0;u>s;s++)c[o+s][a+l]=1;l++}n(h[o][a].cell).attr("rowspan",u).attr("colspan",l)}}}}function j(t){var e=Fe(t,"aoPreDrawCallback","preDraw",[t]);if(-1!==n.inArray(!1,e))ce(t,!1);else{var e=[],s=0,o=t.asStripeClasses,r=o.length,a=t.oLanguage,l=t.iInitDisplayStart,h="ssp"==ze(t),c=t.aiDisplay;t.bDrawing=!0,l!==i&&-1!==l&&(t._iDisplayStart=h?l:l>=t.fnRecordsDisplay()?0:l,t.iInitDisplayStart=-1);var l=t._iDisplayStart,u=t.fnDisplayEnd();if(t.bDeferLoading)t.bDeferLoading=!1,t.iDraw++,ce(t,!1);else if(h){if(!t.bDestroying&&!V(t))return}else t.iDraw++;if(0!==c.length)for(a=h?t.aoData.length:u,h=h?0:l;a>h;h++){var d=c[h],p=t.aoData[d];if(null===p.nTr&&I(t,d),d=p.nTr,0!==r){var f=o[s%r];p._sRowStripe!=f&&(n(d).removeClass(p._sRowStripe).addClass(f),p._sRowStripe=f)}Fe(t,"aoRowCallback",null,[d,p._aData,s,h]),e.push(d),s++}else s=a.sZeroRecords,1==t.iDraw&&"ajax"==ze(t)?s=a.sLoadingRecords:a.sEmptyTable&&0===t.fnRecordsTotal()&&(s=a.sEmptyTable),e[0]=n("<tr/>",{"class":r?o[0]:""}).append(n("<td />",{valign:"top",colSpan:g(t),"class":t.oClasses.sRowEmpty}).html(s))[0];Fe(t,"aoHeaderCallback","header",[n(t.nTHead).children("tr")[0],A(t),l,u,c]),Fe(t,"aoFooterCallback","footer",[n(t.nTFoot).children("tr")[0],A(t),l,u,c]),o=n(t.nTBody),o.children().detach(),o.append(n(e)),Fe(t,"aoDrawCallback","draw",[t]),t.bSorted=!1,t.bFiltered=!1,t.bDrawing=!1}}function F(t,e){var i=t.oFeatures,n=i.bFilter;i.bSort&&Se(t),n?q(t,t.oPreviousSearch):t.aiDisplay=t.aiDisplayMaster.slice(),!0!==e&&(t._iDisplayStart=0),j(t)}function N(t){var e=t.oClasses,i=n(t.nTable),i=n("<div/>").insertBefore(i),s=t.oFeatures,o=n("<div/>",{id:t.sTableId+"_wrapper","class":e.sWrapper+(t.nTFoot?"":" "+e.sNoFooter)});t.nHolding=i[0],t.nTableWrapper=o[0],t.nTableReinsertBefore=t.nTable.nextSibling;for(var r,a,l,h,c,u,d=t.sDom.split(""),p=0;p<d.length;p++){if(r=null,a=d[p],"<"==a){if(l=n("<div/>")[0],h=d[p+1],"'"==h||'"'==h){for(c="",u=2;d[p+u]!=h;)c+=d[p+u],u++;"H"==c?c=e.sJUIHeader:"F"==c&&(c=e.sJUIFooter),-1!=c.indexOf(".")?(h=c.split("."),l.id=h[0].substr(1,h[0].length-1),l.className=h[1]):"#"==c.charAt(0)?l.id=c.substr(1,c.length-1):l.className=c,p+=u}o.append(l),o=n(l)}else if(">"==a)o=o.parent();else if("l"==a&&s.bPaginate&&s.bLengthChange)r=re(t);else if("f"==a&&s.bFilter)r=G(t);else if("r"==a&&s.bProcessing)r=he(t);else if("t"==a)r=ue(t);else if("i"==a&&s.bInfo)r=te(t);else if("p"==a&&s.bPaginate)r=ae(t);else if(0!==$e.ext.feature.length)for(l=$e.ext.feature,u=0,h=l.length;h>u;u++)if(a==l[u].cFeature){r=l[u].fnInit(t);break}r&&(l=t.aanFeatures,l[a]||(l[a]=[]),l[a].push(r),o.append(r))}i.replaceWith(o)}function B(t,e){var i,s,o,r,a,l,h,c,u,d,p=n(e).children("tr");for(t.splice(0,t.length),o=0,l=p.length;l>o;o++)t.push([]);for(o=0,l=p.length;l>o;o++)for(i=p[o],s=i.firstChild;s;){if("TD"==s.nodeName.toUpperCase()||"TH"==s.nodeName.toUpperCase()){for(c=1*s.getAttribute("colspan"),u=1*s.getAttribute("rowspan"),c=c&&0!==c&&1!==c?c:1,u=u&&0!==u&&1!==u?u:1,r=0,a=t[o];a[r];)r++;for(h=r,d=1===c?!0:!1,a=0;c>a;a++)for(r=0;u>r;r++)t[o+r][h+a]={cell:s,unique:d},t[o+r].nTr=i}s=s.nextSibling}}function z(t,e,i){var n=[];i||(i=t.aoHeader,e&&(i=[],B(i,e)));for(var e=0,s=i.length;s>e;e++)for(var o=0,r=i[e].length;r>o;o++)!i[e][o].unique||n[o]&&t.bSortCellsTop||(n[o]=i[e][o].cell);return n}function U(t,e,i){if(Fe(t,"aoServerParams","serverParams",[e]),e&&n.isArray(e)){var s={},o=/(.*?)\[\]$/;n.each(e,function(t,e){var i=e.name.match(o);i?(i=i[0],s[i]||(s[i]=[]),s[i].push(e.value)):s[e.name]=e.value}),e=s}var r,a=t.ajax,l=t.oInstance;if(n.isPlainObject(a)&&a.data){r=a.data;var h=n.isFunction(r)?r(e):r,e=n.isFunction(r)&&h?h:n.extend(!0,e,h);delete a.data}h={data:e,success:function(e){var n=e.error||e.sError;n&&t.oApi._fnLog(t,0,n),t.json=e,Fe(t,null,"xhr",[t,e]),i(e)},dataType:"json",cache:!1,type:t.sServerMethod,error:function(e,i){var n=t.oApi._fnLog;"parsererror"==i?n(t,0,"Invalid JSON response",1):4===e.readyState&&n(t,0,"Ajax error",7),ce(t,!1)}},t.oAjaxData=e,Fe(t,null,"preXhr",[t,e]),t.fnServerData?t.fnServerData.call(l,t.sAjaxSource,n.map(e,function(t,e){return{name:e,value:t}}),i,t):t.sAjaxSource||"string"==typeof a?t.jqXHR=n.ajax(n.extend(h,{url:a||t.sAjaxSource})):n.isFunction(a)?t.jqXHR=a.call(l,e,i,t):(t.jqXHR=n.ajax(n.extend(h,a)),a.data=r)}function V(t){if(t.bAjaxDataGet){t.iDraw++,ce(t,!0);var e=H(t);return U(t,e,function(e){$(t,e)},t),!1}return!0}function H(t){var e,i,s,o,r=t.aoColumns,a=r.length,l=t.oFeatures,h=t.oPreviousSearch,c=t.aoPreSearchCols,u=[],d=xe(t);e=t._iDisplayStart,i=!1!==l.bPaginate?t._iDisplayLength:-1;var p=function(t,e){u.push({name:t,value:e})};p("sEcho",t.iDraw),p("iColumns",a),p("sColumns",ri(r,"sName").join(",")),p("iDisplayStart",e),p("iDisplayLength",i);var f={draw:t.iDraw,columns:[],order:[],start:e,length:i,search:{value:h.sSearch,regex:h.bRegex}};for(e=0;a>e;e++)s=r[e],o=c[e],i="function"==typeof s.mData?"function":s.mData,f.columns.push({data:i,name:s.sName,searchable:s.bSearchable,orderable:s.bSortable,search:{value:o.sSearch,regex:o.bRegex}}),p("mDataProp_"+e,i),l.bFilter&&(p("sSearch_"+e,o.sSearch),p("bRegex_"+e,o.bRegex),p("bSearchable_"+e,s.bSearchable)),l.bSort&&p("bSortable_"+e,s.bSortable);return l.bFilter&&(p("sSearch",h.sSearch),p("bRegex",h.bRegex)),l.bSort&&(n.each(d,function(t,e){f.order.push({column:e.col,dir:e.dir}),p("iSortCol_"+t,e.col),p("sSortDir_"+t,e.dir)}),p("iSortingCols",d.length)),r=$e.ext.legacy.ajax,null===r?t.sAjaxSource?u:f:r?u:f}function $(t,e){var n=e.sEcho!==i?e.sEcho:e.draw,s=e.iTotalRecords!==i?e.iTotalRecords:e.recordsTotal,o=e.iTotalDisplayRecords!==i?e.iTotalDisplayRecords:e.recordsFiltered;if(n){if(1*n<t.iDraw)return;t.iDraw=1*n}for(D(t),t._iRecordsTotal=parseInt(s,10),t._iRecordsDisplay=parseInt(o,10),n=W(t,e),s=0,o=n.length;o>s;s++)b(t,n[s]);t.aiDisplay=t.aiDisplayMaster.slice(),t.bAjaxDataGet=!1,j(t),t._bInitComplete||se(t,e),t.bAjaxDataGet=!0,ce(t,!1)}function W(t,e){var s=n.isPlainObject(t.ajax)&&t.ajax.dataSrc!==i?t.ajax.dataSrc:t.sAjaxDataProp;return"data"===s?e.aaData||e[s]:""!==s?T(s)(e):e}function G(t){var i=t.oClasses,s=t.sTableId,o=t.oPreviousSearch,r=t.aanFeatures,a='<input type="search" class="'+i.sFilterInput+'"/>',l=t.oLanguage.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",a):l+a,i=n("<div/>",{id:r.f?null:s+"_filter","class":i.sFilter}).append(n("<label/>").append(l)),r=function(){var e=this.value?this.value:"";e!=o.sSearch&&(q(t,{sSearch:e,bRegex:o.bRegex,bSmart:o.bSmart,bCaseInsensitive:o.bCaseInsensitive}),t._iDisplayStart=0,j(t))},h=n("input",i).val(o.sSearch.replace('"',"&quot;")).bind("keyup.DT search.DT input.DT paste.DT cut.DT","ssp"===ze(t)?me(r,400):r).bind("keypress.DT",function(t){return 13==t.keyCode?!1:void 0}).attr("aria-controls",s);return n(t.nTable).on("filter.DT",function(){try{h[0]!==e.activeElement&&h.val(o.sSearch)}catch(t){}}),i[0]}function q(t,e,n){var s=t.oPreviousSearch,o=t.aoPreSearchCols,r=function(t){s.sSearch=t.sSearch,s.bRegex=t.bRegex,s.bSmart=t.bSmart,s.bCaseInsensitive=t.bCaseInsensitive};if(_(t),"ssp"!=ze(t)){for(X(t,e.sSearch,n,e.bEscapeRegex!==i?!e.bEscapeRegex:e.bRegex,e.bSmart,e.bCaseInsensitive),r(e),e=0;e<o.length;e++)Y(t,o[e].sSearch,e,o[e].bEscapeRegex!==i?!o[e].bEscapeRegex:o[e].bRegex,o[e].bSmart,o[e].bCaseInsensitive);Z(t)}else r(e);t.bFiltered=!0,Fe(t,null,"search",[t])}function Z(t){for(var e,i,n=$e.ext.search,s=t.aiDisplay,o=0,r=n.length;r>o;o++)for(var a=s.length-1;a>=0;a--)i=s[a],e=t.aoData[i],n[o](t,e._aFilterData,i,e._aData)||s.splice(a,1)}function Y(t,e,i,n,s,o){if(""!==e)for(var r=t.aiDisplay,n=J(e,n,s,o),s=r.length-1;s>=0;s--)e=t.aoData[r[s]]._aFilterData[i],n.test(e)||r.splice(s,1)}function X(t,e,i,n,s,o){var r,n=J(e,n,s,o),s=t.oPreviousSearch.sSearch,o=t.aiDisplayMaster;if(0!==$e.ext.search.length&&(i=!0),r=Q(t),0>=e.length)t.aiDisplay=o.slice();else for((r||i||s.length>e.length||0!==e.indexOf(s)||t.bSorted)&&(t.aiDisplay=o.slice()),e=t.aiDisplay,i=e.length-1;i>=0;i--)n.test(t.aoData[e[i]]._sFilterRow)||e.splice(i,1)}function J(t,e,i,s){return t=e?t:K(t),i&&(t="^(?=.*?"+n.map(t.match(/"[^"]+"|[^ ]+/g)||"",function(t){return'"'===t.charAt(0)?t.match(/^"(.*)"$/)[1]:t}).join(")(?=.*?")+").*$"),RegExp(t,s?"i":"")}function K(t){return t.replace(Qe,"\\$1")}function Q(t){var e,i,n,s,o,r,a,l,h=t.aoColumns,c=$e.ext.type.search;for(e=!1,i=0,s=t.aoData.length;s>i;i++)if(l=t.aoData[i],!l._aFilterData){for(r=[],n=0,o=h.length;o>n;n++)e=h[n],e.bSearchable?(a=x(t,i,n,"filter"),a=c[e.sType]?c[e.sType](a):null!==a?a:""):a="",a.indexOf&&-1!==a.indexOf("&")&&(pi.innerHTML=a,a=fi?pi.textContent:pi.innerText),a.replace&&(a=a.replace(/[\r\n]/g,"")),r.push(a);l._aFilterData=r,l._sFilterRow=r.join("  "),e=!0}return e}function te(t){var e=t.sTableId,i=t.aanFeatures.i,s=n("<div/>",{"class":t.oClasses.sInfo,id:i?null:e+"_info"});return i||(t.aoDrawCallback.push({fn:ee,sName:"information"}),s.attr("role","status").attr("aria-live","polite"),n(t.nTable).attr("aria-describedby",e+"_info")),s[0]}function ee(t){var e=t.aanFeatures.i;if(0!==e.length){var i=t.oLanguage,s=t._iDisplayStart+1,o=t.fnDisplayEnd(),r=t.fnRecordsTotal(),a=t.fnRecordsDisplay(),l=a?i.sInfo:i.sInfoEmpty;a!==r&&(l+=" "+i.sInfoFiltered),l+=i.sInfoPostFix,l=ie(t,l),i=i.fnInfoCallback,null!==i&&(l=i.call(t.oInstance,t,s,o,r,a,l)),n(e).html(l)}}function ie(t,e){var i=t.fnFormatNumber,n=t._iDisplayStart+1,s=t._iDisplayLength,o=t.fnRecordsDisplay(),r=-1===s;return e.replace(/_START_/g,i.call(t,n)).replace(/_END_/g,i.call(t,t.fnDisplayEnd())).replace(/_MAX_/g,i.call(t,t.fnRecordsTotal())).replace(/_TOTAL_/g,i.call(t,o)).replace(/_PAGE_/g,i.call(t,r?1:Math.ceil(n/s))).replace(/_PAGES_/g,i.call(t,r?1:Math.ceil(o/s)))}function ne(t){var e,i,n,s=t.iInitDisplayStart,o=t.aoColumns;if(i=t.oFeatures,t.bInitialised){for(N(t),E(t),O(t,t.aoHeader),O(t,t.aoFooter),ce(t,!0),i.bAutoWidth&&fe(t),e=0,i=o.length;i>e;e++)n=o[e],n.sWidth&&(n.nTh.style.width=be(n.sWidth));F(t),o=ze(t),"ssp"!=o&&("ajax"==o?U(t,[],function(i){var n=W(t,i);for(e=0;e<n.length;e++)b(t,n[e]);t.iInitDisplayStart=s,F(t),ce(t,!1),se(t,i)},t):(ce(t,!1),se(t)))}else setTimeout(function(){ne(t)},200)}function se(t,e){t._bInitComplete=!0,e&&p(t),Fe(t,"aoInitComplete","init",[t,e])}function oe(t,e){var i=parseInt(e,10);t._iDisplayLength=i,Ne(t),Fe(t,null,"length",[t,i])}function re(t){for(var e=t.oClasses,i=t.sTableId,s=t.aLengthMenu,o=n.isArray(s[0]),r=o?s[0]:s,o=o?s[1]:s,s=n("<select/>",{name:i+"_length","aria-controls":i,"class":e.sLengthSelect}),a=0,l=r.length;l>a;a++)s[0][a]=new Option(o[a],r[a]);var h=n("<div><label/></div>").addClass(e.sLength);return t.aanFeatures.l||(h[0].id=i+"_length"),e=t.oLanguage.sLengthMenu.split(/(_MENU_)/),h.children().append(1<e.length?[e[0],s,e[2]]:e[0]),n("select",h).val(t._iDisplayLength).bind("change.DT",function(){oe(t,n(this).val()),j(t)}),n(t.nTable).bind("length.dt.DT",function(t,e,i){n("select",h).val(i)}),h[0]}function ae(t){var e=t.sPaginationType,i=$e.ext.pager[e],s="function"==typeof i,o=function(t){j(t)},e=n("<div/>").addClass(t.oClasses.sPaging+e)[0],r=t.aanFeatures;return s||i.fnInit(t,e,o),r.p||(e.id=t.sTableId+"_paginate",t.aoDrawCallback.push({fn:function(t){if(s){var e,n=t._iDisplayStart,a=t._iDisplayLength,l=t.fnRecordsDisplay(),h=-1===a,n=h?0:Math.ceil(n/a),a=h?1:Math.ceil(l/a),l=i(n,a),h=0;for(e=r.p.length;e>h;h++)Be(t,"pageButton")(t,r.p[h],h,l,n,a)}else i.fnUpdate(t,o)},sName:"pagination"})),e}function le(t,e,i){var n=t._iDisplayStart,s=t._iDisplayLength,o=t.fnRecordsDisplay();return 0===o||-1===s?n=0:"number"==typeof e?(n=e*s,n>o&&(n=0)):"first"==e?n=0:"previous"==e?(n=s>=0?n-s:0,0>n&&(n=0)):"next"==e?o>n+s&&(n+=s):"last"==e?n=Math.floor((o-1)/s)*s:Ie(t,0,"Unknown paging action: "+e,5),e=t._iDisplayStart!==n,t._iDisplayStart=n,e&&(Fe(t,null,"page",[t]),i&&j(t)),e}function he(t){return n("<div/>",{id:t.aanFeatures.r?null:t.sTableId+"_processing","class":t.oClasses.sProcessing}).html(t.oLanguage.sProcessing).insertBefore(t.nTable)[0]}function ce(t,e){t.oFeatures.bProcessing&&n(t.aanFeatures.r).css("display",e?"block":"none"),Fe(t,null,"processing",[t,e])}function ue(t){var e=n(t.nTable);e.attr("role","grid");var i=t.oScroll;if(""===i.sX&&""===i.sY)return t.nTable;var s=i.sX,o=i.sY,r=t.oClasses,a=e.children("caption"),l=a.length?a[0]._captionSide:null,h=n(e[0].cloneNode(!1)),c=n(e[0].cloneNode(!1)),u=e.children("tfoot");i.sX&&"100%"===e.attr("width")&&e.removeAttr("width"),u.length||(u=null),i=n("<div/>",{"class":r.sScrollWrapper}).append(n("<div/>",{"class":r.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:s?s?be(s):null:"100%"}).append(n("<div/>",{"class":r.sScrollHeadInner}).css({"box-sizing":"content-box",width:i.sXInner||"100%"}).append(h.removeAttr("id").css("margin-left",0).append(e.children("thead")))).append("top"===l?a:null)).append(n("<div/>",{"class":r.sScrollBody}).css({overflow:"auto",height:o?be(o):null,width:s?be(s):null}).append(e)),u&&i.append(n("<div/>",{"class":r.sScrollFoot}).css({overflow:"hidden",border:0,width:s?s?be(s):null:"100%"}).append(n("<div/>",{"class":r.sScrollFootInner}).append(c.removeAttr("id").css("margin-left",0).append(e.children("tfoot")))).append("bottom"===l?a:null));var e=i.children(),d=e[0],r=e[1],p=u?e[2]:null;return s&&n(r).scroll(function(){var t=this.scrollLeft;d.scrollLeft=t,u&&(p.scrollLeft=t)}),t.nScrollHead=d,t.nScrollBody=r,t.nScrollFoot=p,t.aoDrawCallback.push({fn:de,sName:"scrolling"}),i[0]}function de(t){var e,i,s,o,r,a,l=t.oScroll,h=l.sX,c=l.sXInner,u=l.sY,d=l.iBarWidth,p=n(t.nScrollHead),m=p[0].style,g=p.children("div"),v=g[0].style,_=g.children("table"),g=t.nScrollBody,y=n(g),b=g.style,w=n(t.nScrollFoot).children("div"),x=w.children("table"),S=n(t.nTHead),C=n(t.nTable),T=C[0],M=T.style,A=t.nTFoot?n(t.nTFoot):null,D=t.oBrowser,L=D.bScrollOversize,k=[],P=[],I=[],R=function(t){t=t.style,t.paddingTop="0",t.paddingBottom="0",t.borderTopWidth="0",t.borderBottomWidth="0",t.height=0};C.children("thead, tfoot").remove(),r=S.clone().prependTo(C),e=S.find("tr"),s=r.find("tr"),r.find("th, td").removeAttr("tabindex"),A&&(o=A.clone().prependTo(C),i=A.find("tr"),o=o.find("tr")),h||(b.width="100%",p[0].style.width="100%"),n.each(z(t,r),function(e,i){a=f(t,e),i.style.width=t.aoColumns[a].sWidth}),A&&pe(function(t){t.style.width=""},o),l.bCollapse&&""!==u&&(b.height=y[0].offsetHeight+S[0].offsetHeight+"px"),p=C.outerWidth(),""===h?(M.width="100%",L&&(C.find("tbody").height()>g.offsetHeight||"scroll"==y.css("overflow-y"))&&(M.width=be(C.outerWidth()-d))):""!==c?M.width=be(c):p==y.width()&&y.height()<C.height()?(M.width=be(p-d),C.outerWidth()>p-d&&(M.width=be(p))):M.width=be(p),p=C.outerWidth(),pe(R,s),pe(function(t){I.push(t.innerHTML),k.push(be(n(t).css("width")))},s),pe(function(t,e){t.style.width=k[e]},e),n(s).height(0),A&&(pe(R,o),pe(function(t){P.push(be(n(t).css("width")))},o),pe(function(t,e){t.style.width=P[e]},i),n(o).height(0)),pe(function(t,e){t.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+I[e]+"</div>",t.style.width=k[e]},s),A&&pe(function(t,e){t.innerHTML="",t.style.width=P[e]},o),C.outerWidth()<p?(i=g.scrollHeight>g.offsetHeight||"scroll"==y.css("overflow-y")?p+d:p,L&&(g.scrollHeight>g.offsetHeight||"scroll"==y.css("overflow-y"))&&(M.width=be(i-d)),(""===h||""!==c)&&Ie(t,1,"Possible column misalignment",6)):i="100%",b.width=be(i),m.width=be(i),A&&(t.nScrollFoot.style.width=be(i)),!u&&L&&(b.height=be(T.offsetHeight+d)),u&&l.bCollapse&&(b.height=be(u),l=h&&T.offsetWidth>g.offsetWidth?d:0,T.offsetHeight<g.offsetHeight&&(b.height=be(T.offsetHeight+l))),l=C.outerWidth(),_[0].style.width=be(l),v.width=be(l),_=C.height()>g.clientHeight||"scroll"==y.css("overflow-y"),D="padding"+(D.bScrollbarLeft?"Left":"Right"),v[D]=_?d+"px":"0px",A&&(x[0].style.width=be(l),w[0].style.width=be(l),w[0].style[D]=_?d+"px":"0px"),y.scroll(),(t.bSorted||t.bFiltered)&&(g.scrollTop=0)}function pe(t,e,i){for(var n,s,o=0,r=0,a=e.length;a>r;){for(n=e[r].firstChild,s=i?i[r].firstChild:null;n;)1===n.nodeType&&(i?t(n,s,o):t(n,o),o++),n=n.nextSibling,s=i?s.nextSibling:null;r++}}function fe(e){var i,s,o=e.nTable,r=e.aoColumns,a=e.oScroll,l=a.sY,h=a.sX,c=a.sXInner,u=r.length,a=v(e,"bVisible"),d=n("th",e.nTHead),f=o.getAttribute("width"),m=o.parentNode,_=!1;for(i=0;i<a.length;i++)s=r[a[i]],null!==s.sWidth&&(s.sWidth=ge(s.sWidthOrig,m),_=!0);if(_||h||l||u!=g(e)||u!=d.length){u=n(o.cloneNode(!1)).css("visibility","hidden").removeAttr("id").append(n(e.nTHead).clone(!1)).append(n(e.nTFoot).clone(!1)).append(n("<tbody><tr/></tbody>")),u.find("tfoot th, tfoot td").css("width","");var y=u.find("tbody tr"),d=z(e,u.find("thead")[0]);for(i=0;i<a.length;i++)s=r[a[i]],d[i].style.width=null!==s.sWidthOrig&&""!==s.sWidthOrig?be(s.sWidthOrig):"";if(e.aoData.length)for(i=0;i<a.length;i++)_=a[i],s=r[_],n(_e(e,_)).clone(!1).append(s.sContentPadding).appendTo(y);if(u.appendTo(m),h&&c?u.width(c):h?(u.css("width","auto"),u.width()<m.offsetWidth&&u.width(m.offsetWidth)):l?u.width(m.offsetWidth):f&&u.width(f),ve(e,u[0]),h){for(i=c=0;i<a.length;i++)s=r[a[i]],l=n(d[i]).outerWidth(),c+=null===s.sWidthOrig?l:parseInt(s.sWidth,10)+l-n(d[i]).width();u.width(be(c)),o.style.width=be(c)}for(i=0;i<a.length;i++)s=r[a[i]],(l=n(d[i]).width())&&(s.sWidth=be(l));o.style.width=be(u.css("width")),u.remove()}else for(i=0;u>i;i++)r[i].sWidth=be(d.eq(i).width());f&&(o.style.width=be(f)),!f&&!h||e._reszEvt||(n(t).bind("resize.DT-"+e.sInstance,me(function(){p(e)})),e._reszEvt=!0)}function me(t,e){var n,s,o=e||200;return function(){var e=this,r=+new Date,a=arguments;n&&n+o>r?(clearTimeout(s),s=setTimeout(function(){n=i,t.apply(e,a)},o)):n?(n=r,t.apply(e,a)):n=r}}function ge(t,i){if(!t)return 0;var s=n("<div/>").css("width",be(t)).appendTo(i||e.body),o=s[0].offsetWidth;return s.remove(),o}function ve(t,e){var i=t.oScroll;(i.sX||i.sY)&&(i=i.sX?0:i.iBarWidth,e.style.width=be(n(e).outerWidth()-i))}function _e(t,e){var i=ye(t,e);if(0>i)return null;var s=t.aoData[i];return s.nTr?s.anCells[e]:n("<td/>").html(x(t,i,e,"display"))[0]}function ye(t,e){for(var i,n=-1,s=-1,o=0,r=t.aoData.length;r>o;o++)i=x(t,o,e,"display")+"",i=i.replace(mi,""),i.length>n&&(n=i.length,s=o);return s}function be(t){return null===t?"0px":"number"==typeof t?0>t?"0px":t+"px":t.match(/\d$/)?t+"px":t}function we(){if(!$e.__scrollbarWidth){var t=n("<p/>").css({width:"100%",height:200,padding:0})[0],e=n("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(t).appendTo("body"),i=t.offsetWidth;e.css("overflow","scroll"),t=t.offsetWidth,i===t&&(t=e[0].clientWidth),e.remove(),$e.__scrollbarWidth=i-t}return $e.__scrollbarWidth}function xe(t){var e,i,s,o,r,a,l=[],h=t.aoColumns;e=t.aaSortingFixed,i=n.isPlainObject(e);var c=[];for(s=function(t){t.length&&!n.isArray(t[0])?c.push(t):c.push.apply(c,t)},n.isArray(e)&&s(e),i&&e.pre&&s(e.pre),s(t.aaSorting),i&&e.post&&s(e.post),t=0;t<c.length;t++)for(a=c[t][0],s=h[a].aDataSort,e=0,i=s.length;i>e;e++)o=s[e],r=h[o].sType||"string",l.push({src:a,col:o,dir:c[t][1],index:c[t][2],type:r,formatter:$e.ext.type.order[r+"-pre"]});return l}function Se(t){var e,i,n,s,o=[],r=$e.ext.type.order,a=t.aoData,l=0,h=t.aiDisplayMaster;for(_(t),s=xe(t),e=0,i=s.length;i>e;e++)n=s[e],n.formatter&&l++,De(t,n.col);if("ssp"!=ze(t)&&0!==s.length){for(e=0,i=h.length;i>e;e++)o[h[e]]=e;l===s.length?h.sort(function(t,e){var i,n,r,l,h=s.length,c=a[t]._aSortData,u=a[e]._aSortData;for(r=0;h>r;r++)if(l=s[r],i=c[l.col],n=u[l.col],i=n>i?-1:i>n?1:0,0!==i)return"asc"===l.dir?i:-i;return i=o[t],n=o[e],n>i?-1:i>n?1:0}):h.sort(function(t,e){var i,n,l,h,c=s.length,u=a[t]._aSortData,d=a[e]._aSortData;for(l=0;c>l;l++)if(h=s[l],i=u[h.col],n=d[h.col],h=r[h.type+"-"+h.dir]||r["string-"+h.dir],i=h(i,n),0!==i)return i;return i=o[t],n=o[e],n>i?-1:i>n?1:0})}t.bSorted=!0}function Ce(t){for(var e,i,n=t.aoColumns,s=xe(t),t=t.oLanguage.oAria,o=0,r=n.length;r>o;o++){i=n[o];var a=i.asSorting;e=i.sTitle.replace(/<.*?>/g,"");var l=i.nTh;l.removeAttribute("aria-sort"),i.bSortable&&(0<s.length&&s[0].col==o?(l.setAttribute("aria-sort","asc"==s[0].dir?"ascending":"descending"),i=a[s[0].index+1]||a[0]):i=a[0],e+="asc"===i?t.sSortAscending:t.sSortDescending),l.setAttribute("aria-label",e)}}function Te(t,e,s,o){var r=t.aaSorting,a=t.aoColumns[e].asSorting,l=function(t){var e=t._idx;return e===i&&(e=n.inArray(t[1],a)),e+1>=a.length?0:e+1};s&&t.oFeatures.bSortMulti?(s=n.inArray(e,ri(r,"0")),-1!==s?(e=l(r[s]),r[s][1]=a[e],r[s]._idx=e):(r.push([e,a[0],0]),r[r.length-1]._idx=0)):r.length&&r[0][0]==e?(e=l(r[0]),r.length=1,r[0][1]=a[e],r[0]._idx=e):(r.length=0,r.push([e,a[0]]),r[0]._idx=0),F(t),"function"==typeof o&&o(t)}function Me(t,e,i,n){var s=t.aoColumns[i];Oe(e,{},function(e){!1!==s.bSortable&&(t.oFeatures.bProcessing?(ce(t,!0),setTimeout(function(){Te(t,i,e.shiftKey,n),"ssp"!==ze(t)&&ce(t,!1)},0)):Te(t,i,e.shiftKey,n))})}function Ae(t){var e,i,s=t.aLastSort,o=t.oClasses.sSortColumn,r=xe(t),a=t.oFeatures;if(a.bSort&&a.bSortClasses){for(a=0,e=s.length;e>a;a++)i=s[a].src,n(ri(t.aoData,"anCells",i)).removeClass(o+(2>a?a+1:3));for(a=0,e=r.length;e>a;a++)i=r[a].src,n(ri(t.aoData,"anCells",i)).addClass(o+(2>a?a+1:3))}t.aLastSort=r}function De(t,e){var i,n=t.aoColumns[e],s=$e.ext.order[n.sSortDataType];s&&(i=s.call(t.oInstance,t,e,m(t,e)));for(var o,r=$e.ext.type.order[n.sType+"-pre"],a=0,l=t.aoData.length;l>a;a++)n=t.aoData[a],n._aSortData||(n._aSortData=[]),(!n._aSortData[e]||s)&&(o=s?i[a]:x(t,a,e,"sort"),n._aSortData[e]=r?r(o):o)}function Le(t){if(t.oFeatures.bStateSave&&!t.bDestroying){var e={iCreate:+new Date,iStart:t._iDisplayStart,iLength:t._iDisplayLength,aaSorting:n.extend(!0,[],t.aaSorting),oSearch:n.extend(!0,{},t.oPreviousSearch),aoSearchCols:n.extend(!0,[],t.aoPreSearchCols),abVisCols:ri(t.aoColumns,"bVisible")};Fe(t,"aoStateSaveParams","stateSaveParams",[t,e]),t.fnStateSaveCallback.call(t.oInstance,t,e)}}function ke(t){var e,i,s=t.aoColumns;if(t.oFeatures.bStateSave){var o=t.fnStateLoadCallback.call(t.oInstance,t);if(o&&(e=Fe(t,"aoStateLoadParams","stateLoadParams",[t,o]),-1===n.inArray(!1,e)&&(e=t.iStateDuration,!(e>0&&o.iCreate<+new Date-1e3*e)&&s.length===o.aoSearchCols.length))){t.oLoadedState=n.extend(!0,{},o),t._iDisplayStart=o.iStart,t.iInitDisplayStart=o.iStart,t._iDisplayLength=o.iLength,t.aaSorting=n.map(o.aaSorting,function(t){return t[0]>=s.length?[0,t[1]]:t
}),n.extend(t.oPreviousSearch,o.oSearch),n.extend(!0,t.aoPreSearchCols,o.aoSearchCols);var r=o.abVisCols;for(e=0,i=r.length;i>e;e++)s[e].bVisible=r[e];Fe(t,"aoStateLoaded","stateLoaded",[t,o])}}}function Pe(t){var e=$e.settings,t=n.inArray(t,ri(e,"nTable"));return-1!==t?e[t]:null}function Ie(e,i,n,s){if(n="DataTables warning: "+(null!==e?"table id="+e.sTableId+" - ":"")+n,s&&(n+=". For more information about this error, please see http://datatables.net/tn/"+s),i)t.console&&console.log&&console.log(n);else{if(e=$e.ext,"alert"!=(e.sErrMode||e.errMode))throw Error(n);alert(n)}}function Re(t,e,s,o){n.isArray(s)?n.each(s,function(i,s){n.isArray(s)?Re(t,e,s[0],s[1]):Re(t,e,s)}):(o===i&&(o=s),e[s]!==i&&(t[o]=e[s]))}function Ee(t,e,i){var s,o;for(o in e)e.hasOwnProperty(o)&&(s=e[o],n.isPlainObject(s)?(n.isPlainObject(t[o])||(t[o]={}),n.extend(!0,t[o],s)):t[o]=i&&"data"!==o&&"aaData"!==o&&n.isArray(s)?s.slice():s);return t}function Oe(t,e,i){n(t).bind("click.DT",e,function(e){t.blur(),i(e)}).bind("keypress.DT",e,function(t){13===t.which&&(t.preventDefault(),i(t))}).bind("selectstart.DT",function(){return!1})}function je(t,e,i,n){i&&t[e].push({fn:i,sName:n})}function Fe(t,e,i,s){var o=[];return e&&(o=n.map(t[e].slice().reverse(),function(e){return e.fn.apply(t.oInstance,s)})),null!==i&&n(t.nTable).trigger(i+".dt",s),o}function Ne(t){var e=t._iDisplayStart,i=t.fnDisplayEnd(),n=t._iDisplayLength;i===t.fnRecordsDisplay()&&(e=i-n),(-1===n||0>e)&&(e=0),t._iDisplayStart=e}function Be(t,e){var i=t.renderer,s=$e.ext.renderer[e];return n.isPlainObject(i)&&i[e]?s[i[e]]||s._:"string"==typeof i?s[i]||s._:s._}function ze(t){return t.oFeatures.bServerSide?"ssp":t.ajax||t.sAjaxSource?"ajax":"dom"}function Ue(t,e){var i=[],i=ki.numbers_length,n=Math.floor(i/2);return i>=e?i=li(0,e):n>=t?(i=li(0,i-2),i.push("ellipsis"),i.push(e-1)):(t>=e-1-n?i=li(e-(i-2),e):(i=li(t-1,t+2),i.push("ellipsis"),i.push(e-1)),i.splice(0,0,"ellipsis"),i.splice(0,0,0)),i.DT_el="span",i}function Ve(t){n.each({num:function(e){return Pi(e,t)},"num-fmt":function(e){return Pi(e,t,ti)},"html-num":function(e){return Pi(e,t,Je)},"html-num-fmt":function(e){return Pi(e,t,Je,ti)}},function(e,i){We.type.order[e+t+"-pre"]=i})}function He(t){return function(){var e=[Pe(this[$e.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return $e.ext.internal[t].apply(this,e)}}var $e,We,Ge,qe,Ze,Ye={},Xe=/[\r\n]/g,Je=/<.*?>/g,Ke=/^[\d\+\-a-zA-Z]/,Qe=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),ti=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ei=function(t){return t&&"-"!==t?!1:!0},ii=function(t){var e=parseInt(t,10);return!isNaN(e)&&isFinite(t)?e:null},ni=function(t,e){return Ye[e]||(Ye[e]=RegExp(K(e),"g")),"string"==typeof t?t.replace(/\./g,"").replace(Ye[e],"."):t},si=function(t,e,i){var n="string"==typeof t;return e&&n&&(t=ni(t,e)),i&&n&&(t=t.replace(ti,"")),!t||"-"===t||!isNaN(parseFloat(t))&&isFinite(t)},oi=function(t,e,i){return ei(t)?!0:t&&"string"!=typeof t?null:si(t.replace(Je,""),e,i)?!0:null},ri=function(t,e,n){var s=[],o=0,r=t.length;if(n!==i)for(;r>o;o++)t[o]&&t[o][e]&&s.push(t[o][e][n]);else for(;r>o;o++)t[o]&&s.push(t[o][e]);return s},ai=function(t,e,n,s){var o=[],r=0,a=e.length;if(s!==i)for(;a>r;r++)o.push(t[e[r]][n][s]);else for(;a>r;r++)o.push(t[e[r]][n]);return o},li=function(t,e){var n,s=[];e===i?(e=0,n=t):(n=e,e=t);for(var o=e;n>o;o++)s.push(o);return s},hi=function(t){var e,i,n,s=[],o=t.length,r=0;i=0;t:for(;o>i;i++){for(e=t[i],n=0;r>n;n++)if(s[n]===e)continue t;s.push(e),r++}return s},ci=function(t,e,n){t[e]!==i&&(t[n]=t[e])},ui=/\[.*?\]$/,di=/\(\)$/,pi=n("<div>")[0],fi=pi.textContent!==i,mi=/<.*?>/g;$e=function(t){this.$=function(t,e){return this.api(!0).$(t,e)},this._=function(t,e){return this.api(!0).rows(t,e).data()},this.api=function(t){return t?new Ge(Pe(this[We.iApiIndex])):new Ge(this)},this.fnAddData=function(t,e){var s=this.api(!0),o=n.isArray(t)&&(n.isArray(t[0])||n.isPlainObject(t[0]))?s.rows.add(t):s.row.add(t);return(e===i||e)&&s.draw(),o.flatten().toArray()},this.fnAdjustColumnSizing=function(t){var e=this.api(!0).columns.adjust(),n=e.settings()[0],s=n.oScroll;t===i||t?e.draw(!1):(""!==s.sX||""!==s.sY)&&de(n)},this.fnClearTable=function(t){var e=this.api(!0).clear();(t===i||t)&&e.draw()},this.fnClose=function(t){this.api(!0).row(t).child.hide()},this.fnDeleteRow=function(t,e,n){var s=this.api(!0),t=s.rows(t),o=t.settings()[0],r=o.aoData[t[0][0]];return t.remove(),e&&e.call(this,o,r),(n===i||n)&&s.draw(),r},this.fnDestroy=function(t){this.api(!0).destroy(t)},this.fnDraw=function(t){this.api(!0).draw(!t)},this.fnFilter=function(t,e,n,s,o,r){o=this.api(!0),null===e||e===i?o.search(t,n,s,r):o.column(e).search(t,n,s,r),o.draw()},this.fnGetData=function(t,e){var n=this.api(!0);if(t!==i){var s=t.nodeName?t.nodeName.toLowerCase():"";return e!==i||"td"==s||"th"==s?n.cell(t,e).data():n.row(t).data()||null}return n.data().toArray()},this.fnGetNodes=function(t){var e=this.api(!0);return t!==i?e.row(t).node():e.rows().nodes().flatten().toArray()},this.fnGetPosition=function(t){var e=this.api(!0),i=t.nodeName.toUpperCase();return"TR"==i?e.row(t).index():"TD"==i||"TH"==i?(t=e.cell(t).index(),[t.row,t.columnVisible,t.column]):null},this.fnIsOpen=function(t){return this.api(!0).row(t).child.isShown()},this.fnOpen=function(t,e,i){return this.api(!0).row(t).child(e,i).show().child()[0]},this.fnPageChange=function(t,e){var n=this.api(!0).page(t);(e===i||e)&&n.draw(!1)},this.fnSetColumnVis=function(t,e,n){t=this.api(!0).column(t).visible(e),(n===i||n)&&t.columns.adjust().draw()},this.fnSettings=function(){return Pe(this[We.iApiIndex])},this.fnSort=function(t){this.api(!0).order(t).draw()},this.fnSortListener=function(t,e,i){this.api(!0).order.listener(t,e,i)},this.fnUpdate=function(t,e,n,s,o){var r=this.api(!0);return n===i||null===n?r.row(e).data(t):r.cell(e,n).data(t),(o===i||o)&&r.columns.adjust(),(s===i||s)&&r.draw(),0},this.fnVersionCheck=We.fnVersionCheck;var e=this,s=t===i,c=this.length;s&&(t={}),this.oApi=this.internal=We.internal;for(var p in $e.ext.internal)p&&(this[p]=He(p));return this.each(function(){var p,f={},m=c>1?Ee(f,t,!0):t,g=0,v=this.getAttribute("id"),f=!1,_=$e.defaults;if("table"!=this.nodeName.toLowerCase())Ie(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{a(_),l(_.column),o(_,_,!0),o(_.column,_.column,!0),o(_,m);var x=$e.settings,g=0;for(p=x.length;p>g;g++){if(x[g].nTable==this){if(p=m.bRetrieve!==i?m.bRetrieve:_.bRetrieve,s||p)return x[g].oInstance;if(m.bDestroy!==i?m.bDestroy:_.bDestroy){x[g].oInstance.fnDestroy();break}return Ie(x[g],0,"Cannot reinitialise DataTable",3),void 0}if(x[g].sTableId==this.id){x.splice(g,1);break}}(null===v||""===v)&&(this.id=v="DataTables_Table_"+$e.ext._unique++);var S=n.extend(!0,{},$e.models.oSettings,{nTable:this,oApi:e.internal,oInit:m,sDestroyWidth:n(this)[0].style.width,sInstance:v,sTableId:v});x.push(S),S.oInstance=1===e.length?e:n(this).dataTable(),a(m),m.oLanguage&&r(m.oLanguage),m.aLengthMenu&&!m.iDisplayLength&&(m.iDisplayLength=n.isArray(m.aLengthMenu[0])?m.aLengthMenu[0][0]:m.aLengthMenu[0]),m=Ee(n.extend(!0,{},_),m),Re(S.oFeatures,m,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" ")),Re(S,m,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]),Re(S.oScroll,m,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]),Re(S.oLanguage,m,"fnInfoCallback"),je(S,"aoDrawCallback",m.fnDrawCallback,"user"),je(S,"aoServerParams",m.fnServerParams,"user"),je(S,"aoStateSaveParams",m.fnStateSaveParams,"user"),je(S,"aoStateLoadParams",m.fnStateLoadParams,"user"),je(S,"aoStateLoaded",m.fnStateLoaded,"user"),je(S,"aoRowCallback",m.fnRowCallback,"user"),je(S,"aoRowCreatedCallback",m.fnCreatedRow,"user"),je(S,"aoHeaderCallback",m.fnHeaderCallback,"user"),je(S,"aoFooterCallback",m.fnFooterCallback,"user"),je(S,"aoInitComplete",m.fnInitComplete,"user"),je(S,"aoPreDrawCallback",m.fnPreDrawCallback,"user"),v=S.oClasses,m.bJQueryUI?(n.extend(v,$e.ext.oJUIClasses,m.oClasses),m.sDom===_.sDom&&"lfrtip"===_.sDom&&(S.sDom='<"H"lfr>t<"F"ip>'),S.renderer?n.isPlainObject(S.renderer)&&!S.renderer.header&&(S.renderer.header="jqueryui"):S.renderer="jqueryui"):n.extend(v,$e.ext.classes,m.oClasses),n(this).addClass(v.sTable),(""!==S.oScroll.sX||""!==S.oScroll.sY)&&(S.oScroll.iBarWidth=we()),!0===S.oScroll.sX&&(S.oScroll.sX="100%"),S.iInitDisplayStart===i&&(S.iInitDisplayStart=m.iDisplayStart,S._iDisplayStart=m.iDisplayStart),null!==m.iDeferLoading&&(S.bDeferLoading=!0,g=n.isArray(m.iDeferLoading),S._iRecordsDisplay=g?m.iDeferLoading[0]:m.iDeferLoading,S._iRecordsTotal=g?m.iDeferLoading[1]:m.iDeferLoading),""!==m.oLanguage.sUrl?(S.oLanguage.sUrl=m.oLanguage.sUrl,n.getJSON(S.oLanguage.sUrl,null,function(t){r(t),o(_.oLanguage,t),n.extend(!0,S.oLanguage,m.oLanguage,t),ne(S)}),f=!0):n.extend(!0,S.oLanguage,m.oLanguage),null===m.asStripeClasses&&(S.asStripeClasses=[v.sStripeOdd,v.sStripeEven]);var g=S.asStripeClasses,C=n("tbody tr:eq(0)",this);-1!==n.inArray(!0,n.map(g,function(t){return C.hasClass(t)}))&&(n("tbody tr",this).removeClass(g.join(" ")),S.asDestroyStripes=g.slice());var T,x=[],g=this.getElementsByTagName("thead");if(0!==g.length&&(B(S.aoHeader,g[0]),x=z(S)),null===m.aoColumns)for(T=[],g=0,p=x.length;p>g;g++)T.push(null);else T=m.aoColumns;for(g=0,p=T.length;p>g;g++)u(S,x?x[g]:null);if(y(S,m.aoColumnDefs,T,function(t,e){d(S,t,e)}),C.length){var M=function(t,e){return t.getAttribute("data-"+e)?e:null};n.each(P(S,C[0]).cells,function(t,e){var n=S.aoColumns[t];if(n.mData===t){var s=M(e,"sort")||M(e,"order"),o=M(e,"filter")||M(e,"search");(null!==s||null!==o)&&(n.mData={_:t+".display",sort:null!==s?t+".@data-"+s:i,type:null!==s?t+".@data-"+s:i,filter:null!==o?t+".@data-"+o:i},d(S,t))}})}var A=S.oFeatures;if(m.bStateSave&&(A.bStateSave=!0,ke(S,m),je(S,"aoDrawCallback",Le,"state_save")),m.aaSorting===i)for(x=S.aaSorting,g=0,p=x.length;p>g;g++)x[g][1]=S.aoColumns[g].asSorting[0];if(Ae(S),A.bSort&&je(S,"aoDrawCallback",function(){if(S.bSorted){var t=xe(S),e={};n.each(t,function(t,i){e[i.src]=i.dir}),Fe(S,null,"order",[S,t,e]),Ce(S)}}),je(S,"aoDrawCallback",function(){(S.bSorted||"ssp"===ze(S)||A.bDeferRender)&&Ae(S)},"sc"),h(S),g=n(this).children("caption").each(function(){this._captionSide=n(this).css("caption-side")}),p=n(this).children("thead"),0===p.length&&(p=n("<thead/>").appendTo(this)),S.nTHead=p[0],p=n(this).children("tbody"),0===p.length&&(p=n("<tbody/>").appendTo(this)),S.nTBody=p[0],p=n(this).children("tfoot"),0===p.length&&0<g.length&&(""!==S.oScroll.sX||""!==S.oScroll.sY)&&(p=n("<tfoot/>").appendTo(this)),0===p.length||0===p.children().length?n(this).addClass(v.sNoFooter):0<p.length&&(S.nTFoot=p[0],B(S.aoFooter,S.nTFoot)),m.aaData)for(g=0;g<m.aaData.length;g++)b(S,m.aaData[g]);else(S.bDeferLoading||"dom"==ze(S))&&w(S,n(S.nTBody).children("tr"));S.aiDisplay=S.aiDisplayMaster.slice(),S.bInitialised=!0,!1===f&&ne(S)}}),e=null,this};var gi=[],vi=Array.prototype,_i=function(t){var e,i,s=$e.settings,o=n.map(s,function(t){return t.nTable});return t?t.nTable&&t.oApi?[t]:t.nodeName&&"table"===t.nodeName.toLowerCase()?(e=n.inArray(t,o),-1!==e?[s[e]]:null):t&&"function"==typeof t.settings?t.settings().toArray():("string"==typeof t?i=n(t):t instanceof n&&(i=t),i?i.map(function(){return e=n.inArray(this,o),-1!==e?s[e]:null}).toArray():void 0):[]};$e.Api=Ge=function(t,e){if(!this instanceof Ge)throw"DT API must be constructed as a new object";var i=[],s=function(t){(t=_i(t))&&i.push.apply(i,t)};if(n.isArray(t))for(var o=0,r=t.length;r>o;o++)s(t[o]);else s(t);this.context=hi(i),e&&this.push.apply(this,e.toArray?e.toArray():e),this.selector={rows:null,cols:null,opts:null},Ge.extend(this,this,gi)},Ge.prototype={concat:vi.concat,context:[],each:function(t){if(vi.forEach)vi.forEach.call(this,t,this);else for(var e=0,i=this.length;i>e;e++)t.call(this,this[e],e,this);return this},eq:function(t){var e=this.context;return e.length>t?new Ge(e[t],this[t]):null},filter:function(t){var e=[];if(vi.filter)e=vi.filter.call(this,t,this);else for(var i=0,n=this.length;n>i;i++)t.call(this,this[i],i,this)&&e.push(this[i]);return new Ge(this.context,e)},flatten:function(){var t=[];return new Ge(this.context,t.concat.apply(t,this.toArray()))},join:vi.join,indexOf:vi.indexOf||function(t,e){for(var i=e||0,n=this.length;n>i;i++)if(this[i]===t)return i;return-1},iterator:function(t,e,n){var s,o,r,a,l,h,c,u=[],d=this.context,p=this.selector;for("string"==typeof t&&(n=e,e=t,t=!1),o=0,r=d.length;r>o;o++)if("table"===e)s=n(d[o],o),s!==i&&u.push(s);else if("columns"===e||"rows"===e)s=n(d[o],this[o],o),s!==i&&u.push(s);else if("column"===e||"column-rows"===e||"row"===e||"cell"===e)for(c=this[o],"column-rows"===e&&(h=Si(d[o],p.opts)),a=0,l=c.length;l>a;a++)s=c[a],s="cell"===e?n(d[o],s.row,s.column,o,a):n(d[o],s,o,a,h),s!==i&&u.push(s);return u.length?(t=new Ge(d,t?u.concat.apply([],u):u),e=t.selector,e.rows=p.rows,e.cols=p.cols,e.opts=p.opts,t):this},lastIndexOf:vi.lastIndexOf||function(){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(t){var e=[];if(vi.map)e=vi.map.call(this,t,this);else for(var i=0,n=this.length;n>i;i++)e.push(t.call(this,this[i],i));return new Ge(this.context,e)},pluck:function(t){return this.map(function(e){return e[t]})},pop:vi.pop,push:vi.push,reduce:vi.reduce||function(t,e){return c(this,t,e,0,this.length,1)},reduceRight:vi.reduceRight||function(t,e){return c(this,t,e,this.length-1,-1,-1)},reverse:vi.reverse,selector:null,shift:vi.shift,sort:vi.sort,splice:vi.splice,toArray:function(){return vi.slice.call(this)},to$:function(){return n(this)},toJQuery:function(){return n(this)},unique:function(){return new Ge(this.context,hi(this))},unshift:vi.unshift},Ge.extend=function(t,e,i){if(e&&(e instanceof Ge||e.__dt_wrapper)){var s,o,r,a=function(e,i){return function(){var n=e.apply(t,arguments);return Ge.extend(n,n,i.methodExt),n}};for(s=0,o=i.length;o>s;s++)r=i[s],e[r.name]="function"==typeof r.val?a(r.val,r):n.isPlainObject(r.val)?{}:r.val,e[r.name].__dt_wrapper=!0,Ge.extend(t,e[r.name],r.propExt)}},Ge.register=qe=function(t,e){if(n.isArray(t))for(var i=0,s=t.length;s>i;i++)Ge.register(t[i],e);else{for(var o,r,a=t.split("."),l=gi,i=0,s=a.length;s>i;i++){o=(r=-1!==a[i].indexOf("()"))?a[i].replace("()",""):a[i];var h;t:{h=0;for(var c=l.length;c>h;h++)if(l[h].name===o){h=l[h];break t}h=null}h||(h={name:o,val:{},methodExt:[],propExt:[]},l.push(h)),i===s-1?h.val=e:l=r?h.methodExt:h.propExt}Ge.ready&&$e.api.build()}},Ge.registerPlural=Ze=function(t,e,s){Ge.register(t,s),Ge.register(e,function(){var t=s.apply(this,arguments);return t===this?this:t instanceof Ge?t.length?n.isArray(t[0])?new Ge(t.context,t[0]):t[0]:i:t})},qe("tables()",function(t){var e;if(t){e=Ge;var i=this.context;if("number"==typeof t)t=[i[t]];else var s=n.map(i,function(t){return t.nTable}),t=n(s).filter(t).map(function(){var t=n.inArray(this,s);return i[t]}).toArray();e=new e(t)}else e=this;return e}),qe("table()",function(t){var t=this.tables(t),e=t.context;return e.length?new Ge(e[0]):t}),Ze("tables().nodes()","table().node()",function(){return this.iterator("table",function(t){return t.nTable})}),Ze("tables().body()","table().body()",function(){return this.iterator("table",function(t){return t.nTBody})}),Ze("tables().header()","table().header()",function(){return this.iterator("table",function(t){return t.nTHead})}),Ze("tables().footer()","table().footer()",function(){return this.iterator("table",function(t){return t.nTFoot})}),qe("draw()",function(t){return this.iterator("table",function(e){F(e,!1===t)})}),qe("page()",function(t){return t===i?this.page.info().page:this.iterator("table",function(e){le(e,t)})}),qe("page.info()",function(){if(0===this.context.length)return i;var t=this.context[0],e=t._iDisplayStart,n=t._iDisplayLength,s=t.fnRecordsDisplay(),o=-1===n;return{page:o?0:Math.floor(e/n),pages:o?1:Math.ceil(s/n),start:e,end:t.fnDisplayEnd(),length:n,recordsTotal:t.fnRecordsTotal(),recordsDisplay:s}}),qe("page.len()",function(t){return t===i?0!==this.context.length?this.context[0]._iDisplayLength:i:this.iterator("table",function(e){oe(e,t)})});var yi=function(t,e,i){if("ssp"==ze(t)?F(t,e):(ce(t,!0),U(t,[],function(i){D(t);for(var i=W(t,i),n=0,s=i.length;s>n;n++)b(t,i[n]);F(t,e),ce(t,!1)})),i){var n=new Ge(t);n.one("draw",function(){i(n.ajax.json())})}};qe("ajax.json()",function(){var t=this.context;return 0<t.length?t[0].json:void 0}),qe("ajax.params()",function(){var t=this.context;return 0<t.length?t[0].oAjaxData:void 0}),qe("ajax.reload()",function(t,e){return this.iterator("table",function(i){yi(i,!1===e,t)})}),qe("ajax.url()",function(t){var e=this.context;return t===i?0===e.length?i:(e=e[0],e.ajax?n.isPlainObject(e.ajax)?e.ajax.url:e.ajax:e.sAjaxSource):this.iterator("table",function(e){n.isPlainObject(e.ajax)?e.ajax.url=t:e.ajax=t})}),qe("ajax.url().load()",function(t,e){return this.iterator("table",function(i){yi(i,!1===e,t)})});var bi=function(t,e){var s,o,r,a,l,h,c=[];for(t&&"string"!=typeof t&&t.length!==i||(t=[t]),r=0,a=t.length;a>r;r++)for(o=t[r]&&t[r].split?t[r].split(","):[t[r]],l=0,h=o.length;h>l;l++)(s=e("string"==typeof o[l]?n.trim(o[l]):o[l]))&&s.length&&c.push.apply(c,s);return c},wi=function(t){return t||(t={}),t.filter&&!t.search&&(t.search=t.filter),{search:t.search||"none",order:t.order||"current",page:t.page||"all"}},xi=function(t){for(var e=0,i=t.length;i>e;e++)if(0<t[e].length)return t[0]=t[e],t.length=1,t.context=[t.context[e]],t;return t.length=0,t},Si=function(t,e){var i,s,o,r=[],a=t.aiDisplay;i=t.aiDisplayMaster;var l=e.search;if(s=e.order,o=e.page,"ssp"==ze(t))return"removed"===l?[]:li(0,i.length);if("current"==o)for(i=t._iDisplayStart,s=t.fnDisplayEnd();s>i;i++)r.push(a[i]);else if("current"==s||"applied"==s)r="none"==l?i.slice():"applied"==l?a.slice():n.map(i,function(t){return-1===n.inArray(t,a)?t:null});else if("index"==s||"original"==s)for(i=0,s=t.aoData.length;s>i;i++)"none"==l?r.push(i):(o=n.inArray(i,a),(-1===o&&"removed"==l||1===o&&"applied"==l)&&r.push(i));return r};qe("rows()",function(t,e){t===i?t="":n.isPlainObject(t)&&(e=t,t="");var e=wi(e),s=this.iterator("table",function(i){var s=e;return bi(t,function(t){var e=ii(t);if(null!==e&&!s)return[e];var o=Si(i,s);if(null!==e&&-1!==n.inArray(e,o))return[e];if(!t)return o;for(var e=[],r=0,a=o.length;a>r;r++)e.push(i.aoData[o[r]].nTr);return t.nodeName&&-1!==n.inArray(t,e)?[t._DT_RowIndex]:n(e).filter(t).map(function(){return this._DT_RowIndex}).toArray()})});return s.selector.rows=t,s.selector.opts=e,s}),qe("rows().nodes()",function(){return this.iterator("row",function(t,e){return t.aoData[e].nTr||i})}),qe("rows().data()",function(){return this.iterator(!0,"rows",function(t,e){return ai(t.aoData,e,"_aData")})}),Ze("rows().cache()","row().cache()",function(t){return this.iterator("row",function(e,i){var n=e.aoData[i];return"search"===t?n._aFilterData:n._aSortData})}),Ze("rows().invalidate()","row().invalidate()",function(t){return this.iterator("row",function(e,i){k(e,i,t)})}),Ze("rows().indexes()","row().index()",function(){return this.iterator("row",function(t,e){return e})}),Ze("rows().remove()","row().remove()",function(){var t=this;return this.iterator("row",function(e,i,s){var o=e.aoData;o.splice(i,1);for(var r=0,a=o.length;a>r;r++)null!==o[r].nTr&&(o[r].nTr._DT_RowIndex=r);n.inArray(i,e.aiDisplay),L(e.aiDisplayMaster,i),L(e.aiDisplay,i),L(t[s],i,!1),Ne(e)})}),qe("rows.add()",function(t){var e=this.iterator("table",function(e){var i,n,s,o=[];for(n=0,s=t.length;s>n;n++)i=t[n],i.nodeName&&"TR"===i.nodeName.toUpperCase()?o.push(w(e,i)[0]):o.push(b(e,i));return o}),i=this.rows(-1);return i.pop(),i.push.apply(i,e.toArray()),i}),qe("row()",function(t,e){return xi(this.rows(t,e))}),qe("row().data()",function(t){var e=this.context;return t===i?e.length&&this.length?e[0].aoData[this[0]]._aData:i:(e[0].aoData[this[0]]._aData=t,k(e[0],this[0],"data"),this)}),qe("row().node()",function(){var t=this.context;return t.length&&this.length?t[0].aoData[this[0]].nTr||null:null}),qe("row.add()",function(t){t instanceof n&&t.length&&(t=t[0]);var e=this.iterator("table",function(e){return t.nodeName&&"TR"===t.nodeName.toUpperCase()?w(e,t)[0]:b(e,t)});return this.row(e[0])});var Ci=function(t){var e=this.context;if(e.length&&this.length){var i=e[0].aoData[this[0]];if(i._details){(i._detailsShow=t)?i._details.insertAfter(i.nTr):i._details.remove();var n=e[0],s=new Ge(n);s.off("draw.dt.DT_details column-visibility.dt.DT_details"),0<ri(n.aoData,"_details").length&&(s.on("draw.dt.DT_details",function(){s.rows({page:"current"}).eq(0).each(function(t){t=n.aoData[t],t._detailsShow&&t._details.insertAfter(t.nTr)})}),s.on("column-visibility.dt.DT_details",function(t,e){for(var i,n=g(e),s=0,o=e.aoData.length;o>s;s++)i=e.aoData[s],i._details&&i._details.children("td[colspan]").attr("colspan",n)}))}}return this};qe("row().child()",function(t,e){var s=this.context;if(t===i)return s.length&&this.length?s[0].aoData[this[0]]._details:i;if(s.length&&this.length){var o=s[0],s=s[0].aoData[this[0]],r=[],a=function(t,e){if(t.nodeName&&"tr"===t.nodeName.toLowerCase())r.push(t);else{var i=n("<tr><td/></tr>");n("td",i).addClass(e).html(t)[0].colSpan=g(o),r.push(i[0])}};if(n.isArray(t)||t instanceof n)for(var l=0,h=t.length;h>l;l++)a(t[l],e);else a(t,e);s._details&&s._details.remove(),s._details=n(r),s._detailsShow&&s._details.insertAfter(s.nTr)}return this}),qe(["row().child.show()","row().child().show()"],function(){return Ci.call(this,!0),this}),qe(["row().child.hide()","row().child().hide()"],function(){return Ci.call(this,!1),this}),qe("row().child.isShown()",function(){var t=this.context;return t.length&&this.length?t[0].aoData[this[0]]._detailsShow||!1:!1});var Ti=/^(.*):(name|visIdx|visible)$/;qe("columns()",function(t,e){t===i?t="":n.isPlainObject(t)&&(e=t,t="");var e=wi(e),s=this.iterator("table",function(e){var i=t,s=e.aoColumns,o=ri(s,"sName"),r=ri(s,"nTh");return bi(i,function(t){var i=ii(t);if(""===t)return li(s.length);if(null!==i)return[i>=0?i:s.length+i];var a="string"==typeof t?t.match(Ti):"";if(!a)return n(r).filter(t).map(function(){return n.inArray(this,r)}).toArray();switch(a[2]){case"visIdx":case"visible":return t=parseInt(a[1],10),0>t?(i=n.map(s,function(t,e){return t.bVisible?e:null}),[i[i.length+t]]):[f(e,t)];case"name":return n.map(o,function(t,e){return t===a[1]?e:null})}})});return s.selector.cols=t,s.selector.opts=e,s}),Ze("columns().header()","column().header()",function(){return this.iterator("column",function(t,e){return t.aoColumns[e].nTh})}),Ze("columns().footer()","column().footer()",function(){return this.iterator("column",function(t,e){return t.aoColumns[e].nTf})}),Ze("columns().data()","column().data()",function(){return this.iterator("column-rows",function(t,e,i,n,s){for(var i=[],n=0,o=s.length;o>n;n++)i.push(x(t,s[n],e,""));return i})}),Ze("columns().cache()","column().cache()",function(t){return this.iterator("column-rows",function(e,i,n,s,o){return ai(e.aoData,o,"search"===t?"_aFilterData":"_aSortData",i)})}),Ze("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(t,e,i,n,s){return ai(t.aoData,s,"anCells",e)})}),Ze("columns().visible()","column().visible()",function(t){return this.iterator("column",function(e,s){var o;if(t===i)o=e.aoColumns[s].bVisible;else{var r=e.aoColumns;o=r[s];var a,l,h,c=e.aoData;if(t===i)o=o.bVisible;else{if(o.bVisible!==t){if(t){var u=n.inArray(!0,ri(r,"bVisible"),s+1);for(a=0,l=c.length;l>a;a++)h=c[a].nTr,r=c[a].anCells,h&&h.insertBefore(r[s],r[u]||null)}else n(ri(e.aoData,"anCells",s)).detach(),o.bVisible=!1,O(e,e.aoHeader),O(e,e.aoFooter),Le(e);o.bVisible=t,O(e,e.aoHeader),O(e,e.aoFooter),p(e),(e.oScroll.sX||e.oScroll.sY)&&de(e),Fe(e,null,"column-visibility",[e,s,t]),Le(e)}o=void 0}}return o})}),Ze("columns().indexes()","column().index()",function(t){return this.iterator("column",function(e,i){return"visible"===t?m(e,i):i})}),qe("columns.adjust()",function(){return this.iterator("table",function(t){p(t)})}),qe("column.index()",function(t,e){if(0!==this.context.length){var i=this.context[0];if("fromVisible"===t||"toData"===t)return f(i,e);if("fromData"===t||"toVisible"===t)return m(i,e)}}),qe("column()",function(t,e){return xi(this.columns(t,e))}),qe("cells()",function(t,e,s){if(n.isPlainObject(t)&&(t.row?(s=e,e=null):(s=t,t=null)),n.isPlainObject(e)&&(s=e,e=null),null===e||e===i)return this.iterator("table",function(e){var i,o,r,a,l,h=t,c=wi(s),u=e.aoData,d=Si(e,c),c=ai(u,d,"anCells"),p=n([].concat.apply([],c)),f=e.aoColumns.length;return bi(h,function(t){if(!t){for(o=[],r=0,a=d.length;a>r;r++)for(i=d[r],l=0;f>l;l++)o.push({row:i,column:l});return o}return n.isPlainObject(t)?[t]:p.filter(t).map(function(t,e){return i=e.parentNode._DT_RowIndex,{row:i,column:n.inArray(e,u[i].anCells)}}).toArray()})});var o,r,a,l,h,c=this.columns(e,s),u=this.rows(t,s),d=this.iterator("table",function(t,e){for(o=[],r=0,a=u[e].length;a>r;r++)for(l=0,h=c[e].length;h>l;l++)o.push({row:u[e][r],column:c[e][l]});return o});return n.extend(d.selector,{cols:e,rows:t,opts:s}),d}),Ze("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(t,e,i){return t.aoData[e].anCells[i]})}),qe("cells().data()",function(){return this.iterator("cell",function(t,e,i){return x(t,e,i)})}),Ze("cells().cache()","cell().cache()",function(t){return t="search"===t?"_aFilterData":"_aSortData",this.iterator("cell",function(e,i,n){return e.aoData[i][t][n]})}),Ze("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(t,e,i){return{row:e,column:i,columnVisible:m(t,i)}})}),qe(["cells().invalidate()","cell().invalidate()"],function(t){var e=this.selector;return this.rows(e.rows,e.opts).invalidate(t),this}),qe("cell()",function(t,e,i){return xi(this.cells(t,e,i))}),qe("cell().data()",function(t){var e=this.context,n=this[0];return t===i?e.length&&n.length?x(e[0],n[0].row,n[0].column):i:(S(e[0],n[0].row,n[0].column,t),k(e[0],n[0].row,"data",n[0].column),this)}),qe("order()",function(t,e){var s=this.context;return t===i?0!==s.length?s[0].aaSorting:i:("number"==typeof t?t=[[t,e]]:n.isArray(t[0])||(t=Array.prototype.slice.call(arguments)),this.iterator("table",function(e){e.aaSorting=t.slice()}))}),qe("order.listener()",function(t,e,i){return this.iterator("table",function(n){Me(n,t,e,i)})}),qe(["columns().order()","column().order()"],function(t){var e=this;return this.iterator("table",function(i,s){var o=[];n.each(e[s],function(e,i){o.push([i,t])}),i.aaSorting=o})}),qe("search()",function(t,e,s,o){var r=this.context;return t===i?0!==r.length?r[0].oPreviousSearch.sSearch:i:this.iterator("table",function(i){i.oFeatures.bFilter&&q(i,n.extend({},i.oPreviousSearch,{sSearch:t+"",bRegex:null===e?!1:e,bSmart:null===s?!0:s,bCaseInsensitive:null===o?!0:o}),1)})}),qe(["columns().search()","column().search()"],function(t,e,s,o){return this.iterator("column",function(r,a){var l=r.aoPreSearchCols;return t===i?l[a].sSearch:(r.oFeatures.bFilter&&(n.extend(l[a],{sSearch:t+"",bRegex:null===e?!1:e,bSmart:null===s?!0:s,bCaseInsensitive:null===o?!0:o}),q(r,r.oPreviousSearch,1)),void 0)})}),$e.versionCheck=$e.fnVersionCheck=function(t){for(var e,i,n=$e.version.split("."),t=t.split("."),s=0,o=t.length;o>s;s++)if(e=parseInt(n[s],10)||0,i=parseInt(t[s],10)||0,e!==i)return e>i;return!0},$e.isDataTable=$e.fnIsDataTable=function(t){var e=n(t).get(0),i=!1;return n.each($e.settings,function(t,n){(n.nTable===e||n.nScrollHead===e||n.nScrollFoot===e)&&(i=!0)}),i},$e.tables=$e.fnTables=function(t){return jQuery.map($e.settings,function(e){return!t||t&&n(e.nTable).is(":visible")?e.nTable:void 0})},$e.camelToHungarian=o,qe("$()",function(t,e){var i=this.rows(e).nodes(),i=n(i);return n([].concat(i.filter(t).toArray(),i.find(t).toArray()))}),n.each(["on","one","off"],function(t,e){qe(e+"()",function(){var t=Array.prototype.slice.call(arguments);-1===t[0].indexOf(".dt")&&(t[0]+=".dt");var i=n(this.tables().nodes());return i[e].apply(i,t),this})}),qe("clear()",function(){return this.iterator("table",function(t){D(t)})}),qe("settings()",function(){return new Ge(this.context,this.context)}),qe("data()",function(){return this.iterator("table",function(t){return ri(t.aoData,"_aData")}).flatten()}),qe("destroy()",function(e){return e=e||!1,this.iterator("table",function(i){var s,o=i.nTableWrapper.parentNode,r=i.oClasses,a=i.nTable,l=i.nTBody,h=i.nTHead,c=i.nTFoot,u=n(a),l=n(l),d=n(i.nTableWrapper),p=n.map(i.aoData,function(t){return t.nTr});i.bDestroying=!0,Fe(i,"aoDestroyCallback","destroy",[i]),e||new Ge(i).columns().visible(!0),d.unbind(".DT").find(":not(tbody *)").unbind(".DT"),n(t).unbind(".DT-"+i.sInstance),a!=h.parentNode&&(u.children("thead").detach(),u.append(h)),c&&a!=c.parentNode&&(u.children("tfoot").detach(),u.append(c)),u.detach(),d.detach(),i.aaSorting=[],i.aaSortingFixed=[],Ae(i),n(p).removeClass(i.asStripeClasses.join(" ")),n("th, td",h).removeClass(r.sSortable+" "+r.sSortableAsc+" "+r.sSortableDesc+" "+r.sSortableNone),i.bJUI&&(n("th span."+r.sSortIcon+", td span."+r.sSortIcon,h).detach(),n("th, td",h).each(function(){var t=n("div."+r.sSortJUIWrapper,this);n(this).append(t.contents()),t.detach()})),!e&&o&&o.insertBefore(a,i.nTableReinsertBefore),l.children().detach(),l.append(p),u.css("width",i.sDestroyWidth).removeClass(r.sTable),(s=i.asDestroyStripes.length)&&l.children().each(function(t){n(this).addClass(i.asDestroyStripes[t%s])}),o=n.inArray(i,$e.settings),-1!==o&&$e.settings.splice(o,1)})}),$e.version="1.10.0",$e.settings=[],$e.models={},$e.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0},$e.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null},$e.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null},$e.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(t){try{return JSON.parse((-1===t.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+t.sInstance+"_"+location.pathname))}catch(e){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(t,e){try{(-1===t.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+t.sInstance+"_"+location.pathname,JSON.stringify(e))}catch(i){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oSearch:n.extend({},$e.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null},s($e.defaults),$e.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null},s($e.defaults.column),$e.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:i,oAjaxData:i,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ze(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length
},fnRecordsDisplay:function(){return"ssp"==ze(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var t=this._iDisplayLength,e=this._iDisplayStart,i=e+t,n=this.aiDisplay.length,s=this.oFeatures,o=s.bPaginate;return s.bServerSide?!1===o||-1===t?e+n:Math.min(e+t,this._iRecordsDisplay):!o||i>n||-1===t?n:i},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}},$e.ext=We={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:$e.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:$e.version},n.extend(We,{afnFiltering:We.search,aTypes:We.type.detect,ofnSearch:We.type.search,oSort:We.type.order,afnSortData:We.order,aoFeatures:We.feature,oApi:We.internal,oStdClasses:We.classes,oPagination:We.pager}),n.extend($e.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Mi="",Mi="",Ai=Mi+"ui-state-default",Di=Mi+"css_right ui-icon ui-icon-",Li=Mi+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";n.extend($e.ext.oJUIClasses,$e.ext.classes,{sPageButton:"fg-button ui-button "+Ai,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:Ai+" sorting_asc",sSortDesc:Ai+" sorting_desc",sSortable:Ai+" sorting",sSortableAsc:Ai+" sorting_asc_disabled",sSortableDesc:Ai+" sorting_desc_disabled",sSortableNone:Ai+" sorting_disabled",sSortJUIAsc:Di+"triangle-1-n",sSortJUIDesc:Di+"triangle-1-s",sSortJUI:Di+"carat-2-n-s",sSortJUIAscAllowed:Di+"carat-1-n",sSortJUIDescAllowed:Di+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+Ai,sScrollFoot:"dataTables_scrollFoot "+Ai,sHeaderTH:Ai,sFooterTH:Ai,sJUIHeader:Li+" ui-corner-tl ui-corner-tr",sJUIFooter:Li+" ui-corner-bl ui-corner-br"});var ki=$e.ext.pager;n.extend(ki,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},simple_numbers:function(t,e){return["previous",Ue(t,e),"next"]},full_numbers:function(t,e){return["first","previous",Ue(t,e),"next","last"]},_numbers:Ue,numbers_length:7}),n.extend(!0,$e.ext.renderer,{pageButton:{_:function(t,i,s,o,r,a){var l,h,c=t.oClasses,u=t.oLanguage.oPaginate,d=0,p=function(e,i){var o,f,m,g,v=function(e){le(t,e.data.action,!0)};for(o=0,f=i.length;f>o;o++)if(g=i[o],n.isArray(g))m=n("<"+(g.DT_el||"div")+"/>").appendTo(e),p(m,g);else{switch(h=l="",g){case"ellipsis":e.append("<span>&hellip;</span>");break;case"first":l=u.sFirst,h=g+(r>0?"":" "+c.sPageButtonDisabled);break;case"previous":l=u.sPrevious,h=g+(r>0?"":" "+c.sPageButtonDisabled);break;case"next":l=u.sNext,h=g+(a-1>r?"":" "+c.sPageButtonDisabled);break;case"last":l=u.sLast,h=g+(a-1>r?"":" "+c.sPageButtonDisabled);break;default:l=g+1,h=r===g?c.sPageButtonActive:""}l&&(m=n("<a>",{"class":c.sPageButton+" "+h,"aria-controls":t.sTableId,"data-dt-idx":d,tabindex:t.iTabIndex,id:0===s&&"string"==typeof g?t.sTableId+"_"+g:null}).html(l).appendTo(e),Oe(m,{action:g},v),d++)}},f=n(e.activeElement).data("dt-idx");p(n(i).empty(),o),null!==f&&n(i).find("[data-dt-idx="+f+"]").focus()}}});var Pi=function(t,e,i,n){return t&&"-"!==t?(e&&(t=ni(t,e)),t.replace&&(i&&(t=t.replace(i,"")),n&&(t=t.replace(n,""))),1*t):-1/0};return n.extend(We.type.order,{"date-pre":function(t){return Date.parse(t)||0},"html-pre":function(t){return t?t.replace?t.replace(/<.*?>/g,"").toLowerCase():t+"":""},"string-pre":function(t){return"string"==typeof t?t.toLowerCase():t&&t.toString?t.toString():""},"string-asc":function(t,e){return e>t?-1:t>e?1:0},"string-desc":function(t,e){return e>t?1:t>e?-1:0}}),Ve(""),n.extend($e.ext.type.detect,[function(t,e){var i=e.oLanguage.sDecimal;return si(t,i)?"num"+i:null},function(t){if(t&&!Ke.test(t))return null;var e=Date.parse(t);return null!==e&&!isNaN(e)||ei(t)?"date":null},function(t,e){var i=e.oLanguage.sDecimal;return si(t,i,!0)?"num-fmt"+i:null},function(t,e){var i=e.oLanguage.sDecimal;return oi(t,i)?"html-num"+i:null},function(t,e){var i=e.oLanguage.sDecimal;return oi(t,i,!0)?"html-num-fmt"+i:null},function(t){return ei(t)||"string"==typeof t&&-1!==t.indexOf("<")?"html":null}]),n.extend($e.ext.type.search,{html:function(t){return ei(t)?"":"string"==typeof t?t.replace(Xe," ").replace(Je,""):""},string:function(t){return ei(t)?"":"string"==typeof t?t.replace(Xe," "):t}}),n.extend(!0,$e.ext.renderer,{header:{_:function(t,e,i,s){n(t.nTable).on("order.dt.DT",function(t,n,o,r){t=i.idx,e.removeClass(i.sSortingClass+" "+s.sSortAsc+" "+s.sSortDesc).addClass("asc"==r[t]?s.sSortAsc:"desc"==r[t]?s.sSortDesc:i.sSortingClass)})},jqueryui:function(t,e,i,s){var o=i.idx;n("<div/>").addClass(s.sSortJUIWrapper).append(e.contents()).append(n("<span/>").addClass(s.sSortIcon+" "+i.sSortingClassJUI)).appendTo(e),n(t.nTable).on("order.dt.DT",function(t,n,r,a){e.removeClass(s.sSortAsc+" "+s.sSortDesc).addClass("asc"==a[o]?s.sSortAsc:"desc"==a[o]?s.sSortDesc:i.sSortingClass),e.find("span."+s.sSortIcon).removeClass(s.sSortJUIAsc+" "+s.sSortJUIDesc+" "+s.sSortJUI+" "+s.sSortJUIAscAllowed+" "+s.sSortJUIDescAllowed).addClass("asc"==a[o]?s.sSortJUIAsc:"desc"==a[o]?s.sSortJUIDesc:i.sSortingClassJUI)})}}}),$e.render={number:function(t,e,i,n){return{display:function(s){var s=parseFloat(s),o=parseInt(s,10),s=i?(e+(s-o).toFixed(i)).substring(2):"";return(n||"")+o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)+s}}}},n.extend($e.ext.internal,{_fnExternApiFunc:He,_fnBuildAjax:U,_fnAjaxUpdate:V,_fnAjaxParameters:H,_fnAjaxUpdateDraw:$,_fnAjaxDataSrc:W,_fnAddColumn:u,_fnColumnOptions:d,_fnAdjustColumnSizing:p,_fnVisibleToColumnIndex:f,_fnColumnIndexToVisible:m,_fnVisbleColumns:g,_fnGetColumns:v,_fnColumnTypes:_,_fnApplyColumnDefs:y,_fnHungarianMap:s,_fnCamelToHungarian:o,_fnLanguageCompat:r,_fnBrowserDetect:h,_fnAddData:b,_fnAddTr:w,_fnNodeToDataIndex:function(t,e){return e._DT_RowIndex!==i?e._DT_RowIndex:null},_fnNodeToColumnIndex:function(t,e,i){return n.inArray(i,t.aoData[e].anCells)},_fnGetCellData:x,_fnSetCellData:S,_fnSplitObjNotation:C,_fnGetObjectDataFn:T,_fnSetObjectDataFn:M,_fnGetDataMaster:A,_fnClearTable:D,_fnDeleteIndex:L,_fnInvalidateRow:k,_fnGetRowElements:P,_fnCreateTr:I,_fnBuildHead:E,_fnDrawHead:O,_fnDraw:j,_fnReDraw:F,_fnAddOptionsHtml:N,_fnDetectHeader:B,_fnGetUniqueThs:z,_fnFeatureHtmlFilter:G,_fnFilterComplete:q,_fnFilterCustom:Z,_fnFilterColumn:Y,_fnFilter:X,_fnFilterCreateSearch:J,_fnEscapeRegex:K,_fnFilterData:Q,_fnFeatureHtmlInfo:te,_fnUpdateInfo:ee,_fnInfoMacros:ie,_fnInitialise:ne,_fnInitComplete:se,_fnLengthChange:oe,_fnFeatureHtmlLength:re,_fnFeatureHtmlPaginate:ae,_fnPageChange:le,_fnFeatureHtmlProcessing:he,_fnProcessingDisplay:ce,_fnFeatureHtmlTable:ue,_fnScrollDraw:de,_fnApplyToChildren:pe,_fnCalculateColumnWidths:fe,_fnThrottle:me,_fnConvertToWidth:ge,_fnScrollingWidthAdjust:ve,_fnGetWidestNode:_e,_fnGetMaxLenString:ye,_fnStringToCss:be,_fnScrollBarWidth:we,_fnSortFlatten:xe,_fnSort:Se,_fnSortAria:Ce,_fnSortListener:Te,_fnSortAttachListener:Me,_fnSortingClasses:Ae,_fnSortData:De,_fnSaveState:Le,_fnLoadState:ke,_fnSettingsFromNode:Pe,_fnLog:Ie,_fnMap:Re,_fnBindAction:Oe,_fnCallbackReg:je,_fnCallbackFire:Fe,_fnLengthOverflow:Ne,_fnRenderer:Be,_fnDataSource:ze,_fnRowAttributes:R,_fnCalculateEnd:function(){}}),n.fn.dataTable=$e,n.fn.dataTableSettings=$e.settings,n.fn.dataTableExt=$e.ext,n.fn.DataTable=function(t){return n(this).dataTable(t).api()},n.each($e,function(t,e){n.fn.DataTable[t]=e}),n.fn.dataTable};"function"==typeof define&&define.amd?define("datatables",["jquery"],n):"object"==typeof exports?n(require("jquery")):jQuery&&!jQuery.fn.dataTable&&n(jQuery)}(window,document),function(t,e,i){var n=function(n){var s=function(t,i){!this instanceof s?alert("Scroller warning: Scroller must be initialised with the 'new' keyword."):("undefined"==typeof i&&(i={}),this.s={dt:t,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,viewportRows:0,stateTO:null,drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null},topRowFloat:0,scrollDrawDiff:null},this.s=n.extend(this.s,s.oDefaults,i),this.s.heights.row=this.s.rowHeight,this.dom={force:e.createElement("div"),scroller:null,table:null},this.s.dt.oScroller=this,this._fnConstruct())};if(s.prototype={fnRowToPixels:function(t,e,n){return t=n?this._domain("virtualToPhysical",t*this.s.heights.row):this.s.baseScrollTop+(t-this.s.baseRowTop)*this.s.heights.row,e||e===i?parseInt(t,10):t},fnPixelsToRow:function(t,e,n){var s=t-this.s.baseScrollTop,t=n?this._domain("physicalToVirtual",t)/this.s.heights.row:s/this.s.heights.row+this.s.baseRowTop;return e||e===i?parseInt(t,10):t},fnScrollToRow:function(t,e){var i=this,s=!1,o=this.fnRowToPixels(t),r=t-(this.s.displayBuffer-1)/2*this.s.viewportRows;0>r&&(r=0),(o>this.s.redrawBottom||o<this.s.redrawTop)&&this.s.dt._iDisplayStart!==r&&(s=!0,o=this.fnRowToPixels(t,!1,!0)),"undefined"==typeof e||e?(this.s.ani=s,n(this.dom.scroller).animate({scrollTop:o},function(){setTimeout(function(){i.s.ani=!1},0)})):n(this.dom.scroller).scrollTop(o)},fnMeasure:function(t){this.s.autoHeight&&this._fnCalcRowHeight();var e=this.s.heights;e.viewport=n(this.dom.scroller).height(),this.s.viewportRows=parseInt(e.viewport/e.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer,("undefined"==typeof t||t)&&this.s.dt.oInstance.fnDraw()},_fnConstruct:function(){var e=this;if(this.s.dt.oFeatures.bPaginate){this.dom.force.style.position="absolute",this.dom.force.style.top="0px",this.dom.force.style.left="0px",this.dom.force.style.width="1px",this.dom.scroller=n("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0],this.dom.scroller.appendChild(this.dom.force),this.dom.scroller.style.position="relative",this.dom.table=n(">table",this.dom.scroller)[0],this.dom.table.style.position="absolute",this.dom.table.style.top="0px",this.dom.table.style.left="0px",n(this.s.dt.nTableWrapper).addClass("DTS"),this.s.loadingIndicator&&n(this.dom.scroller.parentNode).css("position","relative").append('<div class="DTS_Loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>"),this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1),this.fnMeasure(!1),n(this.dom.scroller).on("scroll.DTS",function(){e._fnScroll.call(e)}),n(this.dom.scroller).on("touchstart.DTS",function(){e._fnScroll.call(e)}),this.s.dt.aoDrawCallback.push({fn:function(){e.s.dt.bInitialised&&e._fnDrawCallback.call(e)},sName:"Scroller"}),n(t).on("resize.DTS",function(){e._fnInfo()});var i=!0;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(t,n){i&&e.s.dt.oLoadedState?(n.iScroller=e.s.dt.oLoadedState.iScroller,i=!1):n.iScroller=e.dom.scroller.scrollTop},"Scroller_State"),this.s.dt.aoDestroyCallback.push({sName:"Scroller",fn:function(){n(t).off("resize.DTS"),n(e.dom.scroller).off("touchstart.DTS scroll.DTS"),n(e.s.dt.nTableWrapper).removeClass("DTS"),n("div.DTS_Loading",e.dom.scroller.parentNode).remove(),e.dom.table.style.position="",e.dom.table.style.top="",e.dom.table.style.left=""}})}else this.s.dt.oApi._fnLog(this.s.dt,0,"Pagination must be enabled for Scroller")},_fnScroll:function(){var t,e=this,i=this.s.heights,s=this.dom.scroller.scrollTop;if(!this.s.skip)if(this.s.dt.bFiltered||this.s.dt.bSorted)this.s.lastScrollTop=0;else{if(this._fnInfo(),clearTimeout(this.s.stateTO),this.s.stateTO=setTimeout(function(){e.s.dt.oApi._fnSaveState(e.s.dt)},250),s<this.s.redrawTop||s>this.s.redrawBottom){var o=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows);Math.abs(s-this.s.lastScrollTop)>i.viewport||this.s.ani?(t=parseInt(this._domain("physicalToVirtual",s)/i.row,10)-o,this.s.topRowFloat=this._domain("physicalToVirtual",s)/i.row):(t=this.fnPixelsToRow(s)-o,this.s.topRowFloat=this.fnPixelsToRow(s,!1)),0>=t?t=0:t+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(t=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength,0>t&&(t=0)):0!==t%2&&t++,t!=this.s.dt._iDisplayStart&&(this.s.tableTop=n(this.s.dt.nTable).offset().top,this.s.tableBottom=n(this.s.dt.nTable).height()+this.s.tableTop,i=function(){null===e.s.scrollDrawReq&&(e.s.scrollDrawReq=s),e.s.dt._iDisplayStart=t,e.s.dt.oApi._fnCalculateEnd&&e.s.dt.oApi._fnCalculateEnd(e.s.dt),e.s.dt.oApi._fnDraw(e.s.dt)},this.s.dt.oFeatures.bServerSide?(clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(i,this.s.serverWait)):i())}this.s.lastScrollTop=s}},_domain:function(t,e){var i,n=this.s.heights;if(n.virtual===n.scroll){if(i=(n.virtual-n.viewport)/(n.scroll-n.viewport),"virtualToPhysical"===t)return e/i;if("physicalToVirtual"===t)return e*i}var s=(n.scroll-n.viewport)/2,o=(n.virtual-n.viewport)/2;return i=o/(s*s),"virtualToPhysical"===t?o>e?Math.pow(e/i,.5):(e=2*o-e,0>e?n.scroll:2*s-Math.pow(e/i,.5)):"physicalToVirtual"===t?s>e?e*e*i:(e=2*s-e,0>e?n.virtual:2*o-e*e*i):void 0},_fnDrawCallback:function(){var t=this,e=this.s.heights,i=this.dom.scroller.scrollTop,s=n(this.s.dt.nTable).height(),o=this.s.dt._iDisplayStart,r=this.s.dt._iDisplayLength,a=this.s.dt.fnRecordsDisplay();this.s.skip=!0,this._fnScrollForce(),i=0===o?this.s.topRowFloat*e.row:o+r>=a?e.scroll-(a-this.s.topRowFloat)*e.row:this._domain("virtualToPhysical",this.s.topRowFloat*e.row),this.dom.scroller.scrollTop=i,this.s.baseScrollTop=i,this.s.baseRowTop=this.s.topRowFloat;var l=i-(this.s.topRowFloat-o)*e.row;0===o?l=0:o+r>=a&&(l=e.scroll-s),this.dom.table.style.top=l+"px",this.s.tableTop=l,this.s.tableBottom=s+this.s.tableTop,s=(i-this.s.tableTop)*this.s.boundaryScale,this.s.redrawTop=i-s,this.s.redrawBottom=i+s,this.s.skip=!1,setTimeout(function(){t._fnInfo.call(t)},0),this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.iScroller&&((i=this.s.dt.sAjaxSource||t.s.dt.ajax?!0:!1)&&2==this.s.dt.iDraw||!i&&1==this.s.dt.iDraw)&&setTimeout(function(){n(t.dom.scroller).scrollTop(t.s.dt.oLoadedState.iScroller),t.s.redrawTop=t.s.dt.oLoadedState.iScroller-e.viewport/2},0)},_fnScrollForce:function(){var t=this.s.heights;t.virtual=t.row*this.s.dt.fnRecordsDisplay(),t.scroll=t.virtual,1e6<t.scroll&&(t.scroll=1e6),this.dom.force.style.height=t.scroll+"px"},_fnCalcRowHeight:function(){var t=this.s.dt.nTable,e=t.cloneNode(!1),i=n("<tbody/>").appendTo(e),s=n('<div class="'+this.s.dt.oClasses.sWrapper+' DTS"><div class="'+this.s.dt.oClasses.sScrollWrapper+'"><div class="'+this.s.dt.oClasses.sScrollBody+'"></div></div></div>');for(n("tbody tr:lt(4)",t).clone().appendTo(i);3>n("tr",i).length;)i.append("<tr><td>&nbsp;</td></tr>");n("div."+this.s.dt.oClasses.sScrollBody,s).append(e),s.appendTo(this.s.dt.nHolding),this.s.heights.row=n("tr",i).eq(1).outerHeight(),s.remove()},_fnInfo:function(){if(this.s.dt.oFeatures.bInfo){var t=this.s.dt,e=this.dom.scroller.scrollTop,i=Math.floor(this.fnPixelsToRow(e,!1,this.s.ani)+1),s=t.fnRecordsTotal(),o=t.fnRecordsDisplay(),e=Math.ceil(this.fnPixelsToRow(e+this.s.heights.viewport,!1,this.s.ani)),e=e>o?o:e,i=t.fnFormatNumber(i),e=t.fnFormatNumber(e),s=t.fnFormatNumber(s),o=t.fnFormatNumber(o),o=0===t.fnRecordsDisplay()&&t.fnRecordsDisplay()==t.fnRecordsTotal()?t.oLanguage.sInfoEmpty+t.oLanguage.sInfoPostFix:0===t.fnRecordsDisplay()?t.oLanguage.sInfoEmpty+" "+t.oLanguage.sInfoFiltered.replace("_MAX_",s)+t.oLanguage.sInfoPostFix:t.fnRecordsDisplay()==t.fnRecordsTotal()?t.oLanguage.sInfo.replace("_START_",i).replace("_END_",e).replace("_TOTAL_",o)+t.oLanguage.sInfoPostFix:t.oLanguage.sInfo.replace("_START_",i).replace("_END_",e).replace("_TOTAL_",o)+" "+t.oLanguage.sInfoFiltered.replace("_MAX_",t.fnFormatNumber(t.fnRecordsTotal()))+t.oLanguage.sInfoPostFix,t=t.aanFeatures.i;if("undefined"!=typeof t)for(s=0,i=t.length;i>s;s++)n(t[s]).html(o)}}},s.defaults={trace:!1,rowHeight:"auto",serverWait:200,displayBuffer:9,boundaryScale:.5,loadingIndicator:!1},s.oDefaults=s.defaults,s.version="1.2.1","function"==typeof n.fn.dataTable&&"function"==typeof n.fn.dataTableExt.fnVersionCheck&&n.fn.dataTableExt.fnVersionCheck("1.9.0")?n.fn.dataTableExt.aoFeatures.push({fnInit:function(t){var e=t.oInit;return new s(t,e.scroller||e.oScroller||{}).dom.wrapper},cFeature:"S",sFeature:"Scroller"}):alert("Warning: Scroller requires DataTables 1.9.0 or greater - www.datatables.net/download"),n.fn.dataTable.Scroller=s,n.fn.DataTable.Scroller=s,n.fn.dataTable.Api){var o=n.fn.dataTable.Api;o.register("scroller().rowToPixels()",function(t,e,i){var n=this.context;return n.length&&n[0].oScroller?n[0].oScroller.fnRowToPixels(t,e,i):void 0}),o.register("scroller().pixelsToRow()",function(t,e,i){var n=this.context;return n.length&&n[0].oScroller?n[0].oScroller.fnPixelsToRow(t,e,i):void 0}),o.register("scroller().scrollToRow()",function(t,e){return this.iterator("table",function(i){i.oScroller&&i.oScroller.fnScrollToRow(t,e)}),this}),o.register("scroller().measure()",function(t){return this.iterator("table",function(e){e.oScroller&&e.oScroller.fnMeasure(t)}),this})}return s};"function"==typeof define&&define.amd?define("datatables-scroller",["jquery","datatables"],n):jQuery&&!jQuery.fn.dataTable.Scroller&&n(jQuery,jQuery.fn.dataTable)}(window,document),define("colresize",["jquery","jqueryui","datatables"],function(t){return t.fn.dataTable.Api.register("columns().setWidth()",function(e){var i=this.context[0],n=i.aoColumns,s=new t.fn.dataTable.Api(i);for(var o in e){var r=n[o]||null;r&&(r.sWidthOrig=String(e[o]))}return s.columns.adjust().draw(!1),i.oInstance.trigger("colresize.dt",e),this}),t.widget("ui.colresize",{options:{selector:"th",minWidth:20},_create:function(){var e=this,i=this.options,n=this.element,s=n.find(i.selector).not(":last");s.each(function(){!function(o){o[0].style.position="relative";var r=t('<div class="colresize-handle"/>').appendTo(o);r.draggable({containment:n,axis:"x",start:function(){o.addClass("colresize-resized")},drag:function(t,e){e.position.left<i.minWidth?(r.addClass("colresize-fixed"),r[0].style.left=i.minWidth+"px"):r.removeClass("colresize-fixed")},stop:function(t,i){o.removeClass("colresize-resized"),r.removeClass("colresize-fixed"),r[0].style.left="auto",r[0].style.right=0,n.trigger("stop."+e.widgetName,{th:o,index:s.index(o),width:i.position.left,delta:i.position.left-i.originalPosition.left})}})}(t(this))})}}),{}}),define("abstracts/Group",["underscore","abstracts/Model"],function(t,e){var i=e.extend({constructor:function(){e.apply(this,arguments),this.groups=null,this.items=null},defaults:{nbItems:0,name:"",parentId:null},parse:function(t){return t.group||t}});return i}),define("geo",[],function(){var t={E2:.006739496742337,D_EXT:.08181979099211441,MerkElipsK:1e-7,E_LARGE_SEMIAXIS:6378137,E_LARGE_SEMIAXIS_RUS:6378245,EARTH_SEMIAXIS_S:6356752.314245,EARTH_SEMIAXIS_S_RUS:6356863,userLocation:null,getMeridianCurve:function(e){return t.E_LARGE_SEMIAXIS*(1-t.E2)/Math.pow(e,1.5)},getParallelCurve:function(e){return t.E_LARGE_SEMIAXIS/Math.sqrt(e)},getFz:function(t,e,i){var n=n||(t-e)*Math.D2R;return 2*Math.asin(Math.sqrt(Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.D2R)*Math.cos(t*Math.D2R)*Math.sin(i/2)*Math.sin(i/2)))},getDistanceBetweenPoints:function(e,i,n,s){var o=t;i=parseFloat(i),e=parseFloat(e),s=parseFloat(s),n=parseFloat(n);var r=0,a=0,l=0,h=0,c=0,u=0;r=(e+n)/2*Math.D2R;var d=Math.sin(r)*Math.sin(r),p=1-o.E2*d;if(0==p)return 0;a=o.getMeridianCurve(p),l=o.getParallelCurve(p),c=(e-n)*Math.D2R,h=(i-s)*Math.D2R;var f=o.getFz(e,n,h),m=Math.sin(f);if(0==m)return 0;u=Math.cos(n*Math.D2R)*Math.sin(h)/m;var g=Math.cos(Math.asin(u));return m=a*u*u+l*g*g,0==m?0:a*l*f/m},getDistanceBetweenPointsSimple:function(t,e,i,n){var s=6376554*Math.acos(Math.cos(t*Math.D2R)*Math.cos(i*Math.D2R)*Math.cos(n*Math.D2R-e*Math.D2R)+Math.sin(t*Math.D2R)*Math.sin(i*Math.D2R));return s},detectUserLocation:function(){try{var e=$.isFunction(arguments[0])?arguments[0]:null;navigator.geolocation.getCurrentPosition(function(i){t.userLocation=new t.Point({lat:i.coords.latitude,lon:i.coords.longitude}),e&&e(t.userLocation)})}catch(i){throw i}},getLonByStartAndDistance:function(e,i,n){if(0>=n)return i;i=parseFloat(i),e=parseFloat(e);var s=t,o=0,r=e,a=Math.sin(r)*Math.sin(r),l=1-s.E2*a,h=s.getParallelCurve(l);o=2*Math.PI*(n/(Math.PI*h));var c=parseFloat(i)+o/Math.D2R;return c>180&&(c-=360),c}};return t.Point=function(){this.lat=null,this.lon=null,arguments[0]&&"object"==typeof arguments[0]?(this.lat=arguments[0].lat,this.lon=arguments[0].lon):2==arguments.length&&(this.lat=arguments[0],this.lon=arguments[1]),this._view=null},t}),define("maps/GeoMap",["jquery","geo","i18n!_common/nls/common"],function(t,e,i){function n(){if(this.zoom=0,this.center={lat:0,lon:0},this._protocol="http"+(App.isHttpsClient()?"s":"")+"://",this._nbTiles=1,this._size=n.TILE_SIZE,this._useCache=!1,this._kLon=null,this._kLat=[],this._kDist=[],this.scode="YDX",this._geocoding=!1,this._geocodeQueue=[],this._routingService=null,this._routingQueue=[],arguments[0]&&arguments[0]instanceof n){var t=arguments[0];this.setZoom(t.getZoom()),this.setCenter(t.getCenter())}}return n.__CLASS__="GeoMap",n.code=null,n.mapName=null,n.TILE_SIZE=256,n.EMPTY_IMG="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",n.MIN_ZOOM=2,n.MAX_ZOOM=20,n.getName=function(){return this.mapName},n.getCode=function(){return this.code},t.extend(n.prototype,{SEARCH_DATA_TYPE:"jsonp",setZoom:function(t){if(t==this.zoom)return!0;if(!this.checkZoomAvailable(t))return!1;this.zoom=t,this._nbTiles=Math.pow(2,this.zoom),this._size=this._nbTiles*n.TILE_SIZE,this._kLon=this.lonToX(0)/180;for(var i=0,s=0;80>=s;++s)i=this.getXYDistance(s,0,s+1,0),this._kLat[s]=i,this._kDist[s]=Math.round(1e4*e.getDistanceBetweenPointsSimple(s,0,s+1,0)/i)/1e4;return!0},getZoom:function(){return this.zoom},getMinZoom:function(){return"undefined"==typeof this.constructor.MIN_ZOOM?n.MIN_ZOOM:this.constructor.MIN_ZOOM},getMaxZoom:function(){return"undefined"==typeof this.constructor.MAX_ZOOM?n.MAX_ZOOM:this.constructor.MAX_ZOOM},checkZoomAvailable:function(t){return t>=this.getMinZoom()&&t<=this.getMaxZoom()},getKDistByLat:function(t){var t=Math.round(t);return this._kDist[t]||0},getMaxTileNumber:function(){return this._nbTiles-1},setCenter:function(){2===arguments.length?(this.center.lat=arguments[0],this.center.lon=arguments[1]):1===arguments.length&&(t.isArray(arguments[0])?(this.center.lat=arguments[0][0],this.center.lon=arguments[0][1]):this.center=arguments[0])},getCenter:function(){return this.center},getCenterXY:function(){return{x:this.lonToX(this.center.lon),y:this.latToY(this.center.lat)}},getSize:function(){return this._size},lonToX:function(t){return Math.round(this._size*(.5+t/360))},dLonToDX:function(t,e){return this._size*(e-t)/360},xToLon:function(t){return 360*(t%this._size)/this._size-180},latToY:function(t){t>90&&(t-=180),-90>t&&(t+=180);var e=Math.PI*t/180,i=.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),n=0;return 1/0===i?n:i===-1/0?this._size:(n=parseInt((1-i/Math.PI)/2*this._size),0>n?0:n>this._size?this._size:n)},dLatToDY:function(t,e){return this.latToY(e)-this.latToY(t)},getXYDistance:function(t,e,i,n){var s=this.dLonToDX(e,n),o=this.dLatToDY(t,i);return Math.sqrt(s*s+o*o)},yToLat:function(t){var e=(.5-t/this._size)*Math.PI2;return 180*(2*Math.atan(Math.exp(e))-Math.PI/2)/Math.PI},getImgSrc:function(t,e,i){return 0>e||e>this.getMaxTileNumber()?n.EMPTY_IMG:(0>t?t=0:t>=this._nbTiles&&(t%=this._nbTiles),i<this.getMinZoom()||i>this.getMaxZoom(),this._getSourceUrl()+this._buildImgParams(t,e,i))},getEmptySrc:function(){return n.EMPTY_IMG},_getSourceUrl:function(){var t=this.constructor,e=t.HOST[Math.floor(Math.random()*t.HOST.length)];return this._protocol+e+t.DEFAULT_PARAMS},_buildImgParams:function(){return""},getCode:function(){return this.constructor.code||null},getClass:function(){return this.constructor.__CLASS__||""},getProjectionType:function(){return"google"},getTrafficLayerClass:function(){return""},isHybrid:function(){return!1},search:function(e){var n=this,s=t.Deferred(),o=this.getSearchUrl(e);return t.ajax({url:o,type:"GET",method:"GET",dataType:this.SEARCH_DATA_TYPE,beforeSend:function(){},success:function(t){try{var e=n.parseSearchJSON(t);s.resolve(e)}catch(i){s.reject({msg:i})}},error:function(){s.reject({msg:i.canNotFindCoordsByAddress})}}),s},getSearchUrl:function(t){var e="";return t.center&&(e="&ll="+t.center.lon+","+t.center.lat),"https://geocode-maps.yandex.ru/1.x/?geocode="+t.q+e+"&format=json&sco=latlong&lang="+this.getLocale()},parseSearchJSON:function(t){for(var e=[],i=t.response.GeoObjectCollection.featureMember,n=null,s=[],o=0;o<i.length;o++)n=i[o].GeoObject,s=n.Point.pos.split(" "),e.push({lat:s[1],lon:s[0],title:n.metaDataProperty.GeocoderMetaData.text,original:n});return e},suggest:function(e){var i=this,n=t.Deferred(),s=new Date,o="jQuery"+s.getTime();window[o]=function(t){var e=t[0],s=t[1];try{var o=i.parseSuggestJSON(e,s);n.resolve(o)}catch(r){n.reject({msg:r})}};var r=this.getSuggestUrl(e)+"&callback="+o;return t.getScript(r),n},getSuggestUrl:function(t){var e="";t.center&&(e="&ll="+t.center.lon+","+t.center.lat);var i="ru",n="&spn=0.8,0.3";return-1!=App.getLocale().indexOf("en")&&(i="com"),this._protocol+"suggest-maps.yandex."+i+"/suggest-geo?search_type=all&lang="+this.getLocale()+"&fullpath=1&v=5&part="+t.q+e+n},parseSuggestJSON:function(e,i){return t.map(i,function(t){if("geo"==t[0]){for(var e="",i=0,n=t[1].length;n>i;i++)e+="string"==typeof t[1][i]?t[1][i]:t[1][i][1];return{label:e,value:e,original:t}}})},geocode:function(e){if(this._geocoding)return this._geocodeQueue.push(e),void 0;this._geocoding=!0;var i=this,n=this.getGeocodeUrl(e);!e.scode&&(e.scode=this.scode),t.ajax({url:n,type:"GET",method:"GET",timeout:1e3,beforeSend:function(){},success:function(t){try{var n=i.parseGeocodeJSON(t);e.geoId&&(n.geoId=e.geoId),n.lat=e.lat,n.lon=e.lon,e.success&&e.success(n),e.complete&&e.complete()}catch(s){i._onExternalGeocodingFailed(e)}},complete:function(){i._geocoding=!1,i._geocodeQueue.length&&setTimeout(function(){i.geocode(i._geocodeQueue.shift())},100)},error:function(){i._onExternalGeocodingFailed(e)}})},getGeocodeUrl:function(t){return"https://geocode-maps.yandex.ru/1.x/?geocode="+t.lon+","+t.lat+"&format=json&results=1&lang="+this.getLocale()},parseGeocodeJSON:function(t){if(t.scode)return t;try{var e=t.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData;return{address:e.text,kind:e.kind}}catch(i){throw i}},routing:function(){return!0},routingTraffic:function(){return!1},routingReady:function(){return this._routingService},requestRoute:function(e,n){var s=this,o=new t.Deferred;return this.loadRouting?(this.loadRouting().done(function(){s._calcRoute.call(s,e,n).done(function(t){o.resolve(t)}).fail(function(){o.reject.apply(o,arguments)})}).fail(function(){o.reject.apply(o,arguments)}),o):o.reject(i.errNoRoutingOnMap)},getLocale:function(){return App.getLocale().replace("-","_")},_onExternalGeocodingFailed:function(e){if(e.scode){var i=this;t.ajax({url:App.getBaseUrl()+"address/",data:e,success:function(t){try{e.success&&e.success(i.parseGeocodeJSON(t))}catch(n){e.error&&e.error(n)}},complete:function(){e.complete&&e.complete()},error:function(){e.error&&e.error.apply(this,arguments)}})}}}),n.RouteData=function(){this.meta={bounds:[],time:0,trafficTime:0,length:0,trafficLength:0,source:""},this.steps=[],this.points=[]},t.extend(n.RouteData.prototype,{roundTime:function(t){var e=10;return t>86400?e=3600:t>43200?e=1800:t>10800?e=1200:t>3600?e=600:t>1800&&(e=60),Math.ceil(t/e)*e},roundLength:function(t){var e=10;return t>5e3?e=500:t>1e3?e=100:t>300&&(e=50),t=Math.round(t/e),0==t?e:t*e},formatTime:function(t){var e=i.DateTime,n=[],s=parseInt(t/86400),o=parseInt(t/3600)%24,r=parseInt(t/60)%60,a=Math.round(t%60),l=s?s+"&nbsp;"+e.labelsCompact[3]:"";return n.push(l),l=o?o+"&nbsp;"+e.labelsCompact[4]:"",n.push(l),l=r?r+"&nbsp;"+e.labelsCompact[5]:"",n.push(l),l=a?a+"&nbsp;"+e.labelsCompact[6]:0==n.join("").length?"0 "+e.labelsCompact[6]:"",n.push(l),n.join(" ")},formatLength:function(t){var e=Math.floor(t/1e3);return e>0?Math._round(t/1e3,1)+"&nbsp;"+i.km:t+"&nbsp;"+i.m}}),n}),define("abstracts/Collection",["jquery","underscore","backbone"],function(t,e){var i=Backbone.Collection.prototype,n=Backbone.Collection.extend({idProp:"id",fetch:function(){var n=arguments,s=arguments[1]||{};if(e.isArray(arguments[0])){if(s.data={},s.data[this.idProp]=arguments[0],s.merge){var o=this;return t.ajax({url:e.result(this,"url"),data:s.data}).done(function(t){o.add(t,e.extend({parse:!0},s))})}n=[s]}return i.fetch.apply(this,n)}});return n}),define("maps/routing/Route",["jquery","underscore","maps/GeoMap","abstracts/Model"],function(t,e,i,n){var s=n.extend({constructor:function(){n.apply(this,arguments)},defaults:{meta:null,source:null,traffic:!1,points:[],steps:[],color:"#584CD9",fadeColor:"#8282ad",hidden:!1,active:!0,options:{}},initialize:function(){var t=this;this.on("change:points change:source",function(){t.build()})},build:function(){var e=this,n=this.get("source"),s=new t.Deferred,o=[],r=this.get("options");if(n&&n.requestRoute){if(o=this.get("points"),!this.validatePoints(o))return s.reject();e.trigger("request"),n.requestRoute(o,r).done(function(t){t instanceof i.RouteData&&(t.points=o,e.set(t),e.trigger("sync",e,{autoZoom:e.get("active")}),s.resolve())}).fail(function(t){e.trigger("error",t),s.reject(t)})}else e.trigger("error",e,"No source for route or no requestRoute method"),s.reject("No source for route or no requestRoute method");return s},setPointIndex:function(t,e){var i=this.get("points"),n=i[t]||null;return n?(0>e&&(e=0),e>=i.length&&(e=i.length-1),i.splice(t,1),i.splice(e,0,n),!0):!1},setPointParams:function(t,i){var n=this.get("points");n[t]&&e.extend(n[t],i)},validatePoints:function(t){var t=t||this.get("points"),e=!0,i=t.length;if(2>i)return!1;for(;i--;)if(!t[i]||!t[i].lat||!t[i].lon){e=!1;break}return e}});return s}),define("maps/routing/RoutesCollection",["underscore","abstracts/Collection","maps/routing/Route"],function(t,e,i){var n=e.extend({model:i,constructor:function(){e.apply(this,arguments)}});return n}),define("maps/routing/views/RoutingCreateView",["jquery","underscore","jqueryui","abstracts/View","text!maps/routing/tmpl/create.html","text!maps/routing/tmpl/point.html"],function(t,e,i,n,s,o){s=e.template(s),o=e.template(o);var r={address:"location",mobile:"car",stat:"home",guard:"shield"},a=n.extend({className:"routing",constructor:function(){this.form=null,this.pointsList=null,this.inputs=null,this._marker=null,n.apply(this,arguments)},initialize:function(){l.bindEvents.call(this),this.render()},render:function(){var e=this,i=s({pointsHtml:"",i18n:this.model.getTexts()});t("#page").append(this.$el.html(i)),this.form=this.$el.find("form"),this.pointsList=this.$el.find(".points"),t.fn.draggable&&this.$el.draggable({handle:".box-header",containment:"parent",stop:function(t,i){e.model.setUserData("left",i.position.left),e.model.setUserData("top",i.position.top)}}),t.fn.resizable&&this.$el.resizable({handles:"w,e",containment:"parent",minWidth:400,stop:function(t,i){e.model.setUserData("width",i.size.width)
}});var n=this.model.getUserData("left"),o=this.model.getUserData("top"),r=this.model.getUserData("width");null!==n&&(this.el.style.left=n+"px"),null!==o&&(this.el.style.top=o+"px"),null!==r&&(this.el.style.width=r+"px"),this.form.on("submit",function(){return l.onSubmit.call(e),!1})},open:function(){this.$el.removeClass("hidden")},close:function(){this.$el.addClass("hidden"),this._marker&&this._marker.trigger("destroy")&&(this._marker=null)}}),l={bindEvents:function(){var e=this;this.on("suggestsuccess",function(t,e){e&&e(t)}),this.listenTo(this.model,"change:active",function(t,i){i?e.open():e.close()}).listenTo(this.model,"change:activeRoute",function(t,i){var n=t.previous("activeRoute");n&&(e.stopListening(n),e.collection.remove(n)),i?(l.bindRouteEvents.call(e,i),l.renderPoints.call(e)):e.close()}),this.$el.on("click",".close",function(){e.model.set("active",!1)}).on("click",".btn-reset",function(){e.collection.remove(e.collection.models),e.model.buildRoute([])}).on("click",".add-point",function(){}).on("click",".move-point",function(){var i=t(this).closest("li"),n=t(this).is(".move-up"),s=i[n?"prev":"next"]();s.length&&(i[n?"insertBefore":"insertAfter"](s),l.onSubmit.call(e))}).on("click","a[data-type]",function(){var e=t(this),i=e.data("type"),n=t(this).closest(".form-search");n.data("index"),n.removeClass("error").find("input").val("").focus(),n.find(".dropdown-toggle").data("type",i).find("use").attr("xlink:href","#smb-"+r[i])}).on("click",".icon-clear",function(){var e=t(this).closest(".form-search");e.find("input").val("").data("lat",0).data("lon",0).focus(),e.removeClass("active")})},bindRouteEvents:function(t){var e=this;this.listenTo(t,"sync",function(){var i=e.model.getStepsView(t.id);e.$el.find(i.$el).length||i.$el.appendTo(e.$el)}).listenTo(t,"request",function(){e.$el.addClass("loading")}).listenTo(t,"sync error",function(){e.$el.removeClass("loading")})},initAutocomplete:function(e){var i=this,n=this.model.get("parent");t(e).autocomplete({minLength:2,source:function(t,e){var s=this.element,o=s.closest("li"),r=(o.data("index"),{q:t.term,type:o.find(".btn[data-type]").data("type"),center:n.getWidget().getCenter(),bounds:n.getWidget().getBounds()}),a=e,l=function(t){var e=-1!=o[0].className.indexOf("error");t.length?e&&o.removeClass("error"):!e&&o.addClass("error"),a.apply(this,arguments)};i.once("suggestcomplete",function(){s.removeClass("ui-autocomplete-loading")}),-1==o[0].className.indexOf("active")&&(o[0].className+=" active"),n.publish("needsuggest",r,l,i)},select:function(e,n){if(n.item){var s=t(this),o=n.item.value,r=s.closest("li"),a=r.data("index"),h=r.find(".btn[data-type]").data("type");s.val(o),l.search.call(i,o,h,a,n.item.original||null)}}}).on("keyup",function(){})},onSubmit:function(){var e=this.form.find("input[data-lat]"),i=[];e.each(function(){var e=t(this),n=e.closest("li"),s=(n.data("index"),n.find(".btn[data-type]").data("type")),o=t.trim(e.val()),r={type:s,text:o};if(/^\-?[\d]{1,2}(\.[\d]*)?\,\s*?\-?[\d]{1,3}(\.[\d]*)?$/i.test(o)){var a=o.indexOf(",");r.lat=o.substr(0,a),r.lon=o.substr(a+1)}else r.lat=e.data("lat"),r.lon=e.data("lon");r.lat&&r.lon&&(r.lat=parseFloat(r.lat),r.lon=parseFloat(r.lon),i.push(r))}),this.model.get("activeRoute").set("points",i)},search:function(t,i,n,s){var o=this,r=this.model.get("parent"),a=t,h=i,c=s,u=o.pointsList.find(".form-search[data-index="+n+"]"),d=u.find("input");!function(t,i,n,s,u){s.one("searchstart",function(){!c&&s.addClass("ui-autocomplete-loading")}).one("searchcomplete",function(){s.removeClass("ui-autocomplete-loading")}).one("searchsuccess",function(i,r){if(!r||e.isArray(r)&&!r.length)return n.addClass("error"),void 0;var a=e.isArray(r)?r[0]:r,h=a.name||a.title||t;s.val(h).data("lat",a.lat).data("lon",a.lon),l.onSubmit.call(o)}).one("searcherror",function(){});var d={q:a,type:h,center:r.getWidget().getCenter(),bounds:r.getWidget().getBounds()};r.publish("needsearch",d,s,u||null)}(a,h,u,d,c)},renderPoints:function(){var t=this,i="",n=t.model.getTexts(),s=t.model.get("activeRoute").get("points"),a={address:n.address.ucFirst()};App.hasMobile()&&(a.mobile=n.vehiclesLabels[0].ucFirst()),App.hasStationary()&&(a.stat=n.stationaryLabels[0].ucFirst()),App.get("guardsAvailable")&&(a.guard=n.rrTeamShort),e.each(s,function(t,e){i+=o({point:t,i:e,i18n:n,searchTypes:a,icons:r})}),this.pointsList.html(i),this.inputs=t.pointsList.find("input"),this.inputs.each(function(){l.initAutocomplete.call(t,this)}),this.inputs.filter('[value=""]').first().focus()}};return a}),define("maps/routing/views/RouteMapView",["jquery","underscore","geo","abstracts/View","text!maps/routing/tmpl/stepInfo.html","text!maps/routing/tmpl/pointInfo.html"],function(t,e,i,n,s,o){s=e.template(s),o=e.template(o);var r=n.extend({constructor:function(){this.module=null,this._polyline=null,this._segments=[],this._pointsLayer=null,this._viaLayer=null,this._startMarker=null,this._finishMarker=null,this._popup=null,n.apply(this,arguments)},initialize:function(t){this.module=t.module;var e=this;this.listenTo(this.model,"sync",function(t,i){t.get("hidden")||(e._polyline&&a.clearLayers.call(e),e._segments=a.makeSegments.call(e),a.build.call(e,i))}).listenTo(this.model,"remove",function(){e.stopListening(e.model),a.clearLayers.call(e),e._segments=[]}).listenTo(this.model,"change:hidden",function(t,i){a.triggerOnLayers.call(e,i?"hide":"show")}).listenTo(this.model,"change:active",function(t,i){a.clearLayers.call(e),e._segments=a.makeSegments.call(e);var n=e.module.get("parent");if(i)a.build.call(e,{autoZoom:!0});else{var s=e._segments;s.length&&(e._polyline=n.getWidget().buildComplexPolyline());for(var o=0,r=s.length;r>o;o++)e._polyline.addSegment(s[o]);t.get("hidden")||e._polyline&&e._polyline.trigger("show")}})}}),a={makeSegments:function(){var t=[],n=this.model.get("steps");if(!n||!n.length)return t;var s=this.module.get("parent"),o=this.model.get("points"),r=o[0],a=e.last(o),l=n[0].points[0],h=e.last(e.last(n).points),c=20,u=this.model.get("active"),d=u?this.model.get("color"):this.model.get("fadeColor"),p={weight:2,weightArray:{9:4,12:6,15:8},color:d,opacity:u?.75:.65,dashArray:[5,15]};i.getDistanceBetweenPoints(r.lat,r.lon,l[0],l[1])>c&&t.push(s.buildPolyline([[r.lat,r.lon],[l[0],l[1]]],p)),e.extend(p,{dashArray:null,decor:u,decorMinZoom:12});for(var f=0,m=n.length;m>f;++f)t.push(s.buildPolyline(n[f].points,p));return i.getDistanceBetweenPoints(a.lat,a.lon,h[0],h[1])>c&&(e.extend(p,{dashArray:[5,15],decor:!1}),t.push(s.buildPolyline([[a.lat,a.lon],[h[0],h[1]]],p))),t},build:function(t){var e=this.module.get("parent"),i=this.model,n=this._segments;n.length&&(this._polyline=e.getWidget().buildComplexPolyline());for(var s=0,o=n.length;o>s;s++)this._polyline.addSegment(n[s]);var r;i.get("active")&&(r=this.model.get("meta").bounds)&&(!t||t.autoZoom)&&e.setBounds(r,{padding:[40,40]}),this._polyline&&this._polyline.trigger("show"),i.get("active")&&(a.putPoints.call(this),a.putMarkers.call(this),this._pointsLayer.bindPopup(""))},putMarkers:function(){if(!this._polyline)return!1;for(var t=this.model.get("points"),e=[],i=0,n=t.length;n>i;++i){var s;(s=a.buildPointMarker.call(this,i))&&e.push(s)}this._pointsLayer.addLayers(e)},putPoints:function(){if(!this._polyline)return!1;for(var t=this,e=this.model.get("steps"),i=[],n=1,s=e.length;s>n;++n){var o;(o=a.buildStepPointMarker.call(t,e[n]))&&i.push(o)}this._pointsLayer=this.module.get("parent").addLayersGroup({layers:i,clusters:!1})},buildStepPointMarker:function(t){var i=this,n=t.points[0],o=this.module.get("parent").buildMarker({lat:n[0],lon:n[1],className:"step-point-marker",data:t});return o.on("click",function(){this._popup&&this._popup.setContent(s(e.extend({},t,{i18n:i.module.getTexts()})))}),o},buildPointMarker:function(t){var i,n=this,s=this.model.get("points"),r=this.model.get("steps"),a=s[t],l=t==s.length-1,h=0==t?r[0]:null,c="";0==t?(i=r[0].points[0],c=" route-start-marker"):l?(i=e.last(e.last(r).points),c=" route-finish-marker"):(i=[a.lat,a.lon],c=" route-point-marker route-point-"+t);var u=this.module.get("parent").buildMarker({lat:i[0],lon:i[1],className:"route-point-marker"+c,data:{step:h,point:a}});return u.on("click",function(){this._popup&&this._popup.setContent(o(e.extend({},{step:h,point:a,isLast:l},{i18n:n.module.getTexts()})))}),u},triggerOnLayers:function(t){var i=this;e.each(["_polyline","_startMarker","_finishMarker","_viaLayer","_pointsLayer"],function(e){i[e]&&i[e].trigger(t)})},clearLayers:function(){a.triggerOnLayers.call(this,"destroy"),this._startMarker=this._finishMarker=this._viaLayer=this._pointsLayer=null}};return r}),define("maps/routing/views/RouteStepsView",["jquery","underscore","abstracts/View","text!maps/routing/tmpl/stepsList.html"],function(t,e,i,n){n=e.template(n);var s=i.extend({className:"box-content route-steps",constructor:function(){this.module=null,this.container=null,i.apply(this,arguments)},initialize:function(e){this.module=e.module,this._i18n=this.module.getTexts();var i=this;this.listenTo(this.model,"sync",function(){i.model.get("active")&&i.render()}).listenTo(this.model,"error",function(){}).listenTo(this.model,"change:active",function(t,e){e?(i.$el.removeClass("hidden"),i.render()):i.$el.html("").addClass("hidden")}),this.$el.on("click","li[data-index]",function(){var e=t(this),n=e.data("index"),s=i.model.get("steps");i.module.get("parent").zoomTo(s[n].points[0])})},render:function(){var t=this.model.get("points"),i=this.model.get("source").routingTraffic();this.$el.html(n(e.extend({},this.model.attributes,{start:t[0],finish:e.last(t),i18n:this._i18n}))),this.$el.find(".no-traffic-alert")[i?"addClass":"removeClass"]("hidden")}});return s}),define("maps/routing/RoutingModule",["underscore","jquery","geo","abstracts/Module","./RoutesCollection","./Route","./views/RoutingCreateView","./views/RouteMapView","./views/RouteStepsView","i18n!_common/nls/common"],function(t,e,i,n,s,o,r,a,l,h){function c(){for(var e=d.length,i=new Array(e);e--;)i[e]=t.clone(d[e]);return i}var u=h,d=[{type:"mobile",text:"",model:null},{type:"address",text:""}],p=n.extend({constructor:function(){this.items=new s,this._routeId=0,this._stepViews={},n.apply(this,arguments)},defaults:{pointsEdit:!1,activeRoute:null},initialize:function(){f.bindEvents.call(this)},buildRoute:function(e,i){var n=this.get("pointsEdit"),s=new o({id:f.getRouteId.call(this),source:this.get("parent").getMap()});return e&&e.length?1==e.length?e.push(t.clone(d[1])):2!=e.length||e[0]||(e[0]=t.clone(d[0])):e=c(),(n||s.validatePoints(e))&&(new a({model:s,module:this,maps:this.get("parent")}),s.set("points",e).set(i),this.items.add(s),this._stepViews[s.id]=new l({model:s,module:this}),n&&(s.set("active",!0),this.set("activeRoute",s))),s},getStepsView:function(t){return this._stepViews[t]||null},getTexts:function(){return u}}),f={bindEvents:function(){var e=this;this.on("change:active",function(t,i){i&&e.get("pointsEdit")&&!e._view?e._view=new r({model:e,collection:e.items}):i||e.items.remove(e.items.models)}).listenTo(this.get("parent"),"mapchanged",function(i){var n=t.once(function(t){var e=u.errCanNotBuildRoute;"string"==typeof t&&(e=t),alert(e,u.error)});e.items.each(function(t){t.get("source").scode!=i.scode&&(e.listenToOnce(t,"error",n).listenToOnce(t,"sync",function(){e.stopListening(t,"error",n)}),t.set("source",i))})}).listenTo(this.items,"remove",function(t){t.id in e._stepViews&&(e._stepViews[t.id].remove(),delete e._stepViews[t.id])})},getRouteId:function(){return++this._routeId}};return p}),function(t,e,i){var n=t.L,s={};s.version="0.7.3","object"==typeof module&&"object"==typeof module.exports?module.exports=s:"function"==typeof define&&define.amd&&define("_libs/leaflet/leaflet-src",s),s.noConflict=function(){return t.L=n,this},t.L=s,s.Util={extend:function(t){var e,i,n,s,o=Array.prototype.slice.call(arguments,1);for(i=0,n=o.length;n>i;i++){s=o[i]||{};for(e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,s;if("object"==typeof t){s=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(s));return!0}return!1},limitExecByInterval:function(t,e,i){var n,s;return function o(){var r=arguments;return n?(s=!0,void 0):(n=!0,setTimeout(function(){n=!1,s&&(o.apply(i,r),s=!1)},e),t.apply(i,r),void 0)}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return s.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=s.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var s in t)n.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var s=e[n];if(s===i)throw new Error("No value provided for variable "+t);return"function"==typeof s&&(s=s(e)),s})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,s=["webkit","moz","o","ms"];for(i=0;i<s.length&&!n;i++)n=t[s[i]+e];return n}function i(e){var i=+new Date,s=Math.max(0,16-(i-n));return n=i+s,t.setTimeout(e,s)}var n=0,o=t.requestAnimationFrame||e("RequestAnimationFrame")||i,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};s.Util.requestAnimFrame=function(e,n,r,a){return e=s.bind(e,n),r&&o===i?(e(),void 0):o.call(t,e,a)},s.Util.cancelAnimFrame=function(e){e&&r.call(t,e)}}(),s.extend=s.Util.extend,s.bind=s.Util.bind,s.stamp=s.Util.stamp,s.setOptions=s.Util.setOptions,s.Class=function(){},s.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);t.statics&&(s.extend(e,t.statics),delete t.statics),t.includes&&(s.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=s.extend({},n.options,t.options)),s.extend(n,t),n._initHooks=[];var r=this;return e.__super__=r.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){r.prototype.callInitHooks&&r.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},s.Class.include=function(t){s.extend(this.prototype,t)},s.Class.mergeOptions=function(t){s.extend(this.prototype.options,t)},s.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var o="_leaflet_events";s.Mixin={},s.Mixin.Events={addEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,r,a,l,h,c,u,d=this[o]=this[o]||{},p=i&&i!==this&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,r=t.length;r>n;n++)a={action:e,context:i||this},l=t[n],p?(h=l+"_idx",c=h+"_len",u=d[h]=d[h]||{},u[p]||(u[p]=[],d[c]=(d[c]||0)+1),u[p].push(a)):(d[l]=d[l]||[],d[l].push(a));return this},hasEventListeners:function(t){var e=this[o];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[o])return this;if(!t)return this.clearAllEventListeners();if(s.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,r,a,l,h,c,u,d,p,f=this[o],m=i&&i!==this&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,r=t.length;r>n;n++)if(a=t[n],c=a+"_idx",u=c+"_len",d=f[c],e){if(l=m&&d?d[m]:f[a]){for(h=l.length-1;h>=0;h--)l[h].action!==e||i&&l[h].context!==i||(p=l.splice(h,1),p[0].action=s.Util.falseFn);i&&d&&0===l.length&&(delete d[m],f[u]--)}}else delete f[a],delete f[c],delete f[u];return this},clearAllEventListeners:function(){return delete this[o],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,r,a,l,h=s.Util.extend({},e,{type:t,target:this}),c=this[o];if(c[t])for(i=c[t].slice(),n=0,r=i.length;r>n;n++)i[n].action.call(i[n].context,h);a=c[t+"_idx"];for(l in a)if(i=a[l].slice())for(n=0,r=i.length;r>n;n++)i[n].action.call(i[n].context,h);return this},addOneTimeEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=s.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},s.Mixin.Events.on=s.Mixin.Events.addEventListener,s.Mixin.Events.off=s.Mixin.Events.removeEventListener,s.Mixin.Events.once=s.Mixin.Events.addOneTimeEventListener,s.Mixin.Events.fire=s.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,o=n&&!e.addEventListener,r=navigator.userAgent.toLowerCase(),a=-1!==r.indexOf("webkit"),l=-1!==r.indexOf("chrome"),h=-1!==r.indexOf("phantom"),c=-1!==r.indexOf("android"),u=-1!==r.search("android [23]"),d=-1!==r.indexOf("gecko"),p=typeof orientation!=i+"",f=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints&&!t.PointerEvent,m=t.PointerEvent&&t.navigator.pointerEnabled&&t.navigator.maxTouchPoints||f,g="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,v=e.documentElement,_=n&&"transition"in v.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!u,b="MozPerspective"in v.style,w="OTransition"in v.style,x=!t.L_DISABLE_3D&&(_||y||b||w)&&!h,S=!t.L_NO_TOUCH&&!h&&function(){var t="ontouchstart";if(m||t in v)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();s.Browser={ie:n,ielt9:o,webkit:a,gecko:d&&!a&&!t.opera&&!n,android:c,android23:u,chrome:l,ie3d:_,webkit3d:y,gecko3d:b,opera3d:w,any3d:x,mobile:p,mobileWebkit:p&&a,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:S,msPointer:f,pointer:m,retina:g}}(),s.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},s.Point.prototype={clone:function(){return new s.Point(this.x,this.y)},add:function(t){return this.clone()._add(s.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(s.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=s.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=s.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=s.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+s.Util.formatNum(this.x)+", "+s.Util.formatNum(this.y)+")"}},s.point=function(t,e,n){return t instanceof s.Point?t:s.Util.isArray(t)?new s.Point(t[0],t[1]):t===i||null===t?t:new s.Point(t,e,n)},s.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;s>n;n++)this.extend(i[n])},s.Bounds.prototype={extend:function(t){return t=s.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new s.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new s.Point(this.min.x,this.max.y)},getTopRight:function(){return new s.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof s.Point?s.point(t):s.bounds(t),t instanceof s.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=s.bounds(t);var e=this.min,i=this.max,n=t.min,o=t.max,r=o.x>=e.x&&n.x<=i.x,a=o.y>=e.y&&n.y<=i.y;return r&&a},isValid:function(){return!(!this.min||!this.max)}},s.bounds=function(t,e){return!t||t instanceof s.Bounds?t:new s.Bounds(t,e)},s.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},s.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new s.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},s.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var s=e.defaultView.getComputedStyle(t,null);n=s?s[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,o=0,r=t,a=e.body,l=e.documentElement;do{if(n+=r.offsetTop||0,o+=r.offsetLeft||0,n+=parseInt(s.DomUtil.getStyle(r,"borderTopWidth"),10)||0,o+=parseInt(s.DomUtil.getStyle(r,"borderLeftWidth"),10)||0,i=s.DomUtil.getStyle(r,"position"),r.offsetParent===a&&"absolute"===i)break;if("fixed"===i){n+=a.scrollTop||l.scrollTop||0,o+=a.scrollLeft||l.scrollLeft||0;break}if("relative"===i&&!r.offsetLeft){var h=s.DomUtil.getStyle(r,"width"),c=s.DomUtil.getStyle(r,"max-width"),u=r.getBoundingClientRect();("none"!==h||"none"!==c)&&(o+=u.left+r.clientLeft),n+=u.top+(a.scrollTop||l.scrollTop||0);break}r=r.offsetParent}while(r);r=t;do{if(r===a)break;n-=r.scrollTop||0,o-=r.scrollLeft||0,r=r.parentNode}while(r);return new s.Point(o,n)},documentIsLtr:function(){return s.DomUtil._docIsLtrCached||(s.DomUtil._docIsLtrCached=!0,s.DomUtil._docIsLtr="ltr"===s.DomUtil.getStyle(e.body,"direction")),s.DomUtil._docIsLtr},create:function(t,i,n){var s=e.createElement(t);return s.className=i,n&&n.appendChild(s),s},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=s.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=s.Util.splitWords(e),o=0,r=n.length;r>o;o++)t.classList.add(n[o]);else if(!s.DomUtil.hasClass(t,e)){var a=s.DomUtil._getClass(t);s.DomUtil._setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):s.DomUtil._setClass(t,s.Util.trim((" "+s.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(s){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=s.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=s.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&s.Browser.any3d?t.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},s.DomUtil.TRANSFORM=s.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),s.DomUtil.TRANSITION=s.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),s.DomUtil.TRANSITION_END="webkitTransition"===s.DomUtil.TRANSITION||"OTransition"===s.DomUtil.TRANSITION?s.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)s.extend(s.DomUtil,{disableTextSelection:function(){s.DomEvent.on(t,"selectstart",s.DomEvent.preventDefault)},enableTextSelection:function(){s.DomEvent.off(t,"selectstart",s.DomEvent.preventDefault)}});else{var i=s.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);s.extend(s.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}s.extend(s.DomUtil,{disableImageDrag:function(){s.DomEvent.on(t,"dragstart",s.DomEvent.preventDefault)},enableImageDrag:function(){s.DomEvent.off(t,"dragstart",s.DomEvent.preventDefault)}})}(),s.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},s.extend(s.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),s.LatLng.prototype={equals:function(t){if(!t)return!1;t=s.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=s.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+s.Util.formatNum(this.lat,t)+", "+s.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=s.latLng(t);var e=6378137,i=s.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,o=(t.lng-this.lng)*i,r=this.lat*i,a=t.lat*i,l=Math.sin(n/2),h=Math.sin(o/2),c=l*l+h*h*Math.cos(r)*Math.cos(a);return 2*e*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new s.LatLng(this.lat,i)}},s.latLng=function(t,e){return t instanceof s.LatLng?t:s.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new s.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new s.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new s.LatLng(t,e)},s.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;s>n;n++)this.extend(i[n])},s.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=s.latLng(t);return t=null!==e?e:s.latLngBounds(t),t instanceof s.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new s.LatLng(t.lat,t.lng),this._northEast=new s.LatLng(t.lat,t.lng)):t instanceof s.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,o=Math.abs(e.lng-i.lng)*t;return new s.LatLngBounds(new s.LatLng(e.lat-n,e.lng-o),new s.LatLng(i.lat+n,i.lng+o))},getCenter:function(){return new s.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new s.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new s.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof s.LatLng?s.latLng(t):s.latLngBounds(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof s.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=s.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>=e.lat&&n.lat<=i.lat,a=o.lng>=e.lng&&n.lng<=i.lng;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=s.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},s.latLngBounds=function(t,e){return!t||t instanceof s.LatLngBounds?t:new s.LatLngBounds(t,e)},s.Projection={},s.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=t.lng*e,r=n*e;return r=Math.log(Math.tan(Math.PI/4+r/2)),new s.Point(o,r)},unproject:function(t){var e=s.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new s.LatLng(n,i)}},s.Projection.LonLat={project:function(t){return new s.Point(t.lng,t.lat)},unproject:function(t){return new s.LatLng(t.y,t.x)}},s.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return s.point(e,e)}},s.CRS.Simple=s.extend({},s.CRS,{projection:s.Projection.LonLat,transformation:new s.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),s.CRS.EPSG3857=s.extend({},s.CRS,{code:"EPSG:3857",projection:s.Projection.SphericalMercator,transformation:new s.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),s.CRS.EPSG900913=s.extend({},s.CRS.EPSG3857,{code:"EPSG:900913"}),s.CRS.EPSG4326=s.extend({},s.CRS,{code:"EPSG:4326",projection:s.Projection.LonLat,transformation:new s.Transformation(1/360,.5,-1/360,.5)}),s.Map=s.Class.extend({includes:s.Mixin.Events,options:{crs:s.CRS.EPSG3857,fadeAnimation:s.DomUtil.TRANSITION&&!s.Browser.android23,trackResize:!0,markerZoomAnimation:s.DomUtil.TRANSITION&&s.Browser.any3d},initialize:function(t,e){e=s.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=s.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(s.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(s.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),o=this.getSize().divideBy(2),r=t instanceof s.Point?t:this.latLngToContainerPoint(t),a=r.subtract(o).multiplyBy(1-1/n),l=this.containerPointToLatLng(o.add(a));return this.setView(l,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():s.latLngBounds(t);var i=s.point(e.paddingTopLeft||e.padding||[0,0]),n=s.point(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,i.add(n)),r=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),o),l=this.project(t.getNorthEast(),o),h=this.unproject(a.add(l).divideBy(2).add(r),o);return o=e&&e.maxZoom?Math.min(e.maxZoom,o):o,this.setView(h,o,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)
},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(s.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=s.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=s.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=s.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?s.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=s.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),o=i.divideBy(2).round(),r=n.subtract(o);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new s.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=s.latLngBounds(t);var n,o=this.getMinZoom()-(e?1:0),r=this.getMaxZoom(),a=this.getSize(),l=t.getNorthWest(),h=t.getSouthEast(),c=!0;i=s.point(i||[0,0]);do o++,n=this.project(h,o).subtract(this.project(l,o)).add(i),c=e?n.x<a.x||n.y<a.y:a.contains(n);while(c&&r>=o);return c&&e?null:e?o:o-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new s.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new s.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(s.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(s.point(t),e)},layerPointToLatLng:function(t){var e=s.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(s.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return s.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return s.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(s.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(s.latLng(t)))},mouseEventToContainerPoint:function(t){return s.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=s.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;s.DomUtil.addClass(t,"leaflet-container"+(s.Browser.touch?" leaflet-touch":"")+(s.Browser.retina?" leaflet-retina":"")+(s.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=s.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(s.DomUtil.addClass(t.markerPane,e),s.DomUtil.addClass(t.shadowPane,e),s.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return s.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?s.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var o=this._zoom!==e;n||(this.fire("movestart"),o&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):s.DomUtil.setPosition(this._mapPane,new s.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var r=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),r&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(o||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){s.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-1/0,s=this._getZoomSpan();for(t in this._zoomBoundLayers){var o=this._zoomBoundLayers[t];isNaN(o.options.minZoom)||(e=Math.min(e,o.options.minZoom)),isNaN(o.options.maxZoom)||(n=Math.max(n,o.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),s!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(s.DomEvent){e=e||"on",s.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,o=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=o.length;n>i;i++)s.DomEvent[e](this._container,o[i],this._fireMouseEvent,this);this.options.trackResize&&s.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){s.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=s.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||s.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!s.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&s.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),o=this.layerPointToLatLng(n);this.fire(e,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return s.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),o=this.getSize().divideBy(2),r=new s.Bounds(n.subtract(o),n.add(o)),a=this._getBoundsOffset(r,i,e);return this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new s.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),o=this.project(e.getSouthEast(),i).subtract(t.max),r=this._rebound(n.x,-o.x),a=this._rebound(n.y,-o.y);return new s.Point(r,a)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),s.map=function(t,e){return new s.Map(t,e)},s.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=this.R_MAJOR,r=this.R_MINOR,a=t.lng*e*o,l=n*e,h=r/o,c=Math.sqrt(1-h*h),u=c*Math.sin(l);u=Math.pow((1-u)/(1+u),.5*c);var d=Math.tan(.5*(.5*Math.PI-l))/u;return l=-o*Math.log(d),new s.Point(a,l)},unproject:function(t){for(var e,i=s.LatLng.RAD_TO_DEG,n=this.R_MAJOR,o=this.R_MINOR,r=t.x*i/n,a=o/n,l=Math.sqrt(1-a*a),h=Math.exp(-t.y/n),c=Math.PI/2-2*Math.atan(h),u=15,d=1e-7,p=u,f=.1;Math.abs(f)>d&&--p>0;)e=l*Math.sin(c),f=Math.PI/2-2*Math.atan(h*Math.pow((1-e)/(1+e),.5*l))-c,c+=f;return new s.LatLng(c*i,r)}},s.CRS.EPSG3395=s.extend({},s.CRS,{code:"EPSG:3395",projection:s.Projection.Mercator,transformation:function(){var t=s.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new s.Transformation(i,.5,-i,.5)}()}),s.TileLayer=s.Class.extend({includes:s.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:s.Browser.mobile,updateWhenIdle:s.Browser.mobile},initialize:function(t,e){e=s.setOptions(this,e),e.detectRetina&&s.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=s.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=s.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,s,o=t.children,r=-e(1/0,-1/0);for(n=0,s=o.length;s>n;n++)o[n]!==this._container&&(i=parseInt(o[n].style.zIndex,10),isNaN(i)||(r=e(r,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(r)?r:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(s.Browser.ielt9)for(t in e)s.DomUtil.setOpacity(e[t],this.options.opacity);else s.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=s.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=s.DomUtil.create("div",e,this._container),this._tileContainer=s.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var o=s.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(o),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(o)}}},_addTilesFromCenterOut:function(t){var i,n,o,r=[],a=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)o=new s.Point(n,i),this._tileShouldBeLoaded(o)&&r.push(o);var l=r.length;if(0!==l){r.sort(function(t,e){return t.distanceTo(a)-e.distanceTo(a)});var h=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=l,n=0;l>n;n++)this._addTile(r[n],h);this._tileContainer.appendChild(h)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=e.tileSize,s=t.multiplyBy(n),o=s.add([n,n]),r=this._map.unproject(s),a=this._map.unproject(o);if(e.continuousWorld||e.noWrap||(r=r.wrap(),a=a.wrap()),!e.bounds.intersects([r,a]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,s;for(s in this._tiles)e=s.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(s)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(s.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),s.Browser.android||(e.onload=null,e.src=s.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();s.DomUtil.setPosition(n,i,s.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return s.Util.template(this._url,s.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=s.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=s.Util.falseFn,s.Browser.ielt9&&this.options.opacity!==i&&s.DomUtil.setOpacity(t,this.options.opacity),s.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&s.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(s.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==s.Util.emptyImageUrl&&(s.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),s.tileLayer=function(t,e){return new s.TileLayer(t,e)},s.TileLayer.WMS=s.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=s.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&s.Browser.retina?2*n:n;for(var o in e)this.options.hasOwnProperty(o)||"crs"===o||(i[o]=e[o]);this.wmsParams=i,s.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,s.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),o=n.add([i,i]),r=this._crs.project(e.unproject(n,t.z)),a=this._crs.project(e.unproject(o,t.z)),l=this._wmsVersion>=1.3&&this._crs===s.CRS.EPSG4326?[a.y,r.x,r.y,a.x].join(","):[r.x,a.y,a.x,r.y].join(","),h=s.Util.template(this._url,{s:this._getSubdomain(t)});return h+s.Util.getParamString(this.wmsParams,h,!0)+"&BBOX="+l},setParams:function(t,e){return s.extend(this.wmsParams,t),e||this.redraw(),this}}),s.tileLayer.wms=function(t,e){return new s.TileLayer.WMS(t,e)},s.TileLayer.Canvas=s.TileLayer.extend({options:{async:!1},initialize:function(t){s.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=s.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=s.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),s.tileLayer.canvas=function(t){return new s.TileLayer.Canvas(t)},s.ImageOverlay=s.Class.extend({includes:s.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=s.latLngBounds(e),s.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&s.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=s.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&s.Browser.any3d?s.DomUtil.addClass(this._image,"leaflet-zoom-animated"):s.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),s.extend(this._image,{galleryimg:"no",onselectstart:s.Util.falseFn,onmousemove:s.Util.falseFn,onload:s.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),o=this._bounds.getNorthWest(),r=this._bounds.getSouthEast(),a=e._latLngToNewLayerPoint(o,t.zoom,t.center),l=e._latLngToNewLayerPoint(r,t.zoom,t.center)._subtract(a),h=a._add(l._multiplyBy(.5*(1-1/n)));i.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(h)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);s.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){s.DomUtil.setOpacity(this._image,this.options.opacity)}}),s.imageOverlay=function(t,e,i){return new s.ImageOverlay(t,e,i)},s.Icon=s.Class.extend({options:{className:""},initialize:function(t){s.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,o=s.point(n[e+"Size"]);i="shadow"===e?s.point(n.shadowAnchor||n.iconAnchor):s.point(n.iconAnchor),!i&&o&&(i=o.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return s.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),s.icon=function(t){return new s.Icon(t)},s.Icon.Default=s.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];s.Browser.retina&&"icon"===t&&(t+="-2x");var i=s.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),s.Icon.Default.imagePath=function(){var t,i,n,s,o,r=e.getElementsByTagName("script"),a=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=r.length;i>t;t++)if(n=r[t].src,s=n.match(a))return o=n.split(a)[0],(o?o+"/":"")+"images"}(),s.Marker=s.Class.extend({includes:s.Mixin.Events,options:{icon:new s.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){s.setOptions(this,e),this._latlng=s.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=s.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",o=t.icon.createIcon(this._icon),r=!1;o!==this._icon&&(this._icon&&this._removeIcon(),r=!0,t.title&&(o.title=t.title),t.alt&&(o.alt=t.alt)),s.DomUtil.addClass(o,n),t.keyboard&&(o.tabIndex="0"),this._icon=o,this._initInteraction(),t.riseOnHover&&s.DomEvent.on(o,"mouseover",this._bringToFront,this).on(o,"mouseout",this._resetZIndex,this);var a=t.icon.createShadow(this._shadow),l=!1;a!==this._shadow&&(this._removeShadow(),l=!0),a&&s.DomUtil.addClass(a,n),this._shadow=a,t.opacity<1&&this._updateOpacity();var h=this._map._panes;r&&h.markerPane.appendChild(this._icon),a&&l&&h.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&s.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){s.DomUtil.setPosition(this._icon,t),this._shadow&&s.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];s.DomUtil.addClass(t,"leaflet-clickable"),s.DomEvent.on(t,"click",this._onMouseClick,this),s.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)s.DomEvent.on(t,e[i],this._fireMouseEvent,this);s.Handler.MarkerDrag&&(this.dragging=new s.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&s.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&s.DomEvent.preventDefault(t),"mousedown"!==t.type?s.DomEvent.stopPropagation(t):s.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){s.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&s.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),s.marker=function(t,e){return new s.Marker(t,e)},s.DivIcon=s.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return i.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),s.divIcon=function(t){return new s.DivIcon(t)},s.Map.mergeOptions({closePopupOnClick:!0}),s.Popup=s.Class.extend({includes:s.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){s.setOptions(this,t),this._source=e,this._animated=s.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&s.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&s.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),s.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&s.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=s.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t
},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=s.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=s.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",s.DomEvent.disableClickPropagation(t),s.DomEvent.on(t,"click",this._onCloseButtonClick,this));var o=this._wrapper=s.DomUtil.create("div",e+"-content-wrapper",n);s.DomEvent.disableClickPropagation(o),this._contentNode=s.DomUtil.create("div",e+"-content",o),s.DomEvent.disableScrollPropagation(this._contentNode),s.DomEvent.on(o,"contextmenu",s.DomEvent.stopPropagation),this._tipContainer=s.DomUtil.create("div",e+"-tip-container",n),this._tip=s.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,o=this.options.maxHeight,r="leaflet-popup-scrolled";o&&n>o?(e.height=o+"px",s.DomUtil.addClass(t,r)):s.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=s.point(this.options.offset);e&&s.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);s.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new s.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(s.DomUtil.getPosition(this._container));var o=t.layerPointToContainerPoint(n),r=s.point(this.options.autoPanPadding),a=s.point(this.options.autoPanPaddingTopLeft||r),l=s.point(this.options.autoPanPaddingBottomRight||r),h=t.getSize(),c=0,u=0;o.x+i+l.x>h.x&&(c=o.x+i-h.x+l.x),o.x-c-a.x<0&&(c=o.x-a.x),o.y+e+l.y>h.y&&(u=o.y+e-h.y+l.y),o.y-u-a.y<0&&(u=o.y-a.y),(c||u)&&t.fire("autopanstart").panBy([c,u])}},_onCloseButtonClick:function(t){this._close(),s.DomEvent.stop(t)}}),s.popup=function(t,e){return new s.Popup(t,e)},s.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof s.Popup)){var n=t;t=new s.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),s.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=s.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(s.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=s.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof s.Popup?(s.setOptions(t,e),this._popup=t):this._popup=new s.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),s.LayerGroup=s.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s.stamp(t)}}),s.layerGroup=function(t){return new s.LayerGroup(t)},s.FeatureGroup=s.LayerGroup.extend({includes:s.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.off(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new s.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof s.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=s.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),s.featureGroup=function(t){return new s.FeatureGroup(t)},s.Path=s.Class.extend({includes:[s.Mixin.Events],statics:{CLIP_PADDING:function(){var e=s.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){s.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,s.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return s.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),s.Map.include({_updatePathViewport:function(){var t=s.Path.CLIP_PADDING,e=this.getSize(),i=s.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),o=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new s.Bounds(n,o)}}),s.Path.SVG_NS="http://www.w3.org/2000/svg",s.Browser.svg=!(!e.createElementNS||!e.createElementNS(s.Path.SVG_NS,"svg").createSVGRect),s.Path=s.Path.extend({statics:{SVG:s.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(s.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&s.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(s.Browser.svg||!s.Browser.vml)&&s.DomUtil.addClass(this._path,"leaflet-clickable"),s.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)s.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),o=e.layerPointToLatLng(n);this.fire(t.type,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&s.DomEvent.preventDefault(t),"mousemove"!==t.type&&s.DomEvent.stopPropagation(t)}}}),s.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=s.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&s.Browser.any3d?(s.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):s.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,o=i.y-e.y,r=this._pathRoot,a=this._panes.overlayPane;s.Browser.mobileWebkit&&a.removeChild(r),s.DomUtil.setPosition(r,e),r.setAttribute("width",n),r.setAttribute("height",o),r.setAttribute("viewBox",[e.x,e.y,n,o].join(" ")),s.Browser.mobileWebkit&&a.appendChild(r)}}}),s.Path.include({bindPopup:function(t,e){return t instanceof s.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new s.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),s.Browser.vml=!s.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),s.Path=s.Browser.svg||!s.Browser.vml?s.Path:s.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");s.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&s.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?s.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):"",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),s.Map.include(s.Browser.svg||!s.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),s.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),s.Path=s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?s.Path:s.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return s.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!s.Path._updateRequest&&(s.Path._updateRequest=s.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){s.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,o,r;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)o=this._parts[t][e],r=(0===e?"move":"line")+"To",this._ctx[r](o.x,o.y);this instanceof s.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),s.Map.include(s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;s.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),s.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,s=typeof Uint8Array!=i+""?Uint8Array:Array,o=new s(n);o[0]=o[n-1]=1,this._simplifyDPStep(t,o,e,0,n-1);var r,a=[];for(r=0;n>r;r++)o[r]&&a.push(t[r]);return a},_simplifyDPStep:function(t,e,i,n,s){var o,r,a,l=0;for(r=n+1;s-1>=r;r++)a=this._sqClosestPointOnSegment(t[r],t[n],t[s],!0),a>l&&(o=r,l=a);l>i&&(e[o]=1,this._simplifyDPStep(t,e,i,n,o),this._simplifyDPStep(t,e,i,o,s))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,s=0,o=t.length;o>n;n++)this._sqDist(t[n],t[s])>e&&(i.push(t[n]),s=n);return o-1>s&&i.push(t[o-1]),i},clipSegment:function(t,e,i,n){var s,o,r,a=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(a|l))return[t,e];if(a&l)return!1;s=a||l,o=this._getEdgeIntersection(t,e,s,i),r=this._getBitCode(o,i),s===a?(t=o,a=r):(e=o,l=r)}},_getEdgeIntersection:function(t,e,i,n){var o=e.x-t.x,r=e.y-t.y,a=n.min,l=n.max;return 8&i?new s.Point(t.x+o*(l.y-t.y)/r,l.y):4&i?new s.Point(t.x+o*(a.y-t.y)/r,a.y):2&i?new s.Point(l.x,t.y+r*(l.x-t.x)/o):1&i?new s.Point(a.x,t.y+r*(a.x-t.x)/o):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var o,r=e.x,a=e.y,l=i.x-r,h=i.y-a,c=l*l+h*h;return c>0&&(o=((t.x-r)*l+(t.y-a)*h)/c,o>1?(r=i.x,a=i.y):o>0&&(r+=l*o,a+=h*o)),l=t.x-r,h=t.y-a,n?l*l+h*h:new s.Point(r,a)}},s.Polyline=s.Path.extend({initialize:function(t,e){s.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(s.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,o=this._parts,r=null,a=0,l=o.length;l>a;a++)for(var h=o[a],c=1,u=h.length;u>c;c++){e=h[c-1],i=h[c];var d=s.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>d&&(n=d,r=s.LineUtil._sqClosestPointOnSegment(t,e,i))}return r&&(r.distance=Math.sqrt(n)),r},getBounds:function(){return new s.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,o=e?t:[];for(i=0,n=t.length;n>i;i++){if(s.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;o[i]=s.latLng(t[i])}return o},_initEvents:function(){s.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=s.Path.VML,n=0,o=t.length,r="";o>n;n++)e=t[n],i&&e._round(),r+=(n?"L":"M")+e.x+" "+e.y;return r},_clipPoints:function(){var t,e,i,n=this._originalPoints,o=n.length;if(this.options.noClip)return this._parts=[n],void 0;this._parts=[];var r=this._parts,a=this._map._pathViewport,l=s.LineUtil;for(t=0,e=0;o-1>t;t++)i=l.clipSegment(n[t],n[t+1],a,t),i&&(r[e]=r[e]||[],r[e].push(i[0]),(i[1]!==n[t+1]||t===o-2)&&(r[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=s.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),s.Path.prototype._updatePath.call(this))}}),s.polyline=function(t,e){return new s.Polyline(t,e)},s.PolyUtil={},s.PolyUtil.clipPolygon=function(t,e){var i,n,o,r,a,l,h,c,u,d=[1,4,2,8],p=s.LineUtil;for(n=0,h=t.length;h>n;n++)t[n]._code=p._getBitCode(t[n],e);for(r=0;4>r;r++){for(c=d[r],i=[],n=0,h=t.length,o=h-1;h>n;o=n++)a=t[n],l=t[o],a._code&c?l._code&c||(u=p._getEdgeIntersection(l,a,c,e),u._code=p._getBitCode(u,e),i.push(u)):(l._code&c&&(u=p._getEdgeIntersection(l,a,c,e),u._code=p._getBitCode(u,e),i.push(u)),i.push(a));t=i}return t},s.Polygon=s.Polyline.extend({options:{fill:!0},initialize:function(t,e){s.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&s.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(s.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&s.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):s.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var o=s.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);o.length&&e.push(o)}this._parts=e}},_getPathPartStr:function(t){var e=s.Polyline.prototype._getPathPartStr.call(this,t);return e+(s.Browser.svg?"z":"x")}}),s.polygon=function(t,e){return new s.Polygon(t,e)},function(){function t(t){return s.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}s.MultiPolyline=t(s.Polyline),s.MultiPolygon=t(s.Polygon),s.multiPolyline=function(t,e){return new s.MultiPolyline(t,e)},s.multiPolygon=function(t,e){return new s.MultiPolygon(t,e)}}(),s.Rectangle=s.Polygon.extend({initialize:function(t,e){s.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=s.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),s.rectangle=function(t,e){return new s.Rectangle(t,e)},s.Circle=s.Path.extend({initialize:function(t,e,i){s.Path.prototype.initialize.call(this,i),this._latlng=s.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=s.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=360*(this._mRadius/40075017),i=this._latlng;return new s.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":s.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,"+23592600)},getRadius:function(){return this._mRadius},_getLatRadius:function(){return 360*(this._mRadius/40075017)},_getLngRadius:function(){return this._getLatRadius()/Math.cos(s.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),s.circle=function(t,e,i){return new s.Circle(t,e,i)},s.CircleMarker=s.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){s.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){s.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return s.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),s.circleMarker=function(t,e){return new s.CircleMarker(t,e)},s.Polyline.include(s.Path.CANVAS?{_containsPoint:function(t,e){var i,n,o,r,a,l,h,c=this.options.weight/2;for(s.Browser.touch&&(c+=10),i=0,r=this._parts.length;r>i;i++)for(h=this._parts[i],n=0,a=h.length,o=a-1;a>n;o=n++)if((e||0!==n)&&(l=s.LineUtil.pointToSegmentDistance(t,h[o],h[n]),c>=l))return!0;return!1}}:{}),s.Polygon.include(s.Path.CANVAS?{_containsPoint:function(t){var e,i,n,o,r,a,l,h,c=!1;if(s.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(o=0,l=this._parts.length;l>o;o++)for(e=this._parts[o],r=0,h=e.length,a=h-1;h>r;a=r++)i=e[r],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(c=!c);return c}}:{}),s.Circle.include(s.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),s.CircleMarker.include(s.Path.CANVAS?{_updateStyle:function(){s.Path.prototype._updateStyle.call(this)}}:{}),s.GeoJSON=s.FeatureGroup.extend({initialize:function(t,e){s.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,o=s.Util.isArray(t)?t:t.features;if(o){for(e=0,i=o.length;i>e;e++)n=o[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(o[e]);return this}var r=this.options;if(!r.filter||r.filter(t)){var a=s.GeoJSON.geometryToLayer(t,r.pointToLayer,r.coordsToLatLng,r);return a.feature=s.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){var e=this.options.style;e&&(s.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),s.extend(s.GeoJSON,{geometryToLayer:function(t,e,i,n){var o,r,a,l,h="Feature"===t.type?t.geometry:t,c=h.coordinates,u=[];switch(i=i||this.coordsToLatLng,h.type){case"Point":return o=i(c),e?e(t,o):new s.Marker(o);case"MultiPoint":for(a=0,l=c.length;l>a;a++)o=i(c[a]),u.push(e?e(t,o):new s.Marker(o));return new s.FeatureGroup(u);case"LineString":return r=this.coordsToLatLngs(c,0,i),new s.Polyline(r,n);case"Polygon":if(2===c.length&&!c[1].length)throw new Error("Invalid GeoJSON object.");return r=this.coordsToLatLngs(c,1,i),new s.Polygon(r,n);case"MultiLineString":return r=this.coordsToLatLngs(c,1,i),new s.MultiPolyline(r,n);case"MultiPolygon":return r=this.coordsToLatLngs(c,2,i),new s.MultiPolygon(r,n);case"GeometryCollection":for(a=0,l=h.geometries.length;l>a;a++)u.push(this.geometryToLayer({geometry:h.geometries[a],type:"Feature",properties:t.properties},e,i,n));return new s.FeatureGroup(u);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new s.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,s,o,r=[];for(s=0,o=t.length;o>s;s++)n=e?this.coordsToLatLngs(t[s],e-1,i):(i||this.coordsToLatLng)(t[s]),r.push(n);return r},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(s.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?s.extend({},t.feature,{geometry:e}):s.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var r={toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"Point",coordinates:s.GeoJSON.latLngToCoords(this.getLatLng())})}};s.Marker.include(r),s.Circle.include(r),s.CircleMarker.include(r),s.Polyline.include({toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"LineString",coordinates:s.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),s.Polygon.include({toGeoJSON:function(){var t,e,i,n=[s.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=s.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return s.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),s.GeoJSON.getFeature(this,{type:t,coordinates:e})}}s.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),s.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),s.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var o=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(o?e.geometry:s.GeoJSON.asFeature(e)))}),o?s.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),s.geoJson=function(t,e){return new s.GeoJSON(t,e)
},s.DomEvent={addListener:function(t,e,i,n){var o,r,a,l=s.stamp(i),h="_leaflet_"+e+l;return t[h]?this:(o=function(e){return i.call(n||t,e||s.DomEvent._getEvent())},s.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,o,l):(s.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,o,l),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",o,!1),t.addEventListener(e,o,!1)):"mouseenter"===e||"mouseleave"===e?(r=o,a="mouseenter"===e?"mouseover":"mouseout",o=function(e){return s.DomEvent._checkMouse(t,e)?r(e):void 0},t.addEventListener(a,o,!1)):"click"===e&&s.Browser.android?(r=o,o=function(t){return s.DomEvent._filterClick(t,r)},t.addEventListener(e,o,!1)):t.addEventListener(e,o,!1):"attachEvent"in t&&t.attachEvent("on"+e,o),t[h]=o,this))},removeListener:function(t,e,i){var n=s.stamp(i),o="_leaflet_"+e+n,r=t[o];return r?(s.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):s.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",r,!1),t.removeEventListener(e,r,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",r,!1):t.removeEventListener(e,r,!1):"detachEvent"in t&&t.detachEvent("on"+e,r),t[o]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,s.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=s.DomEvent.stopPropagation;return s.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=s.DomEvent.stopPropagation,i=s.Draggable.START.length-1;i>=0;i--)s.DomEvent.on(t,s.Draggable.START[i],e);return s.DomEvent.on(t,"click",s.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return s.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new s.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new s.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){s.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=s.DomEvent._lastClick&&i-s.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?(s.DomEvent.stop(t),void 0):(s.DomEvent._lastClick=i,e(t))}},s.DomEvent.on=s.DomEvent.addListener,s.DomEvent.off=s.DomEvent.removeListener,s.Draggable=s.Class.extend({includes:s.Mixin.Events,statics:{START:s.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.on(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.off(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(s.DomEvent.stopPropagation(t),s.Draggable._disabled||(s.DomUtil.disableImageDrag(),s.DomUtil.disableTextSelection(),this._moving)))){var i=t.touches?t.touches[0]:t;this._startPoint=new s.Point(i.clientX,i.clientY),this._startPos=this._newPos=s.DomUtil.getPosition(this._element),s.DomEvent.on(e,s.Draggable.MOVE[t.type],this._onMove,this).on(e,s.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return this._moved=!0,void 0;var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new s.Point(i.clientX,i.clientY),o=n.subtract(this._startPoint);(o.x||o.y)&&(s.Browser.touch&&Math.abs(o.x)+Math.abs(o.y)<3||(s.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=s.DomUtil.getPosition(this._element).subtract(o),s.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,s.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),s.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){s.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(s.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in s.Draggable.MOVE)s.DomEvent.off(e,s.Draggable.MOVE[t],this._onMove).off(e,s.Draggable.END[t],this._onUp);s.DomUtil.enableImageDrag(),s.DomUtil.enableTextSelection(),this._moved&&this._moving&&(s.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),s.Handler=s.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),s.Map.mergeOptions({dragging:!0,inertia:!s.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:s.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),s.Map.Drag=s.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new s.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,s=(n-e+i)%t+e-i,o=(n+e+i)%t-e-i,r=Math.abs(s+i)<Math.abs(o+i)?s:o;this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,o=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),o)e.fire("moveend");else{var r=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+n-this._times[0])/1e3,l=i.easeLinearity,h=r.multiplyBy(l/a),c=h.distanceTo([0,0]),u=Math.min(i.inertiaMaxSpeed,c),d=h.multiplyBy(u/c),p=u/(i.inertiaDeceleration*l),f=d.multiplyBy(-p/2).round();f.x&&f.y?(f=e._limitOffset(f,e.options.maxBounds),s.Util.requestAnimFrame(function(){e.panBy(f,{duration:p,easeLinearity:l,noMoveStart:!0})})):e.fire("moveend")}}}),s.Map.addInitHook("addHandler","dragging",s.Map.Drag),s.Map.mergeOptions({doubleClickZoom:!0}),s.Map.DoubleClickZoom=s.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),s.Map.addInitHook("addHandler","doubleClickZoom",s.Map.DoubleClickZoom),s.Map.mergeOptions({scrollWheelZoom:!0}),s.Map.ScrollWheelZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),s.DomEvent.on(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault),this._delta=0},removeHooks:function(){s.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),s.DomEvent.off(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=s.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s.bind(this._performZoom,this),i),s.DomEvent.preventDefault(t),s.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),s.Map.addInitHook("addHandler","scrollWheelZoom",s.Map.ScrollWheelZoom),s.extend(s.DomEvent,{_touchstart:s.Browser.msPointer?"MSPointerDown":s.Browser.pointer?"pointerdown":"touchstart",_touchend:s.Browser.msPointer?"MSPointerUp":s.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function o(t){var e;if(s.Browser.pointer?(f.push(t.pointerId),e=f.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(a||i);l=t.touches?t.touches[0]:t,h=n>0&&c>=n,a=i}}function r(t){if(s.Browser.pointer){var e=f.indexOf(t.pointerId);if(-1===e)return;f.splice(e,1)}if(h){if(s.Browser.pointer){var n,o={};for(var r in l)n=l[r],o[r]="function"==typeof n?n.bind(l):n;l=o}l.type="dblclick",i(l),a=null}}var a,l,h=!1,c=250,u="_leaflet_",d=this._touchstart,p=this._touchend,f=[];t[u+d+n]=o,t[u+p+n]=r;var m=s.Browser.pointer?e.documentElement:t;return t.addEventListener(d,o,!1),m.addEventListener(p,r,!1),s.Browser.pointer&&m.addEventListener(s.DomEvent.POINTER_CANCEL,r,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(s.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),s.Browser.pointer&&e.documentElement.removeEventListener(s.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),s.extend(s.DomEvent,{POINTER_DOWN:s.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:s.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:s.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:s.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,o){var r="_leaflet_",a=this._pointers,l=function(t){s.DomEvent.preventDefault(t);for(var e=!1,i=0;i<a.length;i++)if(a[i].pointerId===t.pointerId){e=!0;break}e||a.push(t),t.touches=a.slice(),t.changedTouches=[t],n(t)};if(t[r+"touchstart"+o]=l,t.addEventListener(this.POINTER_DOWN,l,!1),!this._pointerDocumentListener){var h=function(t){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,h,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,h,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function s(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r[e]=t;break}t.touches=r.slice(),t.changedTouches=[t],i(t)}}var o="_leaflet_",r=this._pointers;return t[o+"touchmove"+n]=s,t.addEventListener(this.POINTER_MOVE,s,!1),this},addPointerListenerEnd:function(t,e,i,n){var s="_leaflet_",o=this._pointers,r=function(t){for(var e=0;e<o.length;e++)if(o[e].pointerId===t.pointerId){o.splice(e,1);break}t.touches=o.slice(),t.changedTouches=[t],i(t)};return t[s+"touchend"+n]=r,t.addEventListener(this.POINTER_UP,r,!1),t.addEventListener(this.POINTER_CANCEL,r,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",s=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,s,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,s,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,s,!1),t.removeEventListener(this.POINTER_CANCEL,s,!1)}return this}}),s.Map.mergeOptions({touchZoom:s.Browser.touch&&!s.Browser.android23,bounceAtZoomLimits:!0}),s.Map.TouchZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),o=i.mouseEventToLayerPoint(t.touches[1]),r=i._getCenterLayerPoint();this._startCenter=n.add(o)._divideBy(2),this._startDist=n.distanceTo(o),this._moved=!1,this._zooming=!0,this._centerOffset=r.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),s.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),s.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(s.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),s.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return this._zooming=!1,void 0;var t=this._map;this._zooming=!1,s.DomUtil.removeClass(t._mapPane,"leaflet-touching"),s.Util.cancelAnimFrame(this._animRequest),s.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),o=t.getZoom(),r=t.getScaleZoom(this._scale)-o,a=r>0?Math.ceil(r):Math.floor(r),l=t._limitZoom(o+a),h=t.getZoomScale(l)/this._scale;t._animateZoom(n,l,i,h)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),s.Map.addInitHook("addHandler","touchZoom",s.Map.TouchZoom),s.Map.mergeOptions({tap:!0,tapTolerance:15}),s.Map.Tap=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(s.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,clearTimeout(this._holdTimeout),void 0;var i=t.touches[0],n=i.target;this._startPos=this._newPos=new s.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&s.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(s.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),s.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),s.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&s.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new s.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var s=e.createEvent("MouseEvents");s._simulated=!0,n.target._simulatedClick=!0,s.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(s)}}),s.Browser.touch&&!s.Browser.pointer&&s.Map.addInitHook("addHandler","tap",s.Map.Tap),s.Map.mergeOptions({boxZoom:!0}),s.Map.BoxZoom=s.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){s.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){s.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(s.DomUtil.disableTextSelection(),s.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),s.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this),void 0)},_onMouseMove:function(t){this._moved||(this._box=s.DomUtil.create("div","leaflet-zoom-box",this._pane),s.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),o=n.subtract(e),r=new s.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));s.DomUtil.setPosition(i,r),this._moved=!0,i.style.width=Math.max(0,Math.abs(o.x)-4)+"px",i.style.height=Math.max(0,Math.abs(o.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),s.DomUtil.enableTextSelection(),s.DomUtil.enableImageDrag(),s.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new s.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),s.Map.addInitHook("addHandler","boxZoom",s.Map.BoxZoom),s.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),s.Map.Keyboard=s.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),s.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;s.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,s=i.scrollTop||n.scrollTop,o=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(o,s)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},s=this.keyCodes;for(e=0,i=s.left.length;i>e;e++)n[s.left[e]]=[-1*t,0];for(e=0,i=s.right.length;i>e;e++)n[s.right[e]]=[t,0];for(e=0,i=s.down.length;i>e;e++)n[s.down[e]]=[0,t];for(e=0,i=s.up.length;i>e;e++)n[s.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},s=this.keyCodes;for(e=0,i=s.zoomIn.length;i>e;e++)n[s.zoomIn[e]]=t;for(e=0,i=s.zoomOut.length;i>e;e++)n[s.zoomOut[e]]=-t},_addHooks:function(){s.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){s.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}s.DomEvent.stop(t)}}),s.Map.addInitHook("addHandler","keyboard",s.Map.Keyboard),s.Handler.MarkerDrag=s.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new s.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),s.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),s.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=s.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&s.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),s.Control=s.Class.extend({options:{position:"topright"},initialize:function(t){s.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return s.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),s.control=function(t){return new s.Control(t)},s.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,o){var r=i+t+" "+i+o;e[t+o]=s.DomUtil.create("div",r,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=s.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),s.Control.Zoom=s.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=s.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,o,r){var a=s.DomUtil.create("a",i,n);a.innerHTML=t,a.href="#",a.title=e;var l=s.DomEvent.stopPropagation;return s.DomEvent.on(a,"click",l).on(a,"mousedown",l).on(a,"dblclick",l).on(a,"click",s.DomEvent.preventDefault).on(a,"click",o,r).on(a,"click",this._refocusOnMap,r),a},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";s.DomUtil.removeClass(this._zoomInButton,e),s.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&s.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&s.DomUtil.addClass(this._zoomInButton,e)}}),s.Map.mergeOptions({zoomControl:!0}),s.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new s.Control.Zoom,this.addControl(this.zoomControl))}),s.control.zoom=function(t){return new s.Control.Zoom(t)},s.Control.Attribution=s.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){s.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=s.DomUtil.create("div","leaflet-control-attribution"),s.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),s.Map.mergeOptions({attributionControl:!0}),s.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new s.Control.Attribution).addTo(this))}),s.control.attribution=function(t){return new s.Control.Attribution(t)},s.Control.Scale=s.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=s.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=s.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=s.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,s=this._map.getSize(),o=this.options,r=0;s.x>0&&(r=n*(o.maxWidth/s.x)),this._updateScales(o,r)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,s=3.2808399*t,o=this._iScale;s>5280?(e=s/5280,i=this._getRoundNum(e),o.style.width=this._getScaleWidth(i/e)+"px",o.innerHTML=i+" mi"):(n=this._getRoundNum(s),o.style.width=this._getScaleWidth(n/s)+"px",o.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),s.control.scale=function(t){return new s.Control.Scale(t)},s.Control.Layers=s.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){s.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=s.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=s.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),s.Browser.touch?s.DomEvent.on(e,"click",s.DomEvent.stopPropagation):s.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=s.DomUtil.create("form",t+"-list");if(this.options.collapsed){s.Browser.android||s.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=s.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",s.Browser.touch?s.DomEvent.on(n,"click",s.DomEvent.stop).on(n,"click",this._expand,this):s.DomEvent.on(n,"focus",this._expand,this),s.DomEvent.on(i,"click",function(){setTimeout(s.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=s.DomUtil.create("div",t+"-base",i),this._separator=s.DomUtil.create("div",t+"-separator",i),this._overlaysList=s.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=s.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[s.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var s=e.createElement("div");return s.innerHTML=n,s.firstChild},_addItem:function(t){var i,n=e.createElement("label"),o=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=o):i=this._createRadioElement("leaflet-base-layers",o),i.layerId=s.stamp(t.layer),s.DomEvent.on(i,"click",this._onInputClick,this);var r=e.createElement("span");r.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(r);var a=t.overlay?this._overlaysList:this._baseLayersList;
	return a.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),s=n.length;for(this._handlingClick=!0,t=0;s>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){s.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),s.control.layers=function(t,e,i){return new s.Control.Layers(t,e,i)},s.PosAnimation=s.Class.extend({includes:s.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[s.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",s.DomEvent.on(t,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),s.DomUtil.setPosition(t,e),s.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(s.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(s.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),s.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,this.fire("step"),void 0):(this._onTransitionEnd(),void 0)},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,o=this._el,r=t.getComputedStyle(o);if(s.Browser.any3d){if(n=r[s.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(r.left),i=parseFloat(r.top);return new s.Point(e,i,!0)},_onTransitionEnd:function(){s.DomEvent.off(this._el,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[s.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),s.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(s.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=s.extend({animate:n.animate},n.zoom),n.pan=s.extend({animate:n.animate},n.pan));var o=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(o)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=s.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new s.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){s.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){s.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),s.PosAnimation=s.DomUtil.TRANSITION?s.PosAnimation:s.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=s.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=s.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));s.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){s.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),s.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),s.DomUtil.TRANSITION&&s.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&s.DomUtil.TRANSITION&&s.Browser.any3d&&!s.Browser.android23&&!s.Browser.mobileOpera,this._zoomAnimated&&s.DomEvent.on(this._mapPane,s.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),s.Map.include(s.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n),o=this._getCenterLayerPoint()._add(s);return i.animate===!0||this.getSize().contains(s)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,o,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,o,r,a){a||(this._animatingZoom=!0),s.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,s.Draggable&&(s.Draggable._disabled=!0),s.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:o,backwards:r})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,s.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),s.Draggable&&(s.Draggable._disabled=!1)}}:{}),s.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=s.DomUtil.TRANSFORM,n=t.delta?s.DomUtil.getTranslateString(t.delta):e.style[i],o=s.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?o+" "+n:n+" "+o},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),s.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[s.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",this._stopLoadingImages(t),void 0):(e.style.visibility="hidden",e.style[s.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),clearTimeout(this._clearBgBufferTimer),void 0)},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),s=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&s++;return s/i},_stopLoadingImages:function(t){var e,i,n,o=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=o.length;i>e;e++)n=o[e],n.complete||(n.onload=s.Util.falseFn,n.onerror=s.Util.falseFn,n.src=s.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),s.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=s.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=s.bind(this._handleGeolocationResponse,this),i=s.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new s.LatLng(e,i),o=180*t.coords.accuracy/40075017,r=o/Math.cos(s.LatLng.DEG_TO_RAD*e),a=s.latLngBounds([e-o,i-r],[e+o,i+r]),l=this._locateOptions;if(l.setView){var h=Math.min(this.getBoundsZoom(a),l.maxZoom);this.setView(n,h)}var c={latlng:n,bounds:a,timestamp:t.timestamp};for(var u in t.coords)"number"==typeof t.coords[u]&&(c[u]=t.coords[u]);this.fire("locationfound",c)}})}(window,document),define("maps/views/MapsViewLeaflet",["jquery","underscore","util","abstracts/View","_libs/leaflet/leaflet-src","css!_libs/leaflet/leaflet.css","css!maps/css/maps.css","text!maps/tmpl/maps-leaflet.html","text!maps/tmpl/addr-marker-popup.html","i18n!_common/nls/common"],function(t,e,i,n,s,o,r,a,l,h){function c(){L.MarkerClusterGroup&&!L.MarkerClusterGroup.prototype.updateMarkerPos&&L.MarkerClusterGroup.include({getAllChildren:function(){return this._needsClustering.slice()},updateMarkerPos:function(t,e){if(t.__parent){var i=t.__parent._group._spiderfied,n=t._popup&&t._popup._map;return i||(n||this.removeLayer(t),e&&t.setLatLng(e),n||this.addLayer(t)),void 0}}}),L.Control.Zoomslider&&L.Control.Zoomslider.include({_createZoomBtn:function(t,e,i){var n=this.options.styleNS+"-"+t+" leaflet-bar-part"+" leaflet-bar-part-"+e,s=L.DomUtil.create("a",n,i);return s.href="#",s.title=h["zoom"+t.ucFirst()],L.DomEvent.on(s,"click",L.DomEvent.preventDefault),s}}),L.Control.Pan&&(L.Control.Pan.prototype._panButton,L.Control.Pan.include({_panButton:function(t,e,i,n,s){var o=L.DomUtil.create("div",e+"-wrap",i),r=L.DomUtil.create("a",e,o);return r.href="#",r.title=h["mapPan"+t],L.DomEvent.on(r,"click",L.DomEvent.stopPropagation).on(r,"click",L.DomEvent.preventDefault).on(r,"click",function(){n.panBy(s)},n).on(r,"dblclick",L.DomEvent.stopPropagation),r}}))}function u(){this.addressMarkers=[],this._LMap=null,this._map=null,this._tilesLayer=null,this._hybridLayer=null,this._trafficLayer=null,this._trafficUpdateInterval=null,this._errorTiles=0,this._brokenLevels=0,this._layerIsBroken=!1}LIBS_PATH="_libs/";var l=e.template(l),d={typeSelect:!0,compass:!1,ruler:!1,search:!1,searchTypes:!1,traffic:!1,routing:!1,print:!1,autozoom:!1,slider:!0,zoomButtons:!0,printer:!1,layersControl:!1,clearControl:!1,i18n:h};L_PREFER_CANVAS=!0;var p=.4,f=24e4;if(L.DomUtil.TRANSFORM)var m={transform:"transform",WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MozTransform:"-moz-transform",msTransform:"-ms-transform"},g=m[L.DomUtil.TRANSFORM];L.Map.addInitHook(function(){var e=this;if(this.options.traffic&&this.addControl(new L.Control.Traffic({onToggle:function(){e.fire("toggletraffic")}})),this.options.ruler&&L.ruler(this,{control:{position:"topright",title:h.mapRuler},i18n:{m:h.m,km:h.km}}),this.options.clearControl&&this.addControl(new L.Control.Clear),this.options.layersControl&&this.addControl(new L.Control.MapSelect),this.options.panControl){var i=L.control.pan();this.addControl(i);var n=this,s=t('<div class="zoom-indicator">'+this.getZoom()+"</div>").appendTo(i.getContainer());this.on("zoomend",function(){s.text(n.getZoom())})}this.options.zoomsliderControl&&this.addControl(new L.Control.Zoomslider),this.options.autozoom&&this.addControl(new L.Control.Autozoom({title:h.autozoom})),this.options.print&&this.addControl(new L.Control.Print({title:h.printMap})),this.options.coordinateControl&&L.Control.Coordinates&&this.addControl(new L.Control.Coordinates({position:"bottomright"})),this.addControl(L.control.scale({position:"bottomright",imperial:!1})),this.on("draw:edited",function(t){var e=t.layers,i=0;e.eachLayer(function(){i++}),console.log("Edited "+i+" layers")})}),L.CRS.Yandex=L.extend({},L.CRS,{code:"ydx",D_EXT:.08181979099211441,transformation:new L.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),_lngToX:function(t,e){return e*(.5+t/360)},_latToY:function(t,e){t>90&&(t-=180),-90>t&&(t+=180);var i=Math.sin(t*Math.PI/180),n=e/(2*Math.PI),s=e/2-n*(Math.atanh(i)-this.D_EXT*Math.atanh(this.D_EXT*i));return s===-1/0?s=0:1/0===s&&(s=e),s},_yToLat:function(t,e){var i=1;t>e/2&&(t=e-t,i=-1);var n=(t-e/2)/-(e/(2*Math.PI)),s=2*Math.atan(Math.exp(n))/(2*Math.PI)-1/(2*Math.PI),o=t-e/2,r=0,a=1e-7;do r=s,s=Math.asin(1-(1+Math.sin(r))*Math.pow(1-this.D_EXT*Math.sin(r),this.D_EXT)/(Math.exp(2*o/-(e/(2*Math.PI)))*Math.pow(1+this.D_EXT*Math.sin(r),this.D_EXT)));while(Math.abs(r-s)>a&&!isNaN(s));return 180*i*(isNaN(s)?r:s)/Math.PI},latLngToPoint:function(t,e){var i=this.scale(e),n=this._lngToX(t.lng,i),s=this._latToY(t.lat,i);return new L.Point(n,s)},pointToLatLng:function(t,e){var i=this.scale(e),n=this._yToLat(t.y,i),s=this.transformation.untransform(t,i),o=s.x*L.LatLng.RAD_TO_DEG;return new L.LatLng(n,o)}}),L.TileLayer.prototype.getTileUrl=function(t){return"function"==typeof this._url?this._url(t,this._getSubdomain(t),this.options):L.Util.template(this._url,L.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},L.Marker.include({_movePopup:function(t){this._popup&&this._popup.setLatLng(t.latlng)},unspiderfy:function(){this.__parent&&this.__parent._group._noanimationUnspiderfy()},getLatLon:function(){var t=this.getLatLng();return[t.lat,t.lng]}}),L.Popup.include({getContainer:function(){return this._container},close:function(){this._close()},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else if("function"==typeof this._content){var e;(e=this._content.call(this))&&t(this._contentNode).html(e)}else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}}}),L.FeatureGroup.include({addLayers:function(t){if(t&&t.length)for(b=0,len=t.length;len>b;b++)this.addLayer(t[b])}}),L.Path.include({_infoLayer:null,_showInfo:function(){this._infoLayer&&(this._infoLayer.textContent="function"==typeof this.options.info.content?this.options.info.content.call(this):this.options.info.content)},_moveInfo:function(){if(this._infoLayer){var t=this.getCenterXY();this._infoLayer.setAttribute("x",t.x),this._infoLayer.setAttribute("y",t.y)}}}),L.Path.addInitHook(function(){this.on("add",function(){var t=this,e=this._map;this.options.info&&this.getCenterXY&&(t._infoLayer=document.createElementNS(L.Path.SVG_NS,"text"),t._infoLayer.setAttribute("class","zone-info-layer leaflet-zoom-hide"+(this.options.info.addClass?" "+this.options.info.addClass:"")),t._infoLayer.setAttribute("dy","8"),t._infoLayer.setAttribute("x","0"),t._infoLayer.setAttribute("y","0"),t._infoLayer.setAttribute("fill","#cc0000"),t._path.parentNode.appendChild(t._infoLayer),this._showInfo(),this._moveInfo(),e.on("viewreset",this._moveInfo,this),e.on("zoomend",this._moveInfo,this),this.once("remove",function(){e.off("viewreset",t._moveInfo,t),e.off("zoomend",t._moveInfo,t),t._infoLayer&&t._path.parentNode.removeChild(t._infoLayer)}))})}),L.Polygon.include({getCenterXY:function(){for(var t=this.getLatLngs(),e=t.length,i=0,n=0,s=0;e>s;++s)i+=t[s].lat,n+=t[s].lng;return this._map.latLngToLayerPoint([i/e,n/e])}}),L.Circle.include({getCenterXY:function(){return this._map.latLngToLayerPoint(this.getLatLng())},latLngToLayerPoint:function(t){var e=this._map.project(L.latLng(t));return e._subtract(this._map.getPixelOrigin())}}),L.Circle.prototype.projectLatlngs=function(){var t=this._getLngRadius(),e=this._latlng,i=this.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1e-4)},L.Mixin.Events.trigger=L.Mixin.Events.fireEvent,L.Marker.prototype.trigger=L.Marker.prototype.fireEvent,L.FeatureGroup.prototype.trigger=L.FeatureGroup.prototype.fireEvent,L.Path.prototype.trigger=L.Mixin.Events.fireEvent,L.Handler.prototype.trigger=L.Mixin.Events.fireEvent,L.SVGIcon=L.DivIcon.extend({options:{iconSize:null,el:"div",className:"leaflet-svg-icon",addClassName:"",attributes:null,style:null},createIcon:function(e){var i=this.options,n=e&&e.tagName===i.el.toUpperCase()?e:document.createElement(i.el);i.addClassName&&(i.className+=" "+i.addClassName),n.innerHTML=i.html!==!1?i.html:"";var s=t(n);if(i.style&&s.css(i.style),i.attributes)for(var o in i.attributes)s.attr(o,i.attributes[o]);return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}}),L.PinIcon=L.SVGIcon.extend({options:{html:'<svg class="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="36" viewBox="0 0 24 36"><path class="svg-path svg-pin" d="M12,0C5.366,0,0,5.634,0,12.6C0,22.05,12,36,12,36s12-13.95,12-23.4C24,5.634,18.634,0,12,0z M12,17.1 c-2.484,0-4.5-2.016-4.5-4.5S9.516,8.1,12,8.1s4.5,2.016,4.5,4.5S14.484,17.1,12,17.1z"/></svg>'}}),L.ComplexIcon=L.DivIcon.extend({options:{iconSize:null,el:"div",className:"leaflet-div-icon complex-icon",html:!1,attributes:null,style:null},createIcon:function(e){var i=this.options,n=e&&e.tagName===i.el.toUpperCase()?e:document.createElement(i.el);n.innerHTML=i.html!==!1?i.html:"";var s=t(n);if(i.title&&(n.title=i.title),i.dataId&&s.attr("data-id",i.dataId),i.href&&(n.href=i.href),i.style&&s.css(i.style),i.attributes)for(var o in i.attributes)s.attr(o,i.attributes[o]);return this._setIconStyles(n,"icon"),n},createShadow:function(){return null}}),L.AnimatedMarker=L.Marker.extend({options:{distance:200,animated:!0,interval:1e3,autoStart:!0,normalizeSpeed:!1,onEnd:function(){}},initialize:function(t,i){this._latlngs=[],this._tid=null,this._bakIconTrans=!1,this._bakShadowTrans=!1,this._bakPopupTrans=!1;var n=null;t instanceof L.polyline||t[0]instanceof L.LatLng||e.isArray(t[0])?(this._prepare(t),n=t[0]):(this.options.autoStart=!1,n=t);var s=i.onEnd||null,o=this;this.options.onEnd=function(){o._tid=null,o._removeTransitions(),o._map&&o._map.off({zoomstart:o.stop},o),s&&s.apply(o,arguments)},L.Marker.prototype.initialize.call(this,n,i)},setLatLngs:function(t){t.length&&(this.stop(),this._prepare(t),this.setLatLng(t[0]),this._i=1,this.start())},_prepare:function(t){t instanceof L.polyline?t=t.getLatLngs():t[0]instanceof L.LatLng||(t=L.polyline(t).getLatLngs()),L.DomUtil.TRANSITION?this._latlngs=t:(this._latlngs=this._chunk(t),this.options.distance=10,this.options.interval=this.options.normalizeSpeed?30:this.options.interval/this._latlngs.length)},_chunk:function(t){var e,i=t.length,n=[];for(e=1;i>e;e++){var s=t[e-1],o=t[e],r=s.distanceTo(o),a=this.options.distance/r,l=a*(o.lat-s.lat),h=a*(o.lng-s.lng);if(r>this.options.distance)for(;r>this.options.distance;)s=new L.LatLng(s.lat+l,s.lng+h),r=s.distanceTo(o),n.push(s);else n.push(s)}return n},onAdd:function(t){L.Marker.prototype.onAdd.call(this,t),this.options.autoStart&&this.start()},animate:function(){if(this._latlngs){var t=this,e=this.options,i=this._latlngs.length,n=e.interval;if(this._i<i&&e.normalizeSpeed&&(n=this._latlngs[this._i-1].distanceTo(this._latlngs[this._i])/e.distance*e.interval),L.DomUtil.TRANSITION){var s=g+" "+n+"ms linear";if(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]=s),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]=s),this._popup){var o=this._popup.getContainer();o&&(o.style[L.DomUtil.TRANSITION]=g+" "+n+"ms linear")}}this.setLatLng(this._latlngs[this._i]),this._i++;var t=this;this._tid=setTimeout(function(){t._repeat()},n)}},start:function(){if(this._i||(this._i=1),L.DomUtil.TRANSITION&&(this._icon&&this._icon.style[L.DomUtil.TRANSITION]&&(this._bakIconTrans=this._icon.style[L.DomUtil.TRANSITION]),this._shadow&&this._shadow.style[L.DomUtil.TRANSITION]&&(this._bakShadowTrans=this._shadow.style[L.DomUtil.TRANSITION]),this._popup)){var t=this._popup.getContainer();t&&t.style[L.DomUtil.TRANSITION]&&(this._bakPopupTrans=t.style[L.DomUtil.TRANSITION])}this._map&&this._map.once("zoomstart",L.bind(this.stop,this),this),this.on("stop",L.bind(this.stop,this),this),this.animate()},stop:function(){this._icon&&(this._tid&&clearTimeout(this._tid),this._icon&&this._icon.style[L.DomUtil.TRANSITION]&&this._removeTransitions(),this._i<=this._latlngs.length&&this.setLatLng(e.last(this._latlngs)))},_repeat:function(){this._i===this._latlngs.length?this.options.onEnd.call(this):this.animate()},_removeTransitions:function(){if(L.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[L.DomUtil.TRANSITION]=this._bakIconTrans||""),this._shadow&&(this._shadow.style[L.DomUtil.TRANSITION]=this._bakShadowTrans||""),this._popup)){var t=this._popup.getContainer();t&&(t.style[L.DomUtil.TRANSITION]=this._bakPopupTrans||"")}}}),L.animatedMarker=function(t,e){return new L.AnimatedMarker(t,e)},L.Control.MapSelect=L.Control.extend({options:{position:"topright"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e,i={},n='<div class="btn dropdown pull-right leaflet-control-map-select"><a href="#"class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu nav nav-list" role="menu"><li data-map="YandexMap"><a href="#">'+h.mapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="GoogleMap"><a href="#">'+h.mapName.replace("#name#","Google")+"</a></li>"+'<li data-map="YandexMapSat"><a href="#">'+h.satMapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="YandexMapHybrid"><a href="#">'+h.hybridMapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="YandexMapPeople"><a href="#">'+h.wikiMapName.replace("#name#","Yandex")+"</a></li>"+'<li data-map="GoogleMapSat"><a href="#">'+h.satMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="GoogleMapHybrid"><a href="#">'+h.hybridMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="GoogleMapTerrain"><a href="#">'+h.landMapName.replace("#name#","Google")+"</a></li>"+'<li data-map="OpenStreetMap"><a href="#">'+h.mapName.replace("#name#","OpenStreetMap")+"</a></li>"+'<li data-map="OpenStreetMapTransport"><a href="#">'+h.transMapName.replace("#name#","OpenStreetMap")+"</a></li>";return(e=App.getServerSettings().specialMap)&&(n+='<li data-map="SpecialMap"><a href="#">'+(e.name||h.specialMapName)+"</a></li>"),n+="</ul></div>",i.button=t(n),L.DomEvent.disableClickPropagation(i.button[0]),i},_initEvents:function(){}}),L.Control.Traffic=L.Control.extend({options:{position:"topright",onToggle:null},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button class="btn leaflet-control-traffic'+(this._map.options.showTraffic?" active":"")+'">'+'<i class="icon-traffic"></i> '+h.traffic+"</button>"),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){var t=this;this._ui.button.on("click",function(){var e=t._map.options.showTraffic?"removeClass":"addClass";t._ui.button[e]("active"),t._map.options.showTraffic=!t._map.options.showTraffic,t.options.onToggle&&t.options.onToggle()})}}),L.Control.Print=L.Control.extend({options:{position:"topleft",title:"Print map"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-print">'+'<i class="svg-icon svg-icon-print"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){this._ui.button.on("click",function(){App.publish("printmainmap")})}}),L.Control.Autozoom=L.Control.extend({options:{position:"topleft",title:"Auto zoom"},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-autozoom">'+'<i class="icon-autozoom"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){var t=this;this._ui.button.on("click",function(){var e=this.className,i=-1!=e.indexOf(" fit"),n=-1!=e.indexOf(" active");i||n?n?(this.className=e.replace(" active",""),App.set("autozoomActive",!1)):(this.className+=" active",App.set("autozoomActive",!0)):t._map.fitBounds(App.get("commonBounds"),{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")})})}}),L.Control.Clear=L.Control.extend({options:{position:"topright",title:h.clearMap},onAdd:function(t){return this._map=t,this._ui=this._createUI(),t.whenReady(this._initEvents,this),this._ui.button[0]},_createUI:function(){var e={};return e.button=t('<button title="'+this.options.title+'" class="btn leaflet-control-clear">'+'<i class="svg-icon svg-icon-brush"></i></button>'),L.DomEvent.disableClickPropagation(e.button[0]),e},_initEvents:function(){}});var v=L.Point,_=L.Point.prototype;L.Point=function(){v.apply(this,arguments),this._original=null},L.Point.prototype=_,e.extend(L.Point.prototype,{setOriginal:function(t){this._original=t},getOriginal:function(){return this._original}}),L.ComplexLatLng=function(){L.LatLng.apply(this,arguments),this.speed=0,this.date=null},L.complexLatLng=function(t){if(t instanceof L.ComplexLatLng)return t;if(void 0===t||null===t)return t;if(L.Util.isArray(t))var i=new L.ComplexLatLng(t[0],t[1]);else{if(!("object"==typeof t&&"lat"in t))return null;var i=new L.ComplexLatLng(t.lat,"lng"in t?t.lng:t.lon)}return e.each(["speed","date","alt","rid"],function(e){e in t&&(i[e]=t[e])}),i},L.MyPolyline=L.Polyline.extend({initialize:function(t,e){L.Polyline.prototype.initialize.call(this,t,e),this._decor=null,this._points=null,this._pointsOptions=null,this._originalLatLngs=[]},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;n>i;i++){if(L.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=L.complexLatLng(t[i])}return s},projectLatlngs:function(){this._originalPoints=[];for(var t=null,e=0,i=this._latlngs.length;i>e;e++)t=this._map.latLngToLayerPoint(this._latlngs[e]),t.setOriginal(this._latlngs[e]),this._originalPoints[e]=t},onAdd:function(t){L.Polyline.prototype.onAdd.call(this,t),e.isObject(this.options.weightArray)&&(this.options.defaultWeight=this.options.weight,this._setWeight(),t.on("zoomend",this._setWeight,this)),this.options.decor&&(t.on("zoomend moveend",this._drawDecor,this),this._drawDecor()),this._pointsOptions&&this.drawPoints()},onRemove:function(t){L.Polyline.prototype.onRemove.call(this,t),e.isObject(this.options.weightArray)&&t.off("zoomend",this._setWeight,this),this.options.decor&&(t.off("zoomend moveend",this._drawDecor,this),this._decor&&(this._container.removeChild(this._decor),this._decor=null))},getParts:function(){return this._parts},getOriginalProjectedPoints:function(){for(var t,e=this._originalPoints.length,i=new Array(e),n=this._map.getPixelOrigin(),s=0;e>s;++s)t=this._originalPoints[s],i[s]=t.add(n),i[s]._original=t._original||null;return i},drawPoints:function(t){if(!this._map)return t&&!t.target&&(this._pointsOptions=t,this._pointsOptions._eventsListened=!1),void 0;if(this._points)this._container.removeChild(this._points),this._points=null;else if(t&&!t.target)this._pointsOptions=t,this._pointsOptions._eventsListened=!1;else if(!this._pointsOptions)return this._map.off("zoomend moveend",this.drawPoints,this),void 0;var e=this._pointsOptions;if(e._eventsListened||(this._map.on("zoomend moveend",this.drawPoints,this),this._pointsOptions._eventsListened=!0),!(e.minZoom&&this._map.getZoom()<e.minZoom)){this._points=this._createElement("g"),this._container.appendChild(this._points);var i=this._map,n=this.options.weight/2-1,s=L.LineUtil._reducePoints(this._originalPoints,n*n+4),o=this._map._pathViewport,r=null,a={};0>=n&&(n=1);for(var l=0,h=s.length;h>l;l++)a=s[l],a.x<o.min.x||a.x>o.max.x||a.y<o.min.y||a.y>o.max.y||(r=this._createElement("circle"),r.setAttribute("r",n),r.setAttribute("cx",a.x),r.setAttribute("cy",a.y),r.setAttribute("fill-opacity",.6),r.setAttribute("stroke","rgba(0,0,0,0.1)"),r.setAttribute("stroke-width",2),e.onMouseOver&&!function(t){r.addEventListener("mouseover",function(n){i.isDragging()||e.onMouseOver(n,t.getOriginal())},!1)}(a),e.onMouseOut&&!function(t){r.addEventListener("mouseout",function(n){i.isDragging()||(e.onMouseOut(n,t.getOriginal()),t.getOriginal())},!1)}(a),this._points.appendChild(r));return s}},removePoints:function(){this._points&&(this._map&&this._map.off("zoomend moveend",this.drawPoints,this),this._container.removeChild(this._points),this._points=null,this._pointsOptions=null)},_drawDecor:function(){if(this._decor&&(this._container.removeChild(this._decor),this._decor=null),!(this.options.decorMinZoom&&this._map.getZoom()<this.options.decorMinZoom)){this._decor=this._createElement("g"),this._container.appendChild(this._decor);for(var t=this.getParts(),e=t.length,n=[],s=this._decor,o=null,r=5.657,a=90,l=new i.Transform,h=null,c="0,0 12,4 0,8",e=0,u=t.length;u>e;e++)if(n=t[e],n&&!(n.length<2))for(var d=0,p=1,f=n.length-1,u=0,m=p*a,g=0,v=0,_=0,y=0;f>d;){if(g=n[d+1].x-n[d].x,v=n[d].y-n[d+1].y,y=Math.sqrt(g*g+v*v),u+y>m)for(l.reset(),_=Math.atan(Math.abs(v)/Math.abs(g)),g>=0&&v>=0?_=2*Math.PI-_:0>g&&0>v?_=Math.PI-_:0>g?_=Math.PI+_:0>v&&(_=_),l.rotate(_),h=l.getMatrix(),g=r*Math.cos(_+Math.PI/4),v=r*Math.sin(_+Math.PI/4);u+y>m;)h[4]=n[d].x+(m-u)*Math.cos(_)-g,h[5]=n[d].y+(m-u)*Math.sin(_)-v,o=this._createElement("polygon"),o.setAttribute("stroke-width",0),o.setAttribute("fill","white"),o.setAttribute("points",c),o.setAttribute("transform","matrix("+h.join(",")+")"),s.appendChild(o),m=++p*a;u+=y,++d}}},_setWeight:function(){var t=this._map,e=t.getZoom(),i=!1;for(var n in this.options.weightArray)if(n=parseInt(n),e>=n)i=n;else if(i!==!1)break;var s=this.options.defaultWeight;i!==!1&&(s=this.options.weightArray[i]),this.options.weight=s,this._path&&this._path.setAttribute("stroke-width",s)}}),L.ComplexPolyline=L.FeatureGroup.extend({initialize:function(){this._layers={},this._showPoints=!1,this._originalLatLngs=[]},setLatLngs:function(){return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t=t.concat(e.getLatLngs())}),t},getOriginalProjectedPoints:function(){var t=[];return this.eachLayer(function(e){t=t.concat(e.getOriginalProjectedPoints())}),t},addSegment:function(t){return this.addLayer(t),this},showPoints:function(t){this._showPoints||(this._showPoints=!0,this.eachLayer(function(e){e.drawPoints(t)}))},removePoints:function(){this._showPoints&&(this._showPoints=!1,this.eachLayer(function(t){t.removePoints()}))}}),L.Control.Scale.prototype._updateMetric=function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" "+h.m:e/1e3+" "+h.km},L.Map.include({isDragging:function(){return this.dragging._draggable._moving}}),L.Map.mergeOptions({traffic:!1,showTraffic:!1}),e.extend(u.prototype,{reset:function(){this._LMap&&this._LMap._onResize()},getMap:function(){return this._LMap},setMap:function(t,i){var n=this._map,s=this;this._map=t.map,i&&(this._LMap=L.map(i,{attributionControl:!1,keyboardPanOffset:150,ruler:t.ruler||!1,traffic:t.traffic||!1,showTraffic:t.showTraffic||!1,routing:t.routing||!1,coordinateControl:t.coords||!1,miniMapControl:t.minimap||!1,print:t.print||!1,autozoom:t.autozoom||!1,layersControl:t.layersControl||!1,clearControl:t.clearControl||!1}),this._LMap.on("zoomstart",function(){s._errorTiles=0})),this._tilesLayer&&this._LMap.removeLayer(this._tilesLayer),this._hybridLayer&&(this._LMap.removeLayer(this._hybridLayer),this._hybridLayer=null);var o=L.CRS.EPSG3857;"yandex"==this._map.getProjectionType()&&(o=L.CRS.Yandex);var r=this._map.getSourceData(),a={reuseTiles:!0,subdomains:r.sub||null,errorTileUrl:r.errorTileUrl||"",zIndex:1,minZoom:this._map.getMinZoom(),maxZoom:this._map.getMaxZoom(),continuousWorld:!1,noWrap:!0,onBreak:r.onBreak||null};if(this._tilesLayer=L.tileLayer(r.url,a).addTo(this._LMap),e.extend(this._LMap.options,{crs:o}),this._LMap.setView(t.center,t.zoom,{reset:!0}),!a.errorTileUrl&&this._tilesLayer.on("tileerror",function(t){if(++s._errorTiles/e.size(s._tilesLayer._tiles)>p){if(s._layerIsBroken)return;
		a.onBreak&&(++s._brokenLevels>3||s._LMap.getZoom()<=s._LMap.getMinZoom())?(s._layerIsBroken=!0,a.onBreak(t)):(s._errorTiles=0,s._LMap.setView(s._LMap.getCenter(),s._LMap.getZoom()-1,{zoom:{animate:!1}}))}}),this._tilesLayer.once("load",function(){s._LMap.fire("tilesbuilt")}).on("load",function(){s._layerIsBroken&&s._errorTiles/e.size(s._tilesLayer._tiles)<=p&&(s._layerIsBroken=!1,s._brokenLevels=0)}),this._map.isHybrid()){var l=this._map.getExtraLayer(this),r=l.getSourceData();a.subdomains=r.sub||null,a.zIndex=2,a.minZoom=this._LMap.getMinZoom(),a.maxZoom=this._LMap.getMaxZoom(),this._hybridLayer=L.tileLayer(r.url,a).addTo(this._LMap)}if(this._LMap.options.showTraffic){var h=this._map.getTrafficLayerClass(),c="",s=this;n&&(c=n.getTrafficLayerClass()),c!=h&&(this._trafficLayer&&this._LMap.removeLayer(this._trafficLayer),this.showTrafficLayer())}else this._trafficLayer&&this.removeTrafficLayer();return this._LMap},showTrafficLayer:function(){var t=this,e=this._map.getTrafficLayerClass(),i={};e&&requirejs(["maps/"+e],function(e){var n=new e(t._map,t),s=n.getSourceData();i.subdomains=s.sub||null,i.zIndex=3,i.minZoom=t._LMap.getMinZoom(),i.maxZoom=t._LMap.getMaxZoom(),t._trafficLayer=L.tileLayer(s.url,i).addTo(t._LMap),t._trafficUpdateInterval=setInterval(function(){t.updateTrafficLayer()},f)})},removeTrafficLayer:function(){this._LMap.removeLayer(this._trafficLayer),this._trafficLayer=null,this._trafficUpdateInterval&&(clearInterval(this._trafficUpdateInterval),this._trafficUpdateInterval=null)},updateTrafficLayer:function(){this._trafficLayer&&(this.removeTrafficLayer(),this.showTrafficLayer())},addAddressMarker:function(i,n){var s=this,o=null,r=null;if(n=e.extend({zoom:this._map.getMaxZoom()-2,marker:{draggable:!0,bounceOnAdd:!1,icon:new L.PinIcon({addClassName:"address-marker"})},popup:{closeOnClick:!1}},n||{}),this._LMap.setView([i.lat,i.lon],n.zoom||this._LMap.getZoom()),o=L.marker([i.lat,i.lon],n.marker||{}),o.addTo(this._LMap),r=n.routingModule||null,n.popup){var a=l({i18n:h,data:i,addressActions:n.addressActions||[],routingModule:r,isYandex:n.isYandex,externalLink:n.externalLink}),c=n.openPopup!==!1;o.bindPopup(a,n.popup),c&&o.openPopup();var u=o._popup,d=t(u.getContainer());d.addClass("marker-info").data("marker",o).one("click","a.delete-it",function(){s._LMap.removeLayer(o)}).find(".positive").numeric({decimal:".",negative:!1}),r&&d.on("click","a.route-to",function(){var t=o.getLatLng();return r.openRouting([null,{type:"address",text:d.find(".address").text(),lat:t.lat,lon:t.lng}],d),o.closePopup(),!1}),o.on("dragend",function(){var t=o.getLatLng();s._map.geocode({lat:t.lat,lon:t.lng,success:function(t){t.address&&(i.title=t.address,a=l({i18n:h,data:i,addressActions:n.addressActions||[],routingModule:r}),u.setContent(a),o.trigger("change",i))}})}).on("popreset",function(){u.setContent(l({i18n:h,data:i,addressActions:n.addressActions||[],routingModule:r}))})}return o.on("destroy dblclick",function(){s._LMap.removeLayer(o),s.addressMarkers=e.without(s.addressMarkers,o)}),this.addressMarkers.push(o),o},clearAddressMarkers:function(){for(var t=this.addressMarkers,e=t.length;e--;)this._LMap.removeLayer(t[e]);this.addressMarkers=[]},buildMarker:function(t){var e=L.marker([t.lat,t.lon],{icon:t.icon||new L.ComplexIcon(t),data:t.data||null}),i=this;return e.on("destroy hide",function(){i._LMap.removeLayer(e)}).on("show",function(){i._LMap.addLayer(e)}),e},putMarker:function(t){var e=this.buildMarker(t);return this._LMap.addLayer(e),e},findLayer:function(t){var i=null;return this._LMap?i=e.find(this._LMap._layers,t):null},buildComplexMarker:function(i){if(i.animated)var n=L.animatedMarker([i.lat,i.lon],{autoStart:!1,icon:new L.ComplexIcon(i),model:i.model||null});else var n=L.marker([i.lat,i.lon],{icon:new L.ComplexIcon(i),model:i.model||null,draggable:i.draggable===!0});var s=this;return n.on("place",function(t){if(t.to){var i=[t.to.lat,e.isUndefined(t.to.lon)?t.to.lng:t.to.lon];if(t.animate&&n.setLatLngs)t.cluster&&!n._icon?t.cluster.updateMarkerPos(n,new L.LatLng(i[0],i[1])):(t.interval&&(n.options.interval=t.interval),n.setLatLngs(t.animate));else if(t.cluster)try{t.cluster.updateMarkerPos(n,new L.LatLng(i[0],i[1]))}catch(s){}else n.setLatLng(i)}}).on("rotate",function(i){if(!e.isUndefined(i.angle)&&L.DomUtil.TRANSFORM){if(n._icon){var s=n._icon.getElementsByTagName("I")[0];s.style[L.DomUtil.TRANSFORM]="rotate("+i.angle+"deg)";var s=t(n._icon).html()}else{var o=t(n.options.icon.options.html);o[0].style[L.DomUtil.TRANSFORM]="rotate("+i.angle+"deg)";var s="";o.each(function(){s+=this.outerHTML})}n.options.icon.options.html=s}}).on("iconchange",function(i){e.isUndefined(i.html)||(n.options.icon.options.html=i.html,n._icon&&t(n._icon).html(i.html))}).on("destroy",function(){s._LMap.removeLayer(n)}).on("settitle",function(e){n._icon&&t(n._icon).find(".name").text(e.title)}).on("toggleclass",function(t){var e=n.options.icon.options,i=e.className,s="";if("name"in t){var o=t.name.split(" ");for(var r in o)s=o[r],i.length>0&&new RegExp("(^|\\s)"+s+"(\\s|$)").test(i)?i=L.Util.trim((" "+i+" ").replace(" "+s+" "," ")):i+=(i?" ":"")+s}else"off"in t&&i.length>0&&new RegExp("(^|\\s)"+t.off+"(\\s|$)").test(i)&&(i=L.Util.trim((" "+i+" ").replace(" "+t.off+" "," "))),"on"in t&&(i+=(i?" ":"")+t.on);e.className=i,n.setIcon(new L.ComplexIcon(e))}).on("zoomchange",function(t){t.cluster&&n.unspiderfy(),t&&t.center&&(t.zoom=t.zoom||s._LMap.getMaxZoom(),s.zoom(t))}).on("follow",function(t){t.cluster&&n.unspiderfy(),t&&t.center&&s._LMap.panTo(t.center)}),n},buildLayersGroup:function(i){if(this._LMap){var n=[],s=this,o=t(this._LMap.getPanes().objectsPane);i.layers&&(n=i.layers),i.groupCssClass&&o.addClass(i.groupCssClass);var r=null;if(i.clusters&&L.MarkerClusterGroup){var a=e.extend({maxClusterRadius:50,showCoverageOnHover:!1,zoomToBoundsOnClick:!1,animateAddingMarkers:!1,spiderfyDistanceMultiplier:2},i.clusters);if(i.clusters.icon){var l=i.clusters.icon,h=l.html||"<div>#count#</div>";a.iconCreateFunction=function(t){var e=t.getChildCount();return new L.ComplexIcon({html:h.replace("#count#",e),className:"marker-cluster"+(l.className?" "+l.className:""),style:l.style||null,iconSize:null})}}r=L.markerClusterGroup(a).addLayers(n),r.on("clusterclick",function(t){var e=t.layer;e.getChildCount()<=10||s._LMap.getMaxZoom()===s._LMap.getZoom()?e.spiderfy():e.zoomToBounds()}).on("update",function(){})}else r=L.featureGroup(n,i);if(r.on("destroy",function(){r.clearLayers(),s._LMap.removeLayer(r)}).on("hide",function(){s._LMap.removeLayer(r)}).on("show",function(){s._LMap.addLayer(r)}).on("toggleclass",function(t){t.name&&o.toggleClass(t.name)}),i.events)for(var c in i.events)r.on("click",function(t){i.events[c].call(t.layer,t.originalEvent,{lat:t.latlng.lat,lon:t.latlng.lng},t.layer.options.model||t.layer.options.data||null)});return r}},addLayersGroup:function(t){var e=this.buildLayersGroup(t);return this._LMap.addLayer(e),e},addLayerToGroup:function(t,e){var i=null;switch(e.type){case"path":break;default:i=L.marker(e.point,e)}t.addLayer(i)},zoom:function(t,i){var n=0,s=t.to||t.zoom||this._LMap.getZoom()+1;e.isNumber(s)?n=s:"max"==s&&(n=this._LMap.getMaxZoom()),this._LMap.setView(t.center||this._LMap.getCenter(),n),i&&i()},addPopup:function(e){var i={maxWidth:e.maxWidth||300},n=L.popup(i).setContent(e.content);n.addTo(this._LMap);var s=t(n.getContainer());e.addClass&&s.addClass(e.addClass),e.id&&s.attr("id",e.id),e.model&&s.data("model",e.model)},addHtmlLayer:function(){this._LMap&&new L.LayerGroup},getBoundsZoom:function(t){return this._LMap.getBoundsZoom(t)},removeLayer:function(t){this._LMap.hasLayer(t)&&this._LMap.removeLayer(t)},buildPolyline:function(t,e){var i=this,n=new L.MyPolyline(t,e);return n.on("destroy",function(){i._LMap.removeLayer(n),n=null}).on("hide",function(){i._LMap.removeLayer(n)}).on("show",function(){i._LMap.addLayer(n)}),n},buildComplexPolyline:function(){var t=this,e=new L.ComplexPolyline;return e.on("destroy",function(){e.eachLayer(function(e){t._LMap.removeLayer(e),e=null},e),e=null}).on("hide",function(){e.eachLayer(function(e){t._LMap.removeLayer(e)},e)}).on("show",function(){e.eachLayer(function(e){t._LMap.addLayer(e)},e)}),e},buildPolygon:function(t){var i=[];for(var n in t.latlng){var s=t.latlng[n];s instanceof L.LatLng?i.push(s):i.push(new L.LatLng(s.lat,s.lon))}return new L.Polygon(i,e.extend({stroke:!1,color:"red",weight:5,clickable:!1},t))},buildRadial:function(t){if(e.isArray(t.center))var i=new L.LatLng(t.center[0],t.center[1]);else var i=new L.LatLng(t.center.lat,t.center.lon);return new L.Circle(i,t.radius,e.extend({stroke:!1,color:"red",weight:5,clickable:!1},t))},addLayer:function(t){this._LMap.addLayer(t)},fitPolygon:function(t){this._LMap.fitBounds(t.getBounds())},fitBounds:function(t){return this._LMap.fitBounds(t,arguments[1]||{})},buildEditablePolygon:function(t){var t=t||{};return new L.Edit.Polygon(t)},buildEditableRadial:function(t){var t=t||{};return new L.Edit.Circle(t)},buildEditablePoint:function(t){var t=t||{};return new L.Edit.Point(t)},getCenter:function(){var t=this._LMap.getCenter();return{lat:t.lat,lon:t.lng}},getBounds:function(){var t=this._LMap.getBounds();return[[t.getSouth(),t.getWest()],[t.getNorth(),t.getEast()]]},getBoundsWithPadding:function(t){var e=this._LMap.getPixelBounds(),i=e.min.x+t[0],n=e.min.y+t[1],s=e.max.x-t[0],o=e.max.y-t[1],r=this.unproject([i,o]),a=this.unproject([s,n]);return[[r.lat,r.lng],[a.lat,a.lng]]},setBounds:function(t){if(this._LMap&&t){if(t.minLat)t=[[t.maxLat,t.minLon],[t.minLat,t.maxLon]];else if(e.isArray(t)&&(!t.length||null===t[0][0]))return;this._LMap.fitBounds(t,arguments[1]||{})}},unproject:function(t){return this._LMap.unproject(t)},destroy:function(){this._LMap&&this._LMap.remove()}});for(var y=["setZoom","getZoom","setCenter"],b=y.length;b--;)!function(t){u.prototype[t]=function(){return this._LMap[t].apply(this._LMap,arguments)}}(y[b]);var w={initWidget:function(e,i){if(!i.map||!i.map.getSourceData)return!1;var n=this,s=this.widget.setMap(i,e),o=n.model;return s.off("dblclick").on("dblclick",function(t){return s.setView(t.latlng,s.getZoom()+1),!1}).on("tilesbuilt viewreset",function(){o.publish("tilesbuilt")}).on("zoomstart",function(){o.publish("zoomstart")}).on("zoomend",function(){o.setUserData("zoom",n.widget.getZoom()),i.autozoom&&w.autozoom.call(n)}).on("movestart",function(){o.publish("start")}).on("moveend",function(){o.publish("stop"),o.setUserData("center",n.widget.getCenter()),i.autozoom&&w.autozoom.call(n)}),i.traffic&&s.on("toggletraffic",function(){n.model.setUserData("showTraffic",s.options.showTraffic),s.options.showTraffic?n.widget.showTrafficLayer():n.widget.removeTrafficLayer()}),this.model.get("layersControl")&&(this.$el.find("[data-map="+this.model.get("usedMap")+"]").addClass("active"),this.$el.on("click","[data-map]",function(){var e=t(this);n.model.setMap(e.data("map")),e.addClass("active").siblings(".active").removeClass("active")})),this.$el.on("click",".leaflet-control-clear",function(){App.trigger("clearmap",n.model),n.$el.find(".leaflet-control-ruler.active").trigger("click"),n.widget.clearAddressMarkers()}),i.autozoom&&this.listenTo(App,"change:commonBounds",function(){w.autozoom.call(n)}).listenTo(App,"change:autozoomActive",function(t,e){e||(n._autozoomTimeout&&clearTimeout(n._autozoomTimeout),n.setAutozoomState())}),s},search:function(t){var e=this.searchForm.addClass("active").serializeObject();e.center=this.widget.getCenter(),e.bounds=this.widget.getBounds(),this.model.publish("needsearch",e,this,t||null)},autozoom:function(){if(App.get("autozoomActive")){var t=App.get("commonBounds");if(t&&t[0][0]){var e=this.containsCommonBounds(t);e||w.setAutozoomTimeout.call(this)}}else this.setAutozoomState()},setAutozoomTimeout:function(){var t=this;this._autozoomTimeout&&clearTimeout(this._autozoomTimeout),this._autozoomTimeout=setTimeout(function(){t.widget.getMap().fitBounds(App.get("commonBounds"),{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")}),t._autozoomTimeout=null},5e3)}},x=n.extend({constructor:function(){this._autozoomTimeout=null,n.apply(this,arguments)},initialize:function(){this.select=null,this.cont=null,this.block=null,this.searchForm=null,this.searchInput=null,this.widget=new u;var t=this;this.listenTo(App,"layoutchange",function(){t.widget&&t.widget.reset()}).listenTo(App,"blockmap",function(){t.$el.addClass("blocked")}).listenTo(App,"unblockmap",function(){t.$el.removeClass("blocked")}),this.listenTo(this.model,"mapchanged",function(e){t.widget&&t.widget.setMap({map:e,center:t.widget.getCenter(),zoom:t.widget.getZoom()})}).listenTo(this.model,"layoutchange",function(){t.widget&&t.widget.reset()}),this.on("searchstart",function(){}).on("searchcomplete",function(){}).on("searchsuccess",function(e,i){return e.length?(i.putMarker?t.addAddressMarker(e[0],i):i.zoom&&t.widget.zoom({to:"max",center:e[0]}),i.onsuccess&&i.onsuccess(e),void 0):alert(h.nothingFoundByYourRequest)}).on("searcherror",function(){alert(h.commonSearchError)}).on("suggestsuccess",function(t,e){e&&e(t)}).on("suggesterror",function(){t.searchInput.removeClass("ui-autocomplete-loading")})},render:function(){var i=this,n=e.template(a,e.extend({},d,this.model.attributes));if(this.$el.append(n),this.cont=this.$el,this.setElement(this.$el.find(".maps-module")),this.$el.removeClass("loading"),this.select=this.$el.find(".map-type-select select"),this.select.on("change",function(){i.model.setMap(this.value)}),this.model.get("search")){if(this.searchForm=this.$el.find(".form-search").on("submit",function(){return w.search.call(i),!1}),this.searchInput=this.searchForm.find("input[name=q]"),this.searchForm.on("click",".icon-clear",function(){i.searchForm.removeClass("active"),i.searchInput.val("").focus()}),t.fn.autocomplete){var s=this.searchForm.find("input[name=type]");this.searchInput.autocomplete({minLength:2,source:function(t,e){var n={q:t.term,type:s.val(),center:i.widget.getCenter(),bounds:i.widget.getBounds()};i.model.publish("needsuggest",n,e,i)},select:function(t,e){return e.item&&(i.searchInput.val(e.item.value),w.search.call(i,e.item.original||null)),window.setTimeout(function(){i.searchInput.blur()},0),!1},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})}this.model.get("searchTypes")&&this.searchForm.on("click","a[data-type]",function(){var e=t(this),n=e.data("type");i.searchForm.find("input[name=q]").val("").focus().end().find("input[name=type]").val(n).end().find(".dropdown-toggle span").first().text(e.text()),i.model.setUserData("defSearchType",n)})}},activate:function(i){var n=this;this.model;var s=e.extend({},d,this.model.attributes),o=[];s.compass&&(o.push(LIBS_PATH+"leaflet/plugins/pancontrol/src/L.Control.Pan"),o.push("css!"+LIBS_PATH+"leaflet/plugins/pancontrol/src/L.Control.Pan.css")),s.slider&&(o.push(LIBS_PATH+"leaflet/plugins/zoomslider/src/L.Control.Zoomslider"),o.push("css!"+LIBS_PATH+"leaflet/plugins/zoomslider/src/L.Control.Zoomslider.css")),s.coords&&!t.support.touch&&(o.push(LIBS_PATH+"leaflet/plugins/coordinates/dist/Leaflet.Coordinates-0.1.3.src"),o.push("css!"+LIBS_PATH+"leaflet/plugins/coordinates/dist/Leaflet.Coordinates-0.1.3.css")),s.minimap&&(o.push(LIBS_PATH+"leaflet/plugins/minimap/src/Control.MiniMap"),o.push("css!"+LIBS_PATH+"leaflet/plugins/minimap/src/Control.MiniMap.css")),s.ruler&&(o.push("css!"+LIBS_PATH+"leaflet/plugins/draw/leaflet.draw.css"),o.push(LIBS_PATH+"leaflet/plugins/draw/leaflet.draw")),s.ruler&&o.push(LIBS_PATH+"leaflet/plugins/ruler/leaflet.ruler"),o.push(LIBS_PATH+"leaflet/plugins/markercluster/dist/leaflet.markercluster-src"),o.push("css!"+LIBS_PATH+"leaflet/plugins/markercluster/dist/MarkerCluster.Default.css"),o.push("css!"+LIBS_PATH+"leaflet/plugins/markercluster/dist/MarkerCluster.css");var r=new t.Deferred;return requirejs(o,function(){c(),w.initWidget.call(n,n.$(".module-content")[0],e.extend(s,i||{})),r.resolve()}),this.select.find("[value="+this.model.getMap().getClass()+"]").attr("selected","selected"),t.fn.chosen&&this.select.chosen({disable_search:!0}),r},getWidget:function(){return this.widget},setAutozoomState:function(){var t=this.$el.find("button.leaflet-control-autozoom")[0],e=t.className,i=-1!=e.indexOf(" fit"),n=App.get("commonBounds");if(n&&n[0][0]){var s=this.containsCommonBounds(n);s?i||(t.className+=" fit"):i&&(t.className=e.replace(" fit",""))}else t.className=e.replace(/( fit| active)/,"")},containsCommonBounds:function(t){var e=L.latLngBounds(this.widget.getBoundsWithPadding(App.get("commonBoundsPadding")));return t=L.latLngBounds(t[0],t[1]),e.contains(t)},addAddressMarker:function(t,i){var n=-1!=this.model.get("usedMap").indexOf("andex"),s=t.lat,o=t.lon,r="https://www.google.com/maps/place/"+s+"+"+o+"/@"+s+","+o+",17z";return i=i||{},n&&(r="https://maps.yandex.ru/?text="+t.title+"&ll="+o+","+s+"&z=17"),this.widget.addAddressMarker(t,e.extend({addressActions:i.extraActions||[],routingModule:this.model.get("routing")?this.model:null,isYandex:n,externalLink:r},i))},destroy:function(){this._autozoomTimeout&&clearTimeout(this._autozoomTimeout),App.unsubscribe(this),this.widget.destroy()}});return x}),define("maps/MapsModule",["underscore","jquery","abstracts/Module","util","geo","maps/GeoMap","maps/routing/RoutingModule","maps/views/MapsViewLeaflet","i18n!_common/nls/common"],function(t,e,i,n,s,o,r,a,l){function h(){g=[]}var c="YandexMap",u=12,d=[59.9,30.46],p={},f=i.extend({constructor:function(){this._map=null,this._widget=null,this._suggestCache={},i.apply(this,arguments)},defaults:{usedMap:null,center:null,container:null,parent:null,searchTypes:null},initialize:function(){if(this.get("container")){this.has("searchTypes")&&this.set("defSearchType",t.findWhere(this.get("searchTypes"),{key:this.getUserData("defSearchType")||"address"})),App.subscribe(this.getEventsPrefix()+".zoomstart",function(){h()}),this.has("usedMap")||this.set("usedMap",this.getUserData("usedMap")||c),this.has("center")||this.set("center",this.getUserData("center")||d),this._view=new a({el:this.get("container"),model:this}),this._view.render(),m.initMapEngine.call(this,{map:this.get("usedMap"),zoom:this.getUserData("zoom")||u,center:this.get("center"),showTraffic:this.getUserData("showTraffic")||!1}),m.initSearch.call(this),App.subscribe(this.get("parent").getEventsPrefix()+".zoom",t.bind(this.setBounds,this));var e;if(e=this.get("routing")){var i={id:this.id+"/routing",parent:this,pointsEdit:!0};t.isObject(e)&&t.extend(i,e),this.modules.routing=new r(i)}}},setBounds:function(){this._widget&&this._widget.setBounds.apply(this._widget,arguments)},getZoom:function(){return this._widget.getZoom()},zoomTo:function(e,i){(t.isArray(e)||!(t.isUndefined(e.lat)||t.isUndefined(e.lon)||t.isNull(e.lat)||t.isNull(e.lon)))&&this._widget&&this._widget.zoom({to:i&&i.maxZoom||"max",center:t.isArray(e)?e:[e.lat,e.lon]})},buildPolyline:function(e,i){i=i||{};var n={clickable:!1,weight:4,opacity:1};return i.weightArray?this._view.getWidget().buildPolyline(e,t.extend(n,i||{})):void 0},getMetersInPx:function(t){t>89&&(t=89),-89>t&&(t=-89);var e=Math.round(Math.abs(t));return g[e]?g[e]:m.calcMetersInPx.call(this,e)},getBoundsZoom:function(t){return this._widget.getBoundsZoom(t)},pointToLatLon:function(e){return t.isArray(e)?this._widget.unproject(e):this._widget.unproject([e.x,e.y])},destroy:function(){this._view.destroy()},openRouting:function(t){if(this.modules.routing){var e=this.getMap(),i=this.modules.routing;return e.routing()?(e.routingReady()?i.set("active",!0).buildRoute(t):(showCursor(),e.loadRouting().always(hideCursor).fail(function(t){alert(t,l.error)}).done(function(){i.set("active",!0).buildRoute(t)})),void 0):alert(l.errNoRoutingOnMap,l.error)}},buildRoute:function(t,i){var n=new e.Deferred;if(!this.modules.routing)return n.reject("No routing module");var s=this,o=this.getMap(),r=this.modules.routing;return o.routing()?(o.loadRouting().done(function(){var e=r.set("active",!0).buildRoute(t,i||{});s.listenToOnce(e,"sync",function(){n.resolve(e)}).listenToOnce(e,"error",function(t){n.reject(t)})}).fail(function(t){n.reject(t)}),n):n.reject(l.errNoRoutingOnMap)},isAutozoomWidgetOn:function(){return this.get("autozoom")}}),m={initMapEngine:function(e){var i=this,e=e||{};if(e.map&&e.map instanceof o)this._map=e.map;else{var n=e.map||c,s=p[n]||null;if(!s)return requirejs(["maps/"+n],function(s){p[n]=s,m.initMapEngine.call(i,t.extend(e,{map:new s}))}),void 0;this._map=e.map=new s}this._map.setZoom(e.zoom||this._map.getMaxZoom()-3),e.center?this._map.setCenter(e.center):this._map.setCenter(d);var i=this;this._view.activate(e||{}).done(function(){i.publish("ready"),i.trigger("ready")}),i._widget=i._view.getWidget()},initSearch:function(){var i=this;App.subscribe(this.getEventsPrefix()+".needsearch",function(e,n,s){n.trigger("searchstart");var o=i._map,r=i.get("parent"),a={putMarker:!0};return"address"!=e.type?(o=null,r.getSearchProcessor&&(o=r.getSearchProcessor(e.type))):r.getFoundAddressActions&&(a.extraActions=r.getFoundAddressActions()),o&&o.search?(e.limit=e.limit||1,o.getSearchOptions&&t.extend(a,o.getSearchOptions(e.type)),e.options&&(a.options=e.options),e.mapSearch=!0,o.search(e,s||null).done(function(t){n.trigger("searchsuccess",t,a)}).fail(function(){n.trigger("searcherror")}).always(function(){n.trigger("searchcomplete")}),void 0):(n.trigger("searcherror",{msg:'No search processor found for chosen type + "'+e.type+'"'}),void 0)}),App.subscribe(this.getEventsPrefix()+".needsuggest",function(t,e,n){n.trigger("suggeststart");var s=i._map;return"address"!=t.type&&(s=null,i.get("parent").getSearchProcessor&&(s=i.get("parent").getSearchProcessor(t.type))),s&&s.suggest?(i._suggestCache[t.type]=i._suggestCache[t.type]||{},t.q in i._suggestCache[t.type]?(e(i._suggestCache[t.type][t.q]),n.trigger("suggestsuccess"),void 0):(t.mapSearch=!0,s.suggest(t).always(function(){n.trigger("suggestcomplete")}).done(function(s){n.trigger("suggestsuccess",s,e),i._suggestCache[t.type][t.q]=s}).fail(function(){n.trigger("suggesterror")}),void 0)):(n.trigger("suggesterror",{msg:'No search processor found for chosen type + "'+t.type+'"'}),void 0)}),this.on("needgeoinfo",function(n,s){var o={};return t.isUndefined(n.lat)?n.length&&n.length>=2&&(o.lat=n[0],o.lon=n[1]):(o.lat=n.lat,o.lon=t.isUndefined(n.lon)?n.lng:n.lon),t.isUndefined(n.options)||(o.options=n.options),!t.isUndefined(n.geoId)&&n.geoId>0&&(o.geoId=n.geoId),o.lat&&o.lon?(s.trigger("searchstart"),o.success=function(t){t.address&&o.geoId&&!t.scode&&e.ajax({url:App.getBaseUrl()+"address/save/",data:{geoId:o.geoId,scode:i._map.scode,address:t.address}}),t.address=null==t.address?l.addressNotFound+" ["+Math._round(o.lat,6)+","+Math._round(o.lon,6)+"]":t.address,s.trigger("searchsuccess",t,o)},o.error=function(t){s.trigger("searcherror",t,o)},o.complete=function(){s.trigger("searchcomplete",o)},i._map.geocode(o),void 0):(n.address=l.addressNotFound+("undefined"!=typeof o.lat&&"undefined"!=typeof o.lon?" ["+o.lat+","+o.lon+"]":""),s.trigger("searchsuccess",n,o),void 0)})},calcMetersInPx:function(t){var e=this._widget.getZoom();return this._map.setZoom(e),g[t]=this._map.getKDistByLat(t),g[t]}};t.extend(f.prototype,{addLayer:function(t){return this._widget.addLayer(t)},removeLayer:function(t){return this._widget.removeLayer(t)},addLayersGroup:function(t){return this._widget.addLayersGroup(t)},buildMarker:function(t){return this._widget.buildMarker(t)},putMarker:function(t){return this._widget.putMarker(t)},fitPolygon:function(t){return this._widget.fitPolygon(t)},fitBounds:function(){return this._widget.fitBounds.apply(this._widget,arguments)},getBounds:function(){return this._widget.getBounds.apply(this._widget,arguments)},addHtmlLayer:function(t){return this._widget?this._widget.addHtmlLayer(t):void 0},addPopupLayer:function(){return this._widget?(this._widget.addPopupLayer&&this._widget.addPopupLayer.apply(this._widget,arguments),this.addHtmlLayer.apply(this,arguments)):void 0},setMap:function(){if(arguments[0]instanceof o){if(this._map.getClass()==arguments[0].getClass())return this._map;this._map=arguments[0](this._map)}else{if("string"!=typeof arguments[0])throw"Invalid arguments to set new map";var t=p[arguments[0]]||null;if(!t){var e=arguments[0],i=this;return requirejs(["maps/"+e],function(t){p[e]=t,i.setMap(e)},function(){i.setMap(c)}),void 0}if(this._map.getClass()==t.__CLASS__)return this._map;this._map=new t(this._map),this.set("usedMap",this._map.getClass()),this.setUserData("usedMap",this._map.getClass()),this.trigger("mapchanged",this._map)}this._suggestCache={}},getMap:function(){return this._map},getWidget:function(){return this._widget}});var g=[];return f}),define("_common/views/AppView",["jquery","jqueryui","underscore","jface","abstracts/View","text!_common/tmpl/app.html","text!_common/tmpl/printHeader.html","i18n!_common/nls/common"],function(t,e,i,n,s,o,r,a){function l(){t.datepicker.setDefaults({showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,altFormat:a.DateTime.inputDateFormat,closeText:a.close.ucFirst(),currentText:a.DateTime.today,nextText:a.nextShort.ucFirst(),prevText:a.prevShort.ucFirst(),dayNames:a.DateTime.dayNames,dayNamesMin:a.DateTime.dayNamesMin,dayNamesShort:a.DateTime.dayNamesMin,firstDay:a.DateTime.firstDay,monthNames:a.DateTime.monthNames,monthNamesShort:a.DateTime.monthNamesShort})}var h=null,c=null,u=!1,d=400,p=200,f=null,m=null,g=null,v=null,_=200,y=300,b=150,w=!1,x=!0,S=0,C="app",T=450,M=450,A=500,D=s.extend({el:t("#page"),constructor:function(){this.isLeftWide=!1,s.apply(this,arguments)},initialize:function(){var e=this;"documentElement"in document&&(document.documentElement.lang=App.getLocale().substr(0,2).toLowerCase()),n.init(),n.addWindows(),n.addDialogs(),n.addGrowls(),n.dialog.defaults.btnNames={ok:"Ok",cancel:a.cancel.ucFirst(),submit:a.submit.ucFirst()},t.support.touch&&t("body").addClass("mobile-device"),"undefined"!=typeof PRODUCTION&&t("body").on("contextmenu",function(){return!1}),this.on("needleftwide",function(t){if(t){if(e.isLeftWide)return;u&&e.leftPaneEnable();var i=e.model.getUserData("leftWidthX")||600;e.isLeftWide=!0,i&&e.setLeftPaneWidth(i)}else{if(!e.isLeftWide)return;var i=e.model.getUserData("leftWidth");e.isLeftWide=!1,i&&d!=i&&e.setLeftPaneWidth(i)}}),this.listenTo(this.model,"change:objType",function(t,i){var n=e.$el.find("#objects-tree .tab-toggle");if(n.length){var s="stat"==i?a.stationary:a.vehicles,o='<svg class="svg-icon"><use xlink:href="#smb-'+("stat"==i?"home":"car")+'"></use>'+"</svg>";o+=" <span>"+s+"</span>",n.html(o),n[0].href="#"+i,n.parent().attr("data-hint",s)}}),App.subscribe("printmainmap",function(){var n=t("body").addClass("print-preview");!n.find("#print-hdr").length&&n.find("#outer").prepend(i.template(r,{i18n:e.model.getTexts()})),App.trigger("layoutchange")}),t("body").on("keypress.mainsearch",function(e){if(32==e.keyCode){var i=/INPUT|SELECT|TEXTAREA/i,n=!0;if(i.test(e.target.tagName)&&(n=!1),t("#jface-overlay, #dashboard, #settings").each(function(){"none"==this.style.display||/hidden|invisible/i.test(this.className)||(n=!1)}),f){var s=f.find(">.pane-right-top>.maps-module");if(s.hasClass("blocked")&&(n=!1),n)return s.find(">.module-header input[name=q]").focus(),!1}}}),t.datepicker&&l()},render:function(){if(t("#main-hdr").on("click.locale","[data-locale]",function(){var e=t(this).data("locale");App.publish("localechange",e)}),!App.isAlarmOperator()){d=this.model.getUserData("leftWidth")||d,u=this.model.getUserData("leftClosed"),_=this.model.getUserData("rightBottomHeight")||_,w=this.model.getUserData("rightBottomClosed")===!0,x=!this.model.get("showAlertsLog");var e=this.model.get("objType");this.$el.append(i.template(o,{objType:e,leftWidth:d,leftClosed:u,rightBottomHeight:_,rightBottomClosed:w,rightBottomHidden:x,dashboard:!0,showDashboard:this.model.get("startWithDashboard"),i18n:a})),h=this.$el.find(">.pane-left"),c=h.find(".toggle-pane"),f=this.$el.find(">.pane-right"),m=f.find(">.pane-right-top"),g=f.find(">.pane-right-bottom"),v=g.find(".toggle-pane"),S=this.$el.width();var n=App.getServerSettings();if(n.companyInfo){var s=n.companyInfo,r="";if("string"==typeof s)r=s;else if("object"==typeof s){var l=App.getLocale().substr(0,2);"undefined"!=typeof s[l]?r=s[l]:"undefined"!=typeof s.en&&(r=s.en)}r&&m.append('<div id="company-info">'+r+"</div>")}var p=this,y=t("#main-hdr .brand"),b=this.model.getUserData("dashShown"),T=a.showDashboard,M=this.model.get("startWithDashboard");if(!b&&!M){y.addClass("hint-hl"),T=a.showDashboardInfo;var A,D=setTimeout(function(){y.addClass("hint-always"),A=setTimeout(function(){y.removeClass("hint-always")},2e4)},1e4)}y.on("click",function(){if(p.model.modules.dashboard){var t=p.model.modules.dashboard,e=!t.get("active");t.set("active",e),e&&p.model.modules.system.hideSettings(),D&&clearTimeout(D),A&&clearTimeout(A),-1!=y[0].className.indexOf("hint-always")&&(y[0].className=y[0].className.replace(" hint-always","")),-1!=y[0].className.indexOf("hint-hl")&&(y[0].className=y[0].className.replace(" hint-hl",""),p.model.setUserData("dashShown",!0))}}).addClass("hint hint-right").attr("data-hint",M?a.map.ucFirst():T),t(window).on("resizestop."+C,function(t){var e=t.srcElement||t.currentTarget;(e=window)&&L.onWindowResizeStop.call(p,t)}),L.initPanes.call(this)}},leftPaneEnable:function(){h.removeClass("closed").resizable("enable")},leftPaneDisable:function(){h.addClass("closed").resizable("disable")},getPageWidth:function(){return S},getLeftPaneWidth:function(){return parseInt(h[0].style.width)},setLeftPaneWidth:function(t){return p>t||t>.7*S?!1:(f[0].style.left=h[0].style.width=t+"px",f.trigger("resizestop"),d=t,L.toggleNarrowClass(h,t,T),L.toggleNarrowClass(f,f.width(),M),this.model.setUserData("leftWidth"+(this.isLeftWide?"X":""),d),App.trigger("layoutchange",{leftWidth:d}),void 0)},getMapsContainer:function(){return m},getLeftPane:function(){return h}}),L={initPanes:function(){L.initLeftPane.call(this),L.initRightPane.call(this)},initLeftPane:function(){var t=this;h.resizable({handles:"e",minWidth:p,maxWidth:.7*S,stop:function(e,i){h[0].style.height="100%",f[0].style.left=h[0].style.width,f.trigger("resizestop"),d=i.size.width,t.model.setUserData("leftWidth"+(t.isLeftWide?"X":""),d),App.trigger("layoutchange",{leftWidth:d})},resize:function(t,e){L.onLeftResize(e.size)}}),u&&h.resizable("disable"),c.on("click",function(){return u?t.leftPaneEnable():t.leftPaneDisable(),L.onLeftResize({width:h.width()}),u=!u,t.model.setUserData("leftClosed",u),f.trigger("resizestop"),App.trigger("layoutchange"),!1})},initRightPane:function(){var t=this,e=f.height(),i=e-y;this.listenTo(App,"change:showAlertsLog",function(e,i){g[i?"removeClass":"addClass"]("hidden"),L.toggleRightBottom.call(t,i,!1)}),g.resizable({handles:"n",minHeight:b,maxHeight:i,resize:function(e,i){L.onRightBottomResize.call(t,i.size,!0)},stop:function(e,i){t.model.setUserData("rightBottomHeight",i.size.height),App.trigger("layoutchange",{})}}),(w||x)&&g.resizable("disable"),x||L.setMaxRightBottomHeight.call(this,f.height()-y,!1),L.toggleRightTopSmallClass.call(this),v.on("click",function(){return L.toggleRightBottom.call(t,w),!1})},onLeftResize:function(t){App.trigger("leftpaneresize",t),f[0].style.left=t.width+"px",L.toggleNarrowClass(h,t.width,T),L.toggleNarrowClass(f,f.width(),M)},toggleNarrowClass:function(t,e,i){i>e?-1==t[0].className.indexOf("narrow")&&t.addClass("narrow"):-1!=t[0].className.indexOf("narrow")&&t.removeClass("narrow")},toggleRightBottom:function(t,e){w=!t,e=e===!0,g[w?"addClass":"removeClass"]("closed").resizable(w?"disable":"enable"),w||L.setMaxRightBottomHeight.call(this,f.height()-y,!0),this.model.setUserData("rightBottomClosed",w),e||(L.onRightBottomResize.call(this,{height:w?0:_},!1),App.trigger("layoutchange"))},onRightBottomResize:function(t,e){e&&(_=t.height),m[0].style.bottom=t.height+"px",L.toggleRightTopSmallClass.call(this)},setMaxRightBottomHeight:function(t,e){if(b>t)L.toggleRightBottom.call(this,!1,e),t=b;
else if(w);else{var i=g.height();i>t&&(g[0].style.height=t+"px",L.onRightBottomResize({height:t},!0))}g.resizable("option","maxHeight",t)},onWindowResizeStop:function(){S=this.$el.width();var t=.7*S,e=h.width(),i=h.height();e>t?(h[0].style.width=t+"px",L.onLeftResize({width:e,height:i})):App.trigger("leftpaneresize",{width:e,height:i}),h.resizable("option","maxWidth",.7*S),L.setMaxRightBottomHeight.call(this,i-y,!1),L.toggleRightTopSmallClass.call(this)},toggleRightTopSmallClass:function(){var t=m.height();A>t?-1==m[0].className.indexOf("small")&&m.addClass("small"):-1!=m[0].className.indexOf("small")&&m.removeClass("small")}};return D}),define("timepicker",["jquery"],function(t){var e=function(e,i){this.widget="",this.$element=t(e),this.defaultTime=i.defaultTime,this.disableFocus=i.disableFocus,this.disableMousewheel=i.disableMousewheel,this.isOpen=i.isOpen,this.minuteStep=i.minuteStep,this.modalBackdrop=i.modalBackdrop,this.orientation=i.orientation,this.secondStep=i.secondStep,this.showInputs=i.showInputs,this.showMeridian=i.showMeridian,this.showSeconds=i.showSeconds,this.template=i.template,this.appendWidgetTo=i.appendWidgetTo,this.showWidgetOnAddonClick=i.showWidgetOnAddonClick,this._init()};e.prototype={constructor:e,_init:function(){var e=this;this.showWidgetOnAddonClick&&(this.$element.parent().hasClass("input-append")||this.$element.parent().hasClass("input-prepend"))?(this.$element.parent(".input-append, .input-prepend").find(".add-on").on({"click.timepicker":t.proxy(this.showWidget,this)}),this.$element.on({"focus.timepicker":t.proxy(this.highlightUnit,this),"click.timepicker":t.proxy(this.highlightUnit,this),"keydown.timepicker":t.proxy(this.elementKeydown,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)})):this.template?this.$element.on({"focus.timepicker":t.proxy(this.showWidget,this),"click.timepicker":t.proxy(this.showWidget,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)}):this.$element.on({"focus.timepicker":t.proxy(this.highlightUnit,this),"click.timepicker":t.proxy(this.highlightUnit,this),"keydown.timepicker":t.proxy(this.elementKeydown,this),"blur.timepicker":t.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":t.proxy(this.mousewheel,this)}),this.$widget=this.template!==!1?t(this.getTemplate()).on("click",t.proxy(this.widgetClick,this)):!1,this.showInputs&&this.$widget!==!1&&this.$widget.find("input").each(function(){t(this).on({"click.timepicker":function(){t(this).select()},"keydown.timepicker":t.proxy(e.widgetKeydown,e),"keyup.timepicker":t.proxy(e.widgetKeyup,e)})}),this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null,this.updateFromElementVal()},clear:function(){this.hour="",this.minute="",this.second="",this.meridian="",this.$element.val("")},decrementHour:function(){if(this.showMeridian)if(1===this.hour)this.hour=12;else{if(12===this.hour)return this.hour--,this.toggleMeridian();if(0===this.hour)return this.hour=11,this.toggleMeridian();this.hour--}else this.hour<=0?this.hour=23:this.hour--},decrementMinute:function(t){var e;e=t?this.minute-t:this.minute-this.minuteStep,0>e?(this.decrementHour(),this.minute=e+60):this.minute=e},decrementSecond:function(){var t=this.second-this.secondStep;0>t?(this.decrementMinute(!0),this.second=t+60):this.second=t},elementKeydown:function(t){switch(t.keyCode){case 9:case 27:this.updateFromElementVal();break;case 37:t.preventDefault(),this.highlightPrevUnit();break;case 38:switch(t.preventDefault(),this.highlightedUnit){case"hour":this.incrementHour(),this.highlightHour();break;case"minute":this.incrementMinute(),this.highlightMinute();break;case"second":this.incrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update();break;case 39:t.preventDefault(),this.highlightNextUnit();break;case 40:switch(t.preventDefault(),this.highlightedUnit){case"hour":this.decrementHour(),this.highlightHour();break;case"minute":this.decrementMinute(),this.highlightMinute();break;case"second":this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update()}},getCursorPosition:function(){var t=this.$element.get(0);if("selectionStart"in t)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange(),i=document.selection.createRange().text.length;return e.moveStart("character",-t.value.length),e.text.length-i}},getTemplate:function(){var t,e,i,n,s,o;switch(this.showInputs?(e='<input type="text" class="bootstrap-timepicker-hour" maxlength="2"/>',i='<input type="text" class="bootstrap-timepicker-minute" maxlength="2"/>',n='<input type="text" class="bootstrap-timepicker-second" maxlength="2"/>',s='<input type="text" class="bootstrap-timepicker-meridian" maxlength="2"/>'):(e='<span class="bootstrap-timepicker-hour"></span>',i='<span class="bootstrap-timepicker-minute"></span>',n='<span class="bootstrap-timepicker-second"></span>',s='<span class="bootstrap-timepicker-meridian"></span>'),o='<table><tr><td><a href="#" data-action="incrementHour"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="icon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="icon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="icon-chevron-up"></i></a></td>':"")+"</tr>"+"<tr>"+"<td>"+e+"</td> "+'<td class="separator">:</td>'+"<td>"+i+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+n+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+s+"</td>":"")+"</tr>"+"<tr>"+'<td><a href="#" data-action="decrementHour"><i class="icon-chevron-down"></i></a></td>'+'<td class="separator"></td>'+'<td><a href="#" data-action="decrementMinute"><i class="icon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="icon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="icon-chevron-down"></i></a></td>':"")+"</tr>"+"</table>",this.template){case"modal":t='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'">'+'<div class="modal-header">'+'<a href="#" class="close" data-dismiss="modal">×</a>'+"<h3>Pick a Time</h3>"+"</div>"+'<div class="modal-content">'+o+"</div>"+'<div class="modal-footer">'+'<a href="#" class="btn btn-primary" data-dismiss="modal">OK</a>'+"</div>"+"</div>";break;case"dropdown":t='<div class="bootstrap-timepicker-widget dropdown-menu">'+o+"</div>"}return t},getTime:function(){return""===this.hour?"":this.hour.padLeft(2,"0")+":"+(1===this.minute.toString().length?"0"+this.minute:this.minute)+(this.showSeconds?":"+(1===this.second.toString().length?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:"")},hideWidget:function(){this.isOpen!==!1&&(this.$element.trigger("hide.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}),"modal"===this.template&&this.$widget.modal?this.$widget.modal("hide"):this.$widget.removeClass("open"),t(document).off("mousedown.timepicker, touchend.timepicker"),this.isOpen=!1,this.$widget.detach())},highlightUnit:function(){this.position=this.getCursorPosition(),this.position>=0&&this.position<=2?this.highlightHour():this.position>=3&&this.position<=5?this.highlightMinute():this.position>=6&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():this.position>=9&&this.position<=11&&this.highlightMeridian()},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"second":this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"meridian":this.highlightHour()}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.showMeridian?this.highlightMeridian():this.showSeconds?this.highlightSecond():this.highlightMinute();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour:function(){var t=this.$element.get(0);this.highlightedUnit="hour",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(0,2)},0)},highlightMinute:function(){var t=this.$element.get(0);this.highlightedUnit="minute",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(3,5)},0)},highlightSecond:function(){var t=this.$element.get(0);this.highlightedUnit="second",t.setSelectionRange&&setTimeout(function(){t.setSelectionRange(6,8)},0)},highlightMeridian:function(){var t=this.$element.get(0);this.highlightedUnit="meridian",t.setSelectionRange&&(this.showSeconds?setTimeout(function(){t.setSelectionRange(9,11)},0):setTimeout(function(){t.setSelectionRange(6,8)},0))},incrementHour:function(){if(this.showMeridian){if(11===this.hour)return this.hour++,this.toggleMeridian();12===this.hour&&(this.hour=0)}return 23===this.hour?(this.hour=0,void 0):(this.hour++,void 0)},incrementMinute:function(t){var e;e=t?this.minute+t:this.minute+this.minuteStep-this.minute%this.minuteStep,e>59?(this.incrementHour(),this.minute=e-60):this.minute=e},incrementSecond:function(){var t=this.second+this.secondStep-this.second%this.secondStep;t>59?(this.incrementMinute(!0),this.second=t-60):this.second=t},mousewheel:function(e){if(!this.disableMousewheel){e.preventDefault(),e.stopPropagation();var i=e.originalEvent.wheelDelta||-e.originalEvent.detail,n=null;switch("mousewheel"===e.type?n=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(n=40*e.originalEvent.detail),n&&(e.preventDefault(),t(this).scrollTop(n+t(this).scrollTop())),this.highlightedUnit){case"minute":i>0?this.incrementMinute():this.decrementMinute(),this.highlightMinute();break;case"second":i>0?this.incrementSecond():this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian();break;default:i>0?this.incrementHour():this.decrementHour(),this.highlightHour()}return!1}},place:function(){if(!this.isInline){var e=this.$widget.outerWidth(),i=this.$widget.outerHeight(),n=10,s=t(window).width(),o=t(window).height(),r=t(window).scrollTop(),a=parseInt(this.$element.parents().filter(function(){}).first().css("z-index"),10)+10,l=this.component?this.component.parent().offset():this.$element.offset(),h=this.component?this.component.outerHeight(!0):this.$element.outerHeight(!1),c=this.component?this.component.outerWidth(!0):this.$element.outerWidth(!1),u=l.left,d=l.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left"),"auto"!==this.orientation.x?(this.$widget.addClass("timepicker-orient-"+this.orientation.x),"right"===this.orientation.x&&(u-=e-c)):(this.$widget.addClass("timepicker-orient-left"),l.left<0?u-=l.left-n:l.left+e>s&&(u=s-e-n));var p,f,m=this.orientation.y;"auto"===m&&(p=-r+l.top-i,f=r+o-(l.top+h+i),m=Math.max(p,f)===f?"top":"bottom"),this.$widget.addClass("timepicker-orient-"+m),"top"===m?d+=h:d-=i+parseInt(this.$widget.css("padding-top"),10),this.$widget.css({top:d,left:u,zIndex:a})}},remove:function(){t("document").off(".timepicker"),this.$widget&&this.$widget.remove(),delete this.$element.data().timepicker},setDefaultTime:function(t){if(this.$element.val())this.updateFromElementVal();else if("current"===t){var e=new Date,i=e.getHours(),n=e.getMinutes(),s=e.getSeconds(),o="AM";0!==s&&(s=Math.ceil(e.getSeconds()/this.secondStep)*this.secondStep,60===s&&(n+=1,s=0)),0!==n&&(n=Math.ceil(e.getMinutes()/this.minuteStep)*this.minuteStep,60===n&&(i+=1,n=0)),this.showMeridian&&(0===i?i=12:i>=12?(i>12&&(i-=12),o="PM"):o="AM"),this.hour=i,this.minute=n,this.second=s,this.meridian=o,this.update()}else t===!1?(this.hour=0,this.minute=0,this.second=0,this.meridian="AM"):this.setTime(t)},setTime:function(t,e){if(!t)return this.clear(),void 0;var i,n,s,o,r;"object"==typeof t&&t.getMonth?(n=t.getHours(),s=t.getMinutes(),o=t.getSeconds(),this.showMeridian&&(r="AM",n>12&&(r="PM",n%=12),12===n&&(r="PM"))):(r=null!==t.match(/p/i)?"PM":"AM",t=t.replace(/[^0-9\:]/g,""),i=t.split(":"),n=i[0]?i[0].toString():i.toString(),s=i[1]?i[1].toString():"",o=i[2]?i[2].toString():"",n.length>4&&(o=n.substr(4,2)),n.length>2&&(s=n.substr(2,2),n=n.substr(0,2)),s.length>2&&(o=s.substr(2,2),s=s.substr(0,2)),o.length>2&&(o=o.substr(2,2)),n=parseInt(n,10),s=parseInt(s,10),o=parseInt(o,10),isNaN(n)&&(n=0),isNaN(s)&&(s=0),isNaN(o)&&(o=0),this.showMeridian?1>n?n=1:n>12&&(n=12):(n>=24?n=23:0>n&&(n=0),13>n&&"PM"===r&&(n+=12)),0>s?s=0:s>=60&&(s=59),this.showSeconds&&(isNaN(o)?o=0:0>o?o=0:o>=60&&(o=59))),this.hour=n,this.minute=s,this.second=o,this.meridian=r,this.update(e)},showWidget:function(){if(!this.isOpen&&!this.$element.is(":disabled")){this.$widget.appendTo(this.appendWidgetTo);var e=this;t(document).on("mousedown.timepicker, touchend.timepicker",function(t){e.$element.parent().find(t.target).length||e.$widget.is(t.target)||e.$widget.find(t.target).length||e.hideWidget()}),this.$element.trigger("show.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}),this.place(),this.disableFocus&&this.$element.blur(),""===this.hour&&(this.defaultTime?this.setDefaultTime(this.defaultTime):this.setTime("0:0:0")),"modal"===this.template&&this.$widget.modal?this.$widget.modal("show").on("hidden",t.proxy(this.hideWidget,this)):this.isOpen===!1&&this.$widget.addClass("open"),this.isOpen=!0}},toggleMeridian:function(){this.meridian="AM"===this.meridian?"PM":"AM"},update:function(t){this.updateElement();var t=t||{};t.ignoreWidget||this.updateWidget(),this.$element.trigger("changeTime.timepicker",{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian,options:t})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget!==!1){var t=this.hour,e=1===this.minute.toString().length?"0"+this.minute:this.minute,i=1===this.second.toString().length?"0"+this.second:this.second;this.showInputs?(this.$widget.find("input.bootstrap-timepicker-hour").val(t.padLeft(2,"0")),this.$widget.find("input.bootstrap-timepicker-minute").val(e),this.showSeconds&&this.$widget.find("input.bootstrap-timepicker-second").val(i),this.showMeridian&&this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)):(this.$widget.find("span.bootstrap-timepicker-hour").text(t.padLeft(2,"0")),this.$widget.find("span.bootstrap-timepicker-minute").text(e),this.showSeconds&&this.$widget.find("span.bootstrap-timepicker-second").text(i),this.showMeridian&&this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian))}},updateFromWidgetInputs:function(){if(this.$widget!==!1){var t=this.$widget.find("input.bootstrap-timepicker-hour").val()+":"+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(t,{ignoreWidget:!0})}},widgetClick:function(e){e.stopPropagation(),e.preventDefault();var i=t(e.target),n=i.closest("a").data("action");n&&this[n](),this.update(),i.is("input")&&i.get(0).setSelectionRange(0,2)},widgetKeydown:function(e){var i=t(e.target),n=i.attr("class").replace("bootstrap-timepicker-","");switch(e.keyCode){case 9:if(this.showMeridian&&"meridian"===n||this.showSeconds&&"second"===n||!this.showMeridian&&!this.showSeconds&&"minute"===n)return this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(e.preventDefault(),n){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),i.get(0).setSelectionRange(0,2);break;case 40:switch(e.preventDefault(),n){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),i.get(0).setSelectionRange(0,2)}},widgetKeyup:function(t){(65===t.keyCode||77===t.keyCode||80===t.keyCode||46===t.keyCode||8===t.keyCode||t.keyCode>=46&&t.keyCode<=57)&&this.updateFromWidgetInputs()}},t.fn.timepicker=function(i){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var s=t(this),o=s.data("timepicker"),r="object"==typeof i&&i;o||s.data("timepicker",o=new e(this,t.extend({},t.fn.timepicker.defaults,r,t(this).data()))),"string"==typeof i&&o[i].apply(o,n)})},t.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,disableMousewheel:!1,isOpen:!1,minuteStep:15,modalBackdrop:!1,orientation:{x:"auto",y:"auto"},secondStep:15,showSeconds:!1,showInputs:!0,showMeridian:!0,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:!0},t.fn.timepicker.Constructor=e}),define("_common/views/ProcessorView",["jquery","jqueryui","underscore","abstracts/View","text!_common/tmpl/modelTag.html","text!_common/tmpl/processor.html","timepicker","css!_libs/bootstrap/timepicker/css/bootstrap-timepicker.css"],function(t,e,i,n,s,o){o=i.template(o);var r=n.extend({className:"processor",constructor:function(){this.options={header:"Selected objects",objType:App.get("objType"),choosedType:"",objectsDefined:!1,chooseAction:!1,chooseTime:!0,daterange:!0,track:!1,report:!1,watch:!1,item:!1,adding:!0,tmplItem:s,items:null},this._tpInited=!1,this.itemsList=null,this._content=null,this._heightGap=0,n.apply(this,arguments)},initialize:function(e){var n=this;if(this.options=i.extend(this.options,e||{}),!this.options.i18n&&(this.options.i18n=this.model.getTexts()),this.options.objectsDefined||this.listenTo(App,"toggleobjects",function(t){t.length||n.close(),n.options.item=null,n.options.items=t,n.$el.find("h2").html(a.getHeader.call(n))}),this.options.header=a.getHeader.call(this),this.options.tzId=this.model.getUserData("tzId")||null,!this.options.tzId){var s;this.options.tzId=(s=App.getTimezone({offset:60*App.getUserTimezone()}))?s.id:null}this.$el.on("click",".btn-cancel",function(){n.model.trigger("processorcancel")}).on("click",".btn-clear",function(){n.trigger("clear"),n.close()}).on("click","input[name=objType]",function(){n.setObjectsType(this.value)}).on("click",".btn[data-target]",function(){var e=t(this).data("target"),s=n.options.i18n.DateTime,o=n.form.serializeObject(),r="",a=new Array(3),l=new Array(2),h=(new Date,n.options.i18n.errors),c=n.options.i18n.error.ucFirst();if(n.model.reportDatesRangeNeeded(n.options.choosedType)){var u=n.$el.find("input[name=timeFrom]");if(r=s.prepareDateField(o.dateFrom),a=r.split("-"),!o.timeFrom.split)return u.closest(".control-group").addClass("error"),alert(h.invalidDateOrTimeEntered,c);if(l=o.timeFrom.split(":"),2!=l.length)return u.closest(".control-group").addClass("error"),alert(h.invalidDateOrTimeEntered,c);if(o.startTime=new Date(a[0],a[1]-1,a[2],l[0],l[1]).getTime(),r=s.prepareDateField(o.dateTo),a=r.split("-"),u=n.$el.find("input[name=timeFrom]"),!o.timeTo.split)return u.closest(".control-group").addClass("error"),alert(h.invalidDateOrTimeEntered,c);if(l=o.timeTo.split(":"),2!=l.length)return u.closest(".control-group").addClass("error"),alert(h.invalidDateOrTimeEntered,c);o.endTime=new Date(a[0],a[1]-1,a[2],l[0],l[1]).getTime();var d=n.validateDatesRange(o.startTime,o.endTime);if(d)return n.$el.find(".input-time").closest(".control-group").addClass("error"),alert(d.join("<br />"),c)}else n.model.reportDateNeeded(n.options.choosedType)&&(r=s.prepareDateField(o.date),a=r.split("-"),l=o.time.split(":"),o.time=new Date(a[0],a[1]-1,a[2],l[0],l[1]).getTime(),i.each(["dateFrom","dateTo","timeFrom","timeTo","date"],function(t){delete o[t]}));n.model.trigger("processorsubmit",e,n.options,o)}),this.on("cancel",function(){n.close()}),this.listenTo(App,"change:objType",function(t,e){n.setObjectsType(e)}),t(window).on("resizestop",function(){a.fitSize.call(n)})},render:function(e){var e=e||App.getView().$el,i=this,n=o(this.options),s=new Date;e.append(this.$el.html(n)),this.form=this.$el.find("form"),t.fn.draggable&&this.$el.draggable({handle:".box-header",containment:"parent"}),this.$el.find(".datepicker").datepicker({minDate:new Date(2005,0,1),maxDate:s,altFormat:"dd.mm.yy",onChangeMonthYear:function(e,i,n){var s=new Date(e,i,0);s.setDate(Math.min(n.selectedDay,s.getDate())),t(this).datepicker("setDate",s).datepicker("option","onSelect")()}}),this.$el.find("select[name=tzId]").on("change",function(){i.model.setUserData("tzId",t(this).val())}),this._tpInited=!1,a.initDateRangeInputs.call(this),a.initSingleDateInput.call(this),this.$el.find(".datepicker a.ui-state-hover").removeClass("ui-state-hover"),this._content=this.$el.find(">form>.box-content"),this._heightGap=this.$el.find(">form>.box-header").height()+this.$el.find(">form>.box-footer").height()+60,this.options.report?a.initReportsParams.call(this):a.fitSize.call(this)},close:function(){App.trigger("unblockmap"),this.remove()},setReportsList:function(t){if(this.options.report){if(!i.keys(t).length)return this.close(),void 0;var e=this,n=this.options.objType,s="";i.each(t,function(t,i){-1!=t.objType.indexOf(n)&&(s+='<option data-objectstype="'+t.objType+'"'+(e.options.choosedType&&e.options.choosedType==i?" selected":"")+' value="'+i+'">'+t.name+"</option>")}),this.$el.find("select[name=type]").html(s)}},setObjectsType:function(t){if(!this.options.objectsDefined&&t!=this.options.objType){App.modules.reports&&App.modules.reports.setUserData("choosedType",this.$el.find("select[name=type]").val());var e=this.options.report?"needreport":"needtrack";this.close(),this.model.trigger(e,t)}},validateDatesRange:function(t,e){var i=[],n=this.model.getTexts(),s=new Date;return t&&e||i.push(n.errors.startOrEndTimeIsAbsent),t>=s?i.push(n.errors.startMoreTnanNow):t>=e&&i.push(n.errors.startMoreTnanEndTime),i.length?i:null}}),a={getHeader:function(){var t=this.options.i18n,e=this.options.items,i="";return this.options.track?i=1==e.length?t.track.ucFirst()+" "+t.byObject+": "+(e.at&&e.at(0)||e[0]).get("name"):t.tracks.ucFirst()+" "+t.byNSelectedObjects.replace("#n#",e.length).replace("#type#",t.byVehiclesLabels[1]):(i=t.report.ucFirst()+" ",i+=1==e.length?t.byObject+": "+(e.at&&e.at(0)||e[0]).get("name"):t.byNSelectedObjects.replace("#n#",e.length).replace("#type#",t["stat"==this.options.objType?"byStationaryLabels":"byVehiclesLabels"][1])),i},fitSize:function(){var e=this._content.find(".report-params"),i=t(window).height(),n=this.$el.offset().top,s=parseInt(this.el.style.top||0),o=this._content[0].scrollHeight;e.length&&(o=Math.max(o,e[0].scrollHeight)),o>i-(n-s)-this._heightGap?(this.el.style.top="0",o=i-n-this._heightGap,e.length?(o-=60,e.height(o)):this._content.addClass("scrolled").height(o)):(e.length&&e.height("auto"),this._content.height("auto"))},initSingleDateInput:function(){var t=this,e=this.$el.find(".date-single"),i=e.siblings("input[name=date]"),n=this.$el.find("input[name=time]"),s=new Date;e.datepicker("option","onSelect",function(i,s){var o=e.datepicker("getDate"),r=new Date,l=o.getYear()==r.getYear()&&o.getMonth()==r.getMonth()&&o.getDate()==r.getDate();t._tpInited||a.initTimepickers.call(t),l?n.timepicker("setTime",r.getHours().padLeft(2)+":"+r.getMinutes().padLeft(2),{ignoreButtons:!0}):n.timepicker("setTime","00:00",{ignoreButtons:!0}),s&&s.drawMonth!=s.selectedMonth&&e.datepicker("setDate",o),t.model.setUserData("singleDate",o.getTime())}).datepicker("option","altField",i);var o,r;(o=t.model.getUserData("singleDate"))&&e.datepicker("setDate",new Date(o)),(r=t.model.getUserData("singleTime"))||(r=s.getHours().padLeft(2)+":"+s.getMinutes().padLeft(2)),t._tpInited?n.timepicker("setTime",r,{ignoreButtons:!0}):n.val(r),t._tpInited||a.initTimepickers.call(t),n.on("change",function(){var e=this.value.split(":");if(!(2!=e.length||e[0]<0||e[0]>23||e[1]<0||e[1]>59)){var i=new Date;return i.getHours()==parseInt(e[0])&&i.getMinutes()==parseInt(e[1])?(t.model.setUserData(this.name,null),void 0):(t.model.setUserData("singleTime",this.value),void 0)}})},initTimepickers:function(){var e=this;t.fn.timepicker&&this.$el.find(".input-time").timepicker({minuteStep:1,showMeridian:!1,showInputs:!1}).on("changeTime.timepicker",function(i,n){t(this).closest(".control-group").removeClass("error"),!n.options.ignoreButtons&&a.setButtonsState.call(e)}),this._tpInited=!0},initDateRangeInputs:function(){var e=this,i=this.$el.find(".date-from"),n=i.siblings("input[name=dateFrom]"),s=this.$el.find(".date-to"),o=s.siblings("input[name=dateTo]"),r=this.$el.find("input[name=timeFrom]"),l=this.$el.find("input[name=timeTo]"),h=new Date;this.$el.find(".date.from, .date.to").removeClass("hidden"),i.datepicker("option","onSelect",function(t,n){var o=i.datepicker("getDate"),h=s.datepicker("getDate"),c=h-o;if(e._tpInited||a.initTimepickers.call(e),r.timepicker("setTime","00:00",{ignoreButtons:!1}),n&&n.drawMonth!=n.selectedMonth&&i.datepicker("setDate",o),0>=c){var u=o.getTime(),d=(new Date).getTime(),p=new Date(u);u>d&&(p=new Date(d),l.timepicker("setTime",p.getHours().padLeft(2)+":"+p.getMinutes().padLeft(2),{ignoreButtons:!1})),s.datepicker("setDate",p),e.model.setUserData("dateTo",p.getTime())}t&&n&&a.setButtonsState.call(e),s.find("a.ui-state-hover").removeClass("ui-state-hover"),l.add(r).closest(".control-group").removeClass("error"),e.model.setUserData("dateFrom",o.getTime())}).datepicker("option","altField",n),s.datepicker("option","onSelect",function(t,n){var o=s.datepicker("getDate"),h=i.datepicker("getDate"),c=new Date,u=o-h,d=o.getYear()==c.getYear()&&o.getMonth()==c.getMonth()&&o.getDate()==c.getDate();if(e._tpInited||a.initTimepickers.call(e),d?l.timepicker("setTime",c.getHours().padLeft(2)+":"+c.getMinutes().padLeft(2),{ignoreButtons:!1}):l.timepicker("setTime","00:00",{ignoreButtons:!1}),n&&n.drawMonth!=n.selectedMonth&&s.datepicker("setDate",o),0>=u){var p=new Date(o.getTime());i.datepicker("setDate",p),e.model.setUserData("dateFrom",p.getTime())}t&&n&&a.setButtonsState.call(e),i.find("a.ui-state-hover").removeClass("ui-state-hover"),l.add(r).closest(".control-group").removeClass("error"),e.model.setUserData("dateTo",o.getTime())}).datepicker("option","altField",o);var c,u;(c=e.model.getUserData("dateFrom"))&&i.datepicker("setDate",new Date(c)),(c=e.model.getUserData("dateTo"))&&s.datepicker("setDate",new Date(c)),(u=e.model.getUserData("timeFrom"))&&(e._tpInited?r.timepicker("setTime",u,{ignoreButtons:!1}):r.val(u)),(u=e.model.getUserData("timeTo"))||(u=h.getHours().padLeft(2)+":"+h.getMinutes().padLeft(2)),e._tpInited?l.timepicker("setTime",u,{ignoreButtons:!1}):l.val(u),e._tpInited||a.initTimepickers.call(e),r.add(l).on("change",function(){var t=this.value.split(":");if(!(2!=t.length||t[0]<0||t[0]>23||t[1]<0||t[1]>59)){if(this==l[0]){var i=new Date;if(i.getHours()==parseInt(t[0])&&i.getMinutes()==parseInt(t[1]))return e.model.setUserData(this.name,null),void 0}e.model.setUserData(this.name,this.value)}});var d=this.$el.find(".autoselect");d.on("click","[data-value]",function(){var n=t(this),o=new Date,a=n.data("value"),h=o.getFullYear(),c=o.getMonth(),u=o.getDate(),p=o.getHours().padLeft(2,"0")+":"+o.getMinutes().padLeft(2,"0"),f="00:00",m=o,g=null;switch(d.find(".active").removeClass("active"),n.addClass("active"),a){case"curDay":g=new Date(h,c,u),f=p;break;case"prevDay":g=new Date(h,c,u-1),m=new Date(h,c,u,0,0);break;case"curWeek":var v=o.getDay();g=new Date(h,c,u-(0==v?6:v-1)),f=p;break;case"prevWeek":var v=o.getDay(),_=u-(0==v?6:v-1);m=new Date(h,c,_,0,0),g=new Date(h,c,_-7);break;case"curMonth":g=new Date(h,c,1),f=p;break;case"prevMonth":g=new Date(h,c-1,1),m=new Date(h,c,1,0,0)}s.datepicker("setDate",m,{ignoreButtons:!0}),i.datepicker("setDate",g,{ignoreButtons:!0}),l.timepicker("setTime",f,{ignoreButtons:!0}),e.model.setUserData("dateTo",s.datepicker("getDate").getTime()),e.model.setUserData("dateFrom",i.datepicker("getDate").getTime()),r.timepicker("setTime","00:00",{ignoreButtons:!0}),s.add(i).find("a.ui-state-hover").removeClass("ui-state-hover")}),a.setButtonsState.call(e)},initReportsParams:function(){var t=this.$el.find("select[name=type]"),e=this,i=t.val();a.buildReportParams.call(this,i),a.checkDatepickers.call(this,i),t.on("change",function(){var i=t.val();e.options.choosedType=i,e.$el.find(".report-params .content").empty(),a.buildReportParams.call(e,i),a.checkDatepickers.call(e,i)})},buildReportParams:function(t){var e=this.$el.find(".report-params"),i=this;showCursor(),this.model.getReportExtraFields(t,this.options.objType,this.options.item?[this.options.item]:this.options.items.models?this.options.items.models:this.options.items).done(function(t,n){i.$el.addClass("wide");var s=e.removeClass("hidden").find(".content");s.html(t),n&&n(e);var o=i.$el.parent().width(),r=i.$el.position().left,a=i.$el.width(),l=30;r+a+l>=o&&i.$el.css("left",o-a-l)}).fail(function(){i.$el.removeClass("wide"),e.addClass("hidden")}).always(function(){hideCursor(),a.fitSize.call(i)})},checkDatepickers:function(t){this.model.reportDatesRangeNeeded(t)?(this.$el.find(".time-range").removeClass("disabled"),this.$el.find(".date.from, .date.to").removeClass("hidden"),this.$el.find(".date.single").addClass("hidden"),this.$el.find(".autoselect").removeClass("disabled")):this.model.reportDateNeeded(t)?(this.$el.find(".time-range").removeClass("disabled"),this.$el.find(".date.from, .date.to").addClass("hidden"),this.$el.find(".date.single").removeClass("hidden"),this.$el.find(".autoselect").addClass("disabled")):(this.$el.find(".time-range").addClass("disabled"),this.$el.find(".autoselect").removeClass("disabled"))},setButtonsState:function(){var t=this.options.i18n.DateTime;if(this.options.daterange){this.$el.find(".autoselect .active").removeClass("active");var e=this.$el.find("input[name=dateFrom]"),i=t.prepareDateField(e.val()),n=i.split("-"),s=this.$el.find("input[name=timeFrom]"),o=s.val();if(o.split){var r=o.split(":");if(2==r.length){var a=new Date(n[0],n[1]-1,n[2],r[0],r[1]);if(e=this.$el.find("input[name=dateTo]"),i=t.prepareDateField(e.val()),n=i.split("-"),s=this.$el.find("input[name=timeTo]"),o=s.val(),o.split&&(r=o.split(":"),2==r.length)){var l=new Date(n[0],n[1]-1,n[2],r[0],r[1]),h=this.validateDatesRange(a,l);if(!h)for(var c=new Date,u=c.getFullYear(),d=c.getMonth(),p=c.getDate(),f=["curDay","prevDay","curWeek","prevWeek","curMonth","prevMonth"],m=0,g=f.length;g>m;m++){var v=f[m],_=this.$el.find(".autoselect [data-value="+v+"]");if("curDay"==v)var y=new Date(u,d,p);else if("prevDay"==v)var y=new Date(u,d,p-1),b=new Date(u,d,p,0,0);else if("curWeek"==v)var w=c.getDay(),y=new Date(u,d,p-(0==w?6:w-1));else if("prevWeek"==v)var w=c.getDay(),x=p-(0==w?6:w-1),y=new Date(u,d,x-7),b=new Date(u,d,x,0,0);else if("curMonth"==v)var y=new Date(u,d,1);else if("prevMonth"==v)var y=new Date(u,d-1,1),b=new Date(u,d,1,0,0);if(-1!=v.indexOf("cur")){if(y.getTime()==a.getTime()&&l.getTime()-c.getTime()<6e4){_.addClass("active");break}}else if(y.getTime()==a.getTime()&&l.getTime()==b.getTime()){_.addClass("active");break}}}}}}}};return r}),define("_common/nls/tz",{root:{names:[{offset:-720,name:"Date line",index:"000",id:"Etc/GMT-12"},{offset:-660,name:"Samoa",index:"001",id:"Pacific/Midway"},{offset:-600,name:"Hawaii",index:"002",id:"Pacific/Honolulu"},{offset:-540,name:"Alaska",index:"003",id:"America/Anchorage"},{offset:-480,name:"Pacific Time (USA and Canada)",index:"004",id:"PST8PDT"},{offset:-420,name:"Mountain Standard Time (USA and Canada)",index:"010",id:"MST7MDT"},{offset:-420,name:"La Paz, Mazatlan, Chihuahua",index:"013",id:"America/Chihuahua"},{offset:-420,name:"Arizona",index:"015",id:"America/Chihuahua"},{offset:-360,name:"Central Standard Time (USA and Canada)",index:"020",id:"CST6CDT"},{offset:-360,name:"Saskatchewan",index:"025",id:"America/Regina"},{offset:-360,name:"Guadalajara, Mexico City, Monterrey",index:"030",id:"America/Mexico_City"},{offset:-360,name:"Central America",index:"033",id:"America/Costa_Rica"},{offset:-300,name:"Eastern Standard Time (USA and Canada)",index:"035",id:"EST5EDT"},{offset:-300,name:"Indiana (east)",index:"040",id:"America/Indiana/Petersburg"},{offset:-300,name:"Bogota, Quito, Lima",index:"045",id:"America/Bogota"},{offset:-270,name:"Caracas",index:"055",id:"America/Caracas"},{offset:-240,name:"Atlantic Standard Time (Canada)",index:"050",id:"America/Glace_Bay"},{offset:-240,name:"Georgetown, La Paz, Manaus, San Juan",index:"051",id:"America/La_Paz"},{offset:-240,name:"Santiago",index:"056",id:"America/Santiago"},{offset:-240,name:"Cuiaba",index:"057",id:"America/Cuiaba"},{offset:-210,name:"Newfoundland and Labrador",index:"060",id:"America/St_Johns"},{offset:-180,name:"Brasilia",index:"065",id:"America/Sao_Paulo"},{offset:-180,name:"Buenos Aires",index:"070",id:"America/Argentina/Buenos_Aires"},{offset:-180,name:"Greenland",index:"073",id:"America/Godthab"},{offset:-180,name:"Cayenne, Fortaleza",index:"074",id:"America/Cayenne"},{offset:-180,name:"Montevideo",index:"072",id:"America/Montevideo"},{offset:-120,name:"Mid-Atlantic Standard Time",index:"075",id:"Atlantic/South_Georgia"},{offset:-60,name:"Azores",index:"080",id:"Atlantic/Azores"},{offset:-60,name:"Cape Verde Islands",index:"083",id:"Atlantic/Cape_Verde"},{offset:0,name:"UTC time",index:"085",id:"Etc/UTC"},{offset:0,name:"Dublin, Edinburgh, London, Lisbon",index:"086",id:"Europe/Belfast"},{offset:0,name:"Casablanca",index:"090",id:"Africa/Casablanca"},{offset:0,name:"Monrovia, Reykjavik",index:"091",id:"Atlantic/Reykjavik"},{offset:60,name:"Belgrade, Bratislava, Budapest, Ljubljana, Prague",index:"095",id:"Europe/Budapest"},{offset:60,name:"Warsaw, Zagreb, Sarajevo, Skopje",index:"100",id:"Europe/Warsaw"},{offset:60,name:"Brussels, Copenhagen, Madrid, Paris",index:"105",id:"Europe/Paris"},{offset:60,name:"Amsterdam, Berlin, Berne, Vienna, Rome, Stockholm",index:"110",id:"Europe/Berlin"},{offset:60,name:"Windhoek",index:"112",id:"Africa/Windhoek"},{offset:60,name:"Sub-Saharan Africa",index:"113",id:"Africa/Algiers"},{offset:120,name:"Kaliningrad",index:"114",id:"Europe/Kaliningrad"},{offset:120,name:"Athens, Bucharest",index:"130",id:"Europe/Athens"},{offset:120,name:"Beirut",index:"115",id:"Asia/Beirut"},{offset:120,name:"Cairo",index:"120",id:"Africa/Cairo"},{offset:120,name:"Vilnyus, Kyiv, Riga, Sofia, Tallin, Helsinki",index:"125",id:"Europe/Helsinki"},{offset:120,name:"Jerusalem",index:"135",id:"Asia/Jerusalem"},{offset:120,name:"Harare, Pretoria",index:"140",id:"Africa/Harare"},{offset:180,name:"Moscow, St. Petersburg, Volgograd",index:"145",id:"Europe/Moscow"},{offset:180,name:"Minsk",index:"146",id:"Europe/Minsk"},{offset:180,name:"Kuwait, Riyadh",index:"150",id:"Asia/Kuwait"},{offset:180,name:"Nairobi",index:"155",id:"Africa/Nairobi"},{offset:180,name:"Baghdad",index:"158",id:"Asia/Baghdad"},{offset:210,name:"Tehran",index:"160",id:"Asia/Tehran"},{offset:240,name:"Samara, Izhevsk",index:"161",id:"Europe/Samara"},{offset:240,name:"Abu Dhabi, Muscat",index:"165",id:"Asia/Muscat"},{offset:240,name:"Baku, Tbilisi, Yerevan",index:"170",id:"Asia/Tbilisi"},{offset:270,name:"Kabul",index:"175",id:"Asia/Kabul"},{offset:300,name:"Yekaterinburg, Ufa, Tyumen, Perm",index:"196",id:"Asia/Yekaterinburg"},{offset:300,name:"Islamabad, Karachi",index:"185",id:"Asia/Karachi"},{offset:300,name:"Tashkent",index:"186",id:"Asia/Tashkent"},{offset:330,name:"Calcutta, Mumbai, New Delhi, Chennai",index:"190",id:"Asia/Calcutta"},{offset:330,name:"Sri Jayawardenapura Kotte",index:"200",id:"Asia/Colombo"},{offset:345,name:"Kathmandu",index:"193",id:"Asia/Kathmandu"},{offset:360,name:"Omsk",index:"194",id:"Asia/Omsk"},{offset:360,name:"Astana",index:"195",id:"Asia/Almaty"},{offset:390,name:"Rangoon",index:"203",id:"Asia/Rangoon"},{offset:420,name:"Novosibirsk, Tomsk",index:"206",id:"Asia/Krasnoyarsk"},{offset:420,name:"Krasnoyarsk, Kemerovo, Barnaul, Abakan",index:"207",id:"Asia/Krasnoyarsk"},{offset:420,name:"Bangkok, Djakarta, Hanoi",index:"205",id:"Asia/Bangkok"},{offset:480,name:"Ulan-Ude, Irkutsk",index:"208",id:"Asia/Irkutsk"},{offset:480,name:"Hong Kong, Beijing, Urumqi, Chongqing ",index:"210",id:"Asia/Hong_Kong"},{offset:480,name:"Kuala Lumpur, Singapore",index:"215",id:"Asia/Kuala_Lumpur"},{offset:480,name:"Taipei",index:"220",id:"Asia/Taipei"},{offset:480,name:"Perth",index:"225",id:"Australia/Perth"},{offset:480,name:"Ulaanbaatar",index:"227",id:"Asia/Ulaanbaatar"},{offset:540,name:"Yakutsk, Blagoveshchensk, Chita",index:"240",id:"Asia/Yakutsk"},{offset:540,name:"Seoul",index:"230",id:"Asia/Seoul"},{offset:540,name:"Osaka, Sapporo, Tokyo",index:"235",id:"Asia/Tokyo"},{offset:570,name:"Adelaide",index:"250",id:"Australia/Adelaide"},{offset:600,name:"Khabarovsk, Vladivostok, Magadan",index:"270",id:"Asia/Vladivostok"},{offset:600,name:"Canberra, Melbourne, Sydney",index:"255",id:"Australia/Canberra"},{offset:600,name:"Hobart",index:"265",id:"Australia/Hobart"},{offset:600,name:"Guam, Port Moresby",index:"275",id:"Pacific/Guam"},{offset:660,name:"Yuzhno-Sakhalinsk, Druzhina",index:"291",id:"Asia/Srednekolymsk"},{offset:660,name:"Solomon Islands, New Caledonia",index:"280",id:"Pacific/Guadalcanal"},{offset:720,name:"Petropavlovsk-Kamchatsky",index:"291",id:"Asia/Kamchatka"},{offset:720,name:"Fiji",index:"285",id:"Pacific/Fiji"},{offset:720,name:"Wellington, Auckland",index:"290",id:"Pacific/Auckland"},{offset:780,name:"Nukualofa",index:"300",id:"Etc/GMT+13"}]},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("_common/nls/ru-ru/tz",{names:[{offset:-720,name:"Линия перемены дат",index:"000",id:"Etc/GMT-12"},{offset:-660,name:"Самоа",index:"001",id:"Pacific/Midway"},{offset:-600,name:"Гавайи",index:"002",id:"Pacific/Honolulu"},{offset:-540,name:"Аляска",index:"003",id:"America/Anchorage"},{offset:-480,name:"Тихоокеанское время (США и Канада)",index:"004",id:"PST8PDT"},{offset:-420,name:"Горное время (США и Канада)",index:"010",id:"MST7MDT"},{offset:-420,name:"Ла-Пас, Мазатлан, Чихуахуа",index:"013",id:"America/Chihuahua"},{offset:-420,name:"Аризона",index:"015",id:"America/Chihuahua"},{offset:-360,name:"Центральное время (США и Канада)",index:"020",id:"CST6CDT"},{offset:-360,name:"Саскачеван",index:"025",id:"America/Regina"},{offset:-360,name:"Гвадалахара, Мехико, Монтеррей",index:"030",id:"America/Mexico_City"},{offset:-360,name:"Центральная Америка",index:"033",id:"America/Costa_Rica"},{offset:-300,name:"Восточное время (США и Канада)",index:"035",id:"EST5EDT"},{offset:-300,name:"Индиана (восток)",index:"040",id:"America/Indiana/Petersburg"},{offset:-300,name:"Богота, Кито, Лима",index:"045",id:"America/Bogota"},{offset:-270,name:"Каракас",index:"055",id:"America/Caracas"},{offset:-240,name:"Атлантическое время (Канада)",index:"050",id:"America/Glace_Bay"},{offset:-240,name:"Джорджтаун, Ла-Пас, Манаус, Сан-Хуан",index:"051",id:"America/La_Paz"},{offset:-240,name:"Сантьяго",index:"056",id:"America/Santiago"},{offset:-240,name:"Куяба",index:"057",id:"America/Cuiaba"},{offset:-210,name:"Ньюфаундленд и Лабрадор",index:"060",id:"America/St_Johns"},{offset:-180,name:"Бразилиа",index:"065",id:"America/Sao_Paulo"},{offset:-180,name:"Буэнос-Айрес",index:"070",id:"America/Argentina/Buenos_Aires"},{offset:-180,name:"Гренландия",index:"073",id:"America/Godthab"},{offset:-180,name:"Кайенна, Форталеза",index:"074",id:"America/Cayenne"},{offset:-180,name:"Монтевидео",index:"072",id:"America/Montevideo"},{offset:-120,name:"Среднеатлантическое время",index:"075",id:"Atlantic/South_Georgia"},{offset:-60,name:"Азорские о-ва",index:"080",id:"Atlantic/Azores"},{offset:-60,name:"О-ва Зеленого Мыса",index:"083",id:"Atlantic/Cape_Verde"},{offset:0,name:"Время в формате UTC",index:"085",id:"Etc/UTC"},{offset:0,name:"Дублин, Эдинбург, Лондон, Лиссабон",index:"086",id:"Europe/Belfast"},{offset:0,name:"Касабланка",index:"090",id:"Africa/Casablanca"},{offset:0,name:"Монровия, Рейкьявик",index:"091",id:"Atlantic/Reykjavik"},{offset:60,name:"Белград, Братислава, Будапешт, Любляна, Прага",index:"095",id:"Europe/Budapest"},{offset:60,name:"Варшава, Загреб, Сараево, Скопье",index:"100",id:"Europe/Warsaw"},{offset:60,name:"Брюссель, Копенгаген, Мадрид, Париж",index:"105",id:"Europe/Paris"},{offset:60,name:"Амстердам, Берлин, Берн, Вена, Рим, Стокгольм",index:"110",id:"Europe/Berlin"},{offset:60,name:"Виндхук",index:"112",id:"Africa/Windhoek"},{offset:60,name:"Западная Центральная Африка",index:"113",id:"Africa/Algiers"},{offset:120,name:"Калининград",index:"114",id:"Europe/Kaliningrad"},{offset:120,name:"Афины, Бухарест",index:"130",id:"Europe/Athens"},{offset:120,name:"Бейрут",index:"115",id:"Asia/Beirut"},{offset:120,name:"Каир",index:"120",id:"Africa/Cairo"},{offset:120,name:"Вильнюс, Киев, Рига, София, Таллин, Хельсинки",index:"125",id:"Europe/Helsinki"},{offset:120,name:"Иерусалим",index:"135",id:"Asia/Jerusalem"},{offset:120,name:"Хараре, Претория",index:"140",id:"Africa/Harare"},{offset:180,name:"Москва, Санкт-Петербург, Волгоград",index:"145",id:"Europe/Moscow"},{offset:180,name:"Минск",index:"146",id:"Europe/Minsk"},{offset:180,name:"Кувейт, Эр-Рияд",index:"150",id:"Asia/Kuwait"},{offset:180,name:"Найроби",index:"155",id:"Africa/Nairobi"},{offset:180,name:"Багдад",index:"158",id:"Asia/Baghdad"},{offset:210,name:"Тегеран",index:"160",id:"Asia/Tehran"},{offset:240,name:"Самара, Ижевск",index:"161",id:"Europe/Samara"},{offset:240,name:"Абу-Даби, Мускат",index:"165",id:"Asia/Muscat"},{offset:240,name:"Баку, Тбилиси, Ереван",index:"170",id:"Asia/Tbilisi"},{offset:270,name:"Кабул",index:"175",id:"Asia/Kabul"},{offset:300,name:"Екатеринбург, Уфа, Тюмень, Пермь",index:"196",id:"Asia/Yekaterinburg"},{offset:300,name:"Исламабад, Карачи",index:"185",id:"Asia/Karachi"},{offset:300,name:"Ташкент",index:"186",id:"Asia/Tashkent"},{offset:330,name:"Колката, Мумбаи, Нью-Дели, Ченнай",index:"190",id:"Asia/Calcutta"},{offset:330,name:"Шри-Джаявардене-пура-Котте",index:"200",id:"Asia/Colombo"},{offset:345,name:"Катманду",index:"193",id:"Asia/Kathmandu"},{offset:360,name:"Омск",index:"194",id:"Asia/Omsk"},{offset:360,name:"Астана",index:"195",id:"Asia/Almaty"},{offset:390,name:"Янгон",index:"203",id:"Asia/Rangoon"},{offset:420,name:"Новосибирск, Томск",index:"206",id:"Asia/Krasnoyarsk"},{offset:420,name:"Красноярск, Кемерово, Барнаул, Абакан",index:"207",id:"Asia/Krasnoyarsk"},{offset:420,name:"Бангкок, Джакарта, Ханой",index:"205",id:"Asia/Bangkok"},{offset:480,name:"Улан-Удэ, Иркутск",index:"208",id:"Asia/Irkutsk"},{offset:480,name:"Гонконг, Пекин, Урумчи, Чунцин",index:"210",id:"Asia/Hong_Kong"},{offset:480,name:"Куала-Лумпур, Сингапур",index:"215",id:"Asia/Kuala_Lumpur"},{offset:480,name:"Тайбэй",index:"220",id:"Asia/Taipei"},{offset:480,name:"Перт",index:"225",id:"Australia/Perth"},{offset:480,name:"Улан-Батор",index:"227",id:"Asia/Ulaanbaatar"},{offset:540,name:"Якутск, Благовещенск, Чита",index:"240",id:"Asia/Yakutsk"},{offset:540,name:"Сеул",index:"230",id:"Asia/Seoul"},{offset:540,name:"Осака, Саппоро, Токио",index:"235",id:"Asia/Tokyo"},{offset:570,name:"Аделаида",index:"250",id:"Australia/Adelaide"},{offset:600,name:"Хабаровск, Владивосток, Магадан",index:"270",id:"Asia/Vladivostok"},{offset:600,name:"Канберра, Мельбурн, Сидней",index:"255",id:"Australia/Canberra"},{offset:600,name:"Хобарт",index:"265",id:"Australia/Hobart"},{offset:600,name:"Гуам, Порт-Морсби",index:"275",id:"Pacific/Guam"},{offset:660,name:"Южно-Сахалинск, Дружина",index:"291",id:"Asia/Srednekolymsk"},{offset:660,name:"Соломоновы о-ва, Нов. Каледония",index:"280",id:"Pacific/Guadalcanal"},{offset:720,name:"Петропавловск-Камчатский",index:"291",id:"Asia/Kamchatka"},{offset:720,name:"Фиджи",index:"285",id:"Pacific/Fiji"},{offset:720,name:"Веллингтон, Окленд",index:"290",id:"Pacific/Auckland"},{offset:780,name:"Нукуалофа",index:"300",id:"Etc/GMT+13"}]}),define("_common/AppModule",["jquery","jquerytiny","underscore","jface","abstracts/Module","util","router","storage","_common/views/AppView","_common/views/ProcessorView","i18n!_common/nls/common","i18n!_common/nls/tz"],function(t,e,i,n,s,o,r,a,l,h,c,u){function d(t,e,i){var n=new Date;
	n.setDate(n.getDate()+i);var s=encodeURIComponent(e)+(null==i?"":";expires="+n.toUTCString());document.cookie=t+"="+s}function p(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function f(){this._el=null,this._showCalls=0}var m={mobile:"mobile/MobileModule",stat:"stat/StatModule",guards:"guards/GuardsModule",geozones:"_common/geozones/GeozonesModule",tracks:"_common/tracks/TracksModule",reports:"_common/reports/ReportsModule",alarms:"_common/alerts/AlertsModule",poi:"_common/poi/PoiModule",setup:"_common/setup/SetupModule"},g=12e4,v=15e3,_=3,y="";if("hidden"in document)y="hidden";else for(var b=["webkit","moz","ms","o"],w=0;w<b.length;w++)b[w]+"Hidden"in document&&(y=b[w]+"Hidden");var x=null,S=null;t.ajaxSetup({crossDomain:!0,method:"POST",type:"POST",dataType:"json",processData:!1,contentType:"application/json",traditional:!0,xhrFields:{},beforeSend:function(t,e){e.data=JSON.stringify(e.data),t.setRequestHeader("Accept-Language",LOCALE),"GET"==e.type&&(e.type="POST")}}),"undefined"!=typeof IE_BROWSER&&(t.browser=t.browser||{},t.browser.ie=!0),navigator.userAgent.match(/Trident\/7\./)&&(t.browser=t.browser||{},t.browser.ie=!0,t.browser.ie11=!0);var C=r,T=a,M={},A=null,D="",L={},k=-(new Date).getTimezoneOffset()/60,P=s.extend({constructor:function(){window.App=this,this.serverUp=!1,this.serverWait=!1,this._activeModule=null,this._hasModules=[],this._pingTmt=null,this._reconnectTries=0,this._reconnectMsgShown=!1,this._processor=null,s.apply(this,arguments)},MS:1e3,TYPE_STAT:1,TYPE_MOBILE:0,POSITION_CODE_TECH:"technician",defaults:{visible:!document[y],totalAlarms:null,startWithDashboard:!1,objType:null,reportsInBuild:null,availableReports:null,allowedReports:null,commonBounds:null,commonBoundsMaxZoom:15,commonBoundsPadding:[80,50],autozoomActive:!1,ivSessions:{},showAlertsLog:!1,guardsAvailable:!1},initialize:function(){var t=this;if(C.init(),I.bindEvents.apply(this),this._view=new l({model:this}),!T.currentBackend()){var e=c.errors.localStorageUnavailable,i=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);return i&&(e+="<br />"+c.errors.iosPrivateMode),alert(e,c.error)}requirejs(["system/SystemModule"],function(e){t.modules.system=new e({id:"system"})})},getVersion:function(){return this.modules.system&&this.modules.system.getVersion()},subscribe:function(t,e){for(var n=t.split(" "),s=n.length;s--;){var o=n[s];M[o]||(M[o]=[]),i.isFunction(e)?e={callback:e,context:this,once:!1}:i.isArray(e)?e={callback:e[0],context:e[1]||this,once:!1}:e.context=e.context||this,L[o]?(I._publishOnce.call(this,o,e,L[o]),e.once||M[o].push(e)):M[o].push(e)}return!1},unsubscribe:function(){if(2==arguments.length){for(var t,e=arguments[0],n=arguments[1],s=e.split(" "),o=s.length;o--;)if(M[s[o]])for(var r,t=M[s[o]].slice(0),a=t.length;a--;)r=t[a],(r==n||r.context&&r.callback&&r.context==n.context&&r.callback==n.callback)&&M[s[o]].splice(a,1)}else if(1==arguments.length){var l=arguments[0],o=M.length,a=0;i.each(M,function(t,e){for(o=t.length;o--;)t[o].context&&t[o].context==l&&(M[e]=i.without(M[e],t[o]))})}},publish:function(){I._publishAll.apply(this,arguments)},receive:function(t,e){L[t]=e,e(I._publishAll.apply(this,arguments))},allowed:function(t){return A.can(t)},getAllowedReports:function(){if(this.has("allowedReports"))return this.get("allowedReports");var t=this.hasMobile(),e=this.hasStationary(),n={},s=(i.filter(A.get("allowedActions"),function(t){return-1!=t.indexOf("reports")?(n[t]=1,!0):!1}),this.get("availableReports")),o={};return i.each(s,function(s,r){var a=!0;("mobile"==s.objType&&!t||"stat"==s.objType&&!e)&&(a=!1);var l=s.action||r.toUpperCase();if("string"==typeof l)a="reports."+l in n;else{var h=i.filter(l,function(t){return"reports."+t in n});a=h.length>0}a&&(o[r]=s)}),this.set("allowedReports",o),o},reportsAllowed:function(t,e){if(!this.hasModule(t))return!1;e=e||this.getAllowedReports();var i=!1;for(var n in e)if(-1!=e[n].objType.indexOf(t)){i=!0;break}return i},reportAllowedByType:function(t){var e=t;return"RUNMINI"==t?e="RUN":"ALERTSUM"==t&&(e="ALERTS"),this.allowed("reports."+e)&&t in App.get("reportsInBuild")},policeCallAllowed:function(){return this.userHasRole("vzorgibdd")},hasModule:function(t){return-1!==i.indexOf(this._hasModules,t)},getUserTimezone:function(){return k},getUsername:function(){return A.get("username")},getCredentials:function(){return{login:A.get("username"),pass:A.get("password")}},getBasic:function(){return A.get("basic")},hasMobile:function(){return A&&A.get("hasMobile")},hasStationary:function(){return A&&A.get("hasStationary")},hasGuards:function(){return A&&A.get("hasGuards")},isSmsAllowed:function(){return A&&A.get("isSmsAllowed")},getMinImportTs:function(){return A?A.get("importTs")||0:0},getSettingsView:function(){return this.modules.system?this.modules.system.getSettingsView():null},getRouter:function(){return C},getStorage:function(){return T},getChannels:function(){return M},getLocale:function(){return LOCALE},getLocaleName:function(){var t={"ru-RU":"Русский","ru-ru":"Русский","en-US":"English","en-en":"English","it-IT":"Italiano","it-DE":"Deutsch"};return t[LOCALE]},getTimezonesList:function(){return u.names},getTimezone:function(t){return i.findWhere(u.names,t)},getFullTimezoneName:function(t){var e=Date.offsetToString(t.offset);return"(UTC"+(e?" "+e:"")+") "+t.name},getRMCookieName:function(){return"rm"},buildBaseUrl:function(t){return(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.connector?"/"+t.connector:"")+"/"},setBaseUrl:function(t){D=t},getBaseUrl:function(){return D},getResourceBaseUrl:function(t){var e=this.getBaseUrl(),i=this.getServerSettings();return t in i?e=this.buildBaseUrl(i[t]):"guards"==t&&(e=e.replace(i.connector,"guards-web")),e},isHttpsClient:function(){return"https"===window.location.protocol.substr(0,5)},isHttpsServer:function(){return"https"===this.getServerSettings().protocol},getAdminUrl:function(){var t=this.modules.system.getServerSettings(),e=t.adminHost||t.host,i=this.getCredentials();return(t.protocol?t.protocol+":":"")+"//"+e+(t.port?":"+t.port:"")+"/adminconnector/relogin?j_username="+encodeURIComponent(i.login)+"&j_password="+encodeURIComponent(i.pass)+"&lang="+App.getLocale().replace("-","_")},getServerSettings:function(){return this.modules.system.getServerSettings()},getPlaceholder:function(t){var e={mobile:1,geozones:2,poi:3,tracks:4,reports:5,stat:6,guards:7};return e[t]||null},getSearchProcessor:function(t){return"mobile"==t||"stat"==t?this.modules[t]||null:"guards"==t&&this.hasModule("guards")?this.modules.guards:"objects"==t?this:null},search:function(e){return"objects"==e.type?I.searchObjects.apply(this,arguments):(new t.Deferred).reject("impossible search type")},searchObjectsAndGroups:function(e,i){var n=this.getTexts(),s=new t.Deferred;e=e.toLowerCase();var o={q:e};return"undefined"!=typeof i&&(o.objType=i),t.when(t.ajax({url:App.getBaseUrl()+"objects/obj-search/",data:o}),t.ajax({url:App.getBaseUrl()+"objs-groups/search/",data:o})).done(function(t,e){for(var i=t[0],o=i.length,r=e[0],a=r.length,l=new Array(o+a),h=n.objects.ucFirst(),c=n.groups.ucFirst(),u=0,d=0;o>u;++u,++d){var p={category:h,model:i[u],label:i[u].name+" (#"+i[u].extId+")"};l[d]=p}for(u=0;a>u;++u,++d){r[u].isGroup=!0;var p={category:c,model:r[u],label:r[u].name};l[d]=p}s.resolve(l)}).fail(function(){s.reject()}),s},getSearchOptions:function(){var t=this,e={zoom:!0,putMarker:!1,onsuccess:function(e){for(var n=e.length,s=[],o=[],r=t.modules.mobile||null,a=t.modules.stat||null;n--;)(e[n].objType==t.TYPE_STAT?s:o).push(e[n]);if(t.getUserData("mapSearchMode")){if(r&&o.length&&r.modules.watched){var l=r.modules.watched.items.pluck("id");r.trigger("toggleitems",l.concat(i.pluck(o,"id")),[],t)}if(a&&s.length&&a.modules.watched){var l=a.modules.watched.items.pluck("id");a.trigger("toggleitems",l.concat(i.pluck(s,"id")),[],t)}if(1==o.length+s.length){var h,c;o[0]?(h=o[0],c=r.modules.watched.getEventsPrefix()):(h=s[0],c=a.modules.watched.getEventsPrefix()),t.publish(c+".itemzoom",h)}}else r&&r.modules.watched&&r.modules.watched.setItems(o),a&&a.modules.watched&&a.modules.watched.setItems(s)}};return e},suggest:function(e){return"objects"==e.type?I.suggestObjects.apply(this,arguments):(new t.Deferred).reject("impossible search type")},getPolylineForZone:function(){if(!this.modules.tracks)return null;if(!this.modules.tracks.items.length)return alert(c.pleaseBuildOneTrack,c.attention.ucFirst()),null;var t;return(t=this.modules.tracks.getSinglePolyline())?t.length?t:null:(alert(c.severalTracksShownLeaveOneForZone,c.attention.ucFirst()),null)},getWatchedZonesIds:function(){return this.modules.geozones?this.modules.geozones.getWatchedItemsIds():[]},isAdmin:function(){return A&&A.get("isAdmin")},isAlarmOperator:function(){if(!A)return null;var t=A.get("allowedActions");return this.allowed("alerts")&&0===i.difference(i.difference(t,["reports.LOSTFIX","reports.RUNMINI"]),["alerts","control.followed","control","alerts.closeall","objects.arm","objects.disarm","objects.status.edit","objects.clearfaults","users.edit.himself"]).length},isDemo:function(){return A&&A.isDemo()},userHasRole:function(t){return A&&A.has("roles")&&i.findWhere(A.get("roles"),{code:t})},getTexts:function(){return c},getMapsModule:function(){return this.modules.maps},setActiveModule:function(t){if("string"==typeof t)var t=this.modules[t];else var t=t;return!t||this._activeModule&&t.id==this._activeModule.id?!1:(this._activeModule&&this._activeModule.deactivate(),t.activate(),("mobile"==t.id||"stat"==t.id)&&this.set("objType",t.id),this._activeModule=t,void 0)},getActiveModule:function(){return this._activeModule},getFoundAddressActions:function(){return this.hasModule("mobile")?this.modules.mobile.getFoundAddressActions():[]},getSpeedLimits:function(){return T.get("tracks.speedLimits")||this.modules.mobile&&this.modules.mobile.getUserData("speedLimits")||[60,90]},setProcessor:function(t){this._processor&&(this.stopListening(this._processor),this._processor.trigger("cancel")),this._processor=t,this._processor.render(),this.trigger("blockmap");var e=this.getView(),i=e.getPageWidth(),n=e.getLeftPaneWidth(),s=this._processor.$el,o=s.width(),r=30;i>=n+o+r?s.css("left",n+r):s.css("left",i-o-r)},closeProcessor:function(){this._processor&&(this._processor.remove(),this._processor=null,this.trigger("unblockmap"))},getReportExtraFields:function(t,e,i){return this.modules.reports.getReportExtraFields(t,e,i)},reportDatesRangeNeeded:function(t){return this.modules.reports.datesRangeNeeded(t)},reportDateNeeded:function(t){return this.modules.reports.dateNeeded(t)},loading:function(t,e){return x||(x=new f),t in x?x[t](e||{}):void 0},buildObjTitle:function(t,e){var n=t.has?t.attributes:t;if(!("objType"in n))return t.name||"";e="undefined"==typeof e?" ":e;var s=(this.getUserData("objectsTitle")||{})[n.objType]||["name"],o="";return s.length?i.each(s,function(t){o+="undefined"!=typeof n[t]&&null!==n[t]?(o?e:"")+n[t]:""}):o=n.name,o},getDevicesData:function(e){return t.ajax({url:App.getBaseUrl()+"objects/obj/",data:{objectId:e,tz:App.getUserTimezone()}})},getDevice:function(t){var e,n=this.modules;return i.each(["mobile","stat"],function(i){!e&&n[i]&&n[i].modules.tree&&(e=n[i].modules.tree.items.get(t)||null)}),e},getAllDevicesGroups:function(t){var e=this.modules[t==App.TYPE_STAT?"stat":"mobile"]||null;return e?e.modules.tree.groups:null},getDevicesGroup:function(t){var e,n=this.modules;return i.each(["mobile","stat"],function(i){!e&&n[i]&&n[i].modules.tree&&(e=n[i].modules.tree.groups.get(t)||null)}),e},getAllDevices:function(e,i){var n=new t.Deferred,s=this.modules[e==App.TYPE_STAT?"stat":"mobile"]||null;if(!s||!s.modules.tree)return n.reject("No module");var o=s.modules.tree;return i?o.loadTree().done(function(){n.resolve(o.items)}):n.resolve(o.items),n},getTechnicians:function(){return t.ajax({url:this.getBaseUrl()+"staff/list/",data:{positionCode:this.POSITION_CODE_TECH}})}}),I={bindEvents:function(){var e=this;if(y){var i=y.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(i,function(){e.set("visible",!document[y])})}this.on("logout",function(){showCursor(),t.ajax({url:this.getBaseUrl()+"users/logout/"}).always(function(t){hideCursor(),200!=t.status&&console&&console.log("Error: Logout on server failed"),I.logout.call(e)})}),this.subscribe("authsuccess",function(t){e.getStorage().rootSet("user",t)}),this.subscribe("localechange",function(t){d("locale",t,180),window.location.reload()}),this.subscribe("system.account.ready",function(t){T.setAccountKey(o.Base64.encode(t.getUserId())),A=t.getAccount(),I.loadServerFeatures.call(e).always(function(){I.onAccountReady.call(e)})}),this.on("appready",function(){I.initBoundsWatching.call(e),T.rootGet("openWizard")&&(T.rootRemove("openWizard"),e.trigger("devicecreate",{objType:e.TYPE_MOBILE}))}).on("serverlost",function(){e.serverUp&&!e.serverWait&&I.onConnectionLost.call(e)}).on("change:objType",function(t,i){e.setUserData("objType",i)}).on("change:ivSessions",function(t,e){T.rootSet("ivSessions",e)})},loadServerFeatures:function(){var e=this,i={reports:!1,guards:!1},n=new t.Deferred;return t.when(t.ajax({url:this.getBaseUrl()+"reports/",data:{}}).done(function(t){I.setAvailableReports.call(e,t)}).fail(function(){e.set("availableReports",{})}).always(function(){i.reports=!0,i.guards&&n.resolve()}),this.allowed("alerts")&&this.hasGuards()?t.ajax({url:this.getResourceBaseUrl("guards")+"guards/ping/",data:{}}).done(function(){e.set("guardsAvailable",!0)}).fail(function(){e.set("guardsAvailable",!1)}).always(function(){i.guards=!0,i.reports&&n.resolve()}):function(){e.set("guardsAvailable",!1),i.guards=!0,i.reports&&n.resolve()}()).always(function(){}),n},onAccountReady:function(){var t=this,e=T.rootGet("ivSessions");e&&t.set("ivSessions",e,{silent:!0});var t=this,n=[];if(t._hasModules=n,t.isAlarmOperator())n.push("alarms");else{t.hasMobile()&&n.push("mobile"),t.hasStationary()&&n.push("stat"),n.length||(n=["mobile","stat"]),this.get("guardsAvailable")&&n.push("guards"),(t.isDemo()||t.allowed("zones.create")||t.allowed("zones.edit")||t.allowed("zones.delete"))&&n.push("geozones"),(t.reportsAllowed("mobile")||t.reportsAllowed("stat"))&&n.push("reports"),t.hasMobile()&&n.push("tracks"),(t.isDemo()||t.allowed("poi.create")||t.allowed("poi.edit")||t.allowed("poi.delete"))&&n.push("poi"),n.push("alarms"),t.allowed("objects.create")&&t.on("devicecreate",i.bind(I.openDeviceWizard,t)),t.on("needdevicevideo",i.bind(I.openDeviceVideo,t)),t.allowed("objects.shell")&&n.push("setup");var s=t.getUserData("startWithDashboard");i.isBoolean(s)&&t.set("startWithDashboard",s),t.set("showAlertsLog",t.getUserData("showAlertsLog")===!0),t.on("change:startWithDashboard",function(e,i){t.setUserData("startWithDashboard",i)}).on("change:showAlertsLog",function(e,i){t.setUserData("showAlertsLog",i),i&&!t.modules.log?I.openAlertsLog.call(t):!i&&t.modules.log&&t.modules.log.destroy()});var o=t.getUserData("objType")||"mobile";t.hasModule(o)||(o="mobile"==o?"stat":"mobile"),t.set("objType",o)}t._hasModules=n,t._view.render(),I.addRoutes.call(t),I.buildModules.call(t),t.listenTo(A,"change:basic",function(t,e){var i=T.rootGet("user");i.basic=e,T.rootSet("user",i)}),I.setPingTimeout.call(t),(t.hasModule("reports")||t.hasModule("tracks"))&&(t.on("processorsubmit",function(e,i,n){t.once("buildstartsuccess",function(){t.closeProcessor()}),"tracks"==e?t.trigger("buildtrack",i.items||i.item&&[i.item],n):"reports"==e&&t.publish("needreport",i.objType,i.items||i.item&&[i.item],n)}).on("processorcancel",function(){t.closeProcessor()}),t.hasModule("tracks")&&t.on("needtrack",function(){I.onTrackRequested.apply(t,arguments)}),t.hasModule("reports")&&(t.on("needreport",function(){I.onReportRequested.apply(t,arguments)}),t.subscribe("reports.hiddenreportschange",function(){t._processor&&t._processor.setReportsList(t.modules.reports.getUserReportsTypes())}),t.on("view:report",function(){t.getView().trigger("needleftwide",!0)}),t.subscribe("reports.viewlist",function(){t.getView().trigger("needleftwide",!1)}),t.subscribe("reports.ready",function(){t.on("tracksoptionchange",function(e,i){var n=t.modules.reports,s=n.get("options")||{};s.tracksSettings=s.tracksSettings||{},s.tracksSettings[e]=i,n.set("options",s),n.trigger("change:options",n,s)})})),t.subscribe("reports.needgeoinfo",function(e,i){t.modules.maps&&t.modules.maps.trigger("needgeoinfo",e,i)}))},addRoutes:function(){var t=this;this.routes={},i.each(["mobile","stat","guards","geozones","poi","tracks","reports"],function(e){!function(e){var i={callback:function(){t.setActiveModule(e),t._view.trigger("needleftwide",!1)},context:t};t.routes[e]=i}(e)}),C.addRoutes(this.routes)},buildModules:function(){var t=this;if(this.isAlarmOperator()){var e=i.map(t._hasModules,function(t){return m[t]});return requirejs(e,function(){var e=0;i.each(arguments,function(i){I.buildModule.call(t,t._hasModules[e++],i)}),t.trigger("appready")}),void 0}var n=[{key:"address",name:c.address.ucFirst()},{key:"objects",name:c.objects.ucFirst()}];this.allowed("alerts")&&n.push({key:"guards",name:c.rrTeamShort});var s;requirejs(["maps/MapsModule"],function(e){s=t.modules.maps=new e({id:"maps",container:t._view.getMapsContainer(),parent:t,compass:!0,ruler:!0,search:!0,searchTypes:n,routing:!0,traffic:!0,coords:!0,scale:!0,minimap:!1,print:!0,autozoom:!0,clearControl:!0})}),requirejs(["dashboard/DashboardModule"],function(e){var i=t.modules.dashboard=new e({id:"dashboard",parent:t,active:t.get("startWithDashboard"),loading:!0,mobile:!0});t.listenTo(i,"change:active",function(e,i){t.modules.mobile&&(i?t.modules.mobile.trigger("stopwatching"):t.modules.mobile.trigger("startwatching"))})}),App.subscribe("maps.ready",{context:t,callback:function(){var e=t._hasModules;if(!e.length)return t.interceptCurrentRoute(),void 0;var n=i.map(e,function(t){return m[t]});requirejs(n,function(){var n=0;if(i.each(arguments,function(i){I.buildModule.call(t,e[n++],i)}),t.interceptCurrentRoute(),!t.getActiveModule()){var s=t.get("objType");t.modules[s]?t.setActiveModule(s):t.subscribe(s+".ready",function(){t.setActiveModule(s)})}t.trigger("appready")})}}),this.get("showAlertsLog")&&I.openAlertsLog.call(this)},buildModule:function(t,e){this.modules[t]=new e({id:t,container:"alarms"!=t&&"setup"!=t?this._view.getLeftPane():null,placeholder:this.getPlaceholder(t),parent:this,options:I.getModuleOptions.call(this,t)})},getModuleOptions:function(t){var e={showPoints:T.get("tracks.showPoints")||0,colorTracks:T.get("tracks.colorTracks")||0,speedColors:T.get("tracks.speedColors")||["#0000ff","#00ff00","#ff0000"]};return"mobile"==t||"stat"==t||"guards"==t?{mapsModule:this.modules.maps}:"geozones"==t?{buildByPolyline:this.hasModule("tracks")}:"tracks"==t?i.extend({},e,{mapsModule:this.modules.maps,list:!0,addFromList:!0}):"reports"==t?{mapsModule:this.modules.maps,addFromList:!0,scheduler:!this.isDemo(),tracksSettings:e}:null},setPingTimeout:function(){var t=this;this._pingTmt=setTimeout(function(){I.pingServer.call(t)},g)},pingServer:function(){var t=this;this.modules.system.ping().done(function(){t._reconnectMsgShown&&(n.dialog.stack=[],n.dialog.close(),t._reconnectMsgShown=!1,t.trigger("serverup")),t._pingTmt&&clearTimeout(t._pingTmt),t._reconnectTries=0,t.serverUp=!0,t.serverWait&&(t.trigger("startall"),t.serverWait=!1),I.setPingTimeout.call(t)}).fail(function(){I.onConnectionLost.call(t)})},onConnectionLost:function(){var t=this;return this.serverUp&&(this.trigger("stopall"),this.serverUp=!1,this.serverWait=!0),++t._reconnectTries>_?(I.onReconnectFail.call(t),void 0):(t._pingTmt&&clearTimeout(t._pingTmt),t._pingTmt=setTimeout(function(){I.pingServer.call(t)},v),void 0)},onReconnectFail:function(){var t=this;return this._reconnectMsgShown?(this._pingTmt=setTimeout(function(){I.pingServer.call(t)},g),void 0):(this._reconnectMsgShown=!0,n.dialog.close(),n.dialog.stack=[],alert('<i class="svg-icon svg-icon-spinner icon-spin"></i> '+c.msgReconnecting,c.msgConnectionLost,{addClass:"no-controls",okCallback:function(){t._reconnectMsgShown=!1,t.trigger("logout")},btnNames:{ok:c.exitFromSystem}}),this._pingTmt=setTimeout(function(){I.pingServer.call(t)},g),void 0)},setAvailableReports:function(t){var e={run:{name:c.reportsNames.run,objType:"mobile"},runshort:{name:c.reportsNames.runShort,action:"RUN",objType:"mobile"},movepark:{name:c.reportsNames.movepark,objType:"mobile"},speeding:{name:c.reportsNames.speeding,objType:"mobile"},acceleration:{name:c.reportsNames.acceleration,objType:"mobile"},objst:{name:c.reportsNames.objst,objType:"mobilestat"},device:{name:c.reportsNames.device,objType:"mobile"},flow:{name:c.reportsNames.flow,objType:"mobile"},fuel:{name:c.reportsNames.fuel,objType:"mobile"},fuel2:{name:c.reportsNames.fuel2,objType:"mobile"},device2:{name:c.reportsNames.device2,action:"DEVICERUN",objType:"mobile"},can:{name:c.reportsNames.can,action:"CANDEVICERUN",objType:"mobile"},discretes:{name:c.reportsNames.discretes,action:"DISCRETEPARAMETERS",objType:"mobile"},pass:{name:c.reportsNames.pass,objType:"mobile"},alertssummary:{name:c.reportsNames.alertssummary,action:"ALERTS",objType:"mobilestat"},alerts:{name:c.reportsNames.alerts,objType:"mobilestat",singleObject:!0},temperature:{name:c.reportsNames.temperature,action:["OUTTEMP","COOLTEMP","DEVTEMP"],objType:"mobile"},voltage:{name:c.reportsNames.voltage,action:["CARPOWER","ACC"],objType:"mobile"},engspeed:{name:c.reportsNames.engspeed,objType:"mobile"},distance:{name:c.reportsNames.distance,action:"DISTANCETOOBJECT",objType:"mobile"},guardscallcount:{name:c.reportsNames.guardscallcount,action:"GUARDSCALLCOUNT",objType:"mobilestat"}};e.zoneviz={name:c.reportsNames.zoneviz,objType:"mobile"},e.zoneex={name:c.reportsNames.zoneex,objType:"mobile"},e.zonevizcount={name:c.reportsNames.zonevizcount,objType:"mobile"};var n=i.indexBy(t),s={};this.set("reportsInBuild",n),i.each(e,function(t,e){var o=!0,r=t.action||e.toUpperCase();if("string"==typeof r)o=r in n;else{var a=i.filter(r,function(t){return t in n});t.action=a,o=a.length>0}o&&(s[e]=t)}),this.set("availableReports",s)},mergeBounds:function(t,e){if(!t||!t[0][0])return e&&e[0][0]?e:null;if(!e||!e[0][0])return t;var i=Math.min(t[0][0],e[0][0]),n=Math.min(t[0][1],e[0][1]),s=Math.max(t[1][0],e[1][0]),o=Math.max(t[1][1],e[1][1]);return[[i,o],[s,n]]},initBoundsWatching:function(){var t=this,e={};i.each(["stat","mobile"],function(i){t.hasModule(i)&&(e[i]=!1,function(i){t.listenTo(t.modules[i],"change:bounds",function(n,s,o){var r="mobile"==i?"stat":"mobile";if(e[i]=s,"undefined"==typeof e[r]||e[r]!==!1){var a=I.mergeBounds(s,e[r]);t.set("commonBounds",a),o&&o.zoom&&t.modules.maps.setBounds(a,{maxZoom:t.get("commonBoundsMaxZoom"),padding:t.get("commonBoundsPadding")})}})}(i))})},logout:function(){T.rootRemove("user"),p(this.getRMCookieName()),window.location.href=this.getRouter().getFullOrigin()},_publishOnce:function(t,e,i){e.callback.apply(e.context||this,i)},_publishAll:function(t){for(var e,i=Array.prototype.slice.call(arguments,1),n=[],s=(M[t]||[]).slice(0),o=0,r=s.length;r>o;o++)e=s[o],e&&n.push(e.callback.apply(e.context||this,i));return n},openDeviceWizard:function(t){if(!S){var e=this;requirejs(["_common/wizards/ObjAddWizard"],function(n){S=new n(i.extend({id:"objAddWizard"},t||{})),e.listenToOnce(S,"objectadded",function(t){var i="",n=null;if(t.objType==e.TYPE_MOBILE?e.hasModule("mobile")?n=e.modules.mobile:i="mobile":e.hasModule("stat")?n=e.modules.stat:i="stationary",i){var s=T.rootGet("user");s["has"+i.ucFirst()]=!0,T.rootSet("user",s),window.location.href=e.getRouter().getFullOrigin()}else n.trigger("itemadded",t)}).listenToOnce(S,"destroy",function(t){var i=S.pick("addAndSetup","addToAccount","objType","email");S=null,t&&I.openDeviceWizard.call(e,i)})})}},openDeviceVideo:function(t){if(!this.modules.deviceVideo){var e=this;requirejs(["_common/deviceVideo/DeviceVideoController"],function(i){var n=e.modules.deviceVideo=new i({id:"deviceVideo",device:t.clone()});e.listenToOnce(n,"destroy",function(){e.modules.deviceVideo=null})})}},openAlertsLog:function(){if(!this.modules.log){var t=this;requirejs(["_common/log/LogController"],function(e){var i=t.modules.log=new e({id:"log"});t.listenToOnce(i,"destroy",function(){t.modules.log=null})})}},onReportRequested:function(t){if(this.modules.reports&&(t||(t=this.get("objType")),this.modules[t])){var e,n;if(1==arguments.length?(e=null,n=null):2==arguments.length?i.isArray(arguments[1])?(e=arguments[1],n=null):(e=null,n=arguments[1]):(e=arguments[1],n=arguments[2]),this._processor||this.getActiveModule()==this.modules.reports||C.go("#reports"),e&&n||n&&n.objectId)return this.publish("needreport",t,e,n),void 0;var s=this.modules.reports,o=s.getUserReportsTypes(),r={},a=!0;if(i.keys(o).length){if(!e){this.reportsAllowed("mobile")&&this.reportsAllowed("stat")&&(a=!1),this.reportsAllowed(t)||(t="mobile"==t?"stat":"mobile");var l=this.modules[t];if(e=l.getWatchedObjects(),!e||!e.length)return this.trigger("unblockmap"),alert(c["stat"==t?"noWatchedStationaryMsg":"noWatchedVehiclesMsg"])}var u=s.getUserData("choosedType")||!1,d=s.getHiddenReports();-1!=i.indexOf(d,u)&&(u=!1),e.length>1?i.each(o,function(t,e){t.singleObject||(r[e]=t)}):r=o,n={model:this,report:!0,reportTypes:r,choosedType:u,objType:t,objectsDefined:a,adding:!1,items:e},this._processor&&this._processor.close(),this.setProcessor(new h(n))}}},onTrackRequested:function(){if(this.modules.tracks){this._processor||this.getActiveModule()==this.modules.tracks||C.go("#tracks");var t,e;if(arguments.length?1==arguments.length?i.isArray(arguments[0])?(t=arguments[0],e=null):(t=null,e=arguments[0]):(t=arguments[0],e=arguments[1]):(t=null,e=null),t&&e||e&&e.objectId)return t&&t.length>10||e&&e.objectId&&e.objectId.length>10?alert(c.tooManyObjectsForTracks.replace("#max#",10),c.attention+"!"):(this.trigger("buildtrack",t,e),void 0);if(!t){var n=(this.get("objType"),this.modules.mobile);if(t=n.getWatchedObjects(),!t||!t.length)return this.trigger("unblockmap"),alert(c.noWatchedObjectsMsg)}if(t.length>10)return alert(c.tooManyObjectsForTracks.replace("#max#",10),c.attention+"!");e={model:this,track:!0,adding:!1,items:t,objType:"mobile",objectsDefined:!0},this._processor&&this._processor.close(),this.setProcessor(new h(e))}},searchObjects:function(e,i){var n=this,s=t.Deferred();return i&&i.id?(s.resolve([i]),s):(t.ajax({url:this.getBaseUrl()+"objects/obj-search/",timeout:5e3,data:{q:""+e.q,limit:parseInt(e.limit)},success:function(t){try{s.resolve(I.parseObjectsSearchJSON.call(n,t,e))}catch(i){s.reject({msg:i})}},error:function(t,e,i){s.reject({msg:e+": "+i})}}),s)},parseObjectsSearchJSON:function(t,e){if(!e.mapSearch)return t;for(var i=[],n=0,s=t.length;s>n;++n)t[n].lat&&t[n].lon&&i.push(t[n]);return i},suggestObjects:function(){var e=this,i=t.Deferred(),n=I.searchObjects.apply(this,arguments);return n.done(function(t){try{var n=I.parseObjectsSuggestJSON.call(e,t);i.resolve(n)}catch(s){i.reject({msg:s})}}).fail(function(){i.reject.apply(i,arguments)}),i},parseObjectsSuggestJSON:function(e){return t.map(e,function(t){var e="#"+t.extId+" "+t.name;return{label:e,value:t.name,original:t}})}};return f.defaults={textVisible:!0,textOnly:!1,html:"<div class='loader'><span class='indicator icon-spin svg-icon svg-icon-spinner'></span><strong>"+c.pleaseWait+"</strong>"+"</div>",text:""},i.extend(f.prototype,{_createHtml:function(){this._el=t(f.defaults.html).appendTo("#page")},show:function(e){var i=t.extend({},f.defaults,e||{});++this._showCalls,this._el?this._el.removeClass("hidden"):this._createHtml(),i.textVisible?i.textOnly&&this._el.addClass("text-only"):this._el.find("strong").remove(),i.text&&this.element.find("strong").text(i.text),t("#page").addClass("overlay")},hide:function(){--this._showCalls<=0&&(this._el&&this._el.addClass("hidden"),t("#page").removeClass("overlay"),this._showCalls<0&&(this._showCalls=0))}}),P}),define("system/nls/system",{root:{pleaseCheckFile:"Please check if the #filename# file is in the config folder",canNotLoadServerSettings:"Failed to establish a connection. Please try again later.",pleaseSetHost:'Please fill in the "host" setting in',about:"About the system",version:"Version",thanksForUsing:"Thank you for choosing the GeoRITM system!",resetPassword:"Password recovery",resetPasswordCmd:"Recover",resetPasswordHelpText:"You can restore your password yourself if your email was used as a login. Otherwise contact the person who provided you the login and the password for the system.",resetPasswordSuccessText:"An email with the data for password restore was sent to your email address.",passForEnter:"Login password",repeatPassForEnter:"Repeat password",changePassword:"Change password",oldPassword:"Old password",newPassword:"New password",repeatNewPassword:"Repeat new password",errPass:"Enter password",errNewPass:"Enter new password",errPassLength:"Maximum password length is #max# characters",errPassCyr:"The password can not contain cyrillic letters",pleaseFillAllFields:"Please fill in all fields",oldPasswordIsWrong:"Invalid old password",errPassRepeat:"Please repeat the password correctly",pleaseRepeatCorrectly:"Please repeat new password",passChangeFailed:"Failed to change the password (server error)",adminConsole:"Administration",tipsOfTheDay:"Insight into the system"},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("system/nls/ru-ru/system",{pleaseCheckFile:"Пожалуйста, проверьте наличие файла #filename# в папке config",canNotLoadServerSettings:"Не удалось установить соединение. Пожалуйста повторите попытку позже.",pleaseSetHost:'Пожалуйста, заполните настройку "host" в',about:"О системе",version:"Версия",thanksForUsing:"Благодарим Вас за использование системы GeoRITM.",resetPassword:"Восстановление пароля",resetPasswordCmd:"Восстановить",resetPasswordHelpText:"Восстановить пароль самостоятельно можно, если в качестве логина Вы используете свой e-mail. Если это не так, обратитесь за помощью к тому, кто выдал Вам логин и пароль для доступа к системе.",resetPasswordSuccessText:"На&nbsp;Ваш&nbsp;адрес электронной&nbsp;почты отправлено&nbsp;письмо с&nbsp;данными для&nbsp;восстановления пароля.",passForEnter:"Пароль для входа",repeatPassForEnter:"Повторите пароль",changePassword:"Сменить пароль",oldPassword:"Старый пароль",newPassword:"Новый пароль",repeatNewPassword:"Повторите новый пароль",errPass:"Введите пароль",errNewPass:"Введите новый пароль",errPassLength:"Максимальная длина пароля - #max# символов",errPassCyr:"Пароль не может содержать кириллицу",pleaseFillAllFields:"Пожалуйста, заполните все поля",oldPasswordIsWrong:"Старый пароль введен неверно",errPassRepeat:"Повторите пароль правильно",pleaseRepeatCorrectly:"Пожалуйста, повторите новый пароль правильно",passChangeFailed:"Сменить пароль не удалось (ошибка сервера)",adminConsole:"Администрирование",tipsOfTheDay:"Знакомство с системой"}),define("system/SystemModule",["underscore","jquery","jface","abstracts/Module","i18n!_common/nls/common","i18n!system/nls/system"],function(t,e,i,n,s,o){var r="server.json",a="skin.json",l="version.json",h={server:null,ui:null},c=null,u="",d=n.extend({constructor:function(){this._settingsView=null,n.apply(this,arguments)},initialize:function(){var i=this;this._i18n=e.extend({},s,o),p.loadServerSettings().done(function(e){var n=e;App.setBaseUrl(App.buildBaseUrl(e)),App.loading("show"),p.loadUIVersion.call(i).done(function(t){h.ui=t}),p.validateServer.call(i,e).done(function(e){u=e.version,h.server=n,App.serverUp=!0,p.loadServerSkin().done(function(e){t.extend(h.server,e),p.onSkinResolve.call(i)}).fail(function(){p.onSkinResolve.call(i)})}).fail(function(t){alert(t,i._i18n.error.ucFirst(),{addClass:"no-controls",okCallback:function(){i.initialize()}})}).always(function(){App.loading("hide")})}).fail(function(){alert(i._i18n.canNotLoadServerSettings,i._i18n.error.ucFirst())})},ping:function(t){return t||h.server?(t=t||h.server,e.ajax({method:"post",timeout:5e3,url:(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.connector?"/"+t.connector:"")+"/ping/"})):(new e.Deferred).reject("No server settings")
},showSettings:function(){if(!this._settingsView){var t=this;return requirejs(["system/views/SettingsView"],function(e){t._settingsView=new e({model:t}),t._settingsView.show()}),void 0}this._settingsView.show()},hideSettings:function(){this._settingsView&&this._settingsView.hide()},flushSettings:function(){App.getStorage().flush(),window.location.href=App.getRouter().getFullOrigin()},getVersion:function(){return u},getSettingsView:function(){return this._settingsView},getServerSettings:function(){return h.server},getUISettings:function(){return h.ui},getTexts:function(){return this._i18n}}),p={loadServerSettings:function(){return e.ajax({url:"./config/"+r,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},validateServer:function(t){var i=new e.Deferred;if(!t.host)return i.reject(this._i18n.pleaseSetHost+" config/"+r),i;var n=this;return this.ping(t).done(function(t){i.resolve(t)}).fail(function(t,e){switch(e){case"timeout":i.reject(n._i18n.errors.serverConnectionTimeout);break;default:i.reject(n._i18n.errors.serverConnection)}}),i},loadServerSkin:function(){return e.ajax({url:"./config/"+a,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},onSkinResolve:function(){var t=this,e=h.server,i=["system/auth/AuthModule"];e.skinUrl&&i.push("css!"+e.skinUrl),App.subscribe("authsuccess",function(e,i){!i||i.login!=e.extId&&i.login!=e.username||(e.isDemo=1),p.start.call(t,e)}),requirejs(i,function(e){e.set("parent",t)}),t.publish("ready")},loadUIVersion:function(){return e.ajax({url:"./"+l,method:"GET",type:"GET",cache:!1,crossDomain:!1,processData:!0})},start:function(t){var i=this;c=t,e.ajaxSetup({statusCode:{401:function(){App.trigger("logout")}},beforeSend:function(t,e){"undefined"!=typeof e.data&&null!==e.data&&(e.data=JSON.stringify(e.data)),"GET"==e.type&&(e.type="POST"),t.setRequestHeader("Accept-Language",LOCALE),t.setRequestHeader("Authorization","Basic "+c.basic)}}),requirejs(["system/account/AccountModule","system/demo/DemoModule"],function(t,e){i.modules.account=new t({id:"system/account",parent:i,user:c,isDemo:c.isDemo||!1}),i.listenTo(i.modules.account.getAccount(),"change:basic",function(t,e){p.setBasic(e)}),new e({id:"system/demo",parent:i,isDemo:c.isDemo||!1})})},setBasic:function(t){c.basic=t}};return d}),define("system/auth/nls/ua",{root:{ua:'<p>Terms and conditions of free use of the service geo.ritm.ru</p><ol><li>General Provisions<ol><li>Free registration for the service geo.ritm.ru (hereinafter as the "Service") allows to connect and monitor three mobile facilities equipped with the monitoring system Voyager by one User.</li><li>In order to use the Service or some functions of the Service a User has to accept this Agreement.</li></ol></li><li>Registration<ol><li>To register a User agrees to provide accurate and complete information about itself as prompted in the registration form.</li><li>The Service reserves the right  to require at any time the User confirms the information specified during registration (in particular e-mail and telephone number), failure to provide of which, at the discretion of the Service, can be deemed as the provision of false information and can lead to the account lockout or user data deletion.</li><li>The User does not a right to reproduce, repeat, copy, sell and resell, as well as can not use any parts of the Service (including content available to the User through the Service) or access to it for any commercial purposes. </li></ol></li><li>User Data<ol><li>The Service collects two types of the User data<ol><li>Information voluntarily provided to the Service Administration by the User for registration, connecting and object configuring.</li><li>Technical information from the mobile facility automatically collecting by the software regarding its location and status of the connected equipment.</li></ol></li><li>The User is solely responsible for the accuracy of data entered by him in the process of the Service using, as well as for the conformity of input data to the requirements of the current legislation including third party liability in cases where the User enters data that do not have direct relation to it (for example, data of third parties) or violates the rights and legitimate interests of third parties.</li><li>The User acknowledges and agrees that the Service is not obliged to check data the User inputs in terms of their correctness.</li><li>The User acknowledges and agrees that the Service uses data the User inputs for the preparation of reports requested by the User and informing the User.</li><li>The User acknowledges and agrees that the Service may save and use impersonal technical information gathered as a result of facility operation for research in order to improve the quality of the Service and the provision of additional services.</li></ol></li><li>Terms and conditions of the Service use<ol><li>The Service reserves the right to limit the retention period for the User data, to limit access to functions, reports and other features of the Service.</li><li>The User is solely responsible to third parties for its actions related to the use of the Service including if such actions would lead to a violation of the rights and legitimate interests of third parties, as well as for compliance with the law when using the Service.</li><li>When using the Service the User is not entitled to:<ol><li>To impersonate another person or entity and / or community representative without sufficient rights;</li><li>To collect and store personal data of other persons without proper authorization;</li><li>To disrupt the normal operation of the Service;</li><li>To promote actions aimed at violation of the restrictions and prohibitions imposed by the Agreement;</li><li>To break the rules of law including rules of international law in another way. </li></ol></li></ol></li><li>Exclusive rights to the content of the services and content<ol><li>All items available when using the Service including elements of design, text, graphics, databases, finished documents in  XLS, XLSX, DOC, DOCX, PDF formats and other facilities, as well as any content posted on the Service are subject of the exclusive rights of the Service and other rights holders.</li><li>Use of the Service, as well as any other elements of the Service is possible within the framework of functional Service only. No elements of the Service content and any content posted to the services can not be used in other way without the prior authorization.  The exception is cases expressly provided for by the legislation of the Russian Federation or the Terms and Conditions of the Service Use.</li><li>Use of the elements of the Service content and any content by the User for personal non-commercial use is allowed at the retain of all copyright notices, related rights, trademarks and other notices of authorship, save the name (or nickname) of the author / the name of the right holder intact, saving corresponding facility unchanged.</li></ol></li><li>Limitation of responsibility<ol><li>The User uses the Service at its own risk. The Service is provided "as is". The Service does not accept any liability including for its compliance with the User\'s objectives.</li><li>The Service does not guarantee that it conforms / will conform to the User\'s requirements, will be provided in uninterrupted, timely, secure or error-free manner.</li><li>Any information and / or materials (including downloadable documents, letters, any instructions and guidelines to action, etc.) access to which is allowed to the User by means of the Service can be used by the User at its own risk and the User is responsible for the possible consequences of use of these information and / or materials including the damage it may cause to the User or third parties, for loss of data, time, money or any other harm.</li><li>The Service is not responsible for any kind of loss resulting from the use of the Service or its parts / functions by the User .</li></ol></li><li>Other Provisions<ol><li>Considering the gratuitousness of services provided under this Agreement the rules on consumer protection provided by the legislation of the Russian Federation may not be applicable to the relations between the User and the Service.</li><li>If for whatever reason one or more provisions of this Agreement shall be declared invalid or void, this does not affect the validity or enforceability of the remaining provisions of the Agreement.</li><li>The Service administration reserves the right to change the above rules without previous notice.</li><li>The Rules come into force automatically after the User\'s registration into the system.</li></ol></li></ol>'},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("system/auth/nls/ru-ru/ua",{ua:"<p>Условия бесплатного использования сервиса geo.ritm.ru</p><ol><li>Общие положения<ol><li>Бесплатная регистрация на сервисе geo.ritm.ru (далее Сервис) дает возможность подключения и мониторинга одним Пользователем трех мобильных объектов, оборудованных системой мониторинга Voyager.</li><li>Для того чтобы воспользоваться Сервисом или некоторыми отдельными функциями Сервиса, Пользователю необходимо принять данное Соглашение.</li></ol></li><li>Регистрация<ol><li>Для регистрации Пользователь обязуется предоставить достоверную и полную информацию о себе по вопросам, предлагаемым в форме регистрации.</li><li>Сервис оставляет за собой право в любой момент потребовать от Пользователя подтверждения данных, указанных при регистрации (в частности адрес электронной почты и номер телефона), не предоставление которых, по усмотрению сервиса, может быть приравнено к предоставлению недостоверной информации и повлечь блокирование учетной записи или удаление данных пользователя.</li><li>Пользователь не вправе воспроизводить, повторять и копировать, продавать и перепродавать, а также использовать для каких-либо коммерческих целей какие-либо части Сервиса (включая контент, доступный Пользователю посредством Сервиса), или доступ к нему. </li></ol></li><li>Данные Пользователя<ol><li>Сервис собирает два типа данных Пользователя<ol><li>Информацию, которую Пользователь сознательно предоставил Администрации Сервиса при регистрации, подключении и настройке объекта.</li><li>Техническую информацию от мобильного объекта, собираемую программным обеспечением в автоматическом режиме о его местоположении и состоянии подключенного оборудования.</li></ol></li><li>Пользователь самостоятельно несет ответственность за корректность данных, вводимых им в процесс использования Сервиса, а также за соответствие вводимых данных требованиям действующего законодательства, включая ответственность перед третьим лицами в случаях, когда Пользователь вводит данные, не имеющие к нему прямого отношения (например, данные третьих лиц), или нарушает права и законные интересы третьих лиц.</li><li>Пользователь признает и соглашается с тем, что Сервис не обязан проверять вводимые Пользователем данные на предмет их корректности.</li><li>Пользователь осознает и соглашается с тем, что Сервис использует вводимые Пользователем данные для подготовки запрошенных Пользователем отчетов и оповещения Пользователя.</li><li>Пользователь осознает и соглашается с тем, что Сервис может сохранять и использовать обезличенную техническую информацию, полученную в результате работы объекта для исследований в целях улучшения качества Сервиса и предоставления дополнительных услуг.</li></ol></li><li>Условия использования сервиса<ol><li>Сервис оставляет за собой право ограничивать срок хранения данных Пользователя, ограничивать доступ к функциям, отчетам и другим возможностям Сервиса.</li><li>Пользователь самостоятельно несет ответственность перед третьими лицами за свои действия, связанные с использованием Сервиса, в том числе, если такие действия приведут к нарушению прав и законных интересов третьих лиц, а также за соблюдение законодательства при использовании Сервиса.</li><li>При использовании сервиса Пользователь не вправе:<ol><li>Выдавать себя за другого человека или представителя организации и/или сообщества без достаточных на то прав;</li><li>Несанкционированно собирать и хранить персональные данные других лиц;</li><li>Нарушать нормальную работу Сервиса;</li><li>Содействовать действиям, направленным на нарушение ограничений и запретов, налагаемых Соглашением;</li><li>Другим образом нарушать нормы законодательства, в том числе нормы международного права. </li></ol></li></ol></li><li>Исключительные права на содержание сервисов и контент<ol><li>Все объекты, доступные при помощи Сервиса, в том числе элементы дизайна, текст, графические изображения, базы данных, готовые документы в форматах XLS, XLSX, DOC, DOCX, PDF и другие объекты, а также любой контент, размещенный в Сервисе, являются объектами исключительных прав Сервиса и других правообладателей.</li><li>Использование Сервиса, а также каких-либо иных элементов Сервиса возможно только в рамках функционала Сервиса. Никакие элементы содержания Сервиса, а также любой контент, размещенный на сервисах, не могут быть использованы иным образом без предварительного разрешения. Исключение составляют случаи, прямо предусмотренные законодательством РФ или условиями использования Сервиса.</li><li>Использование Пользователем элементов содержания Сервиса, а также любого контента для личного некоммерческого использования допускается при условии сохранения всех знаков охраны авторского права, смежных прав, товарных знаков, других уведомлений об авторстве, сохранения имени (или псевдонима) автора/наименования правообладателя в неизменном виде, сохранении соответствующего объекта в неизменном виде.</li></ol></li><li>Ограничение ответственности<ol><li>Пользователь использует сервис на свой собственный риск. Сервис предоставляется «как есть». Сервис не принимает на себя никакой ответственности, в том числе за соответствие Сервиса целям Пользователя.</li><li>Сервис не гарантирует, что он соответствует/будет соответствовать требованиям Пользователя, что Сервис будет предоставляться непрерывно, быстро, надежно и без ошибок.</li><li>Любые информацию и/или материалы (в том числе загружаемые документы, письма, какие-либо инструкции и руководства к действию и т.д.), доступ к которым Пользователь получает с использованием Сервиса, Пользователь может использовать на свой собственный страх и риск и самостоятельно несет ответственность за возможные последствия использования указанных информации и/или материалов, в том числе за ущерб, который это может причинить Пользователю или третьим лицам, за потерю данных, времени, денежных средств или любой другой вред.</li><li>Сервис не несет ответственности за любые виды убытков, произошедшие вследствие использования Пользователем Сервиса или отдельных частей/функций Сервиса.</li></ol></li><li>Иные положения<ol><li>Ввиду безвозмездности услуг, оказываемых в рамках настоящего Соглашения, нормы о защите прав потребителей, предусмотренные законодательством Российской Федерации, не могут быть применимы к отношениям между Пользователем и Сервисом.</li><li>Если по тем или иным причинам одно или несколько положений настоящего Соглашения будут признаны недействительными или не имеющими юридической силы, это не оказывает влияния на действительность или применимость остальных положений Соглашения.</li><li>Администрация сервиса оставляет за собой право вносить изменения в вышеуказанные правила без предварительного уведомления.</li><li>Правила вступают в силу автоматически после регистрации Пользователя в системе.</li></ol></li></ol>"}),define("system/auth/views/AuthView",["jquery","underscore","util","jface","bootstrap","abstracts/View","text!system/auth/tmpl/auth.html","text!_common/tmpl/lang.html","text!system/auth/tmpl/nav.html","text!system/auth/tmpl/autoreg.html","text!system/auth/tmpl/resetPassword.html","text!system/auth/tmpl/captcha.html","text!system/auth/tmpl/ua.html","text!system/auth/tmpl/regSuccess.html","i18n!../nls/ua","css!system/auth/css/login.css"],function(t,e,i,n,s,o,r,a,l,h,c,u,d,p,f){a=e.template(a),u=e.template(u);var m=!1,g=o.extend({constructor:function(){this._loginForm=null,this._regForm=null,this._resetPasswordLink=null,this._resetPasswordForm=null,this._captchaKey="",o.apply(this,arguments)},render:function(){var i=this.model.i18n(),n=this.model.getDemoData(),s=e.template(r,{i18n:i,demo:n}),o=App.getServerSettings();this.$el.addClass("login-box").html(s).appendTo("#page"),this.$el.find("input[name=login]").focus();var h=this,c=this._loginForm=this.$el.find(".login-form");("undefined"==typeof o.registration||1==o.registration)&&t.ajax({url:this.model.getCMBaseUrl()+"ping/"}).done(function(){m=!0,v.initRegistration.call(h),v.initResetPassword.call(h)}),c.on("submit",function(){var t=c.find("input[name=login]").val(),e=c.find("input[name=password]").val();return t&&e?(v.login.call(h,t,e),!1):alert(i.enterLoginAndPass,i.error.ucFirst(),{okCallback:function(){h._loginForm.find("input[name="+(t?"password":"login")+"]").focus()}})}),n&&t("#btn-demo-login").on("click",function(){return v.login.call(h,n.login,n.password),!1}),s=e.template(l,{langDropdown:a({compact:!1,curLang:App.getLocaleName(),locale:App.getLocale()}),dataHost:o.host,version:App.getVersion()}),t("#main-hdr .navbar-inner").append(s),t(document).on("click.locale","[data-locale]",function(){var e=t(this).data("locale");App.publish("localechange",e)})}}),v={login:function(e,i){var n=this,s=this.model.i18n();n.$el.addClass("loading"),n.model.authorize(e,i).done(function(e){if(e.id){n.$el.remove(),t("#lang-nav, #data-host").remove(),t(document).off("click.locale");var i=n.model.getDemoData(),o=n.$el.find("input[name=remember]").prop("checked");App.publish("authsuccess",e,i,o)}else alert("No user data in response",s.error.ucFirst())}).fail(function(e,i,n){if("timeout"==i)var o=s.error.ucFirst(),n=s.errors.serverConnectionTimeout;else{var o=e.status?e.status+": ":"";try{var r=t.parseJSON(e.responseText),n=r.msg;r.data&&r.data.logout&&App.trigger("logout"),o+=r.hdr}catch(a){var n=n||s.errors.callServerFailed;404==e.status&&(n=authUrl+"<br />"+n),o+=s.error.ucFirst()}}alert(n,o)}).always(function(){n.$el.removeClass("loading")})},initRegistration:function(){var t=this;this.$el.find(".reg-link").removeClass("hidden").on("click",function(){t._regForm||v.buildRegistration.call(t),t._loginForm.addClass("hidden"),t.$el.addClass("reg-box"),t._regForm.removeClass("hidden").find("input:first").focus()}),this.$el.on("click",".login-link",function(){t.$el.removeClass("reg-box"),t._regForm&&t._regForm.addClass("hidden"),t._resetPasswordForm&&t._resetPasswordForm.addClass("hidden"),t._loginForm.removeClass("hidden").find("input:first").focus()})},buildRegistration:function(){var i=this,s=this.model.i18n(),o=e.template(h,{i18n:s});this.$el.append(o);var r=this._regForm=this.$el.find(".reg-form"),a=r.find("[type=submit]");v.renderCaptcha.call(this,r),this.$el.on("click",".captcha-reload",function(){showCursor(),v.getCaptcha.call(i).done(function(t){i._captchaKey=t.key||"",i.$el.find("img")[0].src=t.img}).always(hideCursor)}).on("click",".ua-link",function(){n.confirm(f.ua,s.usersAgreement,{addClass:"ua-confirm",btnNames:{ok:s.accept,cancel:s.decline},okCallback:function(){i.$el.find("[name=acceptUA]").prop("checked",!0),a.prop("disabled",!1)},cancelCallback:function(){i.$el.find("[name=acceptUA]").prop("checked",!1),a.prop("disabled",!0)}})}).on("click","[name=acceptUA]",function(){a.prop("disabled",!this.checked)}),r.on("submit",function(){r.addClass("loading").find(".error").removeClass("error");var n=i.model.i18n(),s=r.serializeObject();return s["captcha-key"]=i._captchaKey,i.model.register(s).done(function(s){r.addClass("hidden")[0].reset(),i._loginForm.removeClass("hidden").find("input:first").focus(),i.$el.removeClass("reg-box").find(".reg-link").remove(),i.$el.after(e.template(p,{i18n:n,t:Date.format(n.DateTime.longFormat,s.confirmTill)})),t("#reg-success").on("click",".login-link",function(){t("#reg-success").remove()})}).fail(function(t){v.showErrors.call(i,t,r)}).always(function(){r.removeClass("loading")}),!1})},initResetPassword:function(){var t=this;this._resetPasswordLink=this.$el.find(".reset-link"),this._resetPasswordLink.removeClass("hidden").on("click",function(){t._resetPasswordForm||v.buildResetPassword.call(t),t.$el.addClass("reset-box"),t._resetPasswordForm.removeClass("hidden").find("input:first").focus(),t._loginForm.addClass("hidden"),t._regForm&&t._regForm.addClass("hidden")})},buildResetPassword:function(){var t=this,i=this.model.i18n(),n=e.template(c,{i18n:i});this.$el.append(n);var s=this._resetPasswordForm=this.$el.find(".reset-form"),o=s.find("input[name=email]"),r=s.find("button[type=submit]");o.on("keyup",function(){var e=t.model.validateEmail(this.value);null===e?r.prop("disabled",!1):r.prop("disabled",!0)}),s.on("submit",function(){s.addClass("loading").find(".error").removeClass("error");var e=t.model.i18n(),i=s.serializeObject();return t.model.startResetPassword(i).done(function(){s.addClass("hidden")[0].reset(),r.prop("disabled",!0),t._loginForm.removeClass("hidden").find("input:first").focus(),t.$el.removeClass("reset-box"),alert(e.resetPasswordSuccessText,e.thankYou)}).fail(function(e){v.showErrors.call(t,e,s)}).always(function(){s.removeClass("loading")}),!1})},showErrors:function(i,n){var s=this.model.i18n();if(e.isArray(i)){var o=[];e.each(i,function(t){n.find("[name="+t.key+"]").closest(".control-group").addClass("error"),t.msg&&o.push(t.msg+".")}),alert(o.join("<br />"),s.error,{closeCallback:function(){n.find(".control-group.error:first input").focus()}})}else if(i.responseText){var r;(r=t.parseJSON(i.responseText))?alert(r.msg,r.hdr||s.error):alert(s.errors.callServerFailed,s.error)}else alert(s.errors.callServerFailed,s.error)},renderCaptcha:function(t){var e=this,i=this.model.i18n();v.getCaptcha.call(this).done(function(n){e._captchaKey=n.key||"",t.find(".captcha").html(u({captcha:n.img,i18n:i}))})},getCaptcha:function(){return t.ajax({url:this.model.getCMBaseUrl()+"clients/new-captcha/"})}};return g}),define("system/auth/nls/auth",{root:{authorization:"Authorization",rememberMe:"Remember me",signIn:"Sign in",registration:"Registration",firstName:"First name",surname:"Last name",login:"username",phoneNumber:"Phone number",company:"Company (optional)",secretWord:"Code word for phone identification",captcha:"Type the characters you see in the picture",captchaReload:"Reload characters",registerMe:"Registration",enterWithPass:"Authorization",thankYou:"Thank you",enterLoginAndPass:"Please enter username and password",regSuccess:"<p>A registration verification email was sent to your email address.</p><p>For successful registration verify till: <strong class='nobr'>#t#</strong>.</p><p>Without verification your data will be removed from the system.</p>",errFirstName:"Enter a first name",errSurname:"Enter a last name",errEmail:"Enter a valid email",errPhone:"Enter a phone number",errSecretWord:"Enter code word",errCaptcha:"Type the characters you see in the picture",accept:"Accept",decline:"Decline",iAccept:"I accept the terms of",usersAgreement:"User agreement",ofUsersAgreement:"the user agreement",errUA:"You must accept the terms of the user agreement"},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("system/auth/nls/ru-ru/auth",{authorization:"Авторизация",rememberMe:"Запомнить меня",signIn:"Войти",registration:"Регистрация",firstName:"Имя",surname:"Фамилия",login:"логин",phoneNumber:"Телефон",company:"Компания (необязательно)",secretWord:"Кодовое слово для идентификации по телефону",captcha:"Введите символы с картинки",captchaReload:"Показать другие символы",registerMe:"Регистрация",enterWithPass:"Авторизация",thankYou:"Спасибо",enterLoginAndPass:"Пожалуйста, введите имя пользователя и пароль",regSuccess:"<p>На Ваш адрес электронной почты отправлено письмо с данными для подтверждения регистрации.</p><p>Для успешной регистрации необходимо подтверждение до: <strong class='nobr'>#t#</strong>.</p><p>При отсутствии подтверждения Ваши данные будут удалены из системы.</p>",errFirstName:"Введите Имя",errSurname:"Введите Фамилию",errEmail:"Введите правильный E-Mail",errPhone:"Введите номер Телефона",errSecretWord:"Введите Кодовое слово",errCaptcha:"Введите символы с картинки",accept:"Принять",decline:"Отклонить",iAccept:"Я принимаю условия",usersAgreement:"Пользовательское соглашение",ofUsersAgreement:"пользовательского соглашения",errUA:"Вы должны принять условия пользовательского соглашения"}),define("system/auth/AuthModule",["jquery","underscore","util","abstracts/Module","system/auth/views/AuthView","i18n!_common/nls/common","i18n!system/nls/system","i18n!./nls/auth"],function(t,e,i,n,s,o,r,a){function l(){var t=document.cookie,e=App.getRMCookieName(),i=t.indexOf(" "+e+"=");if(-1==i&&(i=t.indexOf(e+"=")),-1==i)t=null;else{i=t.indexOf("=",i)+1;var n=t.indexOf(";",i);-1==n&&(n=t.length),t=decodeURIComponent(t.substring(i,n))}return t}function h(t,e){if(e){var i=new Date;i.setDate(i.getDate()+e)}var n=encodeURIComponent(t)+(i?";expires="+i.toUTCString():"");document.cookie=App.getRMCookieName()+"="+n}function c(){document.cookie=App.getRMCookieName()+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function u(t,e){for(var i,n=new Array(2),s=new Array(4),o="",i=0;4>i;i++)s[i]=m(e.slice(4*i,4*(i+1)));for(i=0;i<t.length;i+=8)n[0]=m(t.slice(i,i+4)),n[1]=m(t.slice(i+4,i+8)),p(n,s),o+=g(n[0])+g(n[1]);return v(o)}function d(t,e){for(var i,n=new Array(2),s=new Array(4),o="",i=0;4>i;i++)s[i]=m(e.slice(4*i,4*(i+1)));for(t=_(t),i=0;i<t.length;i+=8)n[0]=m(t.slice(i,i+4)),n[1]=m(t.slice(i+4,i+8)),f(n,s),o+=g(n[0])+g(n[1]);return o=o.replace(/\0+$/,""),unescape(o)}function p(t,e){for(var i=t[0],n=t[1],s=2654435769,o=32*s,r=0;r!=o;)i+=(n<<4^n>>>5)+n^r+e[3&r],r+=s,n+=(i<<4^i>>>5)+i^r+e[3&r>>>11];t[0]=i,t[1]=n}function f(t,e){for(var i=t[0],n=t[1],s=2654435769,o=32*s;0!=o;)n-=(i<<4^i>>>5)+i^o+e[3&o>>>11],o-=s,i-=(n<<4^n>>>5)+n^o+e[3&o];t[0]=i,t[1]=n}function m(t){for(var e=0,i=0;4>i;i++)e|=t.charCodeAt(i)<<8*i;return isNaN(e)?0:e}function g(t){var e=String.fromCharCode(255&t,255&t>>8,255&t>>16,255&t>>24);return e}function v(t){return t.replace(/[\0\t\n\v\f\r\xa0'"!]/g,function(t){return"!"+t.charCodeAt(0)+"!"})}function _(t){return t.replace(/!\d\d?\d?!/g,function(t){return String.fromCharCode(t.slice(1,-1))})}var y="_crypT$Key",b=14,w=":::",x=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,S=n.extend({initialize:function(){this._i18n=t.extend({},o,r,a);var e=this,i=App.getStorage(),n=i.rootGet("user"),h=e.getDemoData(),c=l(),u=App.getRouter().getGETParams();if(this._view=new s({id:"auth",model:this}),App.subscribe("authsuccess",function(t,i,n){n&&(!i||i.login!=t.extId&&i.login!=t.username)?C.remember.call(e,t,b):C.remember.call(e,t)}),n)u.confirmed?(App.publish("authsuccess",n,h,!0),C.remember.call(this,n),window.location.href=window.location.origin+window.location.pathname):c?u.login&&u.pass?C.authByGET.call(e,u.login,u.pass,function(){App.publish("authsuccess",n,h,!0),"pushState"in window.history&&window.history.pushState("","","/")}):App.publish("authsuccess",n,h,!0):(i.rootRemove("user"),u.login&&u.pass?C.authByGET.call(e,u.login,u.pass,function(){e._view.render()}):this._view.render());else if(c){var d=this.decrypt(c),p=d.split(w);u.login&&u.pass?u.login!=p[0]?C.authByGET.call(e,u.login,u.pass,function(){C.authByCookie.call(e,p[0],p[1])}):C.authByCookie.call(e,p[0],p[1]):C.authByCookie.call(this,p[0],p[1])}else u.login&&u.pass?C.authByGET.call(e,u.login,u.pass,function(){e._view.render()}):this._view.render()},authorize:function(e,i){return t.ajax({url:App.getBaseUrl()+"users/login/",timeout:1e4,data:{login:e,password:i}})},getCMBaseUrl:function(){var t=App.getServerSettings();return(t.protocol||"http")+"://"+t.host+(t.port?":"+t.port:"")+"/clientmanager-rest/"},validateEmail:function(e){var i=null;return x.test(t.trim(e))||(i=this.i18n().errEmail),i},register:function(e){var i,n=new t.Deferred;return(i=C.validateRegData.call(this,e))?n.reject(i):(delete e.passwordRepeat,t.ajax({url:this.getCMBaseUrl()+"clients/self-reg/",data:e,success:function(t){n.resolve(t)},error:function(t){n.reject(t)}})),n},startResetPassword:function(e){var i,n=new t.Deferred;return(i=C.validateResetPasswordData.call(this,e))?n.reject(i):t.ajax({url:this.getCMBaseUrl()+"clients/forgot-password/",data:e,success:function(t){n.resolve(t)},error:function(t){n.reject(t)}}),n},encrypt:function(t,e){return u(i.Base64.encode(unescape(encodeURIComponent(t))),e||y)},decrypt:function(t,e){return decodeURIComponent(escape(i.Base64.decode(d(t,e||y))))},getDemoData:function(){var t=App.getServerSettings().demo||null;return t&&t.login&&t.password||(t=null),t}}),C={remember:function(t,e){var i=this.encrypt(t.username+w+t.password);h(i,e||0)},authByCookie:function(t,e){function i(){c(),window.location.href=s}var n=this,s=App.getRouter().getFullOrigin();this.authorize(t,e).done(function(t){t.id?App.publish("authsuccess",t,n.getDemoData()):i()}).fail(function(){i()})},authByGET:function(t,e,i){var n=this;this.authorize(t,e).done(function(t){t.id?(App.publish("authsuccess",t,n.getDemoData()),"pushState"in window.history&&window.history.pushState("","","/")):i()}).fail(function(){i()})},validateRegData:function(i){var n,s=[],o=this.i18n(),r=50;if(e.each(i,function(e,n){i[n]=t.trim(e)}),i.fname||s.push({key:"fname",msg:o.errFirstName}),i.sname||s.push({key:"sname",msg:o.errSurname}),(n=this.validateEmail(i.email))&&s.push({key:"email",msg:n}),i.phone||s.push({key:"phone",msg:o.errPhone}),i.password){var a=!1;i.password.length>r&&(s.push({key:"password",msg:o.errPassLength.replace("#max#",r)}),a=!0);var l=/[а-яё]/i;l.test(i.password)&&(s.push({key:"password",msg:o.errPassCyr}),a=!0),a||i.passwordRepeat==i.password||s.push({key:"passwordRepeat",msg:i.password&&i.passwordRepeat!=i.password?o.errPassRepeat:""})}else s.push({key:"password",msg:o.errPass});return i.secret||s.push({key:"secret",msg:o.errSecretWord}),i["captcha-answer"]||s.push({key:"captcha-answer",msg:o.errCaptcha}),i.acceptUA||s.push({key:"acceptUA",msg:o.errUA}),s.length?s:null},validateResetPasswordData:function(t){var e,i=[];return(e=this.validateEmail(t.email))&&i.push({key:"email",msg:e}),i.length?i:null}};return new S}),define("system/account/views/AccountNavView",["jquery","underscore","abstracts/View","bootstrap","i18n!_common/nls/common","i18n!system/nls/system","text!system/account/tmpl/accountNav.html","text!_common/tmpl/lang.html"],function(t,e,i,n,s,o,r,a){var l=null,h=i.extend({el:t("#main-hdr"),constructor:function(){this._module=null,i.apply(this,arguments)},initialize:function(t){this._module=t.module||null},render:function(){var i=this,n=this.model.get("allowedActions"),l=e.intersection(["objects.create","objects.edit","objects.delete","objectgroups.create","objectgroups.edit","objectgroups.delete","staff.create","staff.edit","staff.delete","schedule.create","schedule.edit","schedule.delete","users.create","users.edit","users.delete","roles.create","roles.edit","roles.bind","roles.delete"],n).length,h=e.template(r,{account:this.model.attributes,hasAdminAccess:l,adminUrl:App.getAdminUrl(),i18n:e.extend(s,o),changePass:this.model.can("users.edit.himself"),langDropdown:e.template(a,{curLang:App.getLocaleName(),compact:!0,locale:App.getLocale()})});
	t("#main-hdr .navbar-inner").append(h),this.setElement(t("#account-nav")),this.$(".dropdown-toggle").dropdown(),this.$el.on("click",".change-pass-link",function(){i.showChangePassword.call(i)}).on("click",".system-about",function(){App.trigger("showAboutDialog")}).on("click",".settings-link",function(){i._module&&i._module.get("parent").showSettings()})},showChangePassword:function(){if(!l){var t=this;return requirejs(["system/account/views/AccountChangePassView"],function(e){l=new e({model:t.model}),t.showChangePassword(t)}),void 0}l.show()}});return h}),define("system/account/AccountModule",["underscore","abstracts/Model","abstracts/Module","util","system/account/views/AccountNavView"],function(t,e,i,n,s){var o=!1,r=e.extend({constructor:function(){e.apply(this,arguments)},can:function(t){return this.has("allowedActions")&&-1!=this.get("allowedActions").indexOf(t)},changePassword:function(t){var e=this,i=new $.Deferred;for(var s in t)t[s]=new String(t[s]);return t.id=t.id||this.id,$.ajax({url:App.getBaseUrl()+"users/user-change-password/",data:t,complete:function(s){s.status>=200&&s.status<300?(e.set("password",t.password),e.set("basic",n.Base64.encode(e.get("username")+":"+t.password)),i.resolve()):i.reject(s)}}),i},isDemo:function(){return o}}),a=i.extend({modules:{},constructor:function(t){this._account=new r(t.user),i.apply(this,arguments)},initialize:function(){this.get("isDemo")&&this.setDemo(),this._navView=new s({model:this._account,module:this}),l.bindEvents.call(this),this.publish("ready",this),this._navView.render()},getAccount:function(){return this._account},getUserId:function(){return this._account.get("id")},getUsername:function(){return this._account.get("username")},setDemo:function(){o=!0}}),l={bindEvents:function(){}};return a}),define("system/demo/views/DemoView",["jquery","jface","bootstrap","abstracts/View","text!../tmpl/demo.html","text!../tmpl/footer.html","css!../css/demo.css"],function(t,e,i,n,s,o){var r=n.extend({events:{"click [data-action=forward]":"next","click [data-action=back]":"prev","click [data-action=close]":"close","click [data-action=show-again]":"showAgainClick"},constructor:function(){this.current=1,this._controlForward=null,this._controlBack=null,this._bullets=null,n.apply(this,arguments)},render:function(i){var n=960,r=600,a=20;if(!(t(window).width()<n-a||t(window).height()<r-a)){i=_.extend({displayDontShow:!0,donotshow:this.model.getUserData("donotshow")},i||{}),e.showOverlay();var l=this,h={winId:"demo-window",centered:!0,width:n,height:r,headerHtml:"Знакомство с системой",contentHtml:_.template(s,this.model.toJSON()),footerHtml:_.template(o,i),dieAfter:28800,activateCallback:function(){App.trigger("demoopen")},closeCallback:function(){e.hideOverlay()}};e.window.open(h),this.setElement("#"+h.winId),this._controlForward=this.$el.find(".control.forward"),this._controlBack=this.$el.find(".control.back");var c=this._bullets=this.$el.find(".demo-bullets i");this._bullets.on("click",function(){var t=c.index(this);l.setPage(t+1)}),this.listenTo(App,"openalarms",function(){l.$el.trigger("jw.close")})}},next:function(){++this.current,this.animate()},prev:function(){--this.current,this.animate()},setPage:function(t){this.current=t,this.animate()},animate:function(){var e=this.$el.find(".demo-step:eq("+(this.current-1)+")"),i=this._bullets.length;this._bullets.removeClass("active"),t(this._bullets.get(this.current-1)).addClass("active"),e.parent().css("left",-e.get(0).offsetLeft+"px"),1==this.current?(this._controlBack.addClass("hidden"),this._controlForward.removeClass("hidden")):this.current==i?(this._controlForward.addClass("hidden"),this._controlBack.removeClass("hidden")):(this._controlForward.removeClass("hidden"),this._controlBack.removeClass("hidden"))},showAgainClick:function(e){this.model.trigger("showDemoToggle",t(e.target).prop("checked"))}});return r}),define("system/demo/views/DemoAboutView",["jquery","jface","bootstrap","abstracts/View","text!../tmpl/about.html","text!../tmpl/aboutFooter.html","css!../css/demo.css"],function(t,e,i,n,s,o){var r=n.extend({events:{"click .tips-of-day":"tipsClick"},constructor:function(){n.apply(this,arguments)},render:function(){e.showOverlay();var t=this.model.getTexts(),i=this.model.toJSON(),n={winId:"demo-about",centered:!0,width:440,height:400,headerHtml:t.about,contentHtml:_.template(s,_.extend(i,{version:App.getVersion(),ui:this.model.get("parent").getUISettings(),i18n:t})),footerHtml:_.template(o,_.extend(i,{i18n:t})),dieAfter:28800,openCallback:function(){},activateCallback:function(){},closeCallback:function(){e.hideOverlay()}};e.window.open(n),this.setElement("#"+n.winId)},tipsClick:function(t){t.preventDefault(),e.hideOverlay(),e.window.close(),App.trigger("showPresentation")}});return r}),define("system/demo/DemoModule",["underscore","abstracts/Module","./views/DemoView","./views/DemoAboutView","./views/DemoAboutView","i18n!_common/nls/common"],function(t,e,i,n){var s="latestVersion",o="donotshow",r=e.extend({defaults:{presentation:!1,aboutInfo:""},constructor:function(){e.apply(this,arguments)},initialize:function(t){var e=App.getServerSettings(),r=App.getVersion(),l=e.aboutInfo||"";if("undefined"==typeof e.presentation||e.presentation||this.set("presentation",!1),l&&"object"==typeof l){var h=App.getLocale().substr(0,2);l=l[h]||l.en||""}this.set("aboutInfo",l||""),a.bindEvents.call(this),this._aboutView=new n({model:this}),this.get("presentation")&&(this._view=new i({model:this}),t.isDemo?this._view.render({displayDontShow:!1}):(a.isNewVersion.call(this,r)&&(this.toggleShowDemo(!1),this.setUserData(s,a.getVersionCode(r))),this.getUserData(o)||this._view.render()))},toggleShowDemo:function(t){this.setUserData(o,t?"1":"")},getTexts:function(){return this.get("parent").getTexts()}}),a={bindEvents:function(){this.on("showDemoToggle",t.bind(this.toggleShowDemo,this)),this.get("presentation")&&this.listenTo(App,"showPresentation",t.bind(function(){this._view.render()},this)),this.listenTo(App,"showAboutDialog",t.bind(function(){this._aboutView.render()},this))},getVersionCode:function(e){var i="";return t.isString(e)&&""!=e&&(i=e.match(/^(\d*\.\d*)[\s\S]*$/)[1].replace(/\./,"")),i},isNewVersion:function(t){var e=this.getUserData(s);return t=a.getVersionCode(t),e||this.setUserData(s,t),t!==e}};return r}),define("system/nls/settings",{root:{uiElements:"External view",reportsSettings:"Report options",scheduler:"Report scheduler",reportsList:"Report list",clickToChange:"Click to change",zonesSettings:"Geofences settings",alarmsAndAlerts:"Alarm window",historyWindowSettings:"Event window",alertsDirectory:"Event reference",objectsTitleMobile:"Vehicle labels",objectsTitleStat:"<span class='nobr'>Real estate</span> labels",devicesGeozonesBindings:"Binding objects to geofences"},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("system/nls/ru-ru/settings",{uiElements:"Внешний вид",reportsSettings:"Параметры отчетов",scheduler:"Планировщик отчетов",reportsList:"Список отчетов",clickToChange:"Кликните для изменения",zonesSettings:"Настройки зон",alarmsAndAlerts:"Окно тревоги",historyWindowSettings:"Окно событий",alertsDirectory:"Справочник событий",objectsTitleMobile:"Обозначение <span class='nobr'>мобильных объектов</span>",objectsTitleStat:"Обозначение <span class='nobr'>стационарных объектов</span>",devicesGeozonesBindings:"Привязка объектов к геозонам"}),define("system/views/SettingsView",["jquery","jqueryui","underscore","abstracts/View","jqueryui","jface","i18n!_common/nls/common","i18n!system/nls/settings","text!system/tmpl/settings.html","css!system/css/settings.css"],function(t,e,i,n,s,o,r,a,l){var h=i.extend(r,a),c=n.extend({constructor:function(){i.isUndefined(arguments[1])||(this.module=arguments[1]),n.apply(this,arguments)},render:function(){return this.show()},show:function(){if(this.$el.is("#settings"))this.$el.removeClass("hidden");else{var e=App.getStorage(),n={mobile:e.get("mobile")},s=App.getUserData("objectsTitle")||{};App.TYPE_MOBILE in s||(s[App.TYPE_MOBILE]=["name"]),App.TYPE_STAT in s||(s[App.TYPE_STAT]=["name"]);var o=i.template(l,{i18n:h,searchMode:App.getUserData("mapSearchMode")||0,objectsTitle:s,reports:App.hasModule("reports"),scheduler:App.hasModule("reports")&&!App.isDemo(),alarms:App.allowed("alerts"),alarmsOnly:App.isAlarmOperator(),alertsLogDepth:App.getStorage().get("log.depth"),values:n});t(o).appendTo(t("#page")),this.setElement(t("#settings")),u.activate.call(this),App.trigger("settingsready")}App.trigger("settingsopen")},hide:function(){this.$el.addClass("hidden"),App.trigger("settingsclose"),App.trigger("startall")}}),u={activate:function(){var e=this;this.$el.on("click",".close",function(){e.hide()}).find(".nav").on("click","a[data-target]",function(){var i=t(this),n=i.data("target");e.$el.find(">.section").not(".hidden").addClass("hidden").trigger("hidesection"),t(n).removeClass("hidden").trigger("showsection"),e.$el.find(">.nav .active").removeClass("active"),i.parent().addClass("active")}),this.$el.find(".wsm").on("click","input",function(){this.checked&&App.setUserData("mapSearchMode",parseInt(this.value))}),this.$el.find("a.cls").on("click",function(){return o.confirm(r.clearUserSettingsConfirm,r.areYouSure,{okCallback:function(){return e.model.flushSettings()}})}),u.initAlertsLogSettings.call(this);var i=this.$el.find(".objects-title");if(i.on("click","input",function(){var i=t(this).closest("ul");u.setObjectsTitle.call(e,i.data("type"))}),t.fn.sortable&&i.find("ul").sortable({distance:4,stop:function(){u.setObjectsTitle.call(e,t(this).data("type"))}}).disableSelection(),App.isAdmin()){this.$el.find("#alerts-directory").one("showsection",function(){requirejs(["_common/alerts/views/AlarmsDirectoryView"],function(t){new t({i18n:h}).render()})}),this.$el.find("#staff").one("showsection",function(){requirejs(["system/views/StaffGridView"],function(t){new t({i18n:h}).render()})});var n=this.$el.find("#devices-geozones");n.on("showsection",function(){n.data("controller")||requirejs(["_common/alerts/devicesGeozones/DevicesGeozonesController"],function(t){var e=new t({id:"alerts/devicesGeozones",container:n.find(".section-content")});n.data("controller",e)})})}},setObjectsTitle:function(t){var e=[],i=this.$el.find(".objects-title [data-type="+t+"] input"),n=App.getUserData("objectsTitle")||{};n[t]=[],i.each(function(){this.checked&&n[t].push(this.name)}),n[t].length||(n[t]=["name"]),App.setUserData("objectsTitle",n),App.trigger("objectsTitleChange",t,e)},initAlertsLogSettings:function(){this.$el.find("input[name=alertsLog]").on("click",function(){App.set("showAlertsLog",this.checked)}),this.$el.find("input[name=alertsLogDepth]").on("blur",function(){var e=t(this),n=parseInt(e.val());n=Math.min(Math.max(n,10),1e3),i.isNaN(n)&&(n=500),e.val(n),App.getStorage().set("log.depth",n),App.modules.log&&App.modules.log.set("depth",n)})}};return c}),define("system/views/SettingsGridView",["jquery","underscore","jface","abstracts/View","datatables","css!_libs/grids/DataTables/css/jquery.dataTables.cropped.css"],function(t,e,i,n){var s=n.prototype,o=n.extend({constructor:function(){this.loading=!1,this._gridDestroyTmt=null,this._grid=null,this._popup=null,this._i18n=null,n.apply(this,arguments)},_ns:"",_data:null,_hasContext:!1,initialize:function(){var e=this;t("#settings").length?this._initSettings():this.listenTo(App,"settingsready",function(){e._initSettings()}),this.listenTo(App,"settingsclose",function(){e._setDestroyTimeout(),e._popup&&e._popup.trigger("jw.close"),t(window).off("resizestop"+e._ns)}).listenTo(App,"settingsopen",function(){e.$el.hasClass("hidden")||(e._clearDestroyTimeout(),e._grid||e.render()),e._grid&&t(window).on("resizestop"+e._ns,function(){e._grid&&(e._grid.fnSettings().oScroll.sY=e.$el.find(".grid").height()-41,e._grid.fnDraw())})})},render:function(){var t=this;t.$el.addClass("loading"),t._loadData().done(function(){t._buildGrid()}).always(function(){t.$el.removeClass("loading")})},showErrors:function(t){if(t){var i=this,n=[];e.isArray(t)?t.length&&(e.each(t,function(t){i._popup&&i._popup.find("[name="+t.key+"]").closest(".control-group").addClass("error"),n.push(t.msg+".")}),alert(n.join("<br />"),this._i18n.error)):s.showErrors.call(this,t)}},_initSettings:function(){var t=this;this._renderLayout(),this.$el.on("showsection",function(){t._clearDestroyTimeout(),t._grid||t.render()}).on("hidesection",function(){t._setDestroyTimeout(),t._popup&&t._popup.trigger("jw.close")}),t._initEditor()},_loadData:function(){},_renderLayout:function(){},_buildGrid:function(){var e=this,i=this.$el.find(".grid"),n=i.find("table"),s=this._getGridOptions();this._grid=n.dataTable(s),t(window).on("resizestop"+this._ns,function(){e._grid&&(e._grid.fnSettings().oScroll.sY=i.height()-41,e._grid.fnDraw())}),this._initSearch()},_getGridOptions:function(){var t=this.$el.find(".grid");return{data:[],columns:[],orderClasses:!1,paging:!1,info:!1,deferRender:!0,scrollY:t.height()-41,scrollCollapse:!0,language:{search:this._i18n.search+":",zeroRecords:this._i18n.nothingFoundByYourRequest}}},_formatRowEdit:function(t){return'<svg class="svg-icon icon-edit" data-id="'+t+'">'+'<use xlink:href="#smb-edit"></use>'+"</svg>"},_formatRowDelete:function(t){return'<i data-id="'+t+'" class="icon-delete svg-icon svg-icon-remove"></i>'},_formatRowCheck:function(t){return t?'<i class="svg-icon svg-icon-checkmark"></i>':""},_initSearch:function(){var e=this,i=this.$el.find(".dataTables_filter").addClass("form-search");i.append('<i class="icon-clear svg-icon svg-icon-circle-remove"></i>'),this._grid.on("search.dt",function(){if(e._grid){var n=t.trim(e._grid.DataTable().search());n.length?i.addClass("active"):i.removeClass("active")}}),i.on("click",".icon-clear",function(){i.find("input").val(""),e._grid.DataTable().search("").draw()})},_initEditor:function(){var e=this;this.on("rowedit",e._startEdit),this.on("rowdelete",function(){showCursor(),e.loading=!0,e._delete.apply(e,arguments).done(function(){e._onDeleteSuccess.apply(e,arguments)}).fail(function(t){e.showErrors(t)}).always(function(){hideCursor(),e.loading=!1})}),this.$el.on("click",".add-row-link",function(){e.trigger("rowedit",null)}),this._hasContext?(this.$el.on("click",".icon-edit",function(t){t.stopPropagation(),e.$el.contextmenu("open",t)}),this._initContextMenu()):this.$el.on("click",".icon-edit",function(){e.trigger("rowedit",t(this).data("id"))})},_initContextMenu:function(){},_startEdit:function(){},_validate:function(){return null},_save:function(){},_addRow:function(e){var i=this._grid.DataTable(),n=i.row.add(e).draw().node();t(i.table().node().parentNode).scrollTo(n)},_getRow:function(t){return this._grid.DataTable().row(this.$el.find("tr[data-id="+t+"]"))},_updateRow:function(){},_delete:function(){},_onDeleteSuccess:function(t){this._deleteFromData(t),this._deleteFromGrid(t)},_deleteFromData:function(t){if(e.isArray(this._data))for(var i=this._data,n=i.length;n--;)if(i[n].id==t){i.splice(n,1);break}},_deleteFromGrid:function(e){var i=this._getRow(e),n=t(i.node()),s=n.next();s.length||(s=n.prev()),i.remove().draw(),s.length&&t(this._grid.DataTable().table().node().parentNode).scrollTo(s)},_clearDestroyTimeout:function(){this._gridDestroyTmt&&clearTimeout(this._gridDestroyTmt),this._gridDestroyTmt=null},_setDestroyTimeout:function(){var t=this;this._clearDestroyTimeout(),this._gridDestroyTmt=setTimeout(function(){t._destroyGrid()},3e4)},_destroyGrid:function(){this._grid&&(this._grid.DataTable().destroy(),this._grid=null,t(window).off("resizestop"+this._ns))}});return o}),define("maps/MapLayer",[],function(){function t(t,e){this._map=t,this._widget=e,this._protocol="http"+(App.isHttpsClient()?"s":"")+"://",this._cont=null,this._canvas=null,this._context=null,this.enabled=!1}return $.extend(t.prototype,{destroy:function(){this.disable()},setTrigger:function(t){this._trigger=$(t)},getTrigger:function(){return this._trigger},getMapClass:function(){return this._map.getClass()},setMap:function(t){this._map=t},setWidget:function(t){this._widget=t}}),t}),define("maps/TilesMapLayer",["util","maps/GeoMap","maps/MapLayer"],function(e,i,n){function s(){n.apply(this,arguments),this._tiles=null,this._trigger=null}return e.extend(s,n),function(){for(var t=["getClass","getEmptySrc","_getSourceUrl","_buildImgParams"],e=t.length;e--;)!function(e){var i=t[e];s.prototype[i]=function(){return this._map[i].apply(this,arguments)}}(e);for(t=["getZoom","getMinZoom","getMaxZoom","checkZoomAvailable","getMaxTileNumber"],e=t.length;e--;)!function(e){var i=t[e];s.prototype[i]=function(){return this._map[i].apply(this._map,arguments)}}(e)}(),$.extend(s.prototype,{enable:function(){if(null===this._cont){var t=this;return this._init(function(){t.enable()}),void 0}this._trigger&&this._trigger.addClass("active"),this._cont.removeClass("hidden"),this._buildTiles(),this.enabled=!0},disable:function(){this._cont&&this._cont.addClass("hidden"),this._tiles&&this._tiles.remove(),this._tiles=null,this._trigger&&this._trigger.removeClass("active"),this.enabled=!1},_buildTiles:function(){for(var e=(this._widget.position,this._widget.getDimensions()),n="",s=this._map.getZoom(),o=this._widget.firstTile,r=j=0,a=t=0,l=null,h=[];r<e.rows;++r)for(j=0;j<e.cols;++j)l=null,a=j*i.TILE_SIZE,t=r*i.TILE_SIZE,n=this.getImgSrc(o.x+j,o.y+r,s),l=this._getReusableTile(n),l||(l=new Image,l.src=n,l.className="tile load"),l.style.left=a+"px",l.style.top=t+"px",h.push(l);this._cont.html(h);for(var c=this,r=h.length;r--;)$(h[r]).on("error",function(){this.src=c.getEmptySrc(),$(this).remove()}).on("load",function(){this.className=this.className.replace(/\s+load/gi,"")});this._tiles=this._cont.find("img:not[.error]")},onbuild:function(){this._buildTiles()},onzoomstart:function(){this._tiles&&this._tiles.remove(),this._tiles=null},onstart:function(){},onstop:function(){this._buildTiles()},getImgSrc:function(t,e,i){var n=this.getMaxTileNumber();return 0>e||e>n?this.getEmptySrc():(0>t?t=0:t>=n+1&&(t%=n+1),i<this.getMinZoom()||i>this.getMaxZoom()?this.getEmptySrc():this._getSourceUrl()+this._buildImgParams(t,e,i))},_getReusableTile:function(t){if(!this._tiles||!this._tiles.length)return null;var e=new RegExp("x=\\d+&y=\\d+&z?=\\d+"),i=e.exec(t),n=null;return i=i?i[0]||"":null,i&&(n=this._tiles.filter('[src*="'+i+'"]')[0]),n},_init:function(){}}),s}),define("maps/TrafficMapLayer",["util","maps/TilesMapLayer","module"],function(t,e){function i(){e.apply(this,arguments),this._trigger=null}return i.__CLASS__="TrafficMapLayer",i.HOST=null,i.DEFAULT_PARAMS="",t.extend(i,e),$.extend(i.prototype,{_init:function(t){this._cont&&this._cont.length||(this._widget.getDimensions(),this._widget.addLayer('<div id="traffic-cont" class="map-layer hidden"></div>'),this._cont=$("#traffic-cont"),t&&t())},setMap:function(t){t.getTrafficLayerClass&&t.getTrafficLayerClass()==this.getClass()&&(this._map=t)},toggle:function(){this.enabled?this.disable():this.enable()}}),i}),define("maps/YandexMap",["jquery","underscore","util","geo","maps/GeoMap"],function(t,e,i,n,s){var o=null,r="4.114.2",a="map",l=function(){this._loadingRoutingAPI=!1,this._waitInterval=null,this._waitDfds=[],s.apply(this,arguments)};return i.extend(l,s,["getName","getCode"]),l.__CLASS__="YandexMap",l.code="yandex",l.mapName="Карта Yandex",l.HOST=["vec01.maps.yandex.net","vec02.maps.yandex.net","vec03.maps.yandex.net","vec04.maps.yandex.net"],l.DEFAULT_PARAMS="/tiles?l=map&v="+r,l.MAX_ZOOM=18,l.detectVersion=function(i){if(!i)return r;if(!e.isNull(r))return i();var n=this;t.ajax({dataType:"text",url:this._protocol+"api-maps.yandex.ru/1.1.1/xml/data.xml?v=1.45.0",success:function(t){var e=new RegExp(a+"s*:s*[\"']([0-9.]+)[\"']"),s=e.exec(t);s.length&&(r=s[1]),n.DEFAULT_PARAMS+=r,i()}})},t.extend(l.prototype,{getProjectionType:function(){return"yandex"},_buildImgParams:function(t,e,i){return"&x="+t+"&y="+e+"&z="+i+"&lang="+this.getLocale()},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+l.DEFAULT_PARAMS+"&x={x}&y={y}&z={z}&scale=1&lang="+this.getLocale(),sub:["vec01","vec02","vec03","vec04"]}},latToY:function(t){t>90&&(t-=180),-90>t&&(t+=180);var e=Math.sin(t*Math.PI/180),i=this._size/(2*Math.PI),s=Math.round(this._size/2-i*(Math.atanh(e)-n.D_EXT*Math.atanh(n.D_EXT*e)));return s===-1/0?s=0:1/0===s&&(s=this._size),s},yToLat:function(t){var e=1;t>this._size/2&&(t=this._size-t,e=-1);var i=(t-this._size/2)/-(this._size/Math.PI2),s=2*Math.atan(Math.exp(i))/Math.PI2-1/(2*Math.PI),o=t-this._size/2,r=0;do r=s,s=Math.asin(1-(1+Math.sin(r))*Math.pow(1-n.D_EXT*Math.sin(r),n.D_EXT)/(Math.exp(2*o/-(this._size/Math.PI2))*Math.pow(1+n.D_EXT*Math.sin(r),n.D_EXT)));while(Math.abs(r-s)>n.MerkElipsK&&!isNaN(s));return 180*e*(isNaN(s)?r:s)/Math.PI},getTrafficLayerClass:function(){return"YandexTrafficMapLayer"},routingTraffic:function(){return!0},loadRouting:function(){var e=this,i=new t.Deferred;if(this.routingReady())i.resolve();else if(o)e._routingService=o,i.resolve();else if(this._loadingRoutingAPI)if(this._waitInterval)this._waitDfds.push(i);else{var n=0;this._waitDfds.push(i),this._waitInterval=setInterval(function(){++n>=20&&e._clearWaiting(!1)},200)}else this._loadingRoutingAPI=!0,t.getScript("//api-maps.yandex.ru/2.0-stable/?load=package.route&lang="+this.getLocale()).done(function(){ymaps.ready(function(){e._loadingRoutingAPI=!1,o=e._routingService=ymaps,e._clearWaiting(!0),i.resolve()})}).fail(function(){e._clearWaiting(!1),i.reject()});return i},_clearWaiting:function(t){this._waitInterval&&(clearInterval(this._waitInterval),this._waitInterval=null,e.each(this._waitDfds,function(e){e[t?"resolve":"reject"]()}),this._waitDfds=[])},_calcRoute:function(e){for(var i=this,n=new t.Deferred,s=[],o=0,r=e.length;r>o;o++)s.push(e[o].lat&&e[o].lon?e[o].lat+","+e[o].lon:e[o].text);return this._routingService.route(s,{avoidTrafficJams:!0}).then(function(t){n.resolve(i._parseRouteData(t))},function(t){n.reject(t||null)}),n},_parseRouteData:function(t){var i,n,o,r,a,l,h,c,u,d,p,f=new s.RouteData,m={},g=[],v="";m.source="Yandex",m.bounds=t.properties.get("boundedBy"),m.length=t.getLength(),m.roundLength=0,m.time=t.getTime(),m.trafficTime=t.getJamsTime(),m.roundTime=0,f.meta=m;for(var _=0,y=t.getPaths().getLength();y>_;_++){a=t.getPaths().get(_),l=a.getSegments();for(var b=0;b<l.length;b++)h=l[b],v=h.getStreet(),c=h.getLength(),u=f.roundLength(c),m.roundLength+=u,d=h.getTime(),p=f.roundTime(h.getJamsTime()),m.roundTime+=p,i={index:b,bounds:h.properties.get("boundedBy"),length:c,roundLength:u,roundLengthS:f.formatLength(u),angle:h.getAngle(),time:d,trafficTime:h.getJamsTime(),roundTime:p,roundTimeS:f.formatTime(p),road:v,action:this._prepareActionCode(h.getAction()),actionText:h.getHumanAction().ucFirst()+(v?", "+v:""),actionHtml:"<b>"+h.getHumanAction().ucFirst()+"</b>"+(v?", "+v:""),points:h.getCoordinates()},n&&(r=e.last(n.points),i.points.length<2?i.points.unshift(e.clone(r)):(o=e.first(i.points),(o[0]!=r[0]||o[1]!=r[1])&&i.points.unshift(e.clone(r)))),g.push(i),n=i}return m.roundTimeS=f.formatTime(m.roundTime),m.roundLengthS=f.formatLength(m.roundLength),f.steps=g,f},_prepareActionCode:function(t){var e=t;return(-1!=t.indexOf("leave roundabout")||"enter roundabout"==t)&&(e=e.replace(/ /g,"-")),/^(slight|hard|exit|fork) /.test(t)&&(e=e.replace(/ /g,"-").replace("hard","sharp")),e}}),l}),define("maps/YandexMapSat",["underscore","util","maps/YandexMap"],function(t,e,i){function n(){i.apply(this,arguments)}var s="3.286.0";return e.extend(n,i,["getName","getCode","detectVersion"]),n.__CLASS__="YandexMapSat",n.code="yandexsat",n.mapName="Спутник Yandex",n.HOST=["sat01.maps.yandex.net","sat02.maps.yandex.net","sat03.maps.yandex.net","sat04.maps.yandex.net"],n.DEFAULT_PARAMS="/tiles?l=sat&v="+s,n.MAX_ZOOM=18,$.extend(n.prototype,{_buildImgParams:function(t,e,i){return"&x="+t+"&y="+e+"&z="+i},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+n.DEFAULT_PARAMS+"&lang=ru_RU&x={x}&y={y}&z={z}",sub:["sat01","sat02","sat03","sat04"]}},getHybridLayerClass:function(){return"YandexHybridMapLayer"}}),n}),define("maps/HybridMapLayer",["jquery","underscore","util","maps/TilesMapLayer"],function(t,e,i,n){function s(){s.superclass.constructor.apply(this,arguments),this._trigger=null}return s.__CLASS__="HybridMapLayer",s.HOST=null,s.DEFAULT_PARAMS="",i.extend(s,n),t.extend(s.prototype,{_init:function(e){this._cont&&this._cont.length||(this._widget.addLayer('<div id="hybrid-cont" class="map-layer hidden"></div>'),this._cont=t("#hybrid-cont"),e&&e())},setMap:function(t){this._map=t},toggle:function(){this.enabled?this.disable():this.enable()}}),s}),define("maps/YandexMapHybrid",["underscore","util","maps/YandexMap","maps/YandexMapSat","maps/HybridMapLayer"],function(t,e,i,n,s){function o(){n.apply(this,arguments)}function r(){s.apply(this,arguments)}var a="4.114.2",l=null;return e.extend(o,n,["getName","getCode"]),o.__CLASS__="YandexMapHybrid",o.code="yandexhybrid",o.mapName="Гибрид Yandex",o.HOST=n.HOST,o.DEFAULT_PARAMS=n.DEFAULT_PARAMS,o.MAX_ZOOM=n.MAX_ZOOM,$.extend(o.prototype,{isHybrid:function(){return!0},getExtraLayer:function(t){return l?l:l=new r(this,t)},destroyExtraLayer:function(){l&&l.destroy(),l=null}}),e.extend(r,s),r.__CLASS__="YandexHybridMapLayer",r.HOST=["vec01.maps.yandex.net","vec02.maps.yandex.net","vec03.maps.yandex.net","vec04.maps.yandex.net"],r.DEFAULT_PARAMS="/tiles?l=skl&v="+a,$.extend(r.prototype,{_buildImgParams:function(){return n.prototype._buildImgParams.apply(this,arguments)},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+r.DEFAULT_PARAMS+"&lang="+this.getLocale()+"&x={x}&y={y}&z={z}",sub:["vec01","vec02","vec03","vec04"]}},getLocale:function(){return App.getLocale().replace("-","_")}}),o}),define("maps/YandexMapPeople",["underscore","util","maps/YandexMap"],function(t,e,i){function n(){i.apply(this,arguments)}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="YandexMapPeople",n.code="yandexpeople",n.mapName="Народная карта Yandex",n.DEFAULT_PARAMS="/?l=mpmap&sl=104,210342,210370,211777,211818,211939,211993,212001,212015,212019,212026,212032,212081,212216,300024,300026,300198,300270,300292,300330,300337,300344,300351,300358,300365,300372,300379,300386,300393,300400,300406,300407,300468,300472,300523,300641,300651,300661,300931,300939,300954,300969,300993,301050,301084,301125,301135,301155,301164,301183,301275,301383,301388,301494,301501,301520,301596,301676,301685,301700,301773,302053,302080,302089,302090,302107,302526,5300026,5400032,5400052,5400061,70300160,70300190,70300236&token=",n.MAX_ZOOM=18,t.extend(n.prototype,{getSourceData:function(){return{url:this._protocol+"{s}.rdr.um.maps.yandex.net"+n.DEFAULT_PARAMS+"&x={x}&y={y}&z={z}",sub:["01","02","03","04"]}}}),n}),define("maps/YandexTrafficMapLayer",["util","maps/YandexMap","maps/TrafficMapLayer","module"],function(t,e,i){function n(){i.apply(this,arguments)}return t.extend(n,i),n.__CLASS__="YandexTrafficMapLayer",n.HOST=["jgo.maps.yandex.net"],n.DEFAULT_PARAMS="/tiles?l=trf",n._lastUpdateTS=null,n._getLastUpdateTS=function(){var t=new Date;if(null===this._lastUpdateTS||t.getTime()/1e3-240>this._lastUpdateTS){var e=t.getFullYear(),i=t.getMonth(),n=t.getDate(),s=t.getHours(),o=t.getMinutes();o-=0==o%4?4:o%4,o-=4;var r=new Date(e,i,n,s,o,0);this._lastUpdateTS=r.getTime()/1e3}return this._lastUpdateTS},$.extend(n.prototype,{_buildImgParams:function(){var t=e.prototype._buildImgParams.apply(this,arguments);return t+="&tm="+n._getLastUpdateTS()},getSourceData:function(){return{url:this._protocol+"{s}.maps.yandex.net"+n.DEFAULT_PARAMS+"&tm="+n._getLastUpdateTS()+"&x={x}&y={y}&z={z}",sub:["jgo"]}},_getReusableTile:function(t){if(!this._tiles||!this._tiles.length)return null;var e=new RegExp("x=\\d+&y=\\d+&z?=\\d+&tm="+n._getLastUpdateTS()),i=e.exec(t),s=null;return i=i?i[0]||"":null,i&&(s=this._tiles.filter('[src*="'+i+'"]')[0]),s}}),n}),define("maps/GoogleHybridMapLayer",["jquery","underscore","util","./HybridMapLayer"],function(t,e,i,n){function s(){n.apply(this,arguments)}i.extend(s,n),s.__CLASS__="GoogleHybridMapLayer";var o="!3i366039226",r="/maps/vt/pb=!1m5!1m4!1i";return t.extend(s.prototype,{getSourceData:function(){var t=App.getLocale().substr(0,2);return{url:this._protocol+"{s}.google.com/"+r+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"0"+o+"!3m7!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"]}}}),s}),define("async",[],function(){function t(t){var e,i;e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src=t,i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(e,i)}function e(t,e){var i=/!(.+)/,s=t.replace(i,""),o=i.test(t)?t.replace(/.+!/,""):n;return s+=s.indexOf("?")<0?"?":"&",s+o+"="+e}function i(){return s+=1,"__async_req_"+s+"__"}var n="callback",s=0;return{load:function(n,s,o,r){if(r.isBuild)o(null);else{var a=i();window[a]=o,t(e(n,a))}}}}),define("maps/GoogleMap",["underscore","util","./GeoMap","./GoogleHybridMapLayer","async"],function(t,e,i,n){var s=null,o="!3i366039226",r=function(){i.apply(this,arguments),this.scode="GGL",this._extraLayer=null};return e.extend(r,i,["getName","getCode"]),r.__CLASS__="GoogleMap",r.code="google",r.mapName="Карта Google",r.HOST=["www.google.ru"],r.DEFAULT_PARAMS="maps/vt/pb=!1m5!1m4!1i",r.MAX_ZOOM=18,t.extend(r.prototype,{SEARCH_DATA_TYPE:"json",getSourceData:function(){var t=this.getLocale();return{url:this._protocol+"{s}.google.com/"+r.DEFAULT_PARAMS+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"0"+this.getVersion()+"!3m"+("ru"==t?"1":"2")+"!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"]}},getLocale:function(){return App.getLocale().substr(0,2)},getVersion:function(){return o},isHybrid:function(){return!1},getExtraLayer:function(t){return this._extraLayer?this._extraLayer:(this._extraLayer=new n(this,t),this._extraLayer)},destroyExtraLayer:function(){this._extraLayer&&this._extraLayer.destroy(),this._extraLayer=null},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},getSearchUrl:function(t){var e="";t.bounds&&(e="&bounds="+t.bounds[1][0]+","+t.bounds[0][1]+"|"+t.bounds[0][0]+","+t.bounds[1][1]);var i=this._protocol+"maps.googleapis.com/maps/api/geocode/json?"+encodeURI("address="+t.q)+e+"&language="+this.getLocale();return i},parseSearchJSON:function(t){for(var e=[],i=t.results,n=null,s=0;s<i.length;s++)n=i[s],e.push({lat:n.geometry.location.lat,lon:n.geometry.location.lng,title:n.formatted_address,original:n});return e},getGeocodeUrl:function(t){return"//maps.googleapis.com/maps/api/geocode/json?latlng="+t.lat+","+t.lon+"&language="+this.getLocale()},parseGeocodeJSON:function(t){if(t.scode)return t;if("OK"!==t.status)throw new Error(t.error_message||"No addresses found");try{return{address:t.results[0].formatted_address}}catch(e){throw console&&console.error("Seems to be response structure changed"),e}},loadRouting:function(){var t=this,e=new $.Deferred;return this.routingReady()?e.resolve():s?(t._routingService=s,e.resolve()):requirejs(["async!//maps.googleapis.com/maps/api/js?v=3.exp&language="+this.getLocale()],function(){s=t._routingService=new google.maps.DirectionsService,e.resolve()},function(){e.reject("Can not load Google routing API")}),e},_calcRoute:function(t){for(var e=this,i=new $.Deferred,n=[],s=0,o=t.length;o>s;s++)n.push(t[s].lat&&t[s].lon?t[s].lat+","+t[s].lon:t[s].text);var r={origin:n[0],destination:n[n.length-1],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};return n.length>2&&(r.waypoints=n.slice(1,-1).join("|")),this._routingService.route(r,function(t,n){if(n==google.maps.DirectionsStatus.OK){var s=t.routes[0];i.resolve(e._parseRouteData(s))}else i.reject()}),i},_parseRouteData:function(t){var e,n,s,o,r,a,l,h,c,u,d,p,f,m,g=new i.RouteData,v=t.bounds.getNorthEast(),_=t.bounds.getSouthWest(),y=0,b=0,w={},x=[];w.source="Google",w.roundTime=0,w.roundLength=0,w.bounds=[[_.lat(),_.lng()],[v.lat(),v.lng()]];for(var S=0,C=t.legs.length;C>S;S++){n=t.legs[S],s=n.steps,y+=n.duration.value,b+=n.distance.value;for(var T=0;T<s.length;T++){o=s[T],d=o.distance.value,p=g.roundLength(d),w.roundLength+=p,f=o.duration.value,m=g.roundTime(f),w.roundTime+=m,e={index:T,length:d,roundLength:p,roundLengthS:g.formatLength(p),time:f,roundTime:m,roundTimeS:g.formatTime(m),action:this._prepareActionCode(o.maneuver),actionHtml:o.instructions,road:""},a=o.lat_lngs.length,r=[[null,null],[null,null]],h=new Array(a);
	for(var M=0;a>M;M++)l=o.lat_lngs[M],c=l.lat(),u=l.lng(),h[M]=[c,u],(null===r[0][0]||r[0][0]>c)&&(r[0][0]=c),(null===r[0][1]||r[0][1]>u)&&(r[0][1]=u),(null===r[1][0]||r[1][0]<c)&&(r[1][0]=c),(null===r[1][1]||r[1][1]<u)&&(r[1][1]=u);e.points=h,e.bounds=r,x.push(e)}}return w.length=b,w.roundLengthS=g.formatLength(w.roundLength),w.time=y,w.roundTimeS=g.formatTime(w.roundTime),g.meta=w,g.steps=x,g},_prepareActionCode:function(t){return""==t||"straight"==t?"none":"turn-right"==t||"turn-left"==t?t.replace("turn-",""):/(slight|exit|ramp|fork|sharp)/.test(t)?t.replace(/ /g,"-").replace("turn-","").replace("ramp","exit"):"roundabout-right"==t?"leave-roundabout":"merge"==t?t:"unknown"}}),r}),define("maps/nls/google",{root:{errBreak:'Try to open <a href="#url#" target="_blank">this link</a>. If the opened page asks you to determine whether or not you are human, enter the code, and then reload the monitoring page.<br />The selected scale can be unavailable for the current zone. Try to change the map type, or go to another zone, or scale down',errBreakHdr:"The map is not available"},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("maps/nls/ru-ru/google",{errBreak:'Попробуйте открыть <a href="#url#" target="_blank">эту ссылку</a>. Если на полученной странице Вас попросят подтвердить, что Вы не робот, введите код, a затем перезагрузите страницу мониторинга.<br />Также возможно, что выбранный масштаб недоступен для данной области. Попробуйте сменить тип карты или перейти к другой области, или уменьшить масштаб',errBreakHdr:"Карта недоступна"}),define("maps/GoogleMapSat",["underscore","util","./GoogleMap","i18n!./nls/google"],function(t,e,i,n){function s(){i.apply(this,arguments)}var o="!3i702";return e.extend(s,i,["getName","getCode"]),s.__CLASS__="GoogleMapSat",s.code="googlesat",s.mapName="Спутник Google",s.MAX_ZOOM=19,t.extend(s.prototype,{getSourceData:function(){var t=this.getLocale();return{url:this._protocol+"{s}.google.com/"+i.DEFAULT_PARAMS+"{z}!2i{x}!3i{y}"+"!4i256!2m2!1e"+"1"+o+"!3m9!2s"+t+"!3s"+t+"!5e1105!12m1!1e4!12m1!1e47!12m1!1e3!4e0",sub:["www"],onBreak:function(t){alert(n.errBreak.replace("#url#",t.url),n.errBreakHdr)}}},getHybridLayerClass:function(){return"GoogleHybridMapLayer"}}),s}),define("maps/GoogleMapHybrid",["underscore","util","./GoogleMap","./GoogleMapSat"],function(t,e,i,n){function s(){n.apply(this,arguments)}return e.extend(s,n,["getName","getCode"]),s.__CLASS__="GoogleMapHybrid",s.code="googlehybrid",s.mapName="Гибрид Google",s.HOST=n.HOST,s.DEFAULT_PARAMS=n.DEFAULT_PARAMS,s.MAX_ZOOM=n.MAX_ZOOM,$.extend(s.prototype,{isHybrid:function(){return!0}}),s}),define("maps/GoogleMapTerrain",["underscore","util","./GoogleMap","i18n!./nls/google"],function(t,e,i,n){function s(){i.apply(this,arguments)}var o="t@132,r@296348011";return e.extend(s,i,["getName","getCode"]),s.__CLASS__="GoogleMapTerrain",s.code="googleter",s.mapName="Рельеф Google",s.HOST=["mts0.google.ru","mts1.google.ru","mts2.google.ru","mts3.google.ru"],s.DEFAULT_PARAMS="/vt/lyrs="+o+"&src=app&s=Galile",s.MAX_ZOOM=15,t.extend(s.prototype,{getSourceData:function(){return{url:this._protocol+"{s}.google.com"+s.DEFAULT_PARAMS+"&hl="+this.getLocale()+"&x={x}&y={y}&z={z}",sub:["mts0","mts1","mts2","mts3"],onBreak:function(t){alert(n.errBreak.replace("#url#",t.url),n.errBreakHdr)}}}}),s}),define("maps/GoogleTrafficMapLayer",["util","maps/GoogleMap","maps/TrafficMapLayer","module"],function(t,e,i){function n(){i.apply(this,arguments)}return t.extend(n,i),n.__CLASS__="GoogleTrafficMapLayer",n.HOST=["mts0.google.com","mts1.google.com"],n.DEFAULT_PARAMS="/vt/src=app&style=15&lyrs=m@209000000,traffic",$.extend(n.prototype,{_buildImgParams:function(){return params="|seconds_into_week:-1"+e.prototype._buildImgParams.apply(this,arguments)},getSourceData:function(){return{url:this._protocol+"{s}.google.com"+"/vt/src=app&style=15&lyrs=m@209000000,traffic|seconds_into_week:-1&hl=ru&x={x}&y={y}&z={z}",sub:["mts0","mts1","mts2"]}}}),n}),define("maps/OpenStreetMap",["underscore","util","maps/GeoMap"],function(t,e,i){function n(){i.apply(this,arguments),this._protocol="http://",this.scode="OSM"}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="OpenStreetMap",n.code="omap",n.mapName="Карта OpenStreetMap",n.DEFAULT_PARAMS="/",n.MAX_ZOOM=18,t.extend(n.prototype,{_buildImgParams:function(t,e,i){return i+"/"+t+"/"+e+".png"},getSourceData:function(){return this._useCache?function(){var t=x/1024,e=y/1024;return t=t>1?parseInt(t):0,e=e>1?parseInt(e):0,{url:"cache/"+n.code+"/{z}/"+t+"/{x}/"+e+"/{y}.png"}}:{url:this._protocol+"{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",sub:"abc"}},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},getSearchUrl:function(t){var e="";return t.bounds&&(e="&viewbox="+t.bounds[0][1]+","+t.bounds[0][0]+","+t.bounds[1][1]+","+t.bounds[1][0]),this._protocol+"nominatim.openstreetmap.org/search?q="+t.q+e+"&format=json"},parseSearchJSON:function(t){for(var e=[],i=t,n=null,s=0;s<i.length;s++)n=i[s],e.push({lat:n.lat,lon:n.lon,title:n.display_name,original:n});return e},suggest:function(t){var e=this,i=$.Deferred(),n=this.getSuggestUrl(t);return $.ajax({url:n,type:"GET",method:"GET",beforeSend:function(){},success:function(t){try{i.resolve(e.parseSuggestJSON(t))}catch(n){i.reject({msg:n})}}}),i},getSuggestUrl:function(t){return this.getSearchUrl(t)},parseSuggestJSON:function(t){return $.map(t,function(t){return{label:t.display_name,value:t.display_name,lat:t.lat,lon:t.lon}})},getGeocodeUrl:function(t){return"//nominatim.openstreetmap.org/reverse?format=json&lat="+t.lat+"&lon="+t.lon+"&zoom=18"+"&addressdetails=0"+"&email=info@ritm.ru"+"&accept-language="+this.getLocale()},parseGeocodeJSON:function(t){if(t.scode)return t;if(t.error)throw new Error(t.error);try{return{address:t.display_name}}catch(e){throw console&&console.error("Seems to be response structure changed"),e}},routing:function(){return!1}}),n}),define("maps/OpenStreetMapTransport",["underscore","util","maps/OpenStreetMap"],function(t,e,i){function n(){i.apply(this,arguments)}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="OpenStreetMapTransport",n.code="omaptr",n.mapName="Транспорт OpenStreetMap",n.HOST=["a.tile2.opencyclemap.org","b.tile2.opencyclemap.org","c.tile2.opencyclemap.org"],n.DEFAULT_PARAMS=i.DEFAULT_PARAMS,n.MAX_ZOOM=i.MAX_ZOOM,t.extend(n.prototype,{getSourceData:function(){return this._useCache?function(){var t=x/1024,e=y/1024;return t=t>1?parseInt(t):0,e=e>1?parseInt(e):0,{url:"cache/"+n.code+"/{z}/"+t+"/{x}/"+e+"/{y}.png"}}:{url:this._protocol+"{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png",sub:"abc"}}}),n}),define("maps/CloudMadeMap",["underscore","util","maps/GeoMap"],function(t,e,i){function n(){i.apply(this,arguments)}return e.extend(n,i,["getName","getCode"]),n.__CLASS__="CloudMadeMap",n.code="cmmap",n.mapName="Карта CloudMadeMap",n.HOST=["a.tile.cloudmade.com","b.tile.cloudmade.com","c.tile.cloudmade.com"],n.DEFAULT_PARAMS="/BC9A493B41014CAABB98F0471D759707/997/256",n.MAX_ZOOM=18,t.extend(n.prototype,{_buildImgParams:function(t,e,i){return i+"/"+t+"/"+e+".png"},getSourceData:function(){return{url:this._protocol+"{s}.tile.cloudmade.com"+n.DEFAULT_PARAMS+"/{z}/{x}/{y}.png",sub:"abc"}},getTrafficLayerClass:function(){return"GoogleTrafficMapLayer"},routing:function(){return!1}}),n}),define("maps/SpecialMap",["jquery","underscore","util","maps/YandexMap","maps/GoogleMap"],function(t,e,i,n,s){var o={type:"yandex",sas:!1,online:!0,name:"Special map",host:"",path:"",ext:"png",sub:[],minZoom:2,maxZoom:18,errorUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},r=App.getServerSettings().specialMap||{},a="g"==(r.type||o.type).substr(0,1).toLowerCase()?s:n,l=a.prototype,h=function(){this._options=t.extend(!0,{},o,App.getServerSettings().specialMap||{}),a.apply(this,arguments)};i.extend(h,a),h.__CLASS__="SpecialMap",t.extend(h.prototype,{getFilenamePattern:function(){return"tile-{x}-{y}"},getName:function(){return this._options.name},getMinZoom:function(){return this._options.minZoom>0?this._options.minZoom:o.minZoom},getMaxZoom:function(){return this._options.maxZoom>0?this._options.maxZoom:o.maxZoom},getSourceData:function(){var t=c.getUrl.call(this);return{url:t,sub:this._options.sub,errorTileUrl:this._options.errorUrl||o.errorTileUrl}},getTrafficLayerClass:function(){var t="";return this._options.online&&(t=l.getTrafficLayerClass.call(this)),t},getSearchUrl:function(t){var e=l.getSearchUrl.call(this,t);return this._options.online||(e=App.getBaseUrl()+"address/find/"),e},search:function(t){return this._options.online?l.search.call(this,t):c.offlineSearch.call(this,t)},suggest:function(e){return this._options.online?l.suggest.call(this,e):(new t.Deferred).reject()},geocode:function(t){this._options.online?l.geocode.call(this,t):(!t.scode&&(t.scode=this.scode),this._onExternalGeocodingFailed(t))},routing:function(){return this._options.online?l.routing.call(this):!1}});var c={getUrl:function(){var t="",e="url"in this._options?this._options.url:(this._options.host?this._protocol+this._options.host+"/":"")+this._options.path;if(this._options.sas){var i=this._options.ext;t=function(t){var n=t.x,s=t.y,o=t.z,r=Math.floor(n/1024),a=Math.floor(s/1024);return e+"/z"+(o+1)+"/"+r+"/x"+n+"/"+a+"/y"+s+"."+i}}else t=e+"/{z}/"+this.getFilenamePattern()+"."+this._options.ext;return t},offlineSearch:function(e){var i=t.Deferred(),n=this.getSearchUrl(e);return t.ajax({url:n,data:{address:[e.q],scode:this.scode,lat:e.center.lat,lon:e.center.lon},success:function(t){var e,n=[];for(var s in t)e=t[s],n.push({lat:e.lat,lon:e.lon,title:e.address,original:e});i.resolve(n)},error:function(){i.reject()}}),i}};return h}),function(){L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,this._infoLayer=null,this._shape=null,this._modified=!1,this.options=this.options||{},e&&e.shape&&(e.shape=L.Util.extend({},this.options.shape||{},e.shape||{})),this.options=L.Util.extend({},this.options,e),this.on("destroy",this.destroy,this)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this.fire("disabled",{handler:this.type}),this._map.fire("draw:drawstop",{layerType:this.type}))},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._createShape(),this.options.info&&(this._makeInfoLayer(),this._map.on("viewreset",this._moveInfo,this)),this.options.latlng.length&&this._initMarkers(),this.options.addPoints&&this._initMouseMarker())},removeHooks:function(){this._map&&L.DomUtil.enableTextSelection()},setOptions:function(t){L.setOptions(this,t)},destroy:function(){this.disable(),this._cleanUpShape(),this._mouseMarker&&(this._map.removeLayer(this._mouseMarker),this._mouseMarker=null),this._markers=[],this._shape=null,this._infoLayer&&(this._map.off("viewreset",this._moveInfo,this),this._infoLayer.parentNode.removeChild(this._infoLayer),this._infoLayer=null)},toGeoJSON:function(){return this._shape.toGeoJSON()},getBounds:function(){return this._shape&&this._shape.getBounds()},isModified:function(){return this._modified},_initMouseMarker:function(){this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._addMarker,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this)},_createShape:function(){this._shape=new this.Shape([],this.options.shape)},_initMarkers:function(){for(var t=this.options.latlng,e=0,i=t.length;i>e;++e)this._addMarker(t[e])},_onMouseMove:function(t){var e=t.latlng;this._currentLatLng=e,this._mouseMarker&&this._mouseMarker.setLatLng(e),L.DomEvent.preventDefault(t.originalEvent)},_makeInfoLayer:function(){if(!this._infoLayer){var t="poly-info-layer leaflet-zoom-hide"+(this.options.info.addClass?" "+this.options.info.addClass:"");this._infoLayer=L.DomUtil.create("div",t),this._map.getPanes().overlayPane.appendChild(this._infoLayer)}},_showInfo:function(){this.options.info.content&&(this._infoLayer.innerHTML="function"==typeof this.options.info.content?this.options.info.content.call(this):this.options.info.content),this._moveInfo()},_moveInfo:function(){if(this._infoLayer&&this._markers[0]){var t=this.getCenter();L.DomUtil.setPosition(this._infoLayer,t),this._infoLayer.setAttribute("x",t.x),this._infoLayer.setAttribute("y",t.y)}},_getDistance:function(t,e){return t.distanceTo(e)},_finishShape:function(){this._map.removeLayer(this._mouseMarker),this._fireCreatedEvent()},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})}}),L.Draw.Point=L.Draw.Feature.extend({statics:{TYPE:"point"},options:{addPoints:!0,latlng:null,shape:null,zIndexOffset:2e3},initialize:function(t,e){L.Draw.Feature.prototype.initialize.call(this,t,e),this.type=L.Draw.Point.TYPE;var i=this.options.latlng;this.options.addPoints=i?!1:!0},addHooks:function(){this._map&&(L.DomUtil.disableTextSelection(),this._marker=null,this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this.options.latlng&&this._addMarker(),this.options.addPoints&&this._initMouseMarker())},removeHooks:function(){this.destroy()},setLatLng:function(t){var t=L.latLng(t);this._map.setView(t,this._map.getMaxZoom()-1,{animate:!1}),this._marker?this._marker.setLatLng(t):this._addMarker(t)},isValid:function(){return null!==this.options.latlng},toGeoJSON:function(){return this._marker.toGeoJSON()},getPoint:function(){return this.options.latlng},getBounds:function(){var t=this._marker.getLatLng();return[[t.lat,t.lng],[t.lat,t.lng]]},destroy:function(){this.disable(),this._mouseMarker&&this._map.removeLayer(this._mouseMarker),this._mouseMarker=null,this._marker&&this._map.removeLayer(this._marker),this._marker=null},_addMarker:function(t){if(!this._marker){var e=t.target?t.target.getLatLng():t;this.options.latlng=[e.lat,e.lng];var i=this._createMarker(e);this._marker=i,this._mouseMarker&&this._map.removeLayer(this._mouseMarker),this._fireEdit()}},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=0,e.on("drag",this._move,this).on("dragend",this._fireEdit,this),this._markerGroup.addLayer(e),e},_move:function(){var t=this._marker.getLatLng();this.options.latlng=[t.lat,t.lng],this.fire("drag",{position:this.options.latlng}),this._modified=!0},_fireEdit:function(){this.fire("dragend",{position:this.options.latlng})},_createShape:function(){},_cleanUpShape:function(){}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Shape:L.Polyline,options:{showIndexes:!1,addPoints:!0,latlng:[],shape:{stroke:!0,color:"#f06eaa",weight:4,opacity:.8,fill:!1,clickable:!1},zIndexOffset:2e3},initialize:function(t,e){L.Draw.Feature.prototype.initialize.call(this,t,e),this.type=L.Draw.Polyline.TYPE},getMarkers:function(){return this._markers},getPoints:function(){if(!this._shape)return[];for(var t=this._shape.getLatLngs(),e=t.length,i=new Array(e),n=0;e>n;++n)i[n]=[t[n].lat,t[n].lng];return i},getLastMarker:function(){return this._markers[this._markers.length-1]||null},getFirstMarker:function(){return this._markers[0]||null},removeMarkerByIndex:function(t){this._markers[t]&&this._removeMarker(this._markers[t])},_addMarker:function(t){var e=t.target?t.target.getLatLng():t,i=this._createMarker(e,this._markers.length);this._markers.push(i),this._shape.addLatLng(e),2===this._markers.length&&this._map.addLayer(this._shape),this.fire("nodeadd",{poly:this._shape,marker:i}),t.target&&(this._modified=!0)},_createMarker:function(t,e){var i=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});"undefined"!=typeof e&&(i._index=e);var n=this;return i.on("drag",this._onMarkerDrag,this).on("dblclick destroy",function(){n._markers.length>1&&n._removeMarker(i)},this),this._markerGroup.addLayer(i),this.options.showIndexes&&(i._icon.innerHTML=e),i},_removeMarker:function(t){var e=t,i=t._index;if(this._markers.splice(i,1),this._markerGroup.removeLayer(t),this._shape.spliceLatLngs(i,1),i<this._markers.length)for(var n=i,s=this._markers.length;s>n;n++)this._markers[n]._index=n,this.options.showIndexes&&(this._markers[n]._icon.innerHTML=n),this.fire("nodeindexchange",{marker:this._markers[n]});this.fire("noderemove",{poly:this._shape,marker:e}),e=null},_onMarkerDrag:function(t){var e=t.target;e.setLatLng(this._currentLatLng),this._shape.spliceLatLngs(e._index,1,this._currentLatLng),this.fire("nodechange",{poly:this._shape,marker:e}),this._modified=!0},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this),this._markerGroup&&this._map.removeLayer(this._markerGroup),this._shape&&this._map.removeLayer(this._shape),this.options.addPoints&&this._map.off("mousemove",this._onMouseMove,this)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Shape:L.Polygon,initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},removeHooks:function(){this.destroy()},getArea:function(){var t,e,i=0,n=this._markers,s=[],o=[],r=1/0,a=1/0;if(!n)return!1;var l=n.length;for(e=0;l>e;e++){var h=n[e].getLatLng();h.lat<r&&(r=h.lat),h.lng<a&&(a=h.lng)}for(e=0;l>e;e++){var h=n[e].getLatLng();s[e]=this._getDistance(new L.LatLng(r,a),new L.LatLng(r,h.lng)),o[e]=this._getDistance(new L.LatLng(r,a),new L.LatLng(h.lat,a))}for(e=0;l>e;e++)0==e?(t=s[e]*(o[l-1]-o[e+1]),i+=t):e==l-1?(t=s[e]*(o[e-1]-o[0]),i+=t):(t=s[e]*(o[e-1]-o[e+1]),i+=t);return Math.abs(i/2)},getPerimeter:function(){var t=this._markers,e=0;if("undefined"==typeof t||t.length<3)return 0;for(var i=0;i<t.length-1;i++){var n=t[i].getLatLng(),s=t[i+1].getLatLng();e+=this._getDistance(n,s)}return e+=this._getDistance(s,t[0].getLatLng())},getCenter:function(){for(var t=this._shape._latlngs,e=t.length,i=0,n=0,s=0;e>s;++s)i+=t[s].lat,n+=t[s].lng;return this._map.latLngToLayerPoint([i/e,n/e])},setLatLngs:function(t){this._markerGroup&&this._map.removeLayer(this._markerGroup),this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._markers=[],this.options.latlng=t,this._shape.setLatLngs([]),this._initMarkers(),this._showInfo(),this._modified=!0},isValid:function(){return this._markers.length>=3},_addMarker:function(t){var e=t.target?t.target.getLatLng():t,i=this._createMarker(e,this._markers.length);this._markers.push(i),this._shape.addLatLng(e);var n=this._markers.length;if(n>=2){2===n?this._map.addLayer(this._shape):3===n&&this.options.info&&this._showInfo();var s=this._markers[n-2];s._middleRight&&this._markerGroup.removeLayer(s._middleRight),this._createMiddleMarker(s,i),this._updatePrevNext(s,i),n>2&&(this._createMiddleMarker(i,this._markers[0]),this._updatePrevNext(i,this._markers[0]),this.options.info&&this._showInfo())}t.target&&(this._modified=!0)},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return i._origLatLng=t,i._index=e,i.on("dblclick",this._onMarkerDoubleClick,this),i.on("drag",this._onMarkerDrag,this),this._markerGroup.addLayer(i),i},_createMiddleMarker:function(t,e){var i,n,s,o=this._getMiddleLatLng(t,e),r=this._createMarker(o);r.setIcon(new L.DivIcon({iconSize:null,className:"leaflet-editing-icon leaflet-middle-icon"})),t._middleRight=e._middleLeft=r,n=function(){var n=e._index;r._index=n,r.off("click",i,this).on("dblclick",this._onMarkerDoubleClick,this),o.lat=r.getLatLng().lat,o.lng=r.getLatLng().lng,this._shape.spliceLatLngs(n,0,o),this._markers.splice(n,0,r),r.setIcon(new L.DivIcon({iconSize:null,className:"leaflet-editing-icon"})),this._updateIndexes(n,1),e._index++,this._updatePrevNext(t,r),this._updatePrevNext(r,e)},s=function(){r.off("dragstart",n,this),r.off("dragend",s,this),this._createMiddleMarker(t,r),this._createMiddleMarker(r,e),3==this._markers.length&&(this._createMiddleMarker(e,t),this.options.info&&this._showInfo()),this._modified=!0},i=function(){n.call(this),s.call(this)},r.on("click",i,this).on("dragstart",n,this).on("dragend",s,this),this._markerGroup.addLayer(r)},_onMarkerDrag:function(t){var e=t.target;L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._shape.spliceLatLngs(e._index,1,e._latlng),this._shape.redraw(),this.options.info&&this._showInfo(),this._modified=!0},_onMarkerDoubleClick:function(t){var e=L.Polygon&&this._shape instanceof L.Polygon?4:3,i=t.target;this._shape._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null)},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._shape.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dblclick",this._onMarkerDoubleClick,this),this.options.info&&this._showInfo(),this._modified=!0},_getMiddleLatLng:function(t,e){var i=this._shape._map,n=i.latLngToLayerPoint(t.getLatLng()),s=i.latLngToLayerPoint(e.getLatLng());return i.layerPointToLatLng(n._add(s)._divideBy(2))},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)}}),L.Draw.Circle=L.Draw.Feature.extend({statics:{DEFAULT_RADIUS:{1:4e5,5:2e5,6:1e5,7:5e4,8:3e4,9:1e4,11:3e3,12:2e3,13:1e3,14:500,15:200,17:100,18:50},TYPE:"circle"},Shape:L.Circle,initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Circle.TYPE,this.options.latlng||(this.options.latlng=[]);var i=this.options.latlng;this.options.addPoints=i.length?!1:!0,2==i.length&&(this.options.radius=L.latLng(i[0]).distanceTo(i[1]))},removeHooks:function(){this.destroy()},getRadius:function(){return this._shape&&this._shape.getRadius()||0},setRadius:function(t,e){if(this.options.radius=t,this._shape){if(this._shape.setRadius(t,this._map),!e){var i=this._getResizeMarkerPoint();this.options.latlng[1]=[i.lat,i.lng],this._markers[1].setLatLng(i),this.options.info&&this._showInfo()}this._modified=!0}},setCenter:function(t){var e=L.Util.isArray(t)?t:[t.lat,t.lng];if(2==this._markers.length)this._markers[0].setLatLng(e),this._move(),this._map.fitBounds(this.getBounds());else{var t=L.latLng(e);this._map.setView(t,this._map.getMaxZoom()-1,{animate:!1}),this._addMarker(t)}this._modified=!0},getArea:function(){var t=this.getRadius();return Math.PI*t*t},getCenter:function(){return this.options.latlng[0]?this._map.latLngToLayerPoint(this.options.latlng[0]):null},getPoints:function(){return 2==this.options.latlng.length?this.options.latlng:[]},isValid:function(){return 2==this.options.latlng.length},_createShape:function(){if(this.options.latlng[0]){if(!this.options.radius||this.options.radius<0){var t=this._map.getZoom(),e=L.Draw.Circle.DEFAULT_RADIUS,i=null;for(var n in e){if(t==n){i=n;break}if(!(t>n))break;i=n}this.options.radius=e[i],this._modified=!0}this._shape=new this.Shape(this.options.latlng[0],this.options.radius,this.options.shape),this.fire("resize",{radius:this.options.radius})}},_addMarker:function(t){if(!(this._markers.length>=2)){var e=t.target?t.target.getLatLng():t;if(this.options.latlng.length<2){0==this.options.latlng.length&&(this.options.latlng[0]=[e.lat,e.lng],this._createShape(),this._map.addLayer(this._shape));var i=this._createMoveMarker(e);this._markers.push(i),i=this._createResizeMarker(),this._markers.push(i),e=i.getLatLng(),this.options.latlng[1]=[e.lat,e.lng],this.options.addPoints=!1,this._finishShape(),this.options.info&&this._showInfo()}else{if(0==this._markers.length)var i=this._createMoveMarker(e);else{var i=this._createResizeMarker();this._map.addLayer(this._shape),this.options.info&&this._showInfo()}this._markers.push(i)}}},_createMoveMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=0,e.on("drag",this._move,this),this._markerGroup.addLayer(e),e},_createResizeMarker:function(){var t=this.options.latlng[1]||this._getResizeMarkerPoint(),e=new L.Marker(t,{icon:this.options.icon,draggable:!0,zIndexOffset:2*this.options.zIndexOffset});return e._index=1,e.on("drag",this._resize,this),this._markerGroup.addLayer(e),e},_getResizeMarkerPoint:function(){var t=this._markers[0].getLatLng(),e=this._shape._radius,i=this._map.project(t);return this._map.unproject([i.x+e,i.y])},_move:function(t){var e=t&&t.target||this._markers[0],i=e.getLatLng(),n=this.options.latlng[0].slice(0),s=this._markers[1].getLatLng(),o=[s.lat-n[0]+i.lat,s.lng-n[1]+i.lng];this.options.latlng[0]=[i.lat,i.lng],this.options.latlng[1]=o,this._shape.setLatLng(i),this._markers[1].setLatLng(o),this._shape.redraw(),this.options.info&&this._moveInfo(),this._modified=!0},_resize:function(t){var e=t.target,i=e.getLatLng();this.options.latlng[1]=[i.lat,i.lng];var n=this._calcRadius();this._shape.setRadius(n,!0),this._shape.redraw(),this.options.info&&this._showInfo(),this.fire("resize",{radius:n}),this._modified=!0},_calcRadius:function(){return this._markers[0].getLatLng().distanceTo(this._markers[1].getLatLng())},_cleanUpShape:function(){this._markerGroup&&this._map.removeLayer(this._markerGroup),this._shape&&this._map.removeLayer(this._shape),this.options.addPoints&&this._map.off("mousemove",this._onMouseMove,this)}}),L.Edit={},L.Edit.Shape=L.Handler.extend({options:{addPoints:!1,icon:new L.DivIcon({iconSize:null,className:"leaflet-editing-icon"}),shape:{stroke:!0,color:"rgba(0, 228, 0, 1)",weight:3,fill:!0,clickable:!1},info:{addClass:"",content:function(){return""}},zIndexOffset:1999},DrawShape:null,includes:L.Mixin.Events,initialize:function(t){this._drawObject=null,L.setOptions(this,t);var e=this;this.on("destroy",function(){e._drawObject&&e._drawObject.destroy()})},addHooks:function(){this._map&&!this._drawObject&&(this._drawObject=new this.DrawShape(this._map,this.options||{}))},removeHooks:function(){this._map.removeLayer(this._drawObject)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this._drawObject&&this._drawObject.enable())},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._drawObject&&this._drawObject.disable())},getBounds:function(){return this._drawObject.getBounds()},toGeoJSON:function(){return this._drawObject.toGeoJSON()},onAdd:function(t){this._map=t,this.enable()},onRemove:function(){this.disable()},getPoints:function(){return this._drawObject.getPoints()},isValid:function(){return this._drawObject.isValid()},isModified:function(){return this._drawObject.isModified()}}),L.Edit.Point=L.Edit.Shape.extend({DrawShape:L.Draw.Point,options:{addPoints:!1,icon:new L.DivIcon({iconSize:null,className:"leaflet-point-editing-icon"}),shape:null,info:null,zIndexOffset:1999},addHooks:function(){L.Edit.Shape.prototype.addHooks.call(this,arguments),this._drawObject&&this._drawObject.on("drag dragend",this._onDrag,this)},getPosition:function(){return this._drawObject.getPoint()},setPosition:function(t){return this._drawObject.setLatLng(t)},_onDrag:function(t){this.fire(t.type,{position:t.position})}}),L.Edit.Circle=L.Edit.Shape.extend({DrawShape:L.Draw.Circle,addHooks:function(){L.Edit.Shape.prototype.addHooks.call(this,arguments),this._drawObject&&this._drawObject.on("resize",this._onResize,this)},removeHooks:function(){this._drawObject&&this._drawObject.off("resize",this._onResize,this),L.Edit.Shape.prototype.removeHooks.call(this,arguments)},getRadius:function(){return this._drawObject?this._drawObject.getRadius():0},setRadius:function(t){return this._drawObject.setRadius(t)},getCenter:function(){return this._drawObject?this._drawObject.getCenter():null},setCenter:function(t){return this._drawObject.setCenter(t)},_onResize:function(t){this.fire(t.type,{radius:t.radius})}}),L.Edit.Polygon=L.Edit.Shape.extend({DrawShape:L.Draw.Polygon,setLatLngs:function(t){return this._drawObject.setLatLngs(t)},getArea:function(){return this._drawObject.getArea()},getPerimeter:function(){return this._drawObject.getPerimeter()}})}(this,document),define("_libs/leaflet/plugins/draw/leaflet.draw",function(){}),define("abstracts/ObjectsCollection",["underscore","abstracts/Collection"],function(t,e){var i=e.extend({constructor:function(){e.apply(this,arguments)},idProp:"objectId",parse:function(t){return t.items||t.group&&t.group.items||t}});return i}),define("abstracts/BaseModule",["jquery","underscore","abstracts/Module","util","i18n!_common/nls/common"],function(t,e,i,n,s){var o=i.extend({_maps:null,constructor:function(){this._modules=(this._modules||[]).concat(["update","watched","tree"]),this._zoomItem=null,i.apply(this,arguments)},defaults:e.extend({},i.prototype.defaults,{ready:!1}),initialize:function(){this._i18n=s},buildModules:function(){var t=this,i=e.map(this._modules,function(e){return t._getPathes()[e]});requirejs(i,function(){var i=0;e.each(arguments,function(e){var n=t._modules[i],s=t.id+"/"+n;t.modules[n]=new e({id:s,container:"itemcard"!=n?t._view.getContainer(n):null,placeholder:App.getPlaceholder(s),parent:t,options:t._getModuleOptions(n)}),i++}),t._addRoutes(),t._bindEvents(),t.set("ready",!0)})},suggest:function(){var e=this,i=t.Deferred(),n=this.search.apply(this,arguments);return n.done(function(t){try{var n=e.parseSuggestJSON(t);i.resolve(n)}catch(s){i.reject({msg:s})}}).fail(function(){i.reject.apply(i,arguments)}),i},parseSuggestJSON:function(i){return t.map(i,function(t){var i=e.escape(t.name);return{label:i,value:i,original:t}})},_prepareSearchParams:function(t){return{q:""+t.q,limit:parseInt(t.limit)}},search:function(e,i){var n=this,s=t.Deferred();return i&&i.id?s.resolve([i]):this.URL_SEARCH?(t.ajax({url:this.URL_SEARCH,timeout:5e3,data:this._prepareSearchParams(e),success:function(t){try{s.resolve(n.parseSearchJSON(t,e))}catch(i){s.reject({msg:i})}},error:function(t,e,i){s.reject({msg:e+": "+i})}}),s):s.reject("No url for search")},getSearchOptions:function(){var t=this,i={zoom:!0,putMarker:!1,onsuccess:function(i){if(t.modules.watched){var n=App.getUserData("mapSearchMode")||0;0==n?t.modules.watched.setItems(i):t.trigger("toggleitems",e.pluck(i,"id"),[],t)}}};return i},parseSearchJSON:function(t,e){if(!e.mapSearch)return t;for(var i=[],n=0,s=t.length;s>n;++n)t[n].lat&&t[n].lon&&i.push(t[n]);return i},setMapsModule:function(t){return this._maps=this.modules.maps=t,this},getSelectedItemsIds:function(){return this.modules.watched?this.modules.watched.getWatchedItemsIds():[]},getWatchedObjects:function(){return this.modules.watched&&this.modules.watched.items.models},getAvgUpdateTime:function(){return this.modules.update?this.modules.update.getAvgUpdateTime():200},getMapsModule:function(){return this._maps},getBounds:function(){return this._view.getBounds()},setZoomItem:function(t){this._zoomItem=t},getZoomItem:function(){return this._zoomItem},getItemIdsForUpdate:function(){var e;if(this.get("ready"))e=this._collectWatchedItemIds();else{var i=this;e=new t.Deferred,this.once("change:ready",function(){i._collectWatchedItemIds().done(function(t){e.resolve(t)})})}return e},_getPathes:function(){return{}},getTexts:function(){return this._i18n},_getModuleOptions:function(){return null},_addRoutes:function(){var t=this;this.routes={},this.routes[t.id]={callback:function(e){App.setActiveModule(t.id+"/"+e),App.getView().trigger("needleftwide",!1)},context:this,params:":m(/*extra)"},App.getRouter().addRoutes(this.routes),this.interceptCurrentRoute()
},_bindEvents:function(){var t=this,e=this.modules.watched;this.listenTo(App,"stopall",function(){t.trigger("stopwatching"),t.listenToOnce(App,"startall",function(){t.trigger("startwatching")})}).listenTo(App,"change:visible",function(e,i){var n=t.modules.update;i&&t.get("active")&&n&&(n.stopUpdate(),n.startUpdate(0))}),this.listenTo(App,"clearmap",function(i){i&&i==t._maps&&e.setItems([])}).listenTo(e,"needgeoinfo",function(e,i){t._maps&&t._maps.trigger("needgeoinfo",e,i)}),this.on("filtertree",function(e){t.modules.tree.set("q",e)}).on("needitemzoom",function(t){e.trigger("itemzoom",t)}),this.has("updatePeriod")&&this.on("change:active",function(e,i){var n=t.modules.update;i&&n&&(n.stopUpdate(),n.startUpdate(0))})},_collectWatchedItemIds:function(){var i=new t.Deferred,n=this.modules.watched,s=this.modules.tree;return t.when(n.getItemIdsForUpdate(),s.getItemIdsForUpdate()).done(function(t,n){i.resolve(e.unique(t.concat(n)))}),i}});return o}),define("abstracts/ObjectsTypeModule",["jquery","underscore","abstracts/BaseModule"],function(t,e,i){var n=i.prototype,s=i.extend({URL_SEARCH:App.getBaseUrl()+"objects/obj-search/",constructor:function(){this._modules=(this._modules||[]).concat(["itemcard"]),(App.allowed("objects.create")||App.allowed("objects.edit")||App.allowed("objectgroups.create")||App.allowed("objectgroups.edit"))&&this._modules.push("editor"),i.apply(this,arguments)},defaults:e.extend({},n.defaults,{objType:"",updatePeriod:7e3}),_prepareSearchParams:function(t){var e=n._prepareSearchParams.call(this,t);return e.objType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE,e},parseSuggestJSON:function(e){return t.map(e,function(t){var e="#"+t.extId+" "+t.name;return{label:e,value:t.name,original:t}})},_bindEvents:function(){var t=this,i=this.modules.watched;n._bindEvents.call(this),App.allowed("objects.create")&&this.on("itemedit",function(e){if(!(e&&e.id||!App.allowed("objects.create"))){if(!(e&&e.groupId||!t.modules.tree||t.modules.tree.groups.length||App.allowed("objectgroups.create"))){var i=t.getTexts();return alert(i.errAddGroupBefore,i.error)}e=e||{},e.objType="mobile"==t.get("objType")?App.TYPE_MOBILE:App.TYPE_STAT,App.trigger("devicecreate",e)}}),this.modules.editor&&this.on("groupedit",function(i,n){var s=t.GroupsClass;n=n||{},i?i instanceof s||e.isNumber(i)&&(i=null):i=new s({parentId:n.parentId||null}),i&&t.modules.editor.set("model",i)}).listenTo(this.modules.editor,"toggleform",function(e){t.modules.tree.setTop(e||0)}),App.hasModule("tracks")&&this.listenTo(i,"needtrack",function(t){App.trigger("needtrack",t)}),this.on("itemcardopen",function(e){t.modules.itemcard&&t.modules.itemcard.open(e)})},_getModuleOptions:function(t){return"itemcard"==t?{editable:App.allowed("objects.edit")||App.allowed("objects.create")}:"editor"==t?{mapsModule:this.modules.maps,container:this._view.getModuleContent()||null}:null}});return s}),define("abstracts/update/UpdateModule",["jquery","underscore","abstracts/Module"],function(t,e,i){"use starict";var n=i.extend({defaults:{updatePeriod:null,url:App.getBaseUrl()+"objects/obj/",idParam:"objectId",options:null},constructor:function(){this._xhr=null,this._updateTimeout=null,this._updateStat=[],this._avgUpdateTime=0,i.apply(this,arguments)},initialize:function(){this.has("options")&&this.set(this.get("options")),this.set("updatePeriod",this.get("parent").get("updatePeriod")||7e3),this._bindEvents(),this.startUpdate()},stopUpdate:function(){this._xhr&&this._xhr.abort()&&(this._xhr=null),this._updateTimeout&&clearTimeout(this._updateTimeout)},startUpdate:function(t){clearTimeout(this._updateTimeout),t="undefined"==typeof t?this.get("updatePeriod"):t,this._updateTimeout=setTimeout(e.bind(function(){App.get("visible")?this._update():this.startUpdate()},this),t)},getAvgUpdateTime:function(){return this.get("updatePeriod")+(this._avgUpdateTime||200)},_bindEvents:function(){var t=this.get("parent"),e=this;this.listenTo(t,"stopwatching",function(){e.stopUpdate(),this.listenToOnce(t,"startwatching",function(){e.startUpdate()})})},_update:function(){var t=this;this.getParent().getItemIdsForUpdate().done(function(e){t._requestData(e).done(function(e){e.length&&t.getParent().trigger("updateitems",e),t.startUpdate()}).fail(function(){App.trigger("serverlost")})}).fail(function(){t.startUpdate()})},_requestData:function(i){var n=new t.Deferred;if(i.length){var s=this,o=new Date,r=o.getTime(),a={};a[this.get("idParam")]=i;var l=this.get("url");e.isFunction(l)&&(l=l()),this._xhr=t.ajax({url:l,data:a,statusCode:{401:function(){s.getParent().trigger("401"),setTimeout(function(){App.trigger("logout")},50)}},success:function(t){s._updateStat.length>10&&s._updateStat.splice(0,1),s._updateStat.push((new Date).getTime()-r),s._calcAvgUpdateTime(),n.resolve(t)},error:function(t){n.reject(t)}})}else n.resolve([]);return n},_calcAvgUpdateTime:function(){var t=e.reduce(this._updateStat,function(t,e){return t+e},0);this._avgUpdateTime=t/this._updateStat.length}});return n}),define("abstracts/tree/views/TreeView",["jquery","underscore","jface","abstracts/View","jqueryui","text!_common/abstracts/tree/tmpl/settings.html","_libs/grids/SlickGrid-master/slick.grid"],function(t,e,i,n,s,o,r){o=e.template(o);var a=n.extend({constructor:function(){this.grid=null,this._contextMenu=null,n.apply(this,arguments)},initialize:function(t){var e=this;this.model.getEventsPrefix(),this.listenTo(this.model,"change:loading",function(t,i,n){e.toggleLoading(i),i||!n.success||n.hasItems||e._showNoData()}).listenTo(this.model,"change:active",function(t,i){e.$el[i?"addClass":"removeClass"]("active"),e.$el.closest(".tab-hor-content")[i?"addClass":"removeClass"]("active")}).listenTo(this.model,"alert",function(t,e){e?i.confirm(t,"",{okCallback:e}):alert(t)}),this.render(t)},render:function(){return this._buildSettingsMenu(),this._bindEvents(),this.$el},drawTree:function(){var i=this.model.dataView,n=this,s=this._getColumns(),o={enableCellNavigation:!0,asyncEditorLoading:!1,fullWidthRows:!0,forceFitColumns:!1};i.getItemMetadata=e.bind(function(t){var n=i.getItem(t),s=[];return"undefined"!=typeof n&&(s=this._getItemCSSClasses(n)),{cssClasses:e.uniq(s).join(" ")}},this),this.grid=new r.Grid(this.$el,i,s,o),this.grid.onClick.subscribe(e.bind(function(e,s){if(t(e.currentTarget).hasClass("grid-canvas")){var o=t(e.target),r=o.get(0).tagName.toLowerCase(),a="noaction",l=i.getItem(s.row);if(o.hasClass("toggle")?a="toggle":o.hasClass("icon-edit")?a="edit":"span"==r&&(a="title"),l)switch(a){case"edit":"0"!==l.id&&n.$el.contextmenu("open",e);break;case"toggle":l.closed=!l.closed;var h=n.model.get("propertyId");l.closed?this.model.trigger("group.collapse",l):this.model.trigger("group.expand",l),i.updateItem(l[h],l);break;case"title":this.model.trigger("action","item_show",l);break;default:this.model.trigger("toggleselect",l)}e.preventDefault()}},this)),this.grid.onMouseEnter.subscribe(e.bind(function(e){t(e.currentTarget).closest(".slick-row").addClass("hover")},!0)),this.grid.onScroll.subscribe(e.bind(function(){n._contextMenu&&n.$el.contextmenu("close")},!0)),this.grid.onMouseLeave.subscribe(e.bind(function(e){t(e.currentTarget).closest(".slick-row").removeClass("hover")},!0)),!this._contextMenu&&this._initContextMenu()},_getColumns:function(){return[{id:"name",name:"Name",field:"name",minWidth:10,maxWidth:2e3,width:300,cssClass:"cell-title",formatter:e.bind(this.titleFormatter,this)},{id:"nbItems",name:"",field:"nbItems",minWidth:50,width:70,maxWidth:70,cssClass:"cell-icon",formatter:e.bind(this.statusFormatter,this)}]},clear:function(){this.trigger("clear")},getVisibleItemsIds:function(){for(var e=this.$el.find("[data-grid-itemid]"),i=e.length,n=[];i--;)n.push(parseInt(t(e.get(i)).attr("data-grid-itemid")));return n},refreshGrid:function(){this.grid&&this.grid.invalidate()},toggleLoading:function(t){this.$el[t?"addClass":"removeClass"]("loading")},refresh:function(){this.grid&&this.grid.render()},remove:function(){this.stopListening(App),App.unsubscribe(this),n.prototype.remove.apply(this,arguments)},_buildSettingsMenu:function(){var t=this._getSortFields();if(e.keys(t).length){var i=this.model.getTexts();this.$el.closest(".tab-hor-content").find(".module-settings .dropdown-menu").append(o({objType:this.model.get("objType")||"",sortTypes:t,sortType:this.model.get("sortType")||"name",i18n:i}))}},_getSortFields:function(){},_bindEvents:function(){var e=this,i=this.model;this.$el.closest(".tab-hor-content").on("click",".module-settings [name^=sortBy]",function(i){e.model.set("sortType",t(i.target).val()),e.refreshGrid()}),this.listenTo(i,"change:expired",function(t,i){e.$el[i?"addClass":"removeClass"]("tree-expired loading")}),this.listenTo(App,"layoutchange",function(t){t&&e.grid&&e.grid.resizeCanvas()}).listenTo(App,"leftpaneresize",function(){e.grid&&e.grid.resizeCanvas()})},_getItemCSSClasses:function(t){var e=[];return t.isgroup&&e.push("group"),"undefined"!=typeof t.hwStatus&&e.push("status-"+t.hwStatus),1===t.checked&&e.push("selected"),e},_initContextMenu:function(){var i=this,n=null;this._contextMenu=t(this._buildContextMenu()).appendTo("body"),t.fn.contextmenu&&this._contextMenu.length&&this.$el.contextmenu({selector:".slick-row",menu:this._contextMenu,position:{my:"left top"},before:e.bind(function(s){var o=this.grid.getCellFromEvent(s.originalEvent),r="undefined"!=typeof o.row?o.row:null;n=this.grid.getData().getItem(r),this._contextAllowed(n)?(i._contextMenu.html(this._buildContextMenuItems(n)),i._contextMenu.off("click","").on("click","[data-action]",e.bind(function(e,i){var n=t(i.target).attr("data-action");this.model.trigger("action",n,e)},this,n))):s.preventDefault()},this)})},_contextAllowed:function(t){return t.id>0},_buildContextMenu:function(){return'<ul class="context-menu dropdown-menu nav nav-list" role="menu"></ul>'},_buildContextMenuItems:function(){return""},_getTitleTypes:function(){return{}},_showNoData:function(){this.$el.html('<p class="no-data">'+this.model.getTexts().emptyTreeMsg+"</p>")},titleFormatter:function(){return""},statusFormatter:function(){return""}});return a}),define("abstracts/tree/TreeModule",["jquery","underscore","abstracts/Module","util","abstracts/tree/views/TreeView","_libs/grids/SlickGrid-master/slick.dataview"],function(t,e,i,n,s,o){var r=0,a=1,l=2,h=i.extend({searchCollection:null,treeData:[],_hasTopGroup:!0,constructor:function(){this.dataView=null,this._updateXhr=null,this._updateTimeout=null,this._updateTsById={},this._expireTimeout=null,i.apply(this,arguments)},defaults:{container:null,parent:null,q:"",active:!1,loading:!1,propertyId:"uid",checkedOnly:!1,sortType:"name",sortParam:"sort",updating:!0,expired:!1,lastUpdateTs:0,hasItems:null},initialize:function(){this._bindEvents(),this.loadTree()},_sortCondition:function(){},_clearTree:function(){},loadTree:function(){var i={},n=new t.Deferred;return this.set({hasItems:null,loading:!0}),this._clearTree(),this.has("objType")&&(i.groupType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE),this.has("sortType")&&(i[this.get("sortParam")]=this.get("sortType")),this.fetch({data:i,success:e.bind(function(t,e){e.length&&this._initTree(),this.set({loading:!1,hasItems:e.length>0},{success:!0,hasItems:e.length>0}),n.resolve()},this),error:e.bind(function(e,i){try{var s=t.parseJSON(i.responseText);alert(s.msg,s.hdr)}catch(o){}this.set("loading",!1,{success:!1}),n.reject()},this)}),n},parse:function(t){var i=this.get("propertyId"),n=this._sortCondition();if(this._each(t,e.bind(function(t){n&&this.sort(t),this.treeData.push(this.prepareTreeObject.apply(this,arguments))},this)),this._hasTopGroup){var s={id:"0",name:this.getTopGroupName(),nbItems:this.items.length,indent:0,checked:r,isgroup:!0,parent:null,groups:[],items:[],closed:!1};s[i]="_0",e.each(this.treeData,function(t){0===t.indent&&(t.isgroup?s.groups.push(t.id+""):s.items.push(t.id+""),t.parent=s)}),this.treeData.unshift(s)}},sort:function(t){if(t.objs&&t.objs.length){var e="",i="";t.objs.sort(function(t,n){return e=App.buildObjTitle(t),i=App.buildObjTitle(n),e?e.localeCompare(i):void 0})}},prepareTreeObject:function(t,i,n,s,o){var a=this.get("propertyId");return t.indent=n,t.parent=s,t.checked="undefined"==typeof o?r:o,t.isgroup=i,i?(t.parentId=s&&s.id||null,t[a]=null==s?t.id.toString():s[a]+"_"+t.id,t.groups=c.itemsKeys(t[a],this.extractGroups(t)),t.items=c.itemsKeys(t[a],this.extractItems(t)),t.closed=-1==e.indexOf(this._openedGroups,t.id),this.groups.add(t)):(t[a]=null==s?"_"+t.id:s[a]+"_"+t.id,this.items.add(t,{parse:!0}),this._copyParams(this.items.get(t.id).attributes,t)),t},getSelectedItems:function(){return this.items.where({checked:a})},getSelectedItemsIds:function(){return this.getParent().getSelectedItemsIds()},isGroupData:function(t){return"undefined"!=typeof t.objs},extractGroups:function(t){return t.objsGroups},extractItems:function(t){return t.objs},getTreeGroupById:function(t){var i=e.filter(this.dataView.getItems(),function(e){return e.isgroup&&e.id==t});return i[0]||null},getTopGroupName:function(){return this.getTexts().allObjects},buildItemTitle:function(t){if(t.isgroup)return t.name;var e=App.buildObjTitle.apply(App,arguments);return e+=(e.length?" (":"")+"#"+t.extId+(e.length?")":"")},getItemIdsForUpdate:function(){var e,i=new t.Deferred,n=this.get("hasItems");if(!this.get("parent").get("active"))return this._setExpireTimeout(3e3),i.resolve([]);if(null!==n)e=this.getSelectedAndVisibleItemIds(),e.length||(this._clearExpireTimeout(),this.set({lastUpdateTs:+new Date,expired:!1})),i.resolve(e);else{var s=this;this.once("change:hasItems",function(){i.resolve(s.getSelectedAndVisibleItemIds())})}return i},getSelectedAndVisibleItemIds:function(){var t=[];return e.each(this.getSelectedItemsIds(),function(e){t.push(e)}),e.union(t,this._view.getVisibleItemsIds())},getTexts:function(){return this.get("parent").getTexts()},setTop:function(t){this._view.el.style.top=t+"px"},destroy:function(){this.stopListening(),App.unsubscribe(this)},_initTree:function(){this._createTree(),this._view.drawTree();var t;if((t=this.getSelectedItemsIds())&&(this._setObjectsCheckedStatus(t),this._view.refreshGrid()),!this.getUserData("notFirst")&&1==this.groups.length){this.setUserData("notFirst",!0);var e=this.groups.at(0),i=this.getTreeGroupById(e.id);e.set("closed",!1),i.closed=!1,this.trigger("group.expand",e),this.dataView.updateItem(i[this.get("propertyId")],i)}},_onToggleSelect:function(t){var i=this.getSelectedItems(),n=[],s=[],o=t.checked==r?a:r;if(t.isgroup){c.setGroupsCheckedStatus.call(this,t.id,o);var l=this.getSelectedItems();o?n=e.pluck(e.difference(l,i),"id"):s=e.pluck(e.difference(i,l),"id")}else this._setObjectsCheckedStatus(o?t.id:[],o?[]:t.id),o?n[0]=t.id:s[0]=t.id;this._view.refreshGrid(),this.getParent().trigger("toggleitems",n,s,this)},_bindEvents:function(){var t=this,i=this.get("parent");this.on("action",function(t,e){if("number"==typeof e){var i=this.items.get(e);if(!i)return;e=i.attributes}this._processAction(t,e)}).on("change:sortType",function(){t.setUserData("sortType",t.get("sortType")),t.loadTree()}).on("change:checkedOnly",function(){t.dataView.refresh()}).on("change:q",function(){t._onStartSearch()}).on("group.expand",function(n){n&&-1==e.indexOf(t._openedGroups,n.id)&&(t._openedGroups.push(n.id),t.setUserData("openedGroups",t._openedGroups),t.get("updating")&&App.get("visible")&&i.get("active")&&t._updateGroup(n))}).on("group.collapse",function(i){i&&(t._openedGroups=e.without(t._openedGroups,i.id),t.setUserData("openedGroups",t._openedGroups))}).on("toggleselect",function(e){t._onToggleSelect(e)}),this.listenTo(i,"toggleitems",e.bind(function(t,e,i){i!=this&&(this._setObjectsCheckedStatus(t,e),this._view.refreshGrid())},this)).listenTo(i,"groupadded",this.loadTree,this).listenTo(i,"itemchanged",this._onItemChange,this).listenTo(i,"groupchanged",this._onGroupChange,this).listenTo(i,"updateitems",this._updateItems),this.get("updating")&&this.listenTo(App,"change:visible",function(e,n){n||t._setExpireTimeout(i.get("updatePeriod"))}),App.subscribe("getallitemsingroup",e.bind(function(t,e){e(c.getAllItemOnGroup.call(this,t))},this)),this.listenTo(App,"objectsTitleChange",function(e){t._getTitleType()===e&&t.loadTree()})},_processAction:function(t,e){var i,n=this.getTexts(),s=this.get("parent");switch(t){case"group_report":i=c.getAllItemOnGroup.call(this,e.id),i.length?App.trigger("needreport",this.get("objType"),i):this.trigger("alert",n.alertCantbBuildReportWithEmpty);break;case"group_edit":s.trigger("groupedit",this.groups.get(e.id));break;case"group_add_object":var o=this.groups.get(e.id);s.trigger("itemedit",{groupId:o.id,groupName:o.get("name")});break;case"group_add_group":var o=this.groups.get(e.id);s.trigger("groupedit",null,{parentId:o.id});break;case"item_show":e.checked?s.trigger("needitemzoom",e.id):(s.setZoomItem(e.id),this.trigger("toggleselect",e,!0));break;case"obj_report":App.trigger("needreport",this.get("objType"),[this.items.get(e.id)]);break;case"obj_card":s.trigger("itemcardopen",this.items.get(e.id));break;case"obj_editpos":this.trigger("action","item_show",e),s.trigger("itemedit",this.items.get(e.id));break;case"obj_history":App.trigger("needdevicehistory",this.items.get(e.id))}},_getTitleType:function(){},_onStartSearch:function(){var t=this.get("q");if(t.length>=2){var i={q:t};this.has("objType")&&(i.objType="stat"==this.get("objType")?App.TYPE_STAT:App.TYPE_MOBILE),this.searchCollection.fetch({data:i,success:e.bind(function(){var t=this.get("propertyId"),i=[];this.searchCollection.each(e.bind(function(n){var s=n.get("id"),o=this._getObjectItemsByIDs(s);e.each(o,e.bind(function(e){i.push(e[t]);for(var n=e.parent;n;)i.push(n[t].toString()),n.closed&&(n.closed=!1,this.trigger("group.expand",n)),n=n.parent},this))},this)),this.searchResult=e.uniq(i),this.dataView.refresh()},this)})}else t.length=0,this.searchResult=[],this.dataView.refresh()},_copyParams:function(t,e){e.name=t.name},_onItemChange:function(){},_onGroupChange:function(t){var i=t.attributes,n=i.id,t=e.findWhere(this.dataView.getItems(),{isgroup:!0,id:n});t&&(t.name=i.name,t.nbItems=i.nbItems,this.groups.get(n).set({name:i.name,nbItems:i.nbItems}),this._view.refreshGrid())},_updateObjectModel:function(t){var e=this.items.get(t.id);return e&&e.set(t),e},_getObjectItemsByIDs:function(t){if(!this.dataView)return[];t=e.isArray(t)?t:[t];var i=[];return t.length>0&&e.isString(t[0])?e.each(t,function(t){i.push(parseInt(t.replace(/[\d]*_/g,"")))}):i=t,e.filter(this.dataView.getItems(),function(t){return!t.isgroup&&-1!=e.indexOf(i,t.id)})},_createTree:function(){var t=this,i=this.treeData,n=this.get("propertyId");this.dataView=new o.Data.DataView({idProperty:this.get("propertyId")}),this.dataView.beginUpdate(),this.dataView.setItems(i),this.dataView.setFilter(e.bind(function(t){if("0"===t.id)return!0;if(this.get("q").length>1&&-1==e.indexOf(this.searchResult,t[n]))return!1;if(this.get("checkedOnly")&&!t.checked)return!1;if(null!=t.parent)for(var i=t.parent;i;){if(i.closed)return!1;i=i.parent}return!0},this)),this.dataView.endUpdate(),this.dataView.onRowCountChanged.subscribe(function(){t._view.grid.updateRowCount(),t._view.grid.render()}),this.dataView.onRowsChanged.subscribe(function(e,i){t._view.grid.invalidateRows(i.rows),t._view.grid.render()}),this.get("updating")&&!App.get("visible")&&this._setExpireTimeout(this.get("parent").get("updatePeriod"))},_each:function(t,e,i,n){i="undefined"!=typeof i?i:0,n=0===i?null:n;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s],r=this.isGroupData(o);e(o,r,i,n),r&&(this._each(o.objsGroups,e,i+1,o),delete o.objsGroups,this._each(o.objs,e,i+1,o),delete o.objs)}},_setObjectsCheckedStatus:function(t,i){t=c.convertIdsToArray(t),i=c.convertIdsToArray(i);var n=this._getObjectItemsByIDs(t),s=this._getObjectItemsByIDs(i);e.each(n,e.bind(function(t){this.items.get(t.id).set("checked",a),t.checked=a},this)),e.each(s,e.bind(function(t){this.items.get(t.id).set("checked",r),t.checked=r},this));for(var o=c.getGroupListByObjItems.call(this,e.union(n,s)),l=o.length;l--;)e.each(o[l],e.bind(this._setGroupStatus,this));this._hasTopGroup&&c.setTopGroupStatus.call(this)},_setGroupStatus:function(t){var i=this.groups.get(t);if(i){var n=this.get("propertyId"),s=e.union(i.get("groups"),i.get("items")),o=this.dataView,r=[0,0,0];e.each(e.filter(o.getItems(),function(t){return-1!=e.indexOf(s,t[n])}),function(t){("undefined"==typeof t.nbItems||0!==t.nbItems)&&r[t.checked]++}),i.set("checked",c.defineChecked(r)),o.getItemById(i.get(n)).checked=i.get("checked")}},_updateGroup:function(t){var i=this.getVisibleItemIdsByGroupId(t.id);if(i.length){var n=e.indexBy(this.getSelectedItemsIds()),s=+new Date,o=this._updateTsById,r=this.get("parent").get("updatePeriod");if(i=e.filter(i,function(t){return!(t in n||t in o&&!(s-o[t]>r))}),i.length){var a=this;this._loadItemsData(i).done(function(t){a._updateItems(t)})}}},_loadItemsData:function(t){return App.getDevicesData(t)},_updateItems:function(t){if(t&&this.dataView){this._clearExpireTimeout();var i,n=e.indexBy(t,"id"),s=this.get("propertyId"),o=this,r=null,a=!1,l={},h=this._updateTsById,c=+new Date;e.each(this.dataView.getItems(),function(t){!t.isgroup&&t.id in n&&(r=n[t.id],o._copyParams(r,t),i=o._updateObjectModel(t),h[t.id]=c,i&&(a=e.keys(i.changed).length,(a||l[i.id])&&(o.dataView.updateItem(t[s],t),a&&(l[i.id]=a))))}),this.set({lastUpdateTs:+new Date,expired:!1})}},_clearExpireTimeout:function(){this._expireTimeout&&(clearTimeout(this._expireTimeout),this._expireTimeout=null)},_setExpireTimeout:function(t){if(!this.get("expired")&&!this._expireTimeout){var e=this;this._expireTimeout=setTimeout(function(){e.set("expired",!0)},t)}},getVisibleItemIdsByGroupId:function(t){var i=this.getTreeGroupById(t);if(!i||i.closed)return[];var n,s,o=[],r=this.get("propertyId"),a=i[r]+"_",l=i.groups,h=i.items;return l.length&&e.each(l,e.bind(function(t){n=parseInt(t.replace(a,"")),o=o.concat(this.getVisibleItemIdsByGroupId(n))},this)),h.length&&e.each(h,function(t){s=parseInt(t.replace(a,"")),o.push(s)}),o=e.uniq(o)}}),c={itemsKeys:function(t,e){var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(t+"_"+e[n].id);return i},getAllItemOnGroup:function(t){var i=[],n=this.getTreeGroupById(t);if(!n)return[];var s=this.get("propertyId"),o=n[s]+"_",r=n.groups,a=n.items;return r.length&&e.each(r,e.bind(function(t){var e=t.replace(o,"");i=i.concat(c.getAllItemOnGroup.call(this,e))},this)),a.length&&e.each(a,e.bind(function(t){var e=t.replace(o,"");i.push(this.items.get(e))},this)),i=e.uniq(i)},defineChecked:function(t){var e=!1;return e=t[l]?l:0==t[a]&&t[r]>0?r:t[a]>0&&0==t[r]||0==t[a]&&0==t[r]&&0==t[l]?a:l},getGroupListByObjItems:function(t){var i=[],n=[],s=this.get("propertyId");return e.each(t,e.bind(function(t){n=t[s].split("_"),n.pop(),e.each(n,e.bind(function(t,n){t=parseInt(t),i[n]="undefined"!=typeof i[n]?i[n]:[],-1==e.indexOf(i[n],t)&&i[n].push(t)},this))},this)),i},convertIdsToArray:function(t){return t=e.isArray(t)&&t.length>0&&e.isObject(t[0])?e.pluck(t,"id"):t?e.isNumber(t)?[t]:e.isString(t)?[parseInt(t)]:t:[]},setGroupsCheckedStatus:function(t,i){t=e.isNumber(t)?[t]:e.isString(t)?[parseInt(t)]:t;var n=[];e.each(t,e.bind(function(t){n=n.concat(c.getObjectItemsInGroup.call(this,t))},this)),this._setObjectsCheckedStatus(i?n:[],i?[]:n)},getObjectItemsInGroup:function(t){var i=[],n=this.dataView,s=0===t?n.getItemByIdx(0):this.groups.get(t).attributes;return s.nbItems&&(i=s.items,e.each(s.groups,e.bind(function(t){i=i.concat(c.getObjectItemsInGroup.call(this,parseInt(t.replace(/[\d]*_/g,""))))},this))),i},setTopGroupStatus:function(){if(this.dataView){var t=this.get("propertyId"),i=this.dataView,n=i.getItemByIdx(0),s=e.union(n.groups,n.items),o=[0,0,0];e.each(e.filter(i.getItems(),function(i){return-1!=e.indexOf(s,i[t])}),function(t){("undefined"==typeof t.nbItems||0!==t.nbItems)&&o[t.checked]++}),n.checked=c.defineChecked(o)}}};return h}),define("abstracts/watched/views/WatchedView",["jquery","jqueryui","underscore","abstracts/View"],function(t,e,i,n){var s=89,o=-89,r=180,a=-180,l=n.extend({constructor:function(){this._maps=null,this._clustersLayer=null,this._singlesLayer=null,this._infoView=null,this._popup=null,this._viewsMap={},this._avgUpdateTime=0,n.apply(this,arguments)},_useClusters:!0,initialize:function(){return this._maps=this.model.get("parent").getMapsModule(),this._maps?(this._bindEvents(),void 0):console&&console.error("WatchedView: No Maps module for objects watching")},reset:function(){this.clear(),this._onModuleReady()},clear:function(){this._clustersLayer&&this._clustersLayer.trigger("destroy"),this._singlesLayer&&this._singlesLayer.trigger("destroy"),this._viewsMap={},this.model.set("bounds",null)},addWatchedMulti:function(){},_stopListeningModel:function(t){this.stopListening(t)},removeWatchedMulti:function(t,e){for(var i=t.length;i--;)this._removeViewById(t[i]);"undefined"==typeof e&&(e=this.model.zoomOnRemove),this._calculateBounds(e)},ensureCoords:function(t){var e=t.get("lat"),i=t.get("lon");return e&&i?!0:(t.set({lat:0,lon:0}),!1)},getBounds:function(){return this._bounds},updateBounds:function(t,e){var i=t.get("lat"),n=t.get("lon");if(i&&n){var l=this._cloneCurrentBounds();if(e)l=this._extendBounds(l,i,n),this.model.set("bounds",l,{zoom:!0});else{var h=!1;i>o&&s>i&&(i>=l[1][0]||i<=l[0][0])&&(h=!0),n>a&&r>n&&(n>=l[1][1]||n<=l[0][1])&&(h=!0),h?this._calculateBounds(this.model.zoomOnRemove):this.model.zoomOnRemove&&this.model.trigger("change:bounds",this.model,l,{zoom:!0})}}},zoomToItem:function(t){var e;if(t&&(i.isNumber(t)||t.id)){var e,n;n=i.isNumber(t)?this.model.items.get(t):t,n&&(e=this._viewsMap[n.id])?e.trigger("zoomchange",{center:[n.get("lat"),n.get("lon")],zoom:15,cluster:this._clustersLayer}):t.lat&&t.lon&&this._maps.setBounds([[t.lat,t.lon],[t.lat,t.lon]],{maxZoom:15})}},_bindEvents:function(){var t=this,e=this.model,i=this.model.items;this.listenToOnce(this.model,"change:ready",this._onModuleReady),this.listenTo(e,"itemzoom",this.zoomToItem).listenTo(i,"add",this._bindModelEvents).listenTo(e,"addmulti",this.addWatchedMulti).listenTo(i,"remove",this._stopListeningModel).listenTo(e,"removemulti",this.removeWatchedMulti),e.get("updating")&&this.listenTo(i,"sync",function(){t._avgUpdateTime=e.get("parent").getAvgUpdateTime()})},_calculateBounds:function(t){var e=this,i=this._getNullBounds();this.model.items.each(function(t){var n=t.get("lat"),s=t.get("lon");n&&s&&(i=e._extendBounds(i,n,s))}),this.model.set("bounds",i,{zoom:t})},_extendBounds:function(t,e,i){return e>o&&s>e&&((e>t[1][0]||null===t[1][0])&&(t[1][0]=e),(e<t[0][0]||null===t[0][0])&&(t[0][0]=e)),i>a&&r>i&&((i>t[1][1]||null===t[1][1])&&(t[1][1]=i),(i<t[0][1]||null===t[0][1])&&(t[0][1]=i)),t},_getNullBounds:function(){return[[null,null],[null,null]]},_cloneCurrentBounds:function(){var t=this.model.get("bounds");return t=t&&t.length?[t[0].slice(0),t[1].slice(0)]:this._getNullBounds()},_onModuleReady:function(){var t=this.model.items;if(t.length){var e,i=this,n=[],s=[],o=this._getNullBounds();t.each(function(t){var r=t.get("lat"),a=t.get("lon");r&&a||t.set({lat:0,lon:0}),i._bindModelEvents(t),(e=i._buildMapElement(t))&&(t.get("hasAlarm")?s.push(e):n.push(e)),r&&a&&(o=i._extendBounds(o,r,a))}),t.length&&this.model.set("bounds",o,{zoom:!0}),this._createClustersLayer(n),this._createSinglesLayer(s)}},_checkLayersAndAddView:function(t){var e=this._useClusters?this._clustersLayer:this._singlesLayer;null===e?this[this._useClusters?"_createClustersLayer":"_createSinglesLayer"]([t]):e.addLayer(t)},_createClustersLayer:function(t){var e=this.model.get("objType")+"-"+this.model.get("objViewType");this._clustersLayer=this._maps.addLayersGroup({layers:t||[],groupCssClass:e,clusters:{icon:{html:"<div><span>#count#</span></div>",className:"marker-cluster-small "+this.model.get("objType")+"-cluster"}}})},_createSinglesLayer:function(t){var e="";this.model.has("objType")&&this.model.has("objViewType")&&(e=this.model.get("objType")+"-"+this.model.get("objViewType")),this._singlesLayer=this._maps.addLayersGroup({layers:t||[],groupCssClass:e,clusters:!1})},_buildMapElement:function(){return null},_buildMarkerHtml:function(t){return'<i class="i"></i><span class="name">'+i.escape(t.get("name"))+"</span>"},_bindModelEvents:function(t){var e=this,i=this.model;this.listenTo(t,"change:name",function(t){var n;(n=e._viewsMap[t.id])&&n.trigger("settitle",{title:i.buildItemTitle(t)})}).listenTo(t,"change:coords",function(t,i){if(e._viewsMap[t.id])e._placeOnMap(t),e.updateBounds(t,!1);else if(i[0]&&i[1]){var n;(n=e._buildMapElement(t))&&(e._checkLayersAndAddView(n,t),e._placeOnMap(t),e.updateBounds(t,!0))}}).listenTo(t,"change:hwStatus",function(t,i){var n;if(n=e._viewsMap[t.id]){var s=t.previous("hwStatus");n.trigger("toggleclass",{off:s,on:i})}})},_placeOnMap:function(t){if(t.has("lat")&&t.has("lon")){var e=this._viewsMap[t.id],i=t.get("lat"),n=t.get("lon"),s={model:t,to:{lat:i,lon:n},animate:!1};t.get("hasAlarm")||(s.cluster=this._clustersLayer),e.trigger("place",s)}},_afterViewsBuilt:function(t){var e=this.model.get("parent"),i=e.getZoomItem();this.model.set("bounds",t,{silent:!0}).trigger("change:bounds",this.model,t,{zoom:!i}),i&&(this.zoomToItem(i),e.setZoomItem(null))},_switchViewLayer:function(t,e){var i,n;(i=this._viewsMap[t.id])&&(e?this._clustersLayer.removeLayer(i):this._singlesLayer.removeLayer(i)),(n=this._buildMapElement(t))&&(e?this._singlesLayer?this._singlesLayer.addLayer(n):this._singlesLayer=this._createSinglesLayer([n]):this._clustersLayer?this._clustersLayer.addLayer(n):this._clustersLayer=this._createClustersLayer([n]))},_bindPopup:function(e,i){var n=this;this.model.get("objType"),e.bindPopup(function(){var s=t(this.getContainer());return n._popup=this,s.addClass("obj-info selectable").data("marker",e).on("contentchange",function(){n._popup._map&&n._popup._adjustPan()}),n._popup.on("open",function(){n._buildInfoView(i,s[0]),n._infoView&&n.listenToOnce(n._infoView,"close",function(){n._closePopup(),n.stopListening(n._infoView),n._infoView=null}).listenToOnce(i,"remove",function(){n._infoView&&n._infoView.trigger("close")})}).on("close",function(){n._infoView&&n._infoView.remove()}),'<div class="info-placeholder"></div>'},{autoPan:!0,autoPanPadding:[80,60]})},_closePopup:function(){this._popup&&(this._popup.close(),this._popup.off("open close"),this._popup=null)},_buildInfoView:function(){return null},_removeViewById:function(t){var e;(e=this._viewsMap[t])&&(this._useClusters?this._clustersLayer.removeLayer(e):this._singlesLayer.removeLayer(e),this._viewsMap[t]=null)}});return l}),define("abstracts/watched/WatchedModule",["jquery","underscore","abstracts/Module","abstracts/watched/views/WatchedView"],function(t,e,i){var n=i.extend({constructor:function(){this._xhr=null,this._updateTimeout=null,i.apply(this,arguments)},zoomOnRemove:!1,_viewClass:null,items:null,defaults:e.extend({},i.prototype.defaults,{bounds:null,showBaloon:!0,updating:!0}),initialize:function(){var t=this;this._view=new this._viewClass({model:this}),this._bindEvents(),this.startLongProcess(),this.loadItems().always(function(){t.stopLongProcess()})},loadItems:function(e){var i=new t.Deferred,n="undefined"==typeof e;if(n)if(e=this.getUserData("items")||[],e.length){var s=this;this.items.fetch(e,{silent:!0,statusCode:{401:function(){s.getParent().trigger("401"),setTimeout(function(){App.trigger("logout")},50)}}}).done(function(){s.set("ready",!0),i.resolve()}).fail(function(){i.reject()})}else this.set("ready",!0),i.resolve();else e.length?this.items.fetch(e,{silent:!0,merge:!0}).done(function(){i.resolve()}).fail(function(){i.reject()}):i.resolve();return i},setItems:function(t){if(e.isArray(t)||(t=[t]),1!=t.length||1!=this.items.length||t[0].id!=this.items.at(0).id){var i=e.pluck(t,"id"),n=this.getUserData("items")||[],s=e.difference(i,n),o=e.difference(n,i);o.length&&(this.items.remove(this.items.models,{multi:!0}),this.trigger("removemulti",o,!1)),this.items.set(t,{parse:!0,silent:!0}),this.setUserData("items",this.items.pluck("id")),s.length&&this.trigger("addmulti",s),this.get("parent").trigger("toggleitems",s,o,this)
}},toggleItem:function(t){var i=this.get("parent"),n=e.isNumber(t)?t:t.id;if(this.items.get(n))this.items.remove(n),i.trigger("toggleitems",[],[n],this);else if(!e.isNumber(t)){var s=t.clone();this.items.add(s,{zoom:!0}),i.trigger("toggleitems",[t.id],[],this)}this.setUserData("items",this.items.pluck("id"))},toggleItems:function(t,e,i){var n,s=this.items;if(i!=this){if(e.length){for(n=e.length;n--;)s.remove(e[n],{multi:!0});this.setUserData("items",s.pluck("id")),this.trigger("removemulti",e)}if(t.length){var o=this;this.startLongProcess(),this.loadItems(t).done(function(){o.setUserData("items",s.pluck("id")),o.trigger("addmulti",t)}).always(function(){o.stopLongProcess()})}}},updateItems:function(t){for(var e,i=t.length,n=this.items;i--;)e=n.get(t[i].id),e&&e.set(e.parse(t[i]))},getTexts:function(){return this.get("parent").getTexts()},getBounds:function(){return this.items.length?this.get("bounds"):null},buildItemTitle:function(t){var e=App.buildObjTitle.apply(App,arguments);return e.length||(e=t.has("extId")?"#"+t.get("extId"):t.get("name")),e},_bindEvents:function(){var t=this,e=this.get("parent");this.on("change:objViewType",function(){t.setUserData("objViewType",t.get("objViewType"))}).on("change:bounds",function(t,i,n){e.trigger("change:bounds",e,i,n)}),this.listenTo(e,"toggleitems",this.toggleItems).listenTo(e,"itemchanged",this._onItemChanged).listenTo(e,"updateitems",this.updateItems).listenTo(e,"401",function(){t.setUserData("items",null)})},getWatchedItemsIds:function(){var t=this.getUserData("items");return t||[]},getItemIdsForUpdate:function(){return(new t.Deferred).resolve(this.getWatchedItemsIds())},_onItemChanged:function(t){for(var e,i=t.length;i--;)if(t[i].id&&(e=this.items.get(t[i].id)))for(var n in t[i])"undefined"!=typeof e.attributes[n]&&e.get(n)!=t[i][n]&&e.set(n,t[i][n])},_setItemsFromGET:function(){var t=App.getRouter().getGETParams();if(t.objectId){var e=t.objectId.split(":"),i=e.length;if(i){for(;i--;)e[i]=parseInt(e[i]);this.setUserData("items",e)}}}});return n}),define("abstracts/watched/views/ObjectsWatchedView",["jquery","underscore","./WatchedView"],function(t,e,i){var n=i.prototype,s=i.extend({constructor:function(){i.apply(this,arguments)},isIconsView:function(){return"icons"==this.model.get("objViewType")},addWatchedMulti:function(t){if(t&&t.length){for(var e,i,n=t.length,s=this.model.items,o=[],r=[],a=this._cloneCurrentBounds();n--;)if(i=s.get(t[n])){var l=this.ensureCoords(i);this._bindModelEvents(i),(e=this._buildMapElement(i))&&(i.get("hasAlarm")?r.push(e):o.push(e)),l&&(a=this._extendBounds(a,i.get("lat"),i.get("lon")))}this._afterViewsBuilt(a),this._addViewsToMap(r,o)}},_addViewsToMap:function(t,e){e.length&&(null===this._clustersLayer?this._createClustersLayer(e):this._clustersLayer.addLayers(e)),t.length&&(null===this._singlesLayer?this._createSinglesLayer(t):this._singlesLayer.addLayers(t))},_bindEvents:function(){var t=this;n._bindEvents.apply(this,arguments),this.listenTo(this.model,"change:objViewType",function(e,i){var n=t.model.get("objType"),s=n+"-",o=s+t.model.previous("objViewType");t._clustersLayer&&t._clustersLayer.trigger("toggleclass",{name:s+i+" "+o}),t.reset()})},_bindModelEvents:function(t){var e=this;this.model,n._bindModelEvents.call(this,t),this.listenTo(t,"change:status",function(t,i){var n;if(n=e._viewsMap[t.id]){var s=t.previous("status");n.trigger("toggleclass",{off:s,on:i})}}).listenTo(t,"change:imgPath",function(t){var i;e.isIconsView()&&(i=e._viewsMap[t.id])&&i.trigger("iconchange",{html:'<i class="i" style="background-image:url('+t.getImgPath(!0)+');"></i>'+'<span class="name">'+t.get("name")+"</span>"})}).listenTo(t,"change:hasAlarm",function(t,i){var n;(n=e._viewsMap[t.id])&&n.trigger("toggleclass",{on:"alarm"}),t.get("isFollowed")||e._switchViewLayer(t,i)})},_buildMapElement:function(t){if(t.get("lat")&&t.get("lon")){var e=this.model.get("objType"),i=" obj-"+e+" "+t.get("status");t.get("hasAlarm")&&(i+=" alarm"),t.has("hwStatus")&&(i+=" "+t.get("hwStatus"));var n=this._buildMarkerHtml(t),s=this._viewsMap[t.id]=this._maps.getWidget().buildComplexMarker({lat:t.get("lat"),lon:t.get("lon"),html:n,className:"complex-icon obj"+i,dataId:t.id,animated:!1,model:t});return this.model.get("showBaloon")&&this._bindPopup(s,t),s}},_buildMarkerHtml:function(t){var e="";return this.isIconsView()&&(e=' style="background-image:url('+t.getImgPath(!0)+');"'),'<i class="i"'+e+'></i><span class="name">'+this.model.buildItemTitle(t)+"</span>"},_checkLayersAndAddView:function(t,e){var i=e.get("hasAlarm")||e.get("isFollowed");i?null===this._singlesLayer?this._createSinglesLayer([t]):this._singlesLayer.addLayer(t):null===this._clustersLayer?this._createClustersLayer([t]):this._clustersLayer.addLayer(t)}});return s}),define("abstracts/watched/ObjectsWatchedModule",["jquery","underscore","./WatchedModule","./views/ObjectsWatchedView"],function(t,e,i){var n=i.prototype,s=i.extend({constructor:function(){i.apply(this,arguments)},loadItems:function(t){var e=this,i="undefined"==typeof t;return n.loadItems.apply(this,arguments).done(function(){i&&!e.items.length&&e.trigger("change:bounds",e,null)})}});return s}),define("abstracts/itemcard/CardModel",["underscore","jquery","abstracts/Model","abstracts/GrObject"],function(t,e,i,n){var s=i.extend({constructor:function(){this._object=null,this._newImage=null,i.apply(this,arguments)},defaults:{canSetup:0,item:null,settings:null,objsGroups:[],objStatus:n.STATUS_NOTSERVED,tech:null},setObject:function(t){this._object||(this._object=t)},getImgDir:function(){return this._object.IMG_DIR},getImgExt:function(){return this._object.IMG_EXT},getImagePath:function(){return this.getImgDir()+(this.get("settings").IMAGE_PATH||this._object.defaults.imgPath)+this.getImgExt()},setNewImage:function(t){this._newImage=t,this.trigger("imagechange",{img:t})},getNewImage:function(){return this._newImage},loadStatus:function(){var i=this,n=new e.Deferred;return this._object.loadStatus().done(function(e){i.set("objStatus",e.objStatus),e.objStatus==i._object.STATUS_SERVICE?i._object.getStaff().done(function(e){var s=t.findWhere(e,{positionCode:App.POSITION_CODE_TECH});s&&i.set("tech",s),n.resolve()}).fail(function(){n.reject()}):n.resolve()}).fail(function(){n.reject()}),n},saveStatus:function(t){return this._object.saveStatus(t)},update:function(){},clearDataHistory:function(){return(new e.Deferred).reject("abstract method can not be used")}});return s}),define("jcolorbox",["jquery"],function(t){!function(t,e,i){function n(i,n,s){var o=e.createElement(i);return n&&(o.id=Q+n),s&&(o.style.cssText=s),t(o)}function s(){return i.innerHeight?i.innerHeight:t(i).height()}function o(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==J[e]&&(this.cache[e]=J[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function r(t){var e=M.length,i=(H+t)%e;return 0>i?e+i:i}function a(t,e){return Math.round((/%/.test(t)?("x"===e?A.width():s())/100:1)*parseInt(t,10))}function l(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function h(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function c(t){"contains"in y[0]&&!y[0].contains(t.target)&&t.target!==_[0]&&(t.stopPropagation(),y.focus())}function u(t){u.str!==t&&(y.add(_).removeClass(u.str).addClass(t),u.str=t)}function d(e){H=0,e&&e!==!1&&"nofollow"!==e?(M=t("."+te).filter(function(){var i=t.data(this,K),n=new o(this,i);return n.get("rel")===e}),H=M.index(N.el),-1===H&&(M=M.add(N.el),H=M.length-1)):M=t(N.el)}function p(i){t(e).trigger(i),ae.triggerHandler(i)}function f(i){var s;if(!q){if(s=t(i).data(K),N=new o(i,s),d(N.get("rel")),!W){W=G=!0,u(N.get("className")),y.css({visibility:"hidden",display:"block",opacity:""}),D=n(le,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),w.css({width:"",height:""}).append(D),B=x.height()+T.height()+w.outerHeight(!0)-w.height(),z=S.width()+C.width()+w.outerWidth(!0)-w.width(),U=D.outerHeight(!0),V=D.outerWidth(!0);var r=a(N.get("initialWidth"),"x"),l=a(N.get("initialHeight"),"y"),h=N.get("maxWidth"),f=N.get("maxHeight");N.w=(h!==!1?Math.min(r,a(h,"x")):r)-V-z,N.h=(f!==!1?Math.min(l,a(f,"y")):l)-U-B,D.css({width:"",height:N.h}),Y.position(),p(ee),N.get("onOpen"),F.add(P).hide(),y.focus(),N.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",c,!0),ae.one(oe,function(){e.removeEventListener("focus",c,!0)})),N.get("returnFocus")&&ae.one(oe,function(){t(N.el).focus()})}var m=parseFloat(N.get("opacity"));_.css({opacity:m===m?m:"",cursor:N.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),N.get("closeButton")?j.html(N.get("close")).appendTo(w):j.appendTo("<div/>"),v()}}function m(){y||(X=!1,A=t(i),y=n(le).attr({id:K,"class":t.support.opacity===!1?Q+"IE":"",role:"dialog",tabindex:"-1"}).hide(),_=n(le,"Overlay").hide(),k=t([n(le,"LoadingOverlay")[0],n(le,"LoadingGraphic")[0]]),b=n(le,"Wrapper"),w=n(le,"Content").append(P=n(le,"Title"),I=n(le,"Current"),O=t('<button type="button"/>').attr({id:Q+"Previous"}),E=t('<button type="button"/>').attr({id:Q+"Next"}),R=n("button","Slideshow"),k),j=t('<button type="button"/>').attr({id:Q+"Close"}),b.append(n(le).append(n(le,"TopLeft"),x=n(le,"TopCenter"),n(le,"TopRight")),n(le,!1,"clear:left").append(S=n(le,"MiddleLeft"),w,C=n(le,"MiddleRight")),n(le,!1,"clear:left").append(n(le,"BottomLeft"),T=n(le,"BottomCenter"),n(le,"BottomRight"))).find("div div").css({"float":"left"}),L=n(le,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),F=E.add(O).add(I).add(R)),e.body&&!y.parent().length&&t(e.body).append(_,y.append(b,L))}function g(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),f(this))}return y?(X||(X=!0,E.click(function(){Y.next()}),O.click(function(){Y.prev()}),j.click(function(){Y.close()}),_.click(function(){N.get("overlayClose")&&Y.close()}),t(e).bind("keydown."+Q,function(t){var e=t.keyCode;W&&N.get("escKey")&&27===e&&(t.preventDefault(),Y.close()),W&&N.get("arrowKey")&&M[1]&&!t.altKey&&(37===e?(t.preventDefault(),O.click()):39===e&&(t.preventDefault(),E.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Q,"."+te,i):t("."+te).live("click."+Q,i)),!0):!1}function v(){var e,s,o,r=Y.prep,c=++he;if(G=!0,$=!1,p(re),p(ie),N.get("onLoad"),N.h=N.get("height")?a(N.get("height"),"y")-U-B:N.get("innerHeight")&&a(N.get("innerHeight"),"y"),N.w=N.get("width")?a(N.get("width"),"x")-V-z:N.get("innerWidth")&&a(N.get("innerWidth"),"x"),N.mw=N.w,N.mh=N.h,N.get("maxWidth")&&(N.mw=a(N.get("maxWidth"),"x")-V-z,N.mw=N.w&&N.w<N.mw?N.w:N.mw),N.get("maxHeight")&&(N.mh=a(N.get("maxHeight"),"y")-U-B,N.mh=N.h&&N.h<N.mh?N.h:N.mh),e=N.get("href"),Z=setTimeout(function(){k.show()},100),N.get("inline")){var u=t(e);o=t("<div>").hide().insertBefore(u),ae.one(re,function(){o.replaceWith(u)}),r(u)}else N.get("iframe")?r(" "):N.get("html")?r(N.get("html")):l(N,e)?(e=h(N,e),$=new Image,t($).addClass(Q+"Photo").bind("error",function(){r(n(le,"Error").html(N.get("imgError")))}).one("load",function(){c===he&&setTimeout(function(){var e;t.each(["alt","longdesc","aria-describedby"],function(e,i){var n=t(N.el).attr(i)||t(N.el).attr("data-"+i);n&&$.setAttribute(i,n)}),N.get("retinaImage")&&i.devicePixelRatio>1&&($.height=$.height/i.devicePixelRatio,$.width=$.width/i.devicePixelRatio),N.get("scalePhotos")&&(s=function(){$.height-=$.height*e,$.width-=$.width*e},N.mw&&$.width>N.mw&&(e=($.width-N.mw)/$.width,s()),N.mh&&$.height>N.mh&&(e=($.height-N.mh)/$.height,s())),N.h&&($.style.marginTop=Math.max(N.mh-$.height,0)/2+"px"),M[1]&&(N.get("loop")||M[H+1])&&($.style.cursor="pointer",$.onclick=function(){Y.next()}),$.style.width=$.width+"px",$.style.height=$.height+"px",r($)},1)}),$.src=e):e&&L.load(e,N.get("data"),function(e,i){c===he&&r("error"===i?n(le,"Error").html(N.get("xhrError")):t(this).contents())})}var _,y,b,w,x,S,C,T,M,A,D,L,k,P,I,R,E,O,j,F,N,B,z,U,V,H,$,W,G,q,Z,Y,X,J={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title}},K="colorbox",Q="cbox",te=Q+"Element",ee=Q+"_open",ie=Q+"_load",ne=Q+"_complete",se=Q+"_cleanup",oe=Q+"_closed",re=Q+"_purge",ae=t("<a/>"),le="div",he=0,ce={},ue=function(){function t(){clearTimeout(r)}function e(){(N.get("loop")||M[H+1])&&(t(),r=setTimeout(Y.next,N.get("slideshowSpeed")))}function i(){R.html(N.get("slideshowStop")).unbind(l).one(l,n),ae.bind(ne,e).bind(ie,t),y.removeClass(a+"off").addClass(a+"on")}function n(){t(),ae.unbind(ne,e).unbind(ie,t),R.html(N.get("slideshowStart")).unbind(l).one(l,function(){Y.next(),i()}),y.removeClass(a+"on").addClass(a+"off")}function s(){o=!1,R.hide(),t(),ae.unbind(ne,e).unbind(ie,t),y.removeClass(a+"off "+a+"on")}var o,r,a=Q+"Slideshow_",l="click."+Q;return function(){o?N.get("slideshow")||(ae.unbind(se,s),s()):N.get("slideshow")&&M[1]&&(o=!0,ae.one(se,s),N.get("slideshowAuto")?i():n(),R.show())}}();t[K]||(t(m),Y=t.fn[K]=t[K]=function(e,i){var n,s=this;if(e=e||{},t.isFunction(s))s=t("<a/>"),e.open=!0;else if(!s[0])return s;return s[0]?(m(),g()&&(i&&(e.onComplete=i),s.each(function(){var i=t.data(this,K)||{};t.data(this,K,t.extend(i,e))}).addClass(te),n=new o(s[0],e),n.get("open")&&f(s[0])),s):s},Y.position=function(e,i){function n(){x[0].style.width=T[0].style.width=w[0].style.width=parseInt(y[0].style.width,10)-z+"px",w[0].style.height=S[0].style.height=C[0].style.height=parseInt(y[0].style.height,10)-B+"px"}var o,r,l,h=0,c=0,u=y.offset();if(A.unbind("resize."+Q),y.css({top:-9e4,left:-9e4}),r=A.scrollTop(),l=A.scrollLeft(),N.get("fixed")?(u.top-=r,u.left-=l,y.css({position:"fixed"})):(h=r,c=l,y.css({position:"absolute"})),c+=N.get("right")!==!1?Math.max(A.width()-N.w-V-z-a(N.get("right"),"x"),0):N.get("left")!==!1?a(N.get("left"),"x"):Math.round(Math.max(A.width()-N.w-V-z,0)/2),h+=N.get("bottom")!==!1?Math.max(s()-N.h-U-B-a(N.get("bottom"),"y"),0):N.get("top")!==!1?a(N.get("top"),"y"):Math.round(Math.max(s()-N.h-U-B,0)/2),y.css({top:u.top,left:u.left,visibility:"visible"}),b[0].style.width=b[0].style.height="9999px",o={width:N.w+V+z,height:N.h+U+B,top:h,left:c},e){var d=0;t.each(o,function(t){return o[t]!==ce[t]?(d=e,void 0):void 0}),e=d}ce=o,e||y.css(o),y.dequeue().animate(o,{duration:e||0,complete:function(){n(),G=!1,b[0].style.width=N.w+V+z+"px",b[0].style.height=N.h+U+B+"px",N.get("reposition")&&setTimeout(function(){A.bind("resize."+Q,Y.position)},1),t.isFunction(i)&&i()},step:n})},Y.resize=function(t){var e;W&&(t=t||{},t.width&&(N.w=a(t.width,"x")-V-z),t.innerWidth&&(N.w=a(t.innerWidth,"x")),D.css({width:N.w}),t.height&&(N.h=a(t.height,"y")-U-B),t.innerHeight&&(N.h=a(t.innerHeight,"y")),t.innerHeight||t.height||(e=D.scrollTop(),D.css({height:"auto"}),N.h=D.height()),D.css({height:N.h}),e&&D.scrollTop(e),Y.position("none"===N.get("transition")?0:N.get("speed")))},Y.prep=function(i){function s(){return N.w=N.w||D.width(),N.w=N.mw&&N.mw<N.w?N.mw:N.w,N.w}function a(){return N.h=N.h||D.height(),N.h=N.mh&&N.mh<N.h?N.mh:N.h,N.h}if(W){var c,d="none"===N.get("transition")?0:N.get("speed");D.remove(),D=n(le,"LoadedContent").append(i),D.hide().appendTo(L.show()).css({width:s(),overflow:N.get("scrolling")?"auto":"hidden"}).css({height:a()}).prependTo(w),L.hide(),t($).css({"float":"none"}),u(N.get("className")),c=function(){function i(){t.support.opacity===!1&&y[0].style.removeAttribute("filter")}var n,s,a=M.length;W&&(s=function(){clearTimeout(Z),k.hide(),p(ne),N.get("onComplete")},P.html(N.get("title")).show(),D.show(),a>1?("string"==typeof N.get("current")&&I.html(N.get("current").replace("{current}",H+1).replace("{total}",a)).show(),E[N.get("loop")||a-1>H?"show":"hide"]().html(N.get("next")),O[N.get("loop")||H?"show":"hide"]().html(N.get("previous")),ue(),N.get("preloading")&&t.each([r(-1),r(1)],function(){var i,n=M[this],s=new o(n,t.data(n,K)),r=s.get("href");r&&l(s,r)&&(r=h(s,r),i=e.createElement("img"),i.src=r)})):F.hide(),N.get("iframe")?(n=e.createElement("iframe"),"frameBorder"in n&&(n.frameBorder=0),"allowTransparency"in n&&(n.allowTransparency="true"),N.get("scrolling")||(n.scrolling="no"),t(n).attr({src:N.get("href"),name:(new Date).getTime(),"class":Q+"Iframe",allowFullScreen:!0}).one("load",s).appendTo(D),ae.one(re,function(){n.src="//about:blank"}),N.get("fastIframe")&&t(n).trigger("load")):s(),"fade"===N.get("transition")?y.fadeTo(d,1,i):i())},"fade"===N.get("transition")?y.fadeTo(d,0,function(){Y.position(0,c)}):Y.position(d,c)}},Y.next=function(){!G&&M[1]&&(N.get("loop")||M[H+1])&&(H=r(1),f(M[H]))},Y.prev=function(){!G&&M[1]&&(N.get("loop")||H)&&(H=r(-1),f(M[H]))},Y.close=function(){W&&!q&&(q=!0,W=!1,p(se),N.get("onCleanup"),A.unbind("."+Q),_.fadeTo(N.get("fadeOut")||0,0),y.stop().fadeTo(N.get("fadeOut")||0,0,function(){y.hide(),_.hide(),p(re),D.remove(),setTimeout(function(){q=!1,p(oe),N.get("onClosed")},1)}))},Y.remove=function(){y&&(y.stop(),t[K].close(),y.stop(!1,!0).remove(),_.remove(),q=!1,y=null,t("."+te).removeData(K).removeClass(te),t(e).unbind("click."+Q).unbind("keydown."+Q))},Y.element=function(){return t(N.el)},Y.settings=J)}(t,document,window)}),define("_common/pictures/views/PicturesView",["jquery","underscore","abstracts/View","text!_common/pictures/tmpl/pictures.html","jcolorbox","css!_libs/colorbox/colorbox.css","css!_common/pictures/css/pictures.css"],function(t,e,i,n){function s(){t(this).data("loaded",!0).parent().removeClass("loading")}n=e.template(n);var o=i.extend({constructor:function(){this._pictures=null,this._carouselContent=null,this._bullets=null,this._controls=null,this._caption=null,this._captionText=null,this._captionForm=null,this._captionInput=null,this._noData=null,i.apply(this,arguments)},initialize:function(){var t=this;this.render(),r.bindEvents.call(this),this.model.loadList().done(function(e){t.$el.removeClass("loading"),r.buildCarousel.call(t),e.length&&r.displayPicture.call(t,t.model.getList()[0],!0)})},render:function(){this.$el.addClass("loading").html(n(e.extend({},this.model.attributes,{emptyMsg:this.model.getTexts().noPictures}))),this._pictures=this.$el.find(".pictures"),this._carouselContent=this.$el.find(".carousel-inner"),this._bullets=this.$el.find(".carousel-bullets"),this._noData=this.$el.find(".no-data"),this._controls=this.$el.find(".carousel-control"),this._caption=this.$el.find(".caption"),this._captionText=this._caption.find("span"),this.model.get("editCaption")&&(this._captionForm=this.$el.find(".caption-form"),this._captionInput=this._captionForm.find("input"))}}),r={bindEvents:function(){var i=this;this.$el.on("click",".carousel-bullets li",function(){i.model.set("current",t(this).data("index"))}).on("click",".carousel-control",function(){var t=-1!=this.className.indexOf("left")?-1:1;r.stepBy.call(i,t)}).on("click","img",function(){var n=i.model.getList()[t(this).parent().data("index")];t.colorbox({html:'<img src="'+this.src+'">',title:e.escape(n.caption),maxWidth:.9*window.innerWidth,maxHeight:.9*window.innerHeight})});var n="";"onwheel"in document?n="wheel":"onmousewheel"in document&&(n="mousewheel"),n&&this.$el.find(".carousel-inner").on(n,function(t){var e=r.getWheelDelta(t.originalEvent);r.stepBy.call(i,e>0?-1:1)}),this.model.get("editCaption")&&(i._captionText.on("click",function(){var t=i._captionText.text();i._caption.addClass("hidden"),i._captionForm.removeClass("hidden"),t!=i.model.getTexts().noCaption?i._captionInput.val(t):i._captionInput.val(""),i._captionInput.focus()}),this._captionInput.on("keypress",function(t){return t.stopPropagation(),13==t.keyCode||10==t.keyCode?(r.saveCaption.call(i),!1):void 0}).on("keyup",function(t){t.stopPropagation(),27==t.keyCode&&r.cancelEditCaption.call(i)}),i._captionForm.on("click",".cancel-caption",function(){r.cancelEditCaption.call(i)}).on("click",".save-caption",function(){r.saveCaption.call(i)})),this.listenTo(this.model,"change:current",function(t,e){r.displayPicture.call(i,i.model.getList()[e],e>t.previous("current"))}).listenTo(this.model,"pictureadded",function(e){var n=i.model.getList().length;1==n&&r.showCarousel.call(i);var o=t(r.getCarouselItem(e,n-1)).appendTo(i._carouselContent);i._bullets.append(r.getBullet(e,n-1)),o.find("img").one("load",s)}).listenTo(this.model,"picturedeleted",function(e,n){i.model.getList().length||r.hideCarousel.call(i);var s=i.$el.find("[data-index]");s.each(function(){var e=t(this),i=e.data("index");i>n&&e.data("index",i-1).attr("data-index",i-1)}),i.$el.find("[data-id="+e+"]").remove()})},stepBy:function(t){var e=this.model.get("current"),i=this.model.getList().length-1,n=e+t;this.model.set("current",Math.max(0,Math.min(i,n)))},buildCarousel:function(){var t=this.model.getList();if(t.length){var i="",n="",o=0;e.each(t,function(t){n+=r.getBullet(t,o),i+=r.getCarouselItem(t,o),o++}),this._bullets.html(n),this._carouselContent.html(i),this._controls.removeClass("hidden"),this.$el.find("img").one("load",s)}else r.hideCarousel.call(this)},showCarousel:function(){this._pictures.removeClass("hidden"),this._controls.removeClass("hidden"),this._noData.addClass("hidden")},hideCarousel:function(){this._pictures.addClass("hidden"),this._controls.addClass("hidden"),this._noData.removeClass("hidden")},getBullet:function(t,e){return'<li data-index="'+e+'" data-id="'+t.id+'"></li>'},getCarouselItem:function(t,e){return'<div data-index="'+e+'" data-id="'+t.id+'" class="item">'+'<img src="#" alt="" />'+"</div>"},displayPicture:function(t,i){var n=this,s=t.id,o=this.model.get("current"),a=this.$el.find(".carousel-inner"),l=a.find(".item[data-id="+s+"]"),h=-1!=l[0].className.indexOf("deleted"),c=a.find(".active"),u=this.$el.find(".carousel-control.left").removeClass("disabled"),d=this.$el.find(".carousel-control.right").removeClass("disabled");0==o&&u.addClass("disabled"),o==this.model.getList().length-1&&d.addClass("disabled"),c.length&&(l.addClass(i?"next":"prev"),c.addClass(i?"prev":"next")),setTimeout(function(){if(c.removeClass("active"),l.removeClass("prev next").addClass("active"),n.$el.find(".carousel-bullets .active").removeClass("active").end().find('.carousel-bullets [data-index="'+o+'"]').addClass("active"),!h){l.addClass("loading");var i=n.model.getTexts().noCaption,a=l.find("img");r.cancelEditCaption.call(n),n._captionText.text(e.escape(t.caption||i)),n.model.loadPicture(s).done(function(e){a[0].src="data:"+t.mimeType+";base64,"+e,a.data("loaded")&&l.removeClass("loading"),setTimeout(function(){c.removeClass("prev next")},500)}).fail(function(t){l.removeClass("loading"),(401==t||"Unauthorized"==t)&&l.addClass("deleted").html(n.model.getTexts().pictureHadBeenDeleted)})}},10)},saveCaption:function(){var i=this,n=this.model.getTexts();this.$el.addClass("loading");var s=e.escape(t.trim(i._captionInput.val()));this.model.saveCaption(s).done(function(){i._captionText.text(s||n.noCaption),r.cancelEditCaption.call(i)}).fail(function(){alert(n.canNotSave,n.error)}).always(function(){i.$el.removeClass("loading")})},cancelEditCaption:function(){this._captionForm&&-1==this._captionForm[0].className.indexOf("hidden")&&(this._captionForm.addClass("hidden"),this._caption.removeClass("hidden"))},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e}};return o}),define("_common/pictures/PicturesModule",["underscore","jquery","abstracts/Module","_common/pictures/views/PicturesView","i18n!_common/nls/common"],function(t,e,i,n,s){var o=i.extend({constructor:function(){this._list=null,this._loaded={},i.apply(this,arguments)},defaults:{container:null,objectId:0,current:0,editCaption:!1},initialize:function(){this._view=new n({el:this.get("container"),model:this})},getTexts:function(){return s},getList:function(){return this._list},loadList:function(){if(null==this._list){var t=this;return e.ajax({url:App.getBaseUrl()+"pictures/find-for-object/",data:{objectId:this.get("objectId")},success:function(e){t._list=e}})}return(new e.Deferred).resolve(this._list)},loadPicture:function(i){var n=this,s=new e.Deferred;if("undefined"==typeof this._loaded[i]){var o=t.findWhere(this._list,{id:i});e.ajax({url:App.getBaseUrl()+"pictures/data/?pictureId="+i,dataType:"text",contentType:o.mimeType,data:{pictureId:o.id},processData:!0,mimeType:o.mimeType,statusCode:{401:function(){delete n._loaded[i]}},success:function(t){n._loaded[i]=t,s.resolve(t)},error:function(t){s.reject(t.statusText)}})}else s.resolve(n._loaded[i]);return s},addPicture:function(t){this._list.push(t),this.trigger("pictureadded",t),this.set("current",this._list.length-1)},deletePicture:function(i){var n=this,s=t.findWhere(this._list,{id:i});if(s){var o=t.indexOf(this._list,s),r=this.get("current");e.ajax({url:App.getBaseUrl()+"pictures/delete/",data:[i],complete:function(t){t.status>=200&&t.status<300&&(i in n._loaded&&(n._loaded[i]=null),n._list.splice(o,1),n.trigger("picturedeleted",i,o),r==o&&(n.set("current",null,{silent:!0}),n._list.length&&(o<n._list.length?n.set("current",o):n.set("current",0))))}})}},saveCaption:function(t){var i=this._list[this.get("current")],n=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"pictures/set-caption/",data:{pictureId:i.id,caption:t},complete:function(e){e.status>=200&&e.status<300?(i.caption=t,n.resolve()):n.reject()}}),n},destroy:function(){this._loaded=null,this._list=null,this._view.remove()}});return o}),define("abstracts/itemcard/Notification",["underscore","abstracts/Model"],function(t,e){var i={devices:"notificationObjectCollection",deviceGroups:"notificationGroupCollection",areas:"notificationAreaCollection",zones:"notificationZoneCollection",alertGroups:"notificationAlertGroupCollection",alerts:"notificationAlertCollection",addresses:"notificationAddressCollection"},n="EML",s="SMS",o=e.extend({constructor:function(){e.apply(this,arguments)},defaults:t.extend({},e.defaults,{id:0,name:"",isActive:!0,devices:[],deviceGroups:[],alertGroups:[],alerts:[],addresses:[]}),parse:function(e){var n=e,s=t.invert(i);return r.translate(n,s),n},serialize:function(){var t=JSON.parse(JSON.stringify(this.attributes));return r.translate(t,i),t.id||delete t.id,t},getAddressCode:function(t){return-1!=t.indexOf("email")?n:-1!=t.indexOf("phone")?s:""},getEmails:function(){return r.getAddresses.call(this,{addressType:n})},getPhones:function(){return r.getAddresses.call(this,{addressType:s})}}),r={translate:function(e,i){return t.each(e,function(n,s){t.isObject(n)&&r.translate(n,i),s in i&&(e[i[s]]=n,delete e[s])}),e},getAddresses:function(e){var i=t.where(this.get("addresses"),e);return t.pluck(i,"address")},setAddresses:function(e,i){var n=t.filter(this.get("addresses"),function(t){return t.addressType!=e});t.each(i,function(t){n.push({address:t,addressType:e})}),this.set("addresses",n)}};return o}),define("abstracts/itemcard/NotificationsCollection",["abstracts/Collection","./Notification"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},model:e,url:App.getBaseUrl()+"notifications/"});return i}),define("abstracts/itemcard/views/NotificationsView",["jquery","jqueryui","jface","underscore","abstracts/View","../NotificationsCollection","../Notification","text!../tmpl/notificationsEditable.html","text!../tmpl/notificationForm.html","text!../tmpl/notificationRow.html"],function(t,e,i,n,s,o,r,a,l,h){a=n.template(a),l=n.template(l),h=n.template(h);var c=100,u=100,d=s.extend({constructor:function(){this.controller=null,this.parent=null,this.collection=new o,this._isStationary=!1,this._notification=null,this._popup=null,this._selects={alertGroups:null,alerts:null,areas:null,zones:null},this._alertGroups=null,this._alerts=null,this._xhr=null,s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,this.collection.url=App.getBaseUrl()+"notifications/by-object-id/",p.bindEvents.call(this);var e=this;this.collection.fetch({data:{id:this.model.id}}).done(function(){e.render()})},render:function(){this.$el.html(a({i18n:this.controller.getTexts(),items:this.collection.toJSON(),tmplRow:h}))},remove:function(){this.stopListening(),this._popup.trigger("jw.close"),this._popup=null}}),p={bindEvents:function(){var e=this;this.listenTo(this.collection,"request",function(){e.$el.addClass("loading")}).listenTo(this.collection,"sync",function(){e.$el.removeClass("loading")}).listenTo(this.collection,"add",function(t){p.addRow.call(e,t)}).listenTo(this.collection,"remove",function(t){var i=e.$el.find("table"),n=i.find("tr[data-id="+t.id+"]");n.remove(),e.collection.length||i.addClass("hidden").siblings(".no-data").removeClass("hidden")}),this.parent.on("addrow",function(t){"notification"==t&&p.edit.call(e,0)}),this.$el.on("click",".row-edit",function(){p.edit.call(e,t(this).data("id"))}).off("click",".row-remove").on("click",".row-remove",function(){return p.openDeleteConfirm.call(e,t(this).data("id")),!1})},edit:function(e){if(!this._notification||this._notification.id!==e){var s=this.controller.getTexts();if(!e&&this.collection.length>=u)return alert(s.notificationLimitReached,s.attention);var o=this,a=null,h=Number(this.model.get("settings").ObjType),c=e?this.collection.get(e):new r({name:s.notification+" "+(this.collection.length+1)}),d=n.extend({},c.attributes,{objType:h,emails:c.getEmails(),phones:c.getPhones(),i18n:s}),f=this.$el.offset();this._isStationary=h==App.TYPE_STAT,t("#win-notification").trigger("jw.close"),this._notification=c,e?(a=n.findWhere(c.get("devices"),{objectId:this.model.id}),this._isStationary&&(d.areaNums=p.getAreaNums.call(this))):(a={id:this.model.id},this._isStationary&&(d.areaNums=[])),d.device=a,this._isStationary&&(d.areas=this.model.get("areas")),i.window.open({winId:"win-notification",addForm:'<form method="post" action=""></form>',addClass:"loading",headerHtml:e?n.escape(c.get("name")):s.newNotification,contentHtml:l(d),footerHtml:'<button type="submit" class="btn btn-primary">'+s.save+"</button>"+'<a href="javascript:;" class="btn jw-close">'+s.cancel.ucFirst()+"</a>",dieAfter:0,initX:Math.max(f.left-20,10),initY:50,width:600,resizable:!1,openCallback:function(){o._popup=this},showCallback:function(){var t=this;p.initForm.call(o,t.find("form")).always(function(){t.removeClass("loading"),p.initMultiSelects.call(o),t.find("textarea").each(function(){this.style.height=this.scrollHeight+2+"px"}),t.find("input[type=text]").first().focus()})},closeCallback:function(){o._notification=null,n.each(o._selects,function(t,e){o._selects[e]=null}),o._xhr&&(o._xhr.abort(),o._xhr=null)}})}},initForm:function(e){var i=this,n=new t.Deferred,s=e.find("textarea");return e.find("input[type=text]").first().focus(),e.on("submit",function(){return p.onSubmit.call(i,e),!1}),t.autoResize(s),this._alertGroups&&this._alerts?n.resolve():(t.when(t.ajax({url:App.getBaseUrl()+"alert-template-group/list/",data:{}}),t.ajax({url:App.getBaseUrl()+"alert-template/list/",data:{}})).done(function(t,e){i._alertGroups=t[0],i._alerts=e[0],n.resolve()}).fail(function(){n.reject()}),n)},initMultiSelects:function(){var t=this,e=this.controller.getTexts();
	n.each(this._selects,function(e,i){t._selects[i]=t._popup.find("select[name="+i+"]")}),p.buildAlertGroups.call(this),p.buildAlerts.call(this,this._alerts,n.pluck(this._notification.get("alerts"),"alertTemplateId")),this._isStationary&&p.buildZones.call(this,p.filterZones.call(t,p.getAreaNums.call(this)),p.getZoneIds.call(this)),this._popup.find("select").chosen({disable_search:!1,disable_search_threshold:10,no_results_text:e.searchNoResults});var i=this._selects.alertGroups,s=this._selects.alerts;if(i.on("change",function(){var e=p.getSelectValues(i);p.buildAlerts.call(t,p.filterAlerts.call(t,e)),s.trigger("chosen:updated")}),this._isStationary){var o=this._selects.areas,r=this._selects.zones;o.on("change",function(){var e=p.getSelectValues(o);p.buildZones.call(t,p.filterZones.call(t,e)),r.trigger("chosen:updated")})}},buildAlertGroups:function(){var t=this._popup.find("select[name=alertGroups]"),e="",i=n.pluck(this._notification.get("alertGroups"),"alertGroupId");n.each(this._alertGroups,function(t){e+='<option value="'+t.id+'"'+(-1!=n.indexOf(i,t.id)?" selected":"")+">"+t.name+"</option>"}),t.html(e)},buildAlerts:function(t,e){var i=this._selects.alerts,s="",e=e||p.getSelectValues(i);n.each(t,function(t){s+='<option value="'+t.id+'"'+(-1!=n.indexOf(e,t.id)?" selected":"")+">"+p.formatCode(t.code)+" "+t.message+"</option>"}),i.html(s)},getAreaNums:function(){if(!this._isStationary||!this._notification.id)return[];var t=n.indexBy(this.model.get("areas"),"num"),e=null,i=[],s=n.findWhere(this._notification.get("devices"),{objectId:this.model.id});return n.each(s.areas,function(n){e=t[n.num],e&&i.push(e.num)}),i},getZoneIds:function(){if(!this._isStationary||!this._notification.id)return[];var t=n.indexBy(this.model.get("areas"),"num"),e=this.model.get("zones"),i=null,s=null,o=[],r=n.findWhere(this._notification.get("devices"),{objectId:this.model.id});return n.each(r.areas,function(r){i=t[r.num],i&&n.each(r.zones,function(t){s=n.find(e,function(e){return e.areaId==i.id&&e.num==t.num}),s&&o.push(s.id)})}),o},buildZones:function(t,e){var i,s=this._selects.zones,o=this.controller.getTexts(),r="",e=e||p.getSelectValues(s),a="",l=n.indexBy(this.model.get("areas"),"id");n.each(t,function(t){a=t.name?n.escape(t.name):o.objZone+" "+t.num,i=l[t.areaId],a+=" ("+(i.name?n.escape(i.name):o.objArea+" "+i.num)+")",r+='<option value="'+t.id+'"'+(-1!=n.indexOf(e,t.id)?" selected":"")+">"+a+"</option>"}),s.html(r)},getSelectValues:function(t){var e=t.val()||[];return n.map(e,function(t){return Number(t)})},filterAlerts:function(t){if(!t.length)return this._alerts;var e=n.filter(this._alerts,function(e){return-1!=n.indexOf(t,e.groupId)});return e},filterZones:function(t){var e=this.model.get("zones");if(!t.length)return[];var i=n.indexBy(this.model.get("areas"),"id");return n.filter(e,function(e){return-1!=n.indexOf(t,i[e.areaId].num)})},onSubmit:function(t){var e,i=this,n=p.serializeForm.call(this,t),s=this._notification.id;return(e=p.validate.call(this,n))?(p.showErrors.call(this,e),void 0):(this._popup.addClass("loading"),p[s?"update":"create"].call(this,n).done(function(t){i._notification.set("id",t.id),s?i.$el.find("tr[data-id="+s+"]").replaceWith(p.renderRow.call(i,i._notification)):i.collection.add(i._notification),i._popup.trigger("jw.close")}).fail(function(){p.showErrors.call(i,arguments[0])}).always(function(){i._popup.removeClass("loading")}),void 0)},serializeForm:function(e){var i=this,s={},o={objectId:this.model.id};s.name=t.trim(e.find("input[name=name]").val()),s.isActive=e.find("input[name=isActive]").is(":checked"),s.addresses=[],s.alertGroups=[],s.alerts=[],n.each(["emails","phones"],function(o){var r=e.find("[name="+o+"]"),a=i._notification.getAddressCode(o);if(r.length&&a){var l=r.val().split(/[\,,;,\n]/);l=n.filter(l,function(e){return t.trim(e).length}),"phones"==o&&(l=n.map(l,function(t){return t.replace(/[+,\-,\(,\)]/gi,"")})),l=n.map(l,function(e){return t.trim(e)});for(var h=0,c=l.length;c>h;++h)s.addresses.push({address:l[h],addressType:a})}});for(var r=p.getSelectValues(i._selects.alertGroups),a=0,l=r.length;l>a;++a)s.alertGroups.push({alertGroupId:r[a]});r=p.getSelectValues(i._selects.alerts);for(var a=0,l=r.length;l>a;++a)s.alerts.push({alertTemplateId:r[a]});var h,c,u=p.getSelectValues(this._selects.areas),d=n.indexBy(this.model.get("areas"),"id"),f=p.getSelectValues(this._selects.zones),m=n.filter(this.model.get("zones"),function(t){return-1!=n.indexOf(f,t.id)});if(m=n.groupBy(m,function(t){return d[t.areaId].num}),o.areas=[],u.length)for(var a=0,l=u.length;l>a;++a){if(h={num:u[a],zones:[]},u[a]in m){c=n.pluck(m[u[a]],"num");for(var g=0,v=c.length;v>g;++g)h.zones.push({num:c[g]})}o.areas.push(h)}return s.devices=[o],s},validate:function(t){var e=[],i=this.controller.getTexts();if(t.name||e.push({key:"name",msg:i.errNotificationName}),t.addresses.length)if(t.addresses.length>c)e.push({key:["emails","phones"],msg:i.errNotificationMaxAddresses.replace("#max#",c)});else{var s=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,o=this._notification.getAddressCode("emails"),r=p.validateAddresses(n.filter(t.addresses,function(t){return t.addressType==o}),s);s=/^\d{9,15}$/i,o=this._notification.getAddressCode("phones");var a=p.validateAddresses(n.filter(t.addresses,function(t){return t.addressType==o}),s);if(r.length||a.length){var l=[];r.length&&l.push("emails"),a.length&&l.push("phones"),e.push({key:l,msg:i.errNotificationAddressesIncorrect})}}else e.push({key:["emails","phones"],msg:i.errNotificationAddresses});return e.length?e:null},validateAddresses:function(t,e){for(var i=[],n=0,s=t.length;s>n;++n)e.test(t[n].address)||i.push(t[n]);return i},update:function(e){var i=this,n=this._notification.id,s=new t.Deferred;return p.remove.call(this,n).done(function(){i._notification.set("id",0),p.create.call(i,e).done(function(t){s.resolve(t)}).fail(function(){s.reject(arguments[0])})}).fail(function(){s.reject(arguments[0])}),s},create:function(e){this._notification.set(e);var i=App.getBaseUrl()+"notifications/create/",n=this._notification.serialize();return this._xhr=t.ajax({url:i,data:n}),this._xhr},addRow:function(t){var e=p.renderRow.call(this,t);1==this.collection.length&&(this.$el.find("table").removeClass("hidden"),this.$el.find(".no-data").addClass("hidden")),this.$el.find("tbody").append(e)},renderRow:function(t){var e=this.controller.getTexts(),i=t.attributes;return h(n.extend({isActiveS:i.isActive?e.notificationSwitchedOn:e.notificationSwitchedOff},i))},remove:function(e){return t.ajax({url:App.getBaseUrl()+"notifications/delete/",data:{id:e}})},openDeleteConfirm:function(t){var e=this,s=this.collection.get(t),o=this.controller.getTexts().notificationDeleteConfirm;s&&i.confirm(o.msg.replace("#name#","<strong>"+n.escape(s.get("name"))+"</strong>"),o.hdr,{okCallback:function(){e.$el.addClass("loading"),p.remove.call(e,t).done(function(){e.collection.remove(t)}).fail(function(){p.showErrors.call(e)}).always(function(){e.$el.removeClass("loading")})}})},showErrors:function(e){var i=this.controller.getTexts(),s=[];if(n.isArray(arguments[0])){var o=this._popup;n.each(e,function(t){n.isArray(t.key)||(t.key=[t.key]),n.each(t.key,function(t){o.find('[name="'+t+'"]').closest(".control-group").addClass("error")}),s.push(t.msg)});var r=o.find(".error").first()}else if("string"==typeof arguments[0])s.push(arguments[0]);else if(arguments[0].responseText)try{var a=t.parseJSON(arguments[0].responseText);s.push(a.msg)}catch(l){s.push(i.errors.callServerFailed)}s.length&&alert(s.join("<br />"),i.error,{closeCallback:function(){r&&r.find("input, select, textarea").focus()}})},formatCode:function(t){var e=String(t);return 4==e.length&&(e=e.substr(0,3)+"."+e.substr(3)),e}};return d}),define("abstracts/itemcard/views/CamerasView",["jquery","jqueryui","jface","underscore","abstracts/View","text!../tmpl/cameras.html","text!../tmpl/cameraPreview.html","text!../tmpl/camerasAdd.html"],function(t,e,i,n,s,o,r,a){o=n.template(o),r=n.template(r),a=n.template(a);var l="https://streaming.ivideon.com/preview/live",h=s.extend({constructor:function(){this.controller=null,this.parent=null,this.loading=!1,this.connected=!1,this._login="",this._password="",this._selectedIds=[],this._cameras=null,this._camerasById=null,this._xhr=null,this._sessionId="",this.$login=null,this.$password=null,this.$addBlock=null,this.$form=null,this.$list=null,this.$select=null,this.$noCameras=null,this.$btnConnect=null,s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,this.render(),c.bindEvents.call(this);var e=this.model.get("settings");if(this.$addBlock.find("input[name=ivcamid]"),e.ivlogin&&e.ivpassword){var i=this,s=e.ivlogin,o=App.get("ivSessions");s in o&&(this._sessionId=o[s]),this._login=s,this._password=e.ivpassword,this._selectedIds=[],"ivcamid"in e&&(this._selectedIds[0]=e.ivcamid),c.load.call(this).done(function(){var t="ivcamid"in e?String(e.ivcamid):"";if(t.length>0){var s;if(t in i._camerasById?s=i._camerasById[t]:-1==t.indexOf("/")&&(s=n.find(i._camerasById,function(e){return e.id==t})),s)c.onSelect.call(i,s);else{var o=i.controller.getTexts();alert(o.errCameraNotAvailable,o.error),i._selectedIds=[],i.$noCameras.removeClass("hidden")}}}).fail(function(){c.toggleAddBlock.call(i,!1),i.$btnConnect.removeClass("hidden")})}},render:function(){this.$el.html(o(n.extend({},this.model.attributes,{i18n:this.controller.getTexts()}))),this.$login=this.$el.find(".login-input"),this.$password=this.$el.find(".password-input"),this.$addBlock=this.$el.find(".add-camera"),this.$select=this.$addBlock.find("select"),this.$list=this.$el.find(".cameras-list"),this.$noCameras=this.$el.find(".no-data"),this.$btnConnect=this.$el.find(".btn-connect")},remove:function(){this._xhr&&(this._xhr.abort(),this._xhr=null),this.stopListening()}}),c={bindEvents:function(){var e=this;this.$login.add(this.$password).on("blur",function(){var i=e._login,n=e._password;e._login=t.trim(e.$login.val()),e._password=t.trim(e.$password.val()),(e._login!=i||e._password!=n)&&(e.connected=!1,e.$noCameras.addClass("hidden"),c.toggleAddBlock.call(e,!1),c.clearSelected.call(e),e._login&&e._password?e.$btnConnect.removeClass("hidden"):e.$btnConnect.addClass("hidden"))}),this.$btnConnect.on("click",function(){return c.connect.call(e),!1}),this.$select.on("change",function(){var i=t(this).val();"-1"!=i?c.onSelect.call(e,e._camerasById[i]):c.clearSelected.call(e)}),this.$el.on("click",".remove-camera",function(){c.clearSelected.call(e)})},connect:function(){var t=this;this._sessionId="",this._cameras=null,this._camerasById=null,this._login&&this._password&&c.load.call(t).done(function(){t.$btnConnect.addClass("hidden"),c.toggleAddBlock.call(t,!0),1==t._cameras.length&&c.onSelect.call(t,t._cameras[0])})},load:function(){var e=this,i=e.controller.getTexts(),s={login:this._login,password:this._password},o=new t.Deferred;return this._sessionId&&(s.sessionId=this._sessionId),this.loading=!0,this.$el.addClass("loading"),this._xhr=t.ajax({url:App.getBaseUrl()+"ivideon/list-cameras/",data:s,success:function(t){e.connected=!0,e._sessionId=t.sessionId,e._cameras=t.cameras,e._camerasById=n.indexBy(e._cameras,function(t){return t.server.id+"/"+t.id});var s=App.get("ivSessions");s[e._login]=e._sessionId,App.set("ivSessions",n.clone(s)),e._cameras.length?(e.$select.prop("disabled",!1),c.buildSelect.call(e),o.resolve(e._cameras)):(o.reject(),alert(i.errCamerasListEmpty,i.error))},error:function(t){o.reject(),c.showAjaxError.call(e,t,i.errCamerasListLoad)},complete:function(){e.loading=!1,e.$el.removeClass("loading")}}),o},showAjaxError:function(e,i){var n=this.controller.getTexts(),s=n.error,o=i;try{var r=t.parseJSON(e.responseText);o=r.msg}catch(a){}alert(o,s)},clearSelected:function(){this.$el.find(".camera-preview").remove(),this._selectedIds=[],this.$select.find('option[value="-1"]').prop("selected",!0),this.connected?this.$noCameras.removeClass("hidden"):this.$select.prop("disabled",!0)},add:function(){if(!this.loading){var e=this,i=this.controller.getTexts(),n=this.$form=t(a({i18n:i})).appendTo(this.parent.$el);n.find(".btn-cancel").on("click",function(){n.remove(),e.$form=null}),input.autocomplete({minLength:2,appendTo:this.parent.$el,source:function(t){t.term}})}},toggleAddBlock:function(t){this.$addBlock[t?"removeClass":"addClass"]("hidden").find("input").prop("disabled",!t)},initAutocomplete:function(t){var e=this;t.autocomplete({minLength:2,appendTo:this.parent.$el,source:function(t,i){for(var n,s=e._cameras,o=t.term.toLowerCase(),r=[],a=0,l=s.length;l>a;a++)n=s[a].name,-1!=n.toLowerCase().indexOf(o)&&r.push({id:s[a].id,label:n,value:n,cameraData:s[a]});i(r)},select:function(t,i){c.onSelect.call(e,i.item.cameraData)}})},buildSelect:function(){for(var t,e,i=this._cameras,n=this.controller.getTexts(),s='<option value="-1">'+n.cameraNotSelected+"</option>",o=0,r=i.length;r>o;o++)e=i[o],t=e.name,s+='<option value="'+e.server.id+"/"+e.id+'">'+t+"</option>";this.$select.html(s)},renderList:function(){for(var t="",e=this._selectedIds,i="",s=null,o=0,r=e;r>o;++o)s=null,i=e[o],s=-1==i.indexOf("/")?n.find(this._camerasById,function(t){t.id==i}):this._camerasById[i],s&&(t+=c.renderPreview.call(this,s));this.$list.html(t)},onSelect:function(e){this.$list.find(".camera-preview").remove();var i=t(c.renderPreview.call(this,e)).appendTo(this.$list);i.find("img").one("error",function(){i.addClass("preview-error")}),this._selectedIds=[e.server.id+"/"+e.id],this.$select.prop("disabled",!1).find('option[value="'+e.server.id+"/"+e.id+'"]').prop("selected",!0),this.$noCameras.addClass("hidden")},renderPreview:function(t){return r(n.extend({},t,{src:l+"?server="+t.server.id+"&camera="+t.id+"&sessionId="+this._sessionId,errorTxt:this.controller.getTexts().errCameraPreview}))}};return h}),define("abstracts/itemcard/views/ChangesHistoryView",["jquery","jqueryui","jface","underscore","abstracts/View","datatables","text!../tmpl/changesHistory.html","css!_libs/grids/DataTables/css/jquery.dataTables.cropped.css","colresize"],function(t,e,i,n,s,o,r){r=n.template(r);var a=s.extend({constructor:function(){this.controller=null,this.parent=null,this.isVisible=!0,this.$table=null,this._grid=null,this._data=[],this._names={},s.apply(this,arguments)},initialize:function(t){this.controller=t.controller,this.parent=t.parent,l.setNames.call(this),this.reload()},reload:function(){var t=this;l.load.call(t).done(function(e){l.prepareData.call(t,e),t.render(),l.bindEvents.call(t)}).fail(function(){})},render:function(){this.$el.html(r({i18n:this.controller.getTexts()})),this.$table=this.$el.find("table"),l.buildGrid.call(this)},formatValue:function(t,e){var i=e,n=this.controller.getTexts();if("STATE"==t){var s=this.controller.getPossibleStates();i=s[e]||e}else"IS_FOLLOWED"==t?i=1==e?n.switchedOn:n.switchedOff:"FILTER_MASK"==t?i=i.replace(/,/gi,", "):/^AN_TYPE\d$/.test(t)&&(i=n.fuelLevelSensor,1==e?i=n.flowSensorOnInput:-1==e&&(i=n.flowSensorOnOutput));return i}}),l={bindEvents:function(){var t=this;this.$table.DataTable().settings()[0],this.$el.on("hidden shown",function(){t.isVisible=-1!=t.el.className.indexOf("active"),t.isVisible&&l.adjustGridSize.call(t)}),this.listenTo(this.parent,"resize:stop",function(){l.adjustGridSize.call(t)})},setNames:function(){var t=this.controller.getTexts(),e=this.model.get("settings").ObjType==App.TYPE_MOBILE,i={name:t.objName,DESCRIPTION:t.comments.ucFirst(),VRC_OWNER:t.objOwner,PHONE1:t.phone.ucFirst()+" 1",PHONE2:t.phone.ucFirst()+" 2",OwnerPassword:t.objOwnerPass,ContractNumber:t.objContract,ContractDate:t.objContractDate,IMAGE_PATH:t.objImage,imei:"IMEI",SIM:t.simCard+" 1",SIM2:t.simCard+" 2",sim1Provider:t.gsmProvider+" 1",sim2Provider:t.gsmProvider+" 2",PASS:t.password.ucFirst(),InstallPlace:t.placeInstall,InstallDate:t.dateInstall,Installer:t.installer,ExtraHardware:t.objExtraHardware,status:t.objStatus,STATE:t.objState,Country:t.country,Region:t.region,City:t.city,Street:t.street,House:t.house,Building:t.building,GateCode:t.gateCode,IntercomCode:t.intercomCode,AppNumber:t.appartment,Lat:t.lat,Lon:t.lon,ivlogin:t.login.ucFirst()+" Ivideon",ivpassword:t.password.ucFirst()+" Ivideon",RESPONSIVE_PERSONS:t.responsible.header,pass1:t.responsible.pass1,pass2:t.responsible.pass2};e&&(n.extend(i,{CAR_ID:t.licenseNumber,MODEL:t.objModel.ucFirst(),VRC_TYPE:t.type.ucFirst(),YEAR:t.objYear,VIN:"VIN",COLOR:t.color.ucFirst(),RouteNumber:t.objRouteNumber,IS_FOLLOWED:t.followedMode,TRACKED_DSENSOR_INDEX:t.indicateTrackedSensorState,AN_TYPE1:t.fuel.ucFirst()+". "+t.analogueSensor+" 1",AN_COEFF1:t.fuel.ucFirst()+". "+t.impulsesByLiter+" 1",FCONSUM_SUMMER1:t.fuelConsumptionNormForSummer+" 1,"+t.l100km,FCONSUMH_SUMMER1:t.fuelConsumptionNormForSummer+" 1, "+t.l1h,FCONSUM_WINTER1:t.fuelConsumptionNormForWinter+" 1, "+t.l100km,FCONSUMH_WINTER1:t.fuelConsumptionNormForWinter+" 1, "+t.l1h,AN_TYPE2:t.fuel.ucFirst()+". "+t.analogueSensor+" 2",AN_COEFF2:t.fuel.ucFirst()+". "+t.impulsesByLiter+" 2",FCONSUM_SUMMER2:t.fuelConsumptionNormForSummer+" 2,"+t.l100km,FCONSUMH_SUMMER2:t.fuelConsumptionNormForSummer+" 2, "+t.l1h,FCONSUM_WINTER2:t.fuelConsumptionNormForWinter+" 2, "+t.l100km,FCONSUMH_WINTER2:t.fuelConsumptionNormForWinter+" 2, "+t.l1h,TankVolume:t.tankVolume,MinFill:t.minFilling,MinPlum:t.minDischarge,SmoothMedianStep:t.stepOfMedianFilter,RemoveAcpOverflowMax:t.maxUsedSensorValues,RemoveAcpOverflowMin:t.minUsedSensorValues,OBJECT_MIN_SPEED:t.minObjectSpeed,OBJECT_MAX_SPEED:t.maxObjectSpeed,FILTER_MASK:t.filters,OBJECT_MIN_PARK_TIME:t.detectParksIfContinueMoreThan,OBJECT_MIN_PARK_MERGE_TIME:t.detectMovementBetweenParksIfContinuesMoreThan}),n.each([1,2,3,4,5,6],function(e){i["D"+e+"Name"]=t.discretSensor+" "+e+" ("+t.discret+")"}),n.each([1,2],function(e){i["AN_NAME"+e]=t.analogueSensor+" "+e+" ("+t.analogue+")",i["C"+e+"Name"]=t.deviceOut+" "+e})),this._names=i},load:function(){var e=this;return this.$el.addClass("loading"),t.ajax({url:App.getBaseUrl()+"objects/card-edits/",data:{objectId:this.model.id}}).always(function(){e.$el.removeClass("loading")})},prepareData:function(t){for(var e,i,s,o,r=this,a=[],h=this._names,c=0,u=/ \((([0-9]{1,3}\.){3}[0-9]{1,3})\)$/,d=0,p=t.length;p>d;++d)e=t[d],i=e.changes.new,s=e.changes.old,n.each(i,function(t,i){if("objType"!=i)if(o={user:e.user,time:e.ts,key:i,ip:""},u.test(o.user)&&(o.ip=u.exec(o.user)[1]||"",o.user=o.user.replace(u,"")),"RESPONSIVE_PERSONS"==i){var d=l.findRespPersonsChanges.call(r,t,s[i]);n.each(d,function(t){a.push(n.extend(o,{index:++c,setting:t.name,oldValue:t.oldValue,newValue:t.newValue}))})}else a.push(n.extend(o,{index:++c,setting:h[i]||i,oldValue:i in s&&"null"!=String(s[i])?s[i]:"",newValue:"null"!=String(t)?t:""}))});this._data=a},findRespPersonsChanges:function(e,i){var s=[],o={pass1:"",pass2:"",persons:[]},r={o:o,n:o},a=this.controller.getTexts();if(e.length&&(r.n=t.parseJSON(e)),i.length&&(r.o=t.parseJSON(i)),JSON.stringify(r.o.persons)!=JSON.stringify(r.n.persons)){var l=[],h="";n.each([r.o.persons,r.n.persons],function(t,e){l[e]=[],n.each(t,function(t){h='"'+n.filter(n.values(t),function(t){return t.length>0}).join('", "')+'"',l[e].push(h)}),l[e]=l[e].join(";<br />")}),s.push({name:a.responsible.header,oldValue:l[0],newValue:l[1]})}return s},buildGrid:function(){var t=this,e=this.controller.getTexts(),i=this.$table,s={};s.data=this._data,s.columns=[{key:"index",data:"index",width:"4%",className:"text-center",orderable:!1,searchable:!1},{key:"time",type:"string",data:function(e,i){return"sort"==i?e.time:t.formatDateTime(e.time)},width:"12%",className:"time"},{key:"setting",data:"setting",width:"14%"},{key:"oldValue",data:function(e){return t.formatValue(e.key,e.oldValue)},width:"24%"},{key:"newValue",data:function(e){return t.formatValue(e.key,e.newValue)},width:"24%"},{key:"user",data:"user",width:"12%"},{key:"ip",data:"ip",width:"10%"}],n.extend(s,{order:[[1,"desc"]],paging:!1,info:!1,deferRender:!0,dom:"rt",scrollY:this.$el.find(".grid-content").height()-this.$el.find("thead").outerHeight(),scrollCollapse:!0,autoWidth:!0,language:{zeroRecords:e.tableNoRecords}}),this._grid=i.dataTable(s)},adjustGridSize:function(){this._grid&&this.isVisible&&(this._grid.fnSettings().oScroll.sY=l.getGridScrollHeight.call(this),this._grid.fnAdjustColumnSizing())},getGridScrollHeight:function(){return this.$el.find(".grid-content").height()-this.$el.find(".dataTables_scrollHead").outerHeight()-2}};return a}),function(t){"function"==typeof define&&define.amd?define("_libs/jquery/jquery.form",["jquery"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){function e(e){var i=e.data;e.isDefaultPrevented()||(e.preventDefault(),t(e.target).ajaxSubmit(i))}function i(e){var i=e.target,n=t(i);if(!n.is("[type=submit],[type=image]")){var s=n.closest("[type=submit]");if(0===s.length)return;i=s[0]}var o=this;if(o.clk=i,"image"==i.type)if(void 0!==e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var r=n.offset();o.clk_x=e.pageX-r.left,o.clk_y=e.pageY-r.top}else o.clk_x=e.pageX-i.offsetLeft,o.clk_y=e.pageY-i.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}var s={};s.fileapi=void 0!==t("<input type='file'/>").get(0).files,s.formdata=void 0!==window.FormData;var o=!!t.fn.prop;t.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var t=this.prop.apply(this,arguments);return t&&t.jquery||"string"==typeof t?t:this.attr.apply(this,arguments)},t.fn.ajaxSubmit=function(e){function i(i){var n,s,o=t.param(i,e.traditional).split("&"),r=o.length,a=[];for(n=0;r>n;n++)o[n]=o[n].replace(/\+/g," "),s=o[n].split("="),a.push([decodeURIComponent(s[0]),decodeURIComponent(s[1])]);return a}function r(n){for(var s=new FormData,o=0;o<n.length;o++)s.append(n[o].name,n[o].value);if(e.extraData){var r=i(e.extraData);for(o=0;o<r.length;o++)r[o]&&s.append(r[o][0],r[o][1])}e.data=null;var a=t.extend(!0,{},t.ajaxSettings,e,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});e.uploadProgress&&(a.xhr=function(){var i=t.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",function(t){var i=0,n=t.loaded||t.position,s=t.total;t.lengthComputable&&(i=Math.ceil(100*(n/s))),e.uploadProgress(t,n,s,i)},!1),i}),a.data=null;var h=a.beforeSend;return a.beforeSend=function(t,i){i.data=e.formData?e.formData:s,h&&h.call(this,t,i)},t.ajax(a)}function a(i){function s(t){var e=null;try{t.contentWindow&&(e=t.contentWindow.document)}catch(i){n("cannot get iframe.contentWindow document: "+i)}if(e)return e;try{e=t.contentDocument?t.contentDocument:t.document}catch(i){n("cannot get iframe.contentDocument: "+i),e=t.document}return e}function r(){function e(){try{var t=s(v).readyState;n("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(i){n("Server abort: ",i," (",i.name,")"),a(M),x&&clearTimeout(x),x=void 0}}var i=u.attr2("target"),o=u.attr2("action"),r="multipart/form-data",h=u.attr("enctype")||u.attr("encoding")||r;S.setAttribute("target",f),(!l||/post/i.test(l))&&S.setAttribute("method","POST"),o!=d.url&&S.setAttribute("action",d.url),d.skipEncodingOverride||l&&!/post/i.test(l)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),d.timeout&&(x=setTimeout(function(){w=!0,a(T)},d.timeout));var c=[];try{if(d.extraData)for(var p in d.extraData)d.extraData.hasOwnProperty(p)&&(t.isPlainObject(d.extraData[p])&&d.extraData[p].hasOwnProperty("name")&&d.extraData[p].hasOwnProperty("value")?c.push(t('<input type="hidden" name="'+d.extraData[p].name+'">').val(d.extraData[p].value).appendTo(S)[0]):c.push(t('<input type="hidden" name="'+p+'">').val(d.extraData[p]).appendTo(S)[0]));d.iframeTarget||g.appendTo("body"),v.attachEvent?v.attachEvent("onload",a):v.addEventListener("load",a,!1),setTimeout(e,15);try{S.submit()}catch(m){var _=document.createElement("form").submit;_.apply(S)}}finally{S.setAttribute("action",o),S.setAttribute("enctype",h),i?S.setAttribute("target",i):u.removeAttr("target"),t(c).remove()}}function a(e){if(!_.aborted&&!P){if(k=s(v),k||(n("cannot access response document"),e=M),e===T&&_)return _.abort("timeout"),C.reject(_,"timeout"),void 0;if(e==M&&_)return _.abort("server abort"),C.reject(_,"error","server abort"),void 0;if(k&&k.location.href!=d.iframeSrc||w){v.detachEvent?v.detachEvent("onload",a):v.removeEventListener("load",a,!1);var i,o="success";try{if(w)throw"timeout";var r="xml"==d.dataType||k.XMLDocument||t.isXMLDoc(k);if(n("isXml="+r),!r&&window.opera&&(null===k.body||!k.body.innerHTML)&&--I)return n("requeing onLoad callback, DOM not available"),setTimeout(a,250),void 0;var l=k.body?k.body:k.documentElement;_.responseText=l?l.innerHTML:null,_.responseXML=k.XMLDocument?k.XMLDocument:k,r&&(d.dataType="xml"),_.getResponseHeader=function(t){var e={"content-type":d.dataType};return e[t.toLowerCase()]},l&&(_.status=Number(l.getAttribute("status"))||_.status,_.statusText=l.getAttribute("statusText")||_.statusText);var h=(d.dataType||"").toLowerCase(),c=/(json|script|text)/.test(h);if(c||d.textarea){var u=k.getElementsByTagName("textarea")[0];if(u)_.responseText=u.value,_.status=Number(u.getAttribute("status"))||_.status,_.statusText=u.getAttribute("statusText")||_.statusText;else if(c){var f=k.getElementsByTagName("pre")[0],m=k.getElementsByTagName("body")[0];f?_.responseText=f.textContent?f.textContent:f.innerText:m&&(_.responseText=m.textContent?m.textContent:m.innerText)}}else"xml"==h&&!_.responseXML&&_.responseText&&(_.responseXML=R(_.responseText));try{L=O(_,h,d)}catch(y){o="parsererror",_.error=i=y||o}}catch(y){n("error caught: ",y),o="error",_.error=i=y||o}_.aborted&&(n("upload aborted"),o=null),_.status&&(o=_.status>=200&&_.status<300||304===_.status?"success":"error"),"success"===o?(d.success&&d.success.call(d.context,L,"success",_),C.resolve(_.responseText,"success",_),p&&t.event.trigger("ajaxSuccess",[_,d])):o&&(void 0===i&&(i=_.statusText),d.error&&d.error.call(d.context,_,o,i),C.reject(_,"error",i),p&&t.event.trigger("ajaxError",[_,d,i])),p&&t.event.trigger("ajaxComplete",[_,d]),p&&!--t.active&&t.event.trigger("ajaxStop"),d.complete&&d.complete.call(d.context,_,o),P=!0,d.timeout&&clearTimeout(x),setTimeout(function(){d.iframeTarget?g.attr("src",d.iframeSrc):g.remove(),_.responseXML=null},100)}}}var h,c,d,p,f,g,v,_,y,b,w,x,S=u[0],C=t.Deferred();if(C.abort=function(t){_.abort(t)},i)for(c=0;c<m.length;c++)h=t(m[c]),o?h.prop("disabled",!1):h.removeAttr("disabled");if(d=t.extend(!0,{},t.ajaxSettings,e),d.context=d.context||d,f="jqFormIO"+(new Date).getTime(),d.iframeTarget?(g=t(d.iframeTarget),b=g.attr2("name"),b?f=b:g.attr2("name",f)):(g=t('<iframe name="'+f+'" src="'+d.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=g[0],_={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var i="timeout"===e?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(s){}g.attr("src",d.iframeSrc),_.error=i,d.error&&d.error.call(d.context,_,i,e),p&&t.event.trigger("ajaxError",[_,d,i]),d.complete&&d.complete.call(d.context,_,i)}},p=d.global,p&&0===t.active++&&t.event.trigger("ajaxStart"),p&&t.event.trigger("ajaxSend",[_,d]),d.beforeSend&&d.beforeSend.call(d.context,_,d)===!1)return d.global&&t.active--,C.reject(),C;if(_.aborted)return C.reject(),C;y=S.clk,y&&(b=y.name,b&&!y.disabled&&(d.extraData=d.extraData||{},d.extraData[b]=y.value,"image"==y.type&&(d.extraData[b+".x"]=S.clk_x,d.extraData[b+".y"]=S.clk_y)));var T=1,M=2,A=t("meta[name=csrf-token]").attr("content"),D=t("meta[name=csrf-param]").attr("content");D&&A&&(d.extraData=d.extraData||{},d.extraData[D]=A),d.forceSync?r():setTimeout(r,10);var L,k,P,I=50,R=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},E=t.parseJSON||function(t){return window.eval("("+t+")")},O=function(e,i,n){var s=e.getResponseHeader("content-type")||"",o="xml"===i||!i&&s.indexOf("xml")>=0,r=o?e.responseXML:e.responseText;return o&&"parsererror"===r.documentElement.nodeName&&t.error&&t.error("parsererror"),n&&n.dataFilter&&(r=n.dataFilter(r,i)),"string"==typeof r&&("json"===i||!i&&s.indexOf("json")>=0?r=E(r):("script"===i||!i&&s.indexOf("javascript")>=0)&&t.globalEval(r)),r};return C}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var l,h,c,u=this;"function"==typeof e?e={success:e}:void 0===e&&(e={}),l=e.type||this.attr2("method"),h=e.url||this.attr2("action"),c="string"==typeof h?t.trim(h):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),e=t.extend(!0,{url:c,success:t.ajaxSettings.success,type:l||t.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},e);var d={};if(this.trigger("form-pre-serialize",[this,e,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(e.beforeSerialize&&e.beforeSerialize(this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=e.traditional;void 0===p&&(p=t.ajaxSettings.traditional);var f,m=[],g=this.formToArray(e.semantic,m);if(e.data&&(e.extraData=e.data,f=t.param(e.data,p)),e.beforeSubmit&&e.beforeSubmit(g,this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,e,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=t.param(g,p);f&&(v=v?v+"&"+f:f),"GET"==e.type.toUpperCase()?(e.url+=(e.url.indexOf("?")>=0?"&":"?")+v,e.data=null):e.data=v;var _=[];if(e.resetForm&&_.push(function(){u.resetForm()}),e.clearForm&&_.push(function(){u.clearForm(e.includeHidden)}),!e.dataType&&e.target){var y=e.success||function(){};_.push(function(i){var n=e.replaceTarget?"replaceWith":"html";t(e.target)[n](i).each(y,arguments)})}else e.success&&_.push(e.success);if(e.success=function(t,i,n){for(var s=e.context||this,o=0,r=_.length;r>o;o++)_[o].apply(s,[t,i,n||u,u])},e.error){var b=e.error;e.error=function(t,i,n){var s=e.context||this;b.apply(s,[t,i,n,u])}}if(e.complete){var w=e.complete;e.complete=function(t,i){var n=e.context||this;w.apply(n,[t,i,u])}}var x=t("input[type=file]:enabled",this).filter(function(){return""!==t(this).val()}),S=x.length>0,C="multipart/form-data",T=u.attr("enctype")==C||u.attr("encoding")==C,M=s.fileapi&&s.formdata;n("fileAPI :"+M);var A,D=(S||T)&&!M;e.iframe!==!1&&(e.iframe||D)?e.closeKeepAlive?t.get(e.closeKeepAlive,function(){A=a(g)}):A=a(g):A=(S||T)&&M?r(g):t.ajax(e),u.removeData("jqxhr").data("jqxhr",A);for(var L=0;L<m.length;L++)m[L]=null;return this.trigger("form-submit-notify",[this,e]),this},t.fn.ajaxForm=function(s){if(s=s||{},s.delegation=s.delegation&&t.isFunction(t.fn.on),!s.delegation&&0===this.length){var o={s:this.selector,c:this.context};
	return!t.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),t(function(){t(o.s,o.c).ajaxForm(s)}),this):(n("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return s.delegation?(t(document).off("submit.form-plugin",this.selector,e).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,s,e).on("click.form-plugin",this.selector,s,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",s,e).bind("click.form-plugin",s,i)},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e,i){var n=[];if(0===this.length)return n;var o,r=this[0],a=this.attr("id"),l=e?r.getElementsByTagName("*"):r.elements;if(l&&!/MSIE [678]/.test(navigator.userAgent)&&(l=t(l).get()),a&&(o=t(":input[form="+a+"]").get(),o.length&&(l=(l||[]).concat(o))),!l||!l.length)return n;var h,c,u,d,p,f,m;for(h=0,f=l.length;f>h;h++)if(p=l[h],u=p.name,u&&!p.disabled)if(e&&r.clk&&"image"==p.type)r.clk==p&&(n.push({name:u,value:t(p).val(),type:p.type}),n.push({name:u+".x",value:r.clk_x},{name:u+".y",value:r.clk_y}));else if(d=t.fieldValue(p,!0),d&&d.constructor==Array)for(i&&i.push(p),c=0,m=d.length;m>c;c++)n.push({name:u,value:d[c]});else if(s.fileapi&&"file"==p.type){i&&i.push(p);var g=p.files;if(g.length)for(c=0;c<g.length;c++)n.push({name:u,value:g[c],type:p.type});else n.push({name:u,value:"",type:p.type})}else null!==d&&"undefined"!=typeof d&&(i&&i.push(p),n.push({name:u,value:d,type:p.type,required:p.required}));if(!e&&r.clk){var v=t(r.clk),_=v[0];u=_.name,u&&!_.disabled&&"image"==_.type&&(n.push({name:u,value:v.val()}),n.push({name:u+".x",value:r.clk_x},{name:u+".y",value:r.clk_y}))}return n},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var i=[];return this.each(function(){var n=this.name;if(n){var s=t.fieldValue(this,e);if(s&&s.constructor==Array)for(var o=0,r=s.length;r>o;o++)i.push({name:n,value:s[o]});else null!==s&&"undefined"!=typeof s&&i.push({name:this.name,value:s})}}),t.param(i)},t.fn.fieldValue=function(e){for(var i=[],n=0,s=this.length;s>n;n++){var o=this[n],r=t.fieldValue(o,e);null===r||"undefined"==typeof r||r.constructor==Array&&!r.length||(r.constructor==Array?t.merge(i,r):i.push(r))}return i},t.fieldValue=function(e,i){var n=e.name,s=e.type,o=e.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||e.disabled||"reset"==s||"button"==s||("checkbox"==s||"radio"==s)&&!e.checked||("submit"==s||"image"==s)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var r=e.selectedIndex;if(0>r)return null;for(var a=[],l=e.options,h="select-one"==s,c=h?r+1:l.length,u=h?r:0;c>u;u++){var d=l[u];if(d.selected){var p=d.value;if(p||(p=d.attributes&&d.attributes.value&&!d.attributes.value.specified?d.text:d.value),h)return p;a.push(p)}}return a}return t(e).val()},t.fn.clearForm=function(e){return this.each(function(){t("input,select,textarea",this).clearFields(e)})},t.fn.clearFields=t.fn.clearInputs=function(e){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,s=this.tagName.toLowerCase();i.test(n)||"textarea"==s?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==s?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?t(this).replaceWith(t(this).clone(!0)):t(this).val(""):e&&(e===!0&&/hidden/.test(n)||"string"==typeof e&&t(this).is(e))&&(this.value="")})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=e;else if("option"==this.tagName.toLowerCase()){var n=t(this).parent("select");e&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=e}})},t.fn.ajaxSubmit.debug=!1}),define("abstracts/itemcard/views/ItemCardView",["jquery","underscore","jqueryui","jface","abstracts/View","abstracts/GrObject","_common/pictures/PicturesModule","./NotificationsView","./CamerasView","./ChangesHistoryView","text!_common/tmpl/modelTag.html","text!../tmpl/icons.html","text!../tmpl/pictureForm.html","text!../tmpl/status.html","text!../tmpl/addNewPerson.html","text!../tmpl/copyRespForm.html","text!../tmpl/techSelect.html","text!../tmpl/tech.html","_libs/jquery/jquery.form","css!../css/card.css"],function(t,e,i,n,s,o,r,a,l,h,c,u,d,p,f,m,g,v){u=e.template(u),c=e.template(c),d=e.template(d),p=e.template(p),f=e.template(f),m=e.template(m),g=e.template(g),v=e.template(v);var _=6,y={V1:"voyager2",V2:"voyager2",V3:"voyager3",V3P:"V3P",V4:"voyager4",VL:"voyagerlight",VLN:"VLN",VL1N:"VLN",VL2N:"VLN",VL3N:"VLN",VC:"voyager2",V2N:"voyager2n",V3N:"voyager4n",V4N:"voyager4n",V5N:"V5N",V15N:"voyager15",V2T:"V2-T",V2TN:"V2-T",V6N:"V6-N",K1:"K1",K2:"K2",K5:"kontakt5",K52:"kontakt5",K9:"K9",K95:"K9",K10:"K9",K10A:"K10A",KL:"KL",KL11:"K9",K14:"kontakt14",K14W:"kontakt14",K15:"voyager15",K16:"K16",K5RT1:"K5RT1",K5RT2:"K5RT2",K5RT3:"K5RT3",Unknown:"unknown"},b=null,w={};w[App.TYPE_MOBILE]={},w[App.TYPE_STAT]={};var x={initPictureUpload:function(){if(!this._pictureForm){var e=this,i=this.module.getTexts();this._pictureForm=t(d({objectId:this.model.get("item").id,i18n:i})).appendTo(this.$el);var n=this._pictureForm,s=n.find(".file-upload");n.ajaxForm({beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+App.getBasic())},beforeSubmit:function(){return e.uploading?!1:0==s.length||0==s.get(0).files.length?(alert(e.module.getTexts().pleaseSelectFile),!1):(e.uploading=!0,n.addClass("loading"),void 0)},success:function(t){e._pictureForm.remove(),e._pictureForm=null,e._picturesModule.addPicture(t)},error:function(){var t=e.module.getTexts();alert(t.uploadFailed,t.error)},complete:function(){n.removeClass("loading"),e.uploading=!1}})}},initCarousel:function(){var t=this.$el.find(".pictures-section");this._picturesModule=new r({objectId:this.model.id,container:t,editCaption:!0}),t.data("init",!0)},onPictureDelete:function(){var t=this,e=this.$el.find(".carousel-inner .active");if(e.length){var i=this.module.getTexts();n.confirm(i.confirmDeletePicture,{okCallback:function(){var e=t._picturesModule,i=e.getList()[e.get("current")].id;e.deletePicture(i)}})}},onFileChange:function(){var t=this.$el.find("[name=file]"),e=t[0].files,i=t.prevAll(".btn-file");if(e&&e.length)if(e[0].size>1048576){var n=this.module.getTexts();alert(n.errorFileSize.replace("#s#","1Mb"),n.error),t[0].value=null}else i.text(e[0].name);else i.text(this.module.getTexts().chooseFile+"...")},onClickPersonAdd:function(){var t=this.$el.find("table.persons"),e=t.find(".AddNewPersonRow").length,i=this.module.getTexts(),n=999;if(e||(t.removeClass("hidden"),t.siblings(".no-data").addClass("hidden")),t.length&&n>e){var s=f({i18n:i,index:e});t.append(s)}},onClickPersonUp:function(i){var n=this.$el.find("table.persons"),s=n.find(".AddNewPersonRow"),o=t(i).parent().parent(),r=s.length;if(s.length&&r>0){var a=o.prev(),l=[];a.hasClass("AddNewPersonRow")&&(e.each(s,function(e){var i=t(e),n=i.attr("data-index");n==a.attr("data-index")?l.push(o.clone()):n==o.attr("data-index")?l.push(a.clone()):l.push(i.clone()),i.remove()}),e.each(l,function(t){n.append(t)}))}},onClickPersonDown:function(i){var n=this.$el.find("table.persons"),s=n.find(".AddNewPersonRow"),o=t(i).parent().parent(),r=s.length;if(s.length&&r>0){var a=o.next(),l=[];a.length&&(e.each(s,function(e){var i=t(e),n=i.attr("data-index");n==o.attr("data-index")?l.push(a.clone()):n==a.attr("data-index")?l.push(o.clone()):l.push(i.clone()),i.remove()}),e.each(l,function(t){n.append(t)}))}},onClickPersonRemove:function(e){var i=this.$el.find("table.persons"),n=t(e).parent().parent(),s=i.find(".AddNewPersonRow").length;n.length&&s>0&&(n.remove(),s--),0>=s&&(i.addClass("hidden"),this.$el.find(".no-data").removeClass("hidden"))},loadTechnicians:function(){if(this._technicians)return(new t.Deferred).resolve(this._technicians);var e=this;return App.getTechnicians().done(function(t){e._technicians=x.sortAndFormatTechnicians.call(e,t)})},sortAndFormatTechnicians:function(t){var i=this;return e.each(t,function(t){t.fullname=i.buildFullName(t)}),e.sortBy(t,function(t){return t.fullname})}},S=s.extend({constructor:function(){this.module=null,this.loading=!1,this._searchCache={},this._pictureForm=null,this._picturesModule=null,this._copyRespForm=null,this._notificationsView=null,this._camerasView=null,this._historyView=null,this._confirmedImei=!1,this._fieldsCache={},this._autocompleteXhr=null,this._autocompleteRequestId=0,this._technicians=null,s.apply(this,arguments)},initialize:function(t){this.module=t.module,this.render(),this._bindEvents()},render:function(){},remove:function(){this.off(),s.prototype.remove.apply(this,arguments)},buildFullName:function(t){var i=this.module.getTexts(),n=i.namesOrder,s=[];return e.each(n,function(e){e in t&&t[e].length&&s.push(t[e])}),e.escape(s.join(" "))},_bindEvents:function(){var i=this;this.$el.on("click",".add-picture",e.bind(x.initPictureUpload,this)).on("click",".delete-picture",e.bind(x.onPictureDelete,this)).on("change",".file-upload",e.bind(x.onFileChange,this)).on("click",".picture-form .btn-cancel",function(){i._pictureForm.remove(),i._pictureForm=null}).on("click",".add-row",function(){i.trigger("addrow",t(this).data("key"))}).on("click",".row-remove",function(){i._onRowRemove(this)}),this.$el.resizable("option","stop",function(t,e){i.trigger("resize:stop",e),console.log("resize:stop")})},_getWindowParams:function(t,e){return{winId:"pop-obj-card",addClass:"item-card obj-card",headerHtml:t.name+(t.extId?" (#"+t.extId+")":""),contentHtml:e,footerHtml:App.allowed("objects.shell")&&this.model.get("canSetup")?'<a class="setup btn" href="javascript:;" >'+this.module.getTexts().setupDevice+"</a>":"",width:670,centered:!0,resizable:!0,minWidth:670,maxWidth:1300,minHeight:300,maxHeight:500,dieAfter:0}},_onActivate:function(){var e=0;this.$el.find(".card-section").each(function(){e=Math.max(t(this).height(),e)}),this.$el.find(".jw-resize")[0].style.height=Math.min(500,e+55)+"px",this.$el.centrify()},_onClose:function(){n.hideOverlay(),this.module.get("editable")&&(t("#pop-obj-img").trigger("jw.close"),this.$el.find(".datepicker").datepicker("destroy"),e.each(["notifications","cameras","history"],e.bind(function(t){var e="_"+t+"View";this[e]&&this[e].remove(),this[e]=null},this))),this._picturesModule&&this._picturesModule.destroy(),this._picturesModule=null},_renderStatus:function(){var t=this.module.getTexts();return p({statuses:t.objStatuses,selected:this.model.get("objStatus")})},_limitInputs:function(){var e=this.$el;t.fn.numeric&&(e.find(".decimal").numeric({decimal:".",negative:!0}),e.find(".integer").numeric({decimal:!1,negative:!1}),e.find(".positive").numeric({decimal:".",negative:!1})),e.find("input[name^=SIM]").numeric({decimal:"+",negative:!1,forceZero:!1})},_activateTextareas:function(){var e=this,i=this.$el;i.find(".textarea").on("click",".editable",function(n){var s=t(this),o=s.siblings("textarea"),r=s.find(".value"),a=s.height();n.stopPropagation(),s.addClass("hidden"),o.removeClass("hidden").height(a).focus(),i.one("click",function(){r.html(e._prepareEditableText(o.val())),s.removeClass("hidden"),o.addClass("hidden")})}).on("click","a, textarea",function(t){t.stopPropagation()})},_prepareEditableText:function(t){var i=t,n=/(https?:\/\/\S+)/gi;return i=e.escape(i),i=i.replace(n,'<a class="link" target="_blank" href="$1">$1</a>'),i=i.replace(new RegExp("\\n","ig"),"<br/>")},_activateImageChange:function(){var i=this,n=this.$el;n.find(".change-img").on("click",function(){if(!i._startChooseImage.call(i)){var n=i._getSpriteImages(),s=i._getImgDir(),o=e.keys(n),r=new t.Deferred;showCursor(),e.each(o,function(e){!function(e){var o=new Image;o.src=s+"icons_"+e+".png",t(o).on("error",function(){n[e]=!1}).on("load",function(){n[e]=this}).on("load error",function(){i._spritesChecked()&&r.resolve()})}(e)}),r.done(function(){hideCursor(),i._startChooseImage.call(i)})}})},_getImgDir:function(){return this.model.getImgDir()},_getImgExt:function(){return this.model.getImgExt()},_startChooseImage:function(){if(!this._spritesChecked())return!1;var i=this._getSpriteImages(),s=!1;if(e.each(i,function(t){0!=t&&(s=!0)}),!s)return alert("No available images","Error"),!0;var o=0,r={},a=this._getImgHeight(),l=this._getImgDir();if(e.each(i,function(t,e){if(0!=t){var i=t.height;i&&(r[e]=i/a,o+=r[e])}}),!o)return alert("Can not get images number","Error"),!0;var h=this,c=this.module.getTexts(),d=this.model.getImagePath(),p=(this.$el,u({getBgr:function(t,e){var i=t*a;return"url("+l+"icons_"+e+".png) 50% -"+i+"px no-repeat"},isActive:function(t,e){var i="default"==e?"":e+"/",n=t*_+1;return d==l+i+n+".png"},totalBySprites:r}));return n.window.open({winId:"pop-obj-img",headerHtml:c.chooseObjectImage,contentHtml:p,width:600,initY:50,initX:Math.max(h.$el.offset().left-20,10),resizable:!0,minWidth:400,maxWidth:1200,dieAfter:0,openCallback:function(){var e=this;e.on("click","li",function(){var i=t(this).data("index"),n=t(this).data("key"),s=("default"==n?"":n+"/")+(i*_+1);h.model.setNewImage(s),e.trigger("jw.close")})}}),!0},_spritesChecked:function(){var t=!0;return e.each(this._getSpriteImages(),function(e){null===e&&(t=!1)}),t},_getDeviceImage:function(t,e){var i="";return"VC"==t&&e&&(0===e.indexOf("V-2")?t="V2N":0===e.indexOf("V-L")?t="VLN":0===e.indexOf("V-15")&&(t="V15N")),i=y[t]||y.Unknown,"img/devices/"+i+".jpg"},_activateAutocompletes:function(){if(t.fn.autocomplete){var e=this;this.$el.find(".autocomplete").autocomplete({minLength:2,appendTo:e.$el.content,source:function(t,i){var n=t.term,s=this.element,o=this.element[0].name;if(o in e._fieldsCache&&n in e._fieldsCache[o])return i(e._fieldsCache[o][n]),void 0;var r=++e._autocompleteRequestId;e._settingSuggest(String(t.term),o,r).done(function(t,n){t.length&&(e._fieldsCache[o]=e._fieldsCache[o]||[],e._fieldsCache[o]=t,n===r&&i(t))}).always(function(){s.removeClass("ui-autocomplete-loading")})}})}},_settingSuggest:function(i,n,s){if(/^sim\dprovider$/i.test(n)){var o=new t.Deferred;return t.when(this._settingSuggestRequest(i,"sim1Provider",s),this._settingSuggestRequest(i,"sim2Provider",s)).done(function(t,i){o.resolve(e.unique(t[0].concat(i[0])),s)}),o}return this._settingSuggestRequest.apply(this,arguments)},_settingSuggestRequest:function(e,i,n){var s=new t.Deferred;return t.ajax({url:App.getBaseUrl()+"objects/setting-suggest/",data:{q:e,key:i}}).done(function(t){s.resolve(t,n)}).fail(function(){s.reject()}),s},_activateSubmit:function(){var t=this;this.$el.find("form").on("submit",function(){return t._onSubmit(!1),!1}).find(".btn-apply").on("click",function(){t._onSubmit(!0)})},_onSubmit:function(t){var e=this;t?e._save(!0).fail(function(t){e._showErrors(t)}):e._save(!1).done(function(){e.$el.trigger("jw.close")}).fail(function(t){e._showErrors(t)})},_showErrors:function(t){if(t){var i=this.module.getTexts(),n=this.$el.find("form"),s="",o=null;if(e.isArray(t)){for(var r=t.length;r--;)if("undefined"!=typeof t[r].key)if(e.isArray(t[r].key))for(var a=t[r].key.length;a--;)n.find("[name="+t[r].key[a]+"]").addClass("error");else n.find("[name="+t[r].key+"]").addClass("error");s=e.pluck(t,"msg").join("<br />"),o=n.find(".error").first()}else s=t;alert(s,i.error,{closeCallback:function(){o&&o.focus()}})}},_activateCommonDates:function(){var e=this.$el.find("input.datepicker").datepicker({dateFormat:"dd.mm.yy",minDate:new Date(2005,0,1),maxDate:"+1y"});e.each(function(){t(this).datepicker("widget").appendTo("#jface-windows")})},_activateGroups:function(){var e=this,i=this.$el,n=parseInt(this.model.get("settings").ObjType||App.TYPE_MOBILE);i.find(".item-groups").on("click",".tag .del-link",function(i){i.stopPropagation();var n=t(this).parents(".item-groups");if(1==n.find(".group").length)return!1;for(var s=t(this).parent(".tag"),o=s.data("model"),r=e.model.get("objsGroups"),a=r.length;a--;)r[a].id==o&&r.splice(a,1);return s.remove(),e.model.set("objsGroups",r),!1}).on("click",".btn-add",function(s){s.stopPropagation();var o=t(this),r=t(this).parents(".item-groups"),a=r.find(".itext");if(!a.length)return!1;var l=App.getBaseUrl()+"objs-groups/search/";return a.autocomplete({minLength:2,appendTo:i.content,source:function(e,i){var s=e.term;return s in w[n]?(i(w[n][s]),void 0):(b=t.ajax({url:l,data:{q:e.term,groupType:n},success:function(t,e,o){if(t.length){for(var r=[],a=0,l=t.length;l>a;a++)r[a]={id:t[a].id,label:t[a].name,value:t[a].name};w[n][s]=r,o===b&&i(r)}},complete:function(){a.removeClass("ui-autocomplete-loading")}}),void 0)},select:function(i,n){for(var s=e.model.get("objsGroups"),l=s.length;l--;)if(s[l].id==n.item.id)return!1;var h={id:n.item.id,name:n.item.label};s.push(h),e.model.set("objsGroups",s);var u=t(c(h));return s.length>1?u.insertAfter(r.find(".tag:last")):u.appendTo(r.find(".list")),a.val("").attr("disabled","disabled").hide(),o.show(),!1},complete:function(){}}),a.removeAttr("disabled").show().focus(),o.hide(),!1}).on("keyup",".itext",function(e){if(27==e.keyCode){var i=t(this),n=i.parents(".item-groups");i.val("").attr("disabled","disabled").hide().autocomplete("destroy"),n.find(".btn-add").show()}e.stopPropagation()}).on("keypress",".itext",function(t){return 13==t.keyCode||10==t.keyCode?!1:(t.stopPropagation(),void 0)})},_activatePictures:function(){var t=this,e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=pictures]").on("shown.bs.tab",function(){t.$el.find(".pictures-section").data("init")||x.initCarousel.call(t)}),this.module.get("editable")&&(this.$el.find(".nav-tabs a[data-key]").on("shown.bs.tab",function(){t._pictureForm=null}),this.$el.find(".nav-tabs a[data-key=pictures]").on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="javascript:;" class="card-extra-action add-picture">'+e.addPicture+"</a>"+'<a href="javascript:;" class="card-extra-action delete-picture">'+e.deletePicture+"</a>")}))},_activateSetup:function(){var t=this,e=this.model.get("item");this.$el.on("click",".setup",function(){App.trigger("devicesetup",{id:e.id,name:e.name,extId:e.extId,password:t.model.get("settings").PASS})})},_activateResponsible:function(){var t=this;if(this.$el.on("click",".add-responsible",function(){x.onClickPersonAdd.call(t)}).on("click",".personUp",function(){x.onClickPersonUp.call(t,this)}).on("click",".personDown",function(){x.onClickPersonDown.call(t,this)}).on("click",".personRemove",function(){x.onClickPersonRemove.call(t,this)}).on("click",".copy-responsible",function(){t._initRespCopy()}).on("click",".copy-resp-form .btn-cancel",function(){t._copyRespForm.remove(),t._copyRespForm=null}),this.module.get("editable")){var e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=people]").on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="javascript:;" class="card-extra-action add-responsible">'+e.responsible.persons.addNew+"</a>"+'<a href="javascript:;" class="card-extra-action copy-responsible">'+e.responsible.copyList+"</a>")})}},_getResponsibleFormValue:function(i){var n=this.$el.find(".responsible-section"),s=n.find(".password"),o={},r={},a=[];return e.each(s,function(e){var i=t(e);o[i.attr("name").replace(/_/g,"")]=i.val()}),e.isUndefined(i._phone1)||(e.isArray(i._name)?e.each(i._name,function(t,e){r={key:i._key[e],name:t,phone1:i._phone1[e],phone2:i._phone2[e],comment:i._comment[e]},a.push(r)}):(r={key:i._key,name:i._name,phone1:i._phone1,phone2:i._phone2,comment:i._comment},a.push(r))),o.persons=a,JSON.stringify(o)},_initRespCopy:function(){if(!this._copyRespForm){var e=this,i=this.module.getTexts();this._copyRespForm=t(m({objectId:this.model.get("item").id,i18n:i})).appendTo(this.$el);var s=this._copyRespForm,o=s.find("input"),r=s.find("button[type=submit]"),a=[];s.on("submit",function(){return n.confirm(i.responsible.copyConfirm,i.copy+"?",{okCallback:function(){s.addClass("loading");var t=e._getResponsibleFormValue(e.$el.find(">form").serializeObject(!0));e._copySettingToObjects({RESPONSIVE_PERSONS:t},a).done(function(){e._copyRespForm.remove(),e._copyRespForm=null}).always(function(){s.removeClass("loading")})}}),!1}),o.catcomplete({delay:0,appendTo:s,minLength:2,source:function(t,i){var n=t.term.toLowerCase();n in e._searchCache?i(e._searchCache[n]):App.searchObjectsAndGroups(n).done(function(t){e._searchCache[n]=t,i(t)}).fail(function(){i([])})},select:function(t,i){var n=i.item.model;if(n.isGroup){var s=App.getDevicesGroup(n.id);a=e._collectObjectIds(s)}else a=[n.id];r.prop("disabled",!a.length)}}),o.on("change",function(){this.value||(a=[],r.prop("disabled",!0))})}},_collectObjectIds:function(t){if(!t.get("nbItems"))return[];var i=[],n=t.get("objsGroups"),s=t.get("objs");return n.length&&e.each(n,e.bind(function(t){i=i.concat(this._collectObjectIds(App.getDevicesGroup(t.id)))},this)),s.length&&(i=i.concat(e.pluck(s,"id"))),i=e.uniq(i)},_copySettingToObjects:function(e,i){var n=[],s=i.length,o=App.getBaseUrl()+"objects/obj-settings-save/";if(!s)return(new t.Deferred).resolve();for(;s--;)n.push(t.ajax({url:o,data:{objectId:parseInt(i[s]),settings:e}}));return t.when.apply(t,n)},_activateNotifications:function(){var t=this,e=this.module.getTexts();this.$el.find(".nav-tabs a[data-key=notifications]").one("shown.bs.tab",function(){t._notificationsView=new a({controller:t.module,parent:t,model:t.model,el:t.$el.find(".notifications-section")})}).on("shown.bs.tab",function(){t.$el.find(".jw-footer-content").prepend('<a href="#" data-key="notification" class="card-extra-action add-row">'+e.addNotification+"</a>")})},_activateCameras:function(){var t=this;this.module.getTexts(),this.$el.find(".nav-tabs a[data-key=cameras]").one("shown.bs.tab",function(){t._camerasView=new l({controller:t.module,parent:t,model:t.model,el:t.$el.find(".cameras-section")})})},_activateChangesHistory:function(){var t=this,e=this.$el.find(".nav-tabs a[data-key=history]"),i=this.$el.find(".history-section");e.one("shown.bs.tab",function(){t._historyView=new h({controller:t.module,parent:t,model:t.model,el:i}),e.on("shown.bs.tab",function(){i.trigger("shown")}).on("hidden.bs.tab",function(){i.trigger("hidden")})})},_activateObjStatus:function(){if(App.allowed("objects.status.edit")){var t=this,e=this.$el.find("select[name=objStatus]"),i=t.$el.find(".tech-staff"),n=this.model.get("objStatus"),s=o.prototype.STATUS_SERVICE;n==s&&this._renderTechnician(),e.on("change",function(){var n=e.val();n==s?(t.model.get("tech"),t.model.has("tech")?t._renderTechnician():t._renderServiceStatusSettings()):i.addClass("hidden")})}},_renderTechnician:function(){var t=this.model.get("tech");if(t){var e=this.$el.find(".tech-staff");t.fullname=this.buildFullName(t),e.removeClass("hidden").html(v({technician:t,i18n:this.module.getTexts(),from:this.formatDateTime(t.from),to:this.formatDateTime(t.to)}))}},_renderServiceStatusSettings:function(){var e=this,i=e.$el.find(".tech-staff");x.loadTechnicians.call(this).done(function(){if(e._technicians.length){var n=e.module.getTexts(),s=n.setServiceStatusPeriodLabel;i.removeClass("hidden").html(g({technicians:e._technicians,periods:[{value:900,label:s.replace("#n#",15).replace("#l#",n.minutesLabels[n.whichLabels(900)])},{value:3600,label:s.replace("#n#",1).replace("#l#",n.hoursLabels[0])},{value:10800,label:s.replace("#n#",3).replace("#l#",n.hoursLabels[n.whichLabels(3)])},{value:86400,label:s.replace("#n#",1).replace("#l#",n.hours24Labels[0])},{value:604800,label:s.replace("#n#",1).replace("#l#",n.week1)}],i18n:e.module.getTexts()}));var o=i.find("select[name=servicePeriod]"),r=i.find(".field-date"),a=i.find("input[name=serviceDate]"),l=i.find("input[name=serviceTime]"),h=i.find(".field-tech");a.datepicker({dateFormat:"dd.mm.yy",minDate:"+1d",maxDate:"+1y",showButtonPanel:!0}),a.datepicker("widget").appendTo("#jface-windows"),a.datepicker("setDate","+1d"),t.fn.timepicker&&l.timepicker({minuteStep:1,showMeridian:!1,showInputs:!1,appendWidgetTo:r,orientation:{y:"top",x:"right"}}),o.on("change",function(){var t=parseInt(o.val());t>=0?(h.removeClass("hidden"),0===t?r.removeClass("hidden"):r.addClass("hidden")):(h.addClass("hidden"),r.addClass("hidden"))}),h.find("select").on("change",function(){this.className=""})}})},_onRowRemove:function(e){var i=t(e),n=i.closest("table");i.closest("tr").remove(),n.find("tbody tr").length||n.addClass("hidden").siblings(".no-data").removeClass("hidden")},_processAndValidateData:function(i,n){var s=n||[],r=this.module.getTexts(),a=new t.Deferred;"imei"in i&&i.imei.length&&!/^\d{1,16}$/gi.test(i.imei)&&s.push({key:"imei",msg:r.errors.invalidIMEI}),i.RESPONSIVE_PERSONS=this._getResponsibleFormValue(i),e.isUndefined(i._phone1)||(delete i._key,delete i._phone1,delete i._phone2,delete i._name,delete i._comment),i.id=this.model.get("item").id;var l;if((l=this.model.getNewImage())&&(i.IMAGE_PATH=l),this.model.get("objsGroups").length){var h=this.model.get("objsGroups"),c=h.length;for(i.groupsIds=[];c--;)i.groupsIds.push(h[c].id)}else s.push({key:"groupId",msg:r.errors.addAtLeastOneGroup});if(e.isUndefined(i.cameraName)||delete i.cameraName,!e.isUndefined(i.ivcamid)&&parseInt(i.ivcamid)<0&&(i.ivcamid=""),e.isUndefined(i.pictureCaption)||delete i.pictureCaption,"servicePeriod"in i){var u=parseInt(i.objStatus);u==o.prototype.STATUS_SERVICE&&parseInt(i.servicePeriod)>=0&&i.techId<=0&&s.push({key:"techId",msg:r.errEnterTechnicianNotSelected})}return s.length?a.reject(s):a.resolve()},_save:function(i){if(!this.model||this.loading)return!1;var s=this,r=new t.Deferred,a=this.module.getTexts(),l=this.$el.find("form"),h=l.serializeObject(!0),c=this.model.get("item").imei||"";return this._confirmedImei!==!1||!c||"imei"in h&&h.imei==c?(l.find("input.error, select.error").removeClass("error"),this._processAndValidateData(h).fail(function(t){return r.reject(t)}).done(function(){var n=parseInt(h.objStatus),l={status:n};if(n==o.prototype.STATUS_SERVICE){var c=parseInt(h.servicePeriod);if(c>=0&&h.techId>0)if(l.staffId=parseInt(h.techId),c>0)l.period=1e3*c;else{var u=+new Date,d=a.DateTime.prepareDateField(h.serviceDate),p=d.split("-"),f=h.serviceTime.split(":");2!=f.length&&(f=[0,0]);var m=+new Date(p[0],p[1]-1,p[2],f[0],f[1]);l.period=m-u}}e.each(["objStatus","techId","servicePeriod","serviceDate","serviceTime"],function(t){delete h[t]}),s.loading=!0,s.$el.addClass("loading"),s._executeRequests(l,h).done(function(){s._confirmedImei=!1,s.model.set("objStatus",n),r.resolve(),s.model.update(h,i||!1),i&&(s._historyView&&s._historyView.reload(),n!=o.prototype.STATUS_SERVICE?s.model.set("tech",null):s.model.loadStatus().done(function(){s.model.has("tech")&&s._renderTechnician()}))}).fail(function(e){try{var i=t.parseJSON(e.responseText),n=i.msg}catch(s){var n=a.errors.canNotSave}r.reject(n)}).always(function(){s.$el.removeClass("loading"),s.loading=!1})}),r):(n.confirm(a.imeiChangeConfirm.msg,a.imeiChangeConfirm.hdr,{okCallback:function(){s._confirmedImei=h.imei,s._onSubmit(i)},btnNames:{ok:a.continue}}),r.reject(null))},_executeRequests:function(e,i){return t.when(this.model.saveStatus(e),t.ajax({url:App.getBaseUrl()+"objects/obj-card-save/",data:i}))}});return S}),define("abstracts/itemcard/ItemCardModule",["underscore","abstracts/Module","abstracts/itemcard/CardModel","abstracts/itemcard/views/ItemCardView"],function(t,e){var i=e.extend({constructor:function(){this.cardModel=null,e.apply(this,arguments)},initialize:function(){this.set("editable",this.get("options").editable)},_open:function(t,e,i){this.cardModel.setObject(t);var n=this;showCursor(),$.when(this.cardModel.loadStatus(),this.cardModel.fetch({data:{objectId:t.id}})).done(function(){var t=n.get("editable")?e:i;n._view=new t({model:n.cardModel,module:n}),n.listenToOnce(n._view,"remove",function(){n._view=null})}).always(hideCursor)},getTexts:function(){return this.get("parent").getTexts()}});return i}),define("abstracts/editor/views/EditorView",["jquery","jqueryui","underscore","jface","abstracts/View","_libs/leaflet/plugins/draw/leaflet.draw","text!_common/abstracts/editor/tmpl/panel.html","css!_libs/leaflet/plugins/draw/leaflet.draw.css"],function(t,e,i,n,s,o,r){r=i.template(r);var a=s.extend({constructor:function(){this.loading=!1,this._form=null,this._body=null,this._editLayer=null,this._addressSearchBlock=null,s.apply(this,arguments)},initialize:function(){this._cont=this.model.get("container"),this.render()},render:function(){var t=this.model.getTexts(),e=r({i18n:t});this._cont.prepend(e),this.setElement(this._cont.find(">.panel")),this._form=this.$el.find("form"),this._body=this.$el.find(".panel-body"),this._bindEvents()},_bindEvents:function(){var t=this,e=this.model;this.on("searchsuccess",function(e,i){"marker"==i.options.source?(t._form.find("input[name=address]").removeClass("error").val(e.address||Math._round(i.lat,6)+","+Math._round(i.lon,6)),t._form.find("input[name=lat]").val(i.lat),t._form.find("input[name=lon]").val(i.lon)):t._putAddressMarker.apply(t,arguments)}).on("searchcomplete",function(e){"marker"==e.options.source&&t.$el.removeClass("loading"),t._addressSearchBlock.addClass("active")}),this.listenTo(e,"change:model",function(i,n){if(null===n)t._close();else{var s=e.previous("model");t.$el.removeClass("hidden"),s?t._onCancel(!0,function(){t._destroyEditableObject(),t._renderModelForm.call(t)}):t._renderModelForm.call(t)}}).listenTo(e.get("parent"),"groupremoved",function(e){t.$el.find("select.group-select option[value="+e+"]").remove()}),this.$el.on("click",".btn-cancel",function(){t._onCancel(!1,function(){e.set("model",null)})}),this.on("suggestsuccess",function(t,e){e&&e(t)}).on("suggesterror",function(){}),this._form.on("submit",function(){return t._onSubmit(),!1})},_renderModelForm:function(){if(!this.loading){var e=this.model.get("model");e instanceof this.model.ItemsClass?(this._renderItemForm(e),this._initEditableObject(),this._form.find("select").on("change",function(){var e=t(this);e.val()?e.removeClass("placeholder error"):e.addClass("placeholder")})):e instanceof this.model.GroupsClass&&this._renderGroupForm(e),this._form.find("[name=name]").on("keyup",function(){t.trim(this.value)&&(this.className=this.className.replace(" error",""))}),this.model.trigger("toggleform",this._form.height())}},_renderItemForm:function(){},_renderGroupForm:function(t){var t=t||this.model.get("model"),e=this.model.getTexts();this._body.html(this._tmplGroup(i.extend({},t.attributes,{i18n:e}))),this._body.find("input[type=text]").first().focus()},_initAddressSearch:function(){var e=this,i=this._form.find("input[name=address]"),n=this.model.get("mapsModule"),s=n.getWidget();this._addressSearchBlock=this.$el.find(".form-search"),this._addressSearchBlock.on("click",".icon-clear",function(){i.val(""),e._addressSearchBlock.removeClass("active"),e.model.get("model").id||(e._form.find("input[name=lat],input[name=lon]").val(0),e._destroyEditableObject()),e._initEditableObject()}).on("click",".btn-search",function(){var t={q:i.val(),type:"address",center:s.getCenter(),bounds:s.getBounds(),options:{source:"field"}};e._search(t,null)}),t.fn.autocomplete&&i.autocomplete({minLength:2,source:function(t,i){var o={q:t.term,type:"address",center:s.getCenter(),bounds:s.getBounds()};n.publish("needsuggest",o,i,e)},select:function(t,n){if(n.item){i.val(n.item.value);var o={q:n.item.value,type:"address",center:s.getCenter(),bounds:s.getBounds(),options:{source:"field"}};e._search(o,n.item.original||null)}return window.setTimeout(function(){i.blur()},0),!1}})},_search:function(t,e){var i=this.model.get("mapsModule");i.publish("needsearch",t,this,e||null)},_putAddressMarker:function(t){if(this._editLayer){var e=[t[0].lat,t[0].lon];this._editLayer.setPosition(e);var i=this._form.find("input[name=lat]"),n=this._form.find("input[name=lon]");i.val(e[0]),n.val(e[1])}},_initEditableObject:function(){var t=this,e=this.model.get("mapsModule");
	this._editLayer=e.getWidget().buildEditablePoint({addPoints:!0}),e.addLayer(this._editLayer),this._editLayer.on("dragend",function(e){t._updateAddress(e.position)})},_updateAddress:function(t){this.$el.addClass("loading"),this.model.get("mapsModule").trigger("needgeoinfo",{lat:t[0],lon:t[1],options:{source:"marker"}},this)},_onSubmit:function(){if(this.loading)return!1;var t=this,e=this.model;this.loading=!0;var i=!1,n=setTimeout(function(){i=!0,t.$el.addClass("loading")},200);return this._form.find("input[type=file]").length||(this._form.find(".error").removeClass("error"),e.saveModel(t._form.serializeObject()).fail(function(e){e&&t._showErrors(e)}).always(function(){clearTimeout(n),i&&t.$el.removeClass("loading")&&(i=!1),t.loading=!1})),!1},_onCancel:function(t,e){var i=this.model,s=this.model[t?"previous":"get"]("model"),o=this.model.getTexts();if(s&&s instanceof this.model.ItemsClass&&s.id){if(this.model.modelChanged)return n.confirm(o.allChangesCancel,o.cancelChanges,{okCallback:function(){i.modelChanged=!1,e&&e()},cancelCallback:function(){t&&i.set("model",s,{silent:!0})}});e&&e()}else i.modelChanged=!1,e&&e()},_showErrors:function(t){var e=this.model.getTexts(),n="",s=null;if(i.isArray(t)){for(var o=t.length;o--;)if("undefined"!=typeof t[o].key)if(i.isArray(t[o].key))for(var r=t[o].key.length;r--;)this._form.find('[name="'+t[o].key[r]+'"]').addClass("error");else this._form.find('[name="'+t[o].key+'"]').addClass("error");n=i.pluck(t,"msg").join("<br />"),s=this._form.find(".error").first()}else n=t;alert(n,e.error,{closeCallback:function(){s&&s.focus()}})},_showErrorsTips:function(t){var e=this,n=this.model.getTexts(),s=[],o=null;i.each(t,function(t){"undefined"!=typeof t.key?e.$el.find('[name="'+t.key+'"]').tip(t.msg,"formerror"):s.push(t.msg)}),o=this._form.find(".error").first(),s.length&&alert(s.join("<br />"),n.error,{closeCallback:function(){o&&o.focus()}})},_close:function(){this.$el.addClass("hidden");var t=this.model.previous("model");this.stopListening(t),this._destroyEditableObject(),this._body.empty(),this.model.trigger("toggleform",0)},_destroyEditableObject:function(){this._editLayer&&this._editLayer.trigger("destroy")&&(this._editLayer=null)}});return a}),define("abstracts/editor/EditorModule",["jquery","_libs/jquery/jquery.form","underscore","abstracts/Module","abstracts/editor/views/EditorView"],function(t,e,i,n){var s=n.extend({defaults:{model:null},constructor:function(){this.ItemsClass=null,this.GroupsClass=null,this.modelChanged=!1,this._itemEditUrl="",this._itemCreateUrl="",this._groupEditUrl="",this._groupCreateUrl="",n.apply(this,arguments)},initialize:function(t){!this.has("mapsModule")&&this.has("options")&&this.set("mapsModule",this.get("options").mapsModule||null),!this.has("container")&&this.has("options")&&this.set("container",this.get("options").container||null),this.get("container")&&(this._view=new t({model:this}))},saveModel:function(e){var n=this,s=new t.Deferred;if(!this.has("model"))return s.reject();var o=!0,r=this.get("model");return r.id&&(o=!1,e.id=r.id),r instanceof this.GroupsClass?n._saveGroup(e).done(function(t){r.set(i.omit(t,"items")),n.get("parent").trigger(o?"groupadded":"groupchanged",r),n.set("model",null)}):s.reject()},getGroupsList:function(){return this.get("parent").getGroupsList()},getTexts:function(){return this.get("parent").getTexts()},_saveItem:function(){},_validateItem:function(){},_saveGroup:function(e){var i,n=new t.Deferred;if(i=this._validateGroup(e))return n.reject(i);var s=this;return t.ajax({url:e.id?this._groupEditUrl:this._groupCreateUrl,data:e,success:function(t){n.resolve("undefined"!=typeof t.groups?t.groups[0]:t)},error:function(i,o,r){if(500==i.status)try{var a=t.parseJSON(i.responseText);alert(a.msg,a.hdr),e.id?(n.resolve(),s.get("parent").trigger("groupremoved",e.id)):n.reject(r)}catch(l){n.reject(r)}else n.reject(r)}}),n},_validateGroup:function(t,e){var i=[];return t.name=String(t.name||""),t.name||i.push({msg:e.name.empty,key:"name"}),i.length?i:null}});return s}),define("abstracts/editor/DeviceEditorModule",["jquery","underscore","abstracts/editor/EditorModule"],function(t,e,i){var n=i.extend({constructor:function(){i.apply(this,arguments)},initialize:function(t){this._itemEditUrl=App.getBaseUrl()+"objects/obj-settings-save/",this._groupEditUrl=App.getBaseUrl()+"objs-groups/edit/",this._groupCreateUrl=App.getBaseUrl()+"objs-groups/create/",i.prototype.initialize.call(this,t)},saveModel:function(e){var n=this,s=new t.Deferred;if(!this.has("model"))return s.reject();var o=this.get("model");return o.id&&(e.id=o.id),o instanceof this.ItemsClass?n._saveItem(e).done(function(t){n._onItemSaved(t,e),n.set("model",null)}).fail(function(t){s.reject(t)}):(e.parentId||(e.parentId=null),i.prototype.saveModel.call(n,e))},_saveItem:function(i){var n,s=new t.Deferred;if(n=this._validateItem(i))return s.reject(n);var o={settings:e.clone(i)};return i.id&&(o.objectId=i.id,delete o.settings.id),e.each(o.settings,function(t,e){o.settings[e]=String(t)}),t.ajax({url:o.objectId?this._itemEditUrl:this._itemCreateUrl,data:o,complete:function(t){t.status>=200&&t.status<300?s.resolve(i):s.reject()}}),s},_validateItem:function(){return null},_onItemSaved:function(){},_validateGroup:function(t){var e=this.getTexts();return i.prototype._validateGroup.call(this,t,{name:{empty:e.enterGroupName}})}});return n}),define("_common/mobile/MobileObject",["underscore","jquery","abstracts/GrObject"],function(t,e,i){function n(t){var e=t.replace("REV ","").split(".");if(e.length<3)return[0,0,0];for(var i=0;3>i;++i)e[i]=e[i].substr(0,3).replace("~[^0-9]~","").replace("~^0+~","");return e}var s=i.extend({constructor:function(){i.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",defaults:t.extend({},i.prototype.defaults,{objType:App.TYPE_MOBILE,color:"",licenseNumber:"",model:"",speed:0,minSpeed:1.001,course:0,alt:0,isGpsOnline:0,isGsmOnline:0,isFollowed:0,restricted:null,rev:""}),parse:function(t){var e=t.item||t.length&&t[0]||t;return"undefined"!=typeof e.img&&(e.imgPath=e.img),e.hwStatus=s.detectHardwareStatus(e),"objStatus"in e||(e.objStatus=this.STATUS_SERVED),e.hasAlarm&&!i.alarmsAllowed(e.objStatus)&&(e.hasAlarm=!1),e.coords=[e.lat,e.lon],e.isFollowed="undefined"!=typeof e.isFollowed?"0"==e.isFollowed?0:1:0,delete e.SIM,delete e.pass,e},isOnline:function(){return 1==this.get("isGsmOnline")},getImgPath:function(t){var e=""+this.get("imgPath"),i=e,n=this.get("course");if(t&&n>0&&360>=n){var s,o=e.lastIndexOf("/");s=-1==o?e:e.substr(o+1),s=parseInt(s)+(180>=n?2:0),i=-1!=o?e.substr(0,o+1)+s:s}return this.IMG_DIR+i+this.IMG_EXT},setControlCommand:function(t,i){var n=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"objects/set-control-command/",data:{objectId:this.id,controlNum:t,command:i},complete:function(t){t.status>=200&&t.status<300?n.resolve():n.reject(t)}}),n},setFollowMode:function(t){return e.ajax({url:App.getBaseUrl()+"objects/obj-followed-save/",data:{objectId:this.id,isFollowed:t}})},setPoliceTranslation:function(t){return e.ajax({url:App.getBaseUrl()+"objects/turn-position-translation/",data:{objectId:this.id,enabled:t}})}});return s.detectCANbyRev=function(t){if(!t)return!1;var e=[];return e="string"==typeof t?n(t):t,3!=e.length?!1:504==e[1]||505==e[1]},s.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e="offline";return"isGpsOnline"in t&&"isGsmOnline"in t&&(t.isGpsOnline&&t.isGsmOnline?e="online":t.isGsmOnline&&(e="fault")),e},s}),define("_common/mobile/MobileObjectsCollection",["abstracts/ObjectsCollection","_common/mobile/MobileObject"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",model:e});return i}),define("_common/mobile/MobileDetails",["underscore","./MobileObject"],function(t,e){var i=e.extend({constructor:function(){e.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj-details/",defaults:t.extend({},e.prototype.defaults,{rev:"",address:null,lastGPSConnectionTime:0,lastGSMConnectionTime:0,power:0,discrets:[],discretsState:"",controls:[],controlsState:"",driversInfo:"",responsive:"",policeTranslation:!1,ivideon:null}),parse:function(i){var n=e.prototype.parse.call(this,i);return"undefined"!=typeof n.lastGPSConnectionTime&&(n.lastGPSConnectionTime*=App.MS),"undefined"!=typeof n.lastGSMConnectionTime&&(n.lastGSMConnectionTime*=App.MS),t.each(["discrets","controls"],function(t){"undefined"!=typeof n[t]&&(n[t+"State"]=JSON.stringify(n[t]))}),"undefined"!=typeof n.power&&(n.power=n.power.state),"undefined"!=typeof n.driversInfo&&(n.driversInfo=JSON.stringify(n.driversInfo)),"undefined"!=typeof n.VZOR_GIBDD_ENABLED&&n.VZOR_GIBDD_ENABLED&&(n.policeTranslation=!0),n},getCurrentStaff:function(){var e=[];try{var i=$.parseJSON(this.get("driversInfo")),n=(new Date).getTime();i.length&&(t.each(i,function(t){t.startTime<n&&t.endTime>n&&e.push($.trim(t.staff.name))}),e=t.uniq(e))}catch(s){}return e}});return i}),define("abstracts/watched/views/DeviceInfoView",["jquery","underscore","abstracts/View","text!../tmpl/deviceInfoHeader.html","text!../tmpl/operateSuccess.svg"],function(t,e,i,n,s){n=e.template(n);var o=".devicedetails",r=i.extend({constructor:function(t){this.parent=t.parent,this.controller=t.controller,this.extended=!0,this.$content=null,this._xhr=null,this._timeout=null,this._controlIndex=null,i.apply(this,arguments)},initialize:function(t){return t.objectId?(this._setModel(t.objectId),this.render(),this._bindEvents(),void 0):(this.trigger("close"),void 0)},render:function(){var t=this,e=this.$el.find(".leaflet-popup-content");this.$el.addClass("extended loading"),e.find(".contents").length||(e.html(this._renderHeader()+'<div class="contents"></div>'+this._renderFooter()),this.$content=this.$el.find(".contents")),this._update({silent:!0}).done(function(){t.$el.find(".name").text(t.model.get("name")),t.model.has("ivideon")&&t.$el.find(".icon-video").removeClass("hidden"),t._renderContent(),t.$el.removeClass("loading"),t.$el.trigger("contentchange")}).fail(function(){})},setActivePage:function(t){var e=this.$el.find(".content.active")[0],i=this.$el.find(".content[data-key="+t+"]")[0];e.className=e.className.replace(" active",""),i.className+=" active",this.$el.trigger("contentchange")},remove:function(){this._stopUpdate(),this.stopListening(this.model).stopListening(this.controller).stopListening(this.controller.get("parent")),this.$el.off(o),this.$content&&this.$content.remove()},getDetailedModelClass:function(){},_renderHeader:function(){return n(this._getHeaderOptions())},_getHeaderOptions:function(){return{i18n:this._getTexts(),editable:App.allowed("objects.edit")||App.allowed("objects.create"),reports:App.hasModule("reports"),tracks:App.hasModule("tracks"),extended:!0,name:this.model.get("name"),hiddenProps:this.controller.getHiddenProperties()}},_renderContent:function(){return""},_renderFooter:function(){return""},_getEventsNS:function(){return o},_bindEvents:function(){var i=this,n="click"+this._getEventsNS();this.listenTo(this.parent,"clear",function(){i.trigger("close")});var s=this.controller.get("parent");this.listenTo(s,"stopwatching",function(){i._stopUpdate(),i.listenToOnce(s,"startwatching",function(){i._update()})}),this._bindModelEvents(),this.on("propschange",function(){var n=i.controller.getHiddenProperties();i.$el.find("[data-prop]").each(function(){var i=t(this);-1!=e.indexOf(n,i.data("prop"))?i.addClass("hidden"):i.removeClass("hidden")})}),this.$el.on(n,".icon-close",function(){i.trigger("close")}).on(n,".icon-target",function(){i.controller.trigger("itemzoom",i.model)}).on(n,".unwatch",function(){i.trigger("close"),i.controller.toggleItem(i.model.id)}).on(n,".icon-card",function(){i.trigger("close"),i.controller.get("parent").trigger("itemcardopen",i.model)}).on(n,".icon-video",function(){i.trigger("close"),App.trigger("needdevicevideo",i.model)}).on(n,".icon-alerts",function(){i.trigger("close"),App.trigger("needdevicehistory",i.model)}).on(n,"[data-page]",function(){var e=t(this).data("page");return i.setActivePage(e),!1}).on(n,".back",function(){var e=t(this).data("target");e&&i.setActivePage(e)}),"undefined"!=typeof PRODUCTION&&this.$el.on("contextmenu",function(){return!1}),this._initOperate()},_bindModelEvents:function(){var t=this;e.each(["name"],function(i){t.listenTo(t.model,"change:"+i,function(n,s){t.$el.find("."+i).text(e.isNull(s)?"":s)})}),this.listenTo(t.model,"change:ivideon",function(e,i){var n=i&&"ivcamid"in i&&i.ivcamid>-1;t.$el.find(".icon-video")[n?"removeClass":"addClass"]("hidden")})},_setIndicatorState:function(t,e){t.attr("data-state","number"==typeof e?e:e?"1":"0")},_setModel:function(t){var e=this.getDetailedModelClass(),i=new e({id:t});this.model=i},_update:function(t){t=t||{};var e=this,i=t.silent===!0;if(this._timeout&&clearTimeout(this._timeout),!i&&!App.get("visible"))return e._timeout=setTimeout(function(){e._update()},e._getUpdatePeriod()),void 0;var n=!1,s=setTimeout(function(){e.$el.addClass("loading"),n=!0},t.showLoading?50:e.model.isOnline()?8e3:4e3);return this._xhr=this.model.fetch({silent:i||!1,data:{objectId:[this.model.id],tz:App.getUserTimezone()}}).done(function(){e._timeout=setTimeout(function(){e._update()},e._getUpdatePeriod())}).always(function(){s&&clearTimeout(s),n&&e.$el.removeClass("loading"),e._xhr=null}),this._xhr},_getUpdatePeriod:function(){return this.model.get("objType")==App.TYPE_MOBILE?7e3:15e3},_stopUpdate:function(){this._xhr&&this._xhr.abort(),this._timeout&&clearTimeout(this._timeout),this._xhr=this._timeout=null},_initOperate:function(){var e=this,i="click"+this._getEventsNS();this.$el.on(i,"[data-page=operate]",function(i){return i.stopPropagation(),e._controlIndex=t(this).data("index"),e._renderOperate(),!1}).on(i,"[data-key=operate] .back",function(){return e._controlIndex=null,!1}).on(i,".operate-actions [data-command]",function(){return e._sendOperate(t(this).data("index"),t(this).data("command")),!1})},_renderOperate:function(){},_sendOperate:function(){return(new t.Deferred).reject("Abstract method _sendOperate called")},_onOperateSuccess:function(){var t=this,e=this._getTexts(),i=this.$el.find(".operate-content");i.addClass("command-complete success").find(".operate-state .state-wrap").html(s).end().find(".operate-actions").html('<p class="command-msg">'+e.commandSent+"</p>"),setTimeout(function(){t._closeOperate(),t.model.isOnline()&&(t._stopUpdate(),t._update({showLoading:!0}))},1e3)},_closeOperate:function(){this._controlIndex=null,this.setActivePage("summary")},_formatConnectionTime:function(){var t="";return t=this.model.isOnline()?this.controller.getTexts().online:this.formatDateTime(this.model.get("lastGSMConnectionTime"))},_getTexts:function(){return{}}});return r}),define("mobile/nls/mobile",{root:{l:"l",l100km:"l/100km",l1h:"l/1h",ms2:"m/sec2",acp:"ADC",objRouteNumber:"Route No",followedMode:'"Follow" mode',indicateTrackedSensorState:"Change the external view based on the sensor state",volume:"volume",ignition:"ignition",fuel:"fuel",fuelVolume:"Fuel level",sensorsAndDevices:"Connections",filters:"Filters",objFollowOn:'Enable "Follow" mode',objFollowOff:'Disable "Follow" mode',parks:"Parkings",parkBegin:"start",parkEnd:"end",parkTime:"parking time",parksTime:"Parking time",filtersSettings:"Filter options",states:{standard:"Standard state",repared:"Repair",technicalService:"Maintenance",switchedOff:"Switched off"},connectionTime:"Connection time",coordinatesTime:"Fixture time",chartsSettings:"Chart settings",fuelLevelSensor:"Fuel level sensor",flowSensorOnInput:"Input flow-through",flowSensorOnOutput:"Output flow-through",sensorNotInstalled:"No sensor installed",impulsesByLiter:"Pulses per litre",fuelConsumptionNormForSummer:"Summer consumption rate",fuelConsumptionNormForWinter:"Winter consumption rate",calibrationTable:"Calibration table",calibrationTableIsEmpty:"The calibration table is empty",tankVolume:"Tank volume",controlOut:"output",filling:"refueling",minFilling:"Minimum refueling",discharge:"discharge",minDischarge:"Minimum discharge",fillings:"refuelings",discharges:"discharges",stepOfMedianFilter:"Median filter step",maxUsedSensorValues:"Upper ADC throughput threshold",minUsedSensorValues:"Lower ADC throughput threshold",errAcpLimits:"The lower ADC threshold must be less than the upper threshold.",coordinatesFiltersByCondition:"Coordinate filters by the condition",useCoordinatesOnlyIfIgnitionIsOn:"Use coordinates only with ignition on",useCoordinatesOnlyWhenMovingOrEventHappens:"Use coordinates only in case of motion or events",useCoordinatesIfSpeedWithinTheRange:"Use coordinates only within specified speed limits",minObjectSpeed:"Minimum object speed",maxObjectSpeed:"Maximum object speed",filtersOfFalseCoordinates:"Wrong coordinates filters",useCoordinatesWithoutLargeDeviationFromParkingPlace:'Use coordinates without disturbances from the parking location ("star" filter)',useCoordinatesWithoutLargeDeviationFromTrack:'Use coordinates without disturbances from the vehicle direction ("jump" filter)',useCoordinatesOnlyWithAltitude:"Use coordinates with height fixture",useCoordinatesOnlyWithGoodSignal:"Use coordinates with high quality signal (high level of signal/noise)",useCoordinatesOnlyWithGoodVoltage:"Use coordinates obtained under device supply voltage at most 37V",parkPlacesFilters:"Parking filters",detectParksIfContinueMoreThan:"Determine parkings with duration more than",detectMovementBetweenParksIfContinuesMoreThan:"Determine movement between parkings with duration more than",dataHasBeenRecalculated:"Recalculated",dataHasBeenPrepared:"The data is ready",clearAndRecalculateDataFromSelectedDate:"Recalculate data from",clearHistoryHelp:"Recalculation will delete the data previously prepared for reports. The data will be recalculated again from the selected date to the current date",clearHistoryInfo:"The data clearing and recalculation are in progress. Recalculation will delete the data previously prepared for reports. The data will be recalculated again from #date# to the current date.",clearHistoryInfoShort:"The data clearing and recalculation are in progress",clearHistoryHelp1:"After the data is deleted, the recalculation will start automatically. This can be time consuming.",clearingDataFrom:"Delete data from",assignedStaff:"Current vehicle",showStaff:"Show current vehicle",workInterval:"Shift",stafState:"Mode",recordTime:"Recording time",odometer:"Odometer",noStaffAssigned:"No vehicle is assigned at the moment.",driver:"Driver",confirmShowTrackForGroup:"Generate the track using more than 10 objects?",alertCantbBuildTrackWithEmpty:"Unable to generate tracks using an empty group",alertCantbBuildReportWithEmpty:"Unable to generate the report using an empty group",haveNoPermission:"You do not have object card editing privileges",canNotExportReport:"Report export failed",errorChangeOutput:"Output state changing failed.",policeTranslation:"Sending to the Road Police",policeTranslationConfirm:{hdr:"Confirm the action",msg:"#action# object data sending to the Road Police?"},policeTranslationState:{on:"Disable sending to the Road Police",off:"Enable sending to the Road Police"}},"ru-ru":!0,"it-it":!0,"de-de":!0}),define("mobile/nls/ru-ru/mobile",{l:"л",l100km:"л/100км",l1h:"л/1ч",ms2:"м/с2",acp:"АЦП",objRouteNumber:"№ маршрута",followedMode:"Режим слежения",indicateTrackedSensorState:"Менять внешний вид в зависимости от состояния датчика",volume:"объем",ignition:"зажигание",fuel:"топливо",fuelVolume:"Уровень топлива",sensorsAndDevices:"Подключения",filters:"Фильтры",objFollowOn:"Включить слежение",objFollowOff:"Выключить слежение",parks:"Стоянки",parkBegin:"начало",parkEnd:"окончание",parkTime:"время стоянки",parksTime:"Время стоянок",filtersSettings:"Параметры фильтров",states:{standard:"Стандартное состояние",repared:"Ремонтные работы",technicalService:"Тех. обслуживание",switchedOff:"Отключен"},connectionTime:"Время соединения",coordinatesTime:"Время фиксации",reportParams:"Параметры отчета",chartsSettings:"Настройки графиков",fuelLevelSensor:"Датчик уровня топлива",flowSensorOnInput:"Проточный на входе",flowSensorOnOutput:"Проточный на выходе",sensorNotInstalled:"Датчик не установлен",impulsesByLiter:"Импульсов на литр",fuelConsumptionNormForSummer:"Норма расхода летом",fuelConsumptionNormForWinter:"Норма расхода зимой",calibrationTable:"Тарировочная таблица",calibrationTableIsEmpty:"Тарировочная таблица не заполнена",tankVolume:"Объем бака",controlOut:"выход",filling:"заправка",minFilling:"Минимальная заправка",discharge:"слив",minDischarge:"Минимальный слив",fillings:"заправки",discharges:"сливы",stepOfMedianFilter:"Шаг медианного фильтра",maxUsedSensorValues:"Верхний пропускной порог АЦП",minUsedSensorValues:"Нижний пропускной порог АЦП",errAcpLimits:"Нижний порог АЦП должен быть ниже верхнего порога.",coordinatesFiltersByCondition:"Фильтры координат по условию",useCoordinatesOnlyIfIgnitionIsOn:"Использовать координаты, только при включенном зажигании",useCoordinatesOnlyWhenMovingOrEventHappens:"Использовать координаты только при движении и событиях",useCoordinatesIfSpeedWithinTheRange:"Использовать координаты в пределах указанного диапазона скоростей",minObjectSpeed:"Минимальная скорость объекта",maxObjectSpeed:"Максимальная скорость объекта",filtersOfFalseCoordinates:"Фильтры ошибочных координат",useCoordinatesWithoutLargeDeviationFromParkingPlace:'Использовать координаты без резких отклонений от места стоянки (фильтр "звезд")',useCoordinatesWithoutLargeDeviationFromTrack:'Использовать координаты без резких отклонений от курса движения (фильтр "прыжков")',useCoordinatesOnlyWithAltitude:"Использовать координаты с фиксацией по высоте",useCoordinatesOnlyWithGoodSignal:"Использовать координаты при хорошем качестве сигнала (высоком уровне сигнал/шум)",useCoordinatesOnlyWithGoodVoltage:"Использовать координаты, полученные при напряжении питания прибора не более 37В",parkPlacesFilters:"Фильтры стоянок",detectParksIfContinueMoreThan:"Определять стоянки продолжительностью более",detectMovementBetweenParksIfContinuesMoreThan:"Определять движение между стоянками продолжительностью более",dataHasBeenRecalculated:"Пересчитано",dataHasBeenPrepared:"Данные подготовлены",clearAndRecalculateDataFromSelectedDate:"Пересчитать данные с",clearHistoryHelp:"При пересчете, ранее подготовленные для отчетов данные будут удалены и рассчитаны заново с выбранной даты до настоящего момента",clearHistoryInfo:"Идет процесс очистки и пересчета данных. После пересчета, ранее подготовленные для отчетов данные будут удалены и рассчитаны заново с #date# до настоящего момента.",clearHistoryInfoShort:"Идет процесс очистки и пересчета данных",clearHistoryHelp1:"После удаления данных автоматически начнется пересчет, это может занять продолжительное время.",clearingDataFrom:"Удаление данных с",assignedStaff:"Текущий экипаж",showStaff:"Показать текущий экипаж",workInterval:"Смена",stafState:"Режим",recordTime:"Время записи",odometer:"Одометр",noStaffAssigned:"В настоящее время экипаж не назначен.",driver:"Водитель",confirmShowTrackForGroup:"Построить трек по более чем 10 объектам?",alertCantbBuildTrackWithEmpty:"Нельзя построить треки по пустой группе",alertCantbBuildReportWithEmpty:"Нельзя строить отчет по пустой группе",haveNoPermission:"У вас нет прав на редактирование карточки объекта",canNotExportReport:"Не удалось экспортировать отчет",errorChangeOutput:"Не удалось изменить состояние выхода.",policeTranslation:"Передача в ГИБДД",policeTranslationConfirm:{hdr:"Подтвердите действие",msg:"#action# передачу данных об объекте в ГИБДД?"},policeTranslationState:{on:"Отключить передачу в ГИБДД",off:"Включить передачу в ГИБДД"}}),define("_common/mobile/watched/views/MobileInfoView",["jquery","underscore","geo","jface","_common/mobile/MobileDetails","abstracts/watched/views/DeviceInfoView","i18n!_common/nls/common","i18n!mobile/nls/mobile","text!../tmpl/objInfo.html","text!../tmpl/baloonFooter.html","text!../tmpl/staffInfo.html","text!../tmpl/discrets.html","text!../tmpl/controls.html","text!../tmpl/operate.html"],function(t,e,i,n,s,o,r,a,l,h,c,u,d,p){l=e.template(l),h=e.template(h),c=e.template(c),u=e.template(u),d=e.template(d),p=e.template(p);var f=t.extend({},r,a),m=100,g=o.extend({constructor:function(){this.$address=null,o.apply(this,arguments)},initialize:function(){this.$el.addClass("mobile-obj-info"),o.prototype.initialize.apply(this,arguments)},getDetailedModelClass:function(){return s},_bindEvents:function(){var t=this,e="click"+this._getEventsNS();o.prototype._bindEvents.apply(this,arguments);var i=this.controller.get("parent").getMapsModule();i&&(this.listenTo(i,"mapchanged",function(){v.onAddressChange.call(t)}),this.$el.on(e,".route-from",function(){t.trigger("close");var e=t.model.get("name");return i.openRouting([{type:"mobile",text:e,model:t.model,lat:t.model.get("lat"),lon:t.model.get("lon")}],t.$el),!1})),this.on("searchstart",function(){t.$address&&t.$address.parent().addClass("loading")}).on("searchcomplete",function(){t.$address&&t.$address.parent().removeClass("loading")}).on("searchsuccess",function(e){t.model.set("address",e.address)}).on("searcherror",function(){var e=Math._round(t.model.get("lat"),4)+", "+Math._round(t.model.get("lon"),4);t.model.set("address",e)}),App.hasModule("tracks")&&this.$el.on(e,".icon-track",function(){return t.controller.trigger("needtrack",[t.model]),t.trigger("close"),!1}),App.reportsAllowed("mobile")&&this.$el.on(e,".icon-report",function(){return App.trigger("needreport","mobile",[t.model]),t.trigger("close"),!1})},_bindModelEvents:function(){var t=this;o.prototype._bindModelEvents.apply(this,arguments),e.each(["licenseNumber","speed","alt"],function(i){t.listenTo(t.model,"change:"+i,function(n,s){"speed"==i&&(s=Math.round(s),s<n.get("minSpeed")&&(s=0)),t.$el.find("."+i).text(e.isNull(s)?"":s)})}),this.listenTo(this.model,"change:coords",function(e){var n=e.previous("lat"),s=e.previous("lon"),o=i.getDistanceBetweenPoints(n,s,e.get("lat"),e.get("lon"));o>m&&v.onAddressChange.call(t)}).listenTo(this.model,"change:address",function(e,i){t.$address&&t.$address.text(i)}),this._bindIndicatorsChanges(),this.listenTo(this.model,"change:driversInfo",function(){t._renderStaff()}).listenTo(this.model,"change:policeTranslation",function(e,i){t.$el.find(".indicator.police").removeClass("on off").addClass(i?"on":"off")})},_bindIndicatorsChanges:function(){var t=this;this.listenTo(this.model,"change:lastGPSConnectionTime",function(e,i){t.$el.find(".lastGPSConnectionTime").text(t.formatDateTime(i))}).listenTo(this.model,"change:lastGSMConnectionTime change:isGsmOnline",function(){t.$el.find(".lastGSMConnectionTime").text(t._formatConnectionTime())}),e.each(["isGpsOnline","isGsmOnline"],function(e){!function(e){t.listenTo(t.model,"change:"+e,function(i,n){t._setIndicatorState(t.$el.find("."+e),n)})}(e)}),this.listenTo(this.model,"change:power",function(e,i){t._setIndicatorState(t.$el.find(".power"),0==i)}),e.each(["discretsState","controlsState"],function(e){!function(e){t.listenTo(t.model,"change:"+e,function(){t["_render"+e.replace("State","").ucFirst()].call(t)})}(e)}),e.each(["localRID","remoteRID"],function(e){!function(e){t.listenTo(t.model,"change:"+e,function(e){var i=null,n=e.get("localRID")||0,s=e.get("remoteRID")||0,o=t.$el.find(".rid-progress");s>0?(n>s&&(n=s),i=Math.round(100*n/s),o.length&&(o.is(".hidden")&&o.removeClass("hidden"),o[0].style.width=i+"%"),t.$el.find(".localRID").text(n),t.$el.find(".remoteRID").text(s),t.$el.find(".rid-percent").text(i)):o.addClass("hidden")})}(e)})},_renderContent:function(){if(this.$content){var t=e.extend({},this.model.attributes,{i18n:f,extended:!0,geoId:this.model.has("geoId")?this.model.get("geoId"):0,addressStr:this.model.has("address")?this.model.get("address"):Math._round(this.model.get("lat"),4)+", "+Math._round(this.model.get("lon"),4),hiddenProps:this.controller.getHiddenProperties()});e.extend(t,{lastGSMConnectionTimeS:this._formatConnectionTime(),lastGPSConnectionTimeS:this.formatDateTime(this.model.get("lastGPSConnectionTime")),ridPercent:null}),t.remoteRID&&(t.localRID>t.remoteRID&&(t.localRID=t.remoteRID),t.ridPercent=Math.round(100*t.localRID/t.remoteRID)),this.$content.html(l(t)),this.$address=this.$el.find(".address"),this.model.has("address")||v.onAddressChange.call(this),this._renderDiscrets(),this._renderControls(),this._renderStaff()}},_renderFooter:function(){var t=this.controller.get("parent").getMapsModule();return h({i18n:f,routingModule:t&&t.modules.routing||null})},_renderDiscrets:function(){this.$el.find(".discrets").html(u({discrets:this.model.get("discrets")}))},_renderControls:function(){var t=this.model.get("controls"),e=this._controlIndex;this.$el.find(".controls").html(d({controls:t})),e&&(e in t&&"possibleStates"in t.index?this._renderOperate():this._closeOperate())},_renderStaff:function(){var e=this.model.get("driversInfo"),i=this.$el.find("a[data-page=staff]"),n=this.$el.find(".content[data-key=staff]");try{var s=t.parseJSON(e),o=c({driversInfo:s,i18n:f});n.html(o),s.length?i.removeClass("hidden"):i.addClass("hidden")}catch(r){i.addClass("hidden"),this.setActivePage("summary")}},_renderOperate:function(){if(this._controlIndex){var t=this.model.get("controls"),e=this.$el.find(".content[data-key=operate]");t&&this._controlIndex in t?e.html(p({i18n:f,index:this._controlIndex,control:t[this._controlIndex],commands:{on:1,off:2,auto:3}})):this._closeOperate()}},_sendOperate:function(t,e){var i=this;this.$el.addClass("loading"),this.model.setControlCommand(t,e).done(function(){i._onOperateSuccess()}).fail(function(t){i.showErrors(t,f.errorChangeOutput)}).always(function(){i.$el.removeClass("loading")})},_getTexts:function(){return f}}),v={onAddressChange:function(){this.$address&&this.$address.length&&this.controller.trigger("needgeoinfo",this.model.pick("lat","lon"),this)}};return g}),define("_common/stat/StatObject",["underscore","jquery","abstracts/GrObject"],function(t,e,i){var n=i.extend({constructor:function(){i.apply(this,arguments)},IMG_DIR:"img/stat/",HW_STATE_ARMED:2,HW_STATE_DISARMED:1,CSD_CALL_STATE_NOT_FOUND:0,CSD_CALL_STATE_PROCESSING:1,CSD_CALL_STATE_FAIL:2,CSD_CALL_STATE_SUCCESS:3,url:App.getBaseUrl()+"objects/obj",defaults:t.extend({},i.prototype.defaults,{objType:App.TYPE_STAT,addressShort:"",isOnline:0,isGuarded:0,hasFault:0,faults:null}),parse:function(e){var s=e.item||e.length&&e[0]||e;return"undefined"==typeof s.imgPath&&(s.imgPath=19),"undefined"!=typeof s.objectState&&(t.each(["isGuarded","hasAlarm","hasFault","isOnline"],function(t){s[t]=s.objectState[t]}),delete s.objectState),"objStatus"in s||(s.objStatus=this.STATUS_SERVED),0===s.hasAlarm||i.alarmsAllowed(s.objStatus)||(s.hasAlarm=0),s.status=n.detectGuardStatus(s),s.hwStatus=n.detectHardwareStatus(s),s.coords=[s.lat||null,s.lon||null],s},isOnline:function(){return 1==this.get("isOnline")},getAreasWhere:function(e){return this.attributes.areas&&this.attributes.areas.length?t.filter(this.attributes.areas,function(i){var n=!0;return t.each(e,function(e,s){"undefined"!=typeof i[s]&&(n&=t.isBoolean(e)?!!i[s]==e:i[s]==e)}),n}):[]},getNotZeroAreas:function(e){if(!this.attributes.areas||!this.attributes.areas.length)return[];var i=e?this.getAreasWhere(e):this.attributes.areas;return t.filter(i,function(t){return 0!=t.num})},getRealAreasState:function(){return e.ajax({url:App.getBaseUrl()+"objects/state/",data:{imei:this.get("imei")}})},toggleGuard:function(t,i){var n=this,s=new e.Deferred;return t=parseInt(t),this.getRealAreasState().done(function(o){var r=o.state;t in r?i&&r[t]==n.HW_STATE_DISARMED||!i&&r[t]==n.HW_STATE_ARMED?e.ajax({url:App.getBaseUrl()+"objects/"+(i?"arm":"disarm")+"/",data:{imei:n.get("imei"),area:t},success:function(){s.resolve()},error:function(t){s.reject(t)}}):s.resolve():s.reject("Area does not exist.")}).fail(function(t){s.reject(t)}),s},loadFaults:function(){var t=this;return e.ajax({url:App.getBaseUrl()+"objects/obj-faults/",data:{objectId:this.id},success:function(e){t.set("faults",e)},error:function(){t.set("faults",null)
}})},resolveFaults:function(i){var n=this,s=new e.Deferred,o=[];return i?o[0]={faultCode:Number(i.code),areaZoneId:Number(i.zone)}:t.each(this.get("faults"),function(t){o.push({faultCode:t.faultCode,areaZoneId:t.areaZoneId})}),e.ajax({url:App.getBaseUrl()+"objects/clear-faults/",data:o,complete:function(e){if(e.status>=200&&e.status<300){if(i){var o=t.filter(n.get("faults"),function(t){return t.areaZoneId!=i.zone||t.faultCode!=i.code});o.length?n.set("faults",o):n.set({hasFault:!1,faults:null})}else n.set("faults",null);s.resolve()}else s.reject()}}),s},callDevice:function(){var t=new e.Deferred;return e.ajax({url:App.getBaseUrl()+"objects/obj-scan/",data:{objectId:this.id}}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t}});return n.detectGuardStatus=function(t){if("status"in t)return t.status;var e="green";return t.isGuarded&&(e=1==t.isGuarded?"blue":"greenblue"),e},n.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e="offline";return t.hasFault?e="fault":t.isOnline&&(e="online"),e},n}),define("_common/stat/StatObjectsCollection",["underscore","abstracts/ObjectsCollection","./StatObject"],function(t,e,i){var n=e.extend({constructor:function(){e.apply(this,arguments)},url:App.getBaseUrl()+"objects/obj/",model:i});return n}),define("_common/guards/Guard",["underscore","jquery","abstracts/Model","geo"],function(t,e,i,n){var s=i.extend({COORDS_EXPIRE_TIME:3e5,constructor:function(){i.apply(this,arguments)},defaults:{name:"",person:"",phone:"",comment:"",groupsIds:[],coords:[],coordinatesTime:null,lat:0,lon:0,speed:0,course:0,isOnline:!1,isGpsOnline:!1,hwStatus:"offline",guardCall:null,route:null,calledByMe:!1,isBound:!1},parse:function(t){var e=t.item||t.length&&t[0]||t;return e.coords=null,e.lat&&e.lon&&(e.coords=[e.lat,e.lon]),e.hwStatus=s.detectHardwareStatus(e),"guardCall"in e||(e.guardCall=null),o.setDistance.call(this),e},acceptedCall:function(){var t=this.get("guardCall");return t&&null!==t.acceptTs},arrived:function(){var t=this.get("guardCall");return t&&null!==t.arriveTs},hasTargetInfo:function(){var t=this.get("guardCall");return t&&"id"in t.target},cancelCall:function(){var t=this;return e.ajax({url:"fixtures/guard-cancel.json",data:{id:this.id}}).done(function(){t.set({guardCall:null})})}});s.detectHardwareStatus=function(t){if("hwStatus"in t)return t.hwStatus;var e="offline";return t.isGpsOnline=t.coordinatesTime>0&&+new Date-t.coordinatesTime<s.prototype.COORDS_EXPIRE_TIME,t.isGpsOnline&&t.isOnline?e="online":t.isOnline&&(e="fault"),e};var o={setDistance:function(){var t=this.get("guardCall"),e=this.get("coords");t&&e&&t.target.lat&&t.target.lon?this.set("distance",n.getDistanceBetweenPoints(e[0],e[1],t.target.lat,t.target.lon)):this.set("distance",null)}};return s}),define("_common/guards/GuardsCollection",["abstracts/ObjectsCollection","./Guard"],function(t,e){var i=t.extend({constructor:function(){t.apply(this,arguments)},url:function(){return App.getBaseUrl()+"guards/guard/"},model:e,idProp:"guardId"});return i}),define("_common/guards/update/GuardsUpdateModule",["underscore","abstracts/update/UpdateModule"],function(t,e){var i=e.prototype,n=e.extend({constructor:function(){e.apply(this,arguments)},defaults:t.extend({},i.defaults,{updatePeriod:15e3,idParam:"guardId",url:function(){return App.getBaseUrl()+"guards/guard/"}}),destroy:function(){this.stopListening(),App.unsubscribe(this)}});return n}),define("_common/guards/watched/views/GuardInfoView",["jquery","underscore","geo","jface","_common/guards/Guard","abstracts/View","text!../tmpl/baloon.html","text!../tmpl/baloonHeader.html","text!../tmpl/baloonFooter.html","text!../tmpl/callInfo.html"],function(t,e,i,n,s,o,r,a,l,h){o.prototype,r=e.template(r),a=e.template(a),l=e.template(l),h=e.template(h);var c=100,u=".guarddetails",d=o.extend({constructor:function(t){this.parent=t.parent,this.controller=t.controller,this.$content=null,this.$address=null,this.$callInfo=null,o.apply(this,arguments)},initialize:function(){this.$el.addClass("guard-info"),this.render(),this._bindEvents()},render:function(){var t=this,e=this.$el.find(".leaflet-popup-content");e.find(".contents").length||(e.html(this._renderHeader()+'<div class="contents"></div>'+this._renderFooter()),this.$content=this.$el.find(".contents")),t._renderContent(),t.$el.trigger("contentchange")},remove:function(){this.stopListening(),this.$el.off(u),this.$content&&this.$content.remove()},_bindEvents:function(){var t=this,e="click"+u,i=this.controller.get("parent").getMapsModule();this.listenTo(this.parent,"clear",function(){t.trigger("close")}),this._bindModelEvents(),this.$el.on(e,".icon-close",function(){t.trigger("close")}).on(e,".icon-target",function(){t.controller.trigger("itemzoom",t.model)}).on(e,".unwatch",function(){t.trigger("close"),t.controller.toggleItem(t.model.id)}).on(e,".target-info",function(){t.model.has("guardCall")&&App.trigger("needdevicehistory",t.model.get("guardCall").target)}),"undefined"!=typeof PRODUCTION&&this.$el.on("contextmenu",function(){return!1}),i&&(this.listenTo(i,"mapchanged",function(){p.onAddressChange.call(t)}),this.$el.on(e,".route-from",function(){t.trigger("close");var e=t.model.get("name");return i.openRouting([{type:"guard",text:e,model:t.model,lat:t.model.get("lat"),lon:t.model.get("lon")}],t.$el),!1})),this.on("searchstart",function(){t.$address&&t.$address.parent().addClass("loading")}).on("searchcomplete",function(){t.$address&&t.$address.parent().removeClass("loading")}).on("searchsuccess",function(e){t.model.set("address",e.address)}).on("searcherror",function(){var e=Math._round(t.model.get("lat"),4)+", "+Math._round(t.model.get("lon"),4);t.model.set("address",e)})},_bindModelEvents:function(){var t=this;e.each(["name","phone","person","comment"],function(i){t.listenTo(t.model,"change:"+i,function(n,s){t.$el.find("."+i).text(e.isNull(s)?"--":s)})}),t.listenTo(t.model,"change:speed",function(e,i){i=Math.round(i),2>i&&(i=0),t.$el.find(".speed").text(i)}).listenTo(this.model,"change:coords",function(e){var n=e.previous("lat"),s=e.previous("lon"),o=i.getDistanceBetweenPoints(n,s,e.get("lat"),e.get("lon"));o>c&&p.onAddressChange.call(t)}).listenTo(this.model,"change:coordinatesTime",function(i,n){t.$el.find(".coordsTime").text(e.isNull(n)?"--":t.formatDateTime(n))}).listenTo(this.model,"change:address",function(e,i){t.$address&&t.$address.text(i)}).listenTo(this.model,"change:guardCall",e.bind(p.onCallChange,this))},_renderHeader:function(){return a({i18n:this.controller.getTexts(),name:this.model.get("name")})},_renderContent:function(){if(this.$content){var t=this.model.get("coordinatesTime"),i=e.extend({},this.model.attributes,{i18n:this.controller.getTexts(),minSpeed:2,geoId:this.model.has("geoId")?this.model.get("geoId"):0,coordsTimeStr:t?this.formatDateTime(t):"--",addressStr:this.model.has("address")?this.model.get("address"):Math._round(this.model.get("lat"),4)+", "+Math._round(this.model.get("lon"),4)});this.$content.html(r(i)),this.$address=this.$el.find(".address"),this.$callInfo=this.$content.find(".call-info"),this.model.has("address")||p.onAddressChange.call(this),p.onCallChange.call(this)}},_renderFooter:function(){var t=this.controller.get("parent").getMapsModule();return l({i18n:this.controller.getTexts(),routingModule:t&&t.modules.routing||null})}}),p={onAddressChange:function(){this.$address&&this.$address.length&&this.controller.trigger("needgeoinfo",this.model.pick("lat","lon"),this)},onCallChange:function(){var t=this.controller.getTexts(),i="";if(this.model.has("guardCall")){var n=this.model.get("guardCall").target;n.id&&(i=App.buildObjTitle(n))}this.$callInfo.html(h(e.extend({},this.model.attributes,{i18n:t,targetTitle:i})))}};return d}),define("_common/guards/watched/views/GuardsMapView",["jquery","underscore","_common/guards/Guard","abstracts/watched/views/WatchedView","./GuardInfoView","text!../tmpl/mapIcon.svg"],function(t,e,i,n,s,o){var r=n.prototype,a=n.extend({constructor:function(){this._useClusters=!1,n.apply(this,arguments)},addWatchedMulti:function(t){if(t){var e,i,n=t.length,s=this.model.items,o=[];if(t.length){for(var r=this._cloneCurrentBounds();n--;)if(i=s.get(t[n])){var a=this.ensureCoords(i);this._bindModelEvents(i),(e=this._buildMapElement(i))&&o.push(e),a&&(r=this._extendBounds(r,i.get("lat"),i.get("lon")))}this._afterViewsBuilt(r)}o.length&&(null===this._singlesLayer?this._createSinglesLayer(o):this._singlesLayer.addLayers(o))}},_onModuleReady:function(){var t=this.model.items;if(t.length){var e,i=this,n=[],s=this._getNullBounds();t.each(function(t){var o=i.ensureCoords(t);i._bindModelEvents(t),(e=i._buildMapElement(t))&&n.push(e),o&&(s=i._extendBounds(s,t.get("lat"),t.get("lon")))}),t.length&&this.model.set("bounds",s,{zoom:!1}),this._createSinglesLayer(n)}},_bindModelEvents:function(t){var e=this;r._bindModelEvents.call(this,t),this.listenTo(t,"change:guardCall",function(t,i){var n=t.previous("guardCall");if(!i||!n){var s;(s=e._viewsMap[t.id])&&s.trigger("toggleclass",i?{on:"busy"}:{off:"busy"})}})},_buildMapElement:function(t){if(t.get("lat")&&t.get("lon")){var i=" guard "+t.get("hwStatus");t.get("speed")<2&&(i+=" park"),t.get("guardCall")&&(i+=" busy");var n=this._viewsMap[t.id]=this._maps.getWidget().buildComplexMarker({lat:t.get("lat"),lon:t.get("lon"),html:'<i class="i">'+o+'</i><span class="name">'+e.escape(t.get("name"))+"</span>",className:"complex-icon obj"+i,dataId:t.id,animated:!1,model:t});return this.model.get("showBaloon")&&this._bindPopup(n,t),n}},_placeOnMap:function(t){if(t.has("lat")&&t.has("lon")){var e=this._viewsMap[t.id],i=t.get("lat"),n=t.get("lon"),s={model:t,to:{lat:i,lon:n},animate:!1};e.trigger("place",s)}},_buildInfoView:function(t,e){this._infoView=new s({el:e,parent:this,controller:this.model,model:t})}});return a}),define("_common/guards/watched/GuardsWatchedModule",["underscore","abstracts/watched/WatchedModule","_common/guards/Guard","_common/guards/GuardsCollection","./views/GuardsMapView"],function(t,e,i,n,s){var o=e.prototype,r=e.extend({constructor:function(){this.items||(this.items=new n),e.apply(this,arguments)},_viewClass:s,getWatchedItemsIds:function(){var t,e=this.get("parent");return t=e.guards?e.guards.pluck("id"):this.getUserData("items"),t||[]},_bindEvents:function(){var t=this;o._bindEvents.call(this),this.off("change:objViewType").off("change:bounds").on("change:bounds",function(e,i,n){n&&n.zoom&&t.get("parent").getMapsModule().setBounds(i,{maxZoom:App.get("commonBoundsMaxZoom"),padding:App.get("commonBoundsPadding")})})}});return r});